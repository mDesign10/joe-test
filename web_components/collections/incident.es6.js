/*! Copyright (c) 2018 CommonTime Ltd */
/*! Build date: Thu Oct 25 2018 11:17:28 GMT+0100 (BST) */
/*! ================================= */
/*! Commit hash: a2a19de (a2a19de053b03b01ad3f167ac4790db0ee013ec6) */
/*! Commit date: Thu Oct 25 2018 11:17:19 GMT+0100 (BST) */
/*! Commit branch: belfast-enhancements */
/*! ================================= */

var _Mathpow=Math.pow,_Mathlog=Math.log,_Mathsqrt=Math.sqrt,_Mathmax=Math.max,_Mathmin=Math.min,_StringfromCharCode=String.fromCharCode,_Mathabs=Math.abs,_NumberMIN_VALUE=Number.MIN_VALUE,_NumberMAX_VALUE=Number.MAX_VALUE,_Mathfloor=Math.floor;(function(u){function f(E){if(h[E])return h[E].exports;var I=h[E]={i:E,l:!1,exports:{}};return u[E].call(I.exports,I,I.exports,f),I.l=!0,I.exports}var h={};return f.m=u,f.c=h,f.i=function(E){return E},f.d=function(E,I,R){f.o(E,I)||Object.defineProperty(E,I,{configurable:!1,enumerable:!0,get:R})},f.n=function(E){var I=E&&E.__esModule?function(){return E['default']}:function(){return E};return f.d(I,'a',I),I},f.o=function(E,I){return Object.prototype.hasOwnProperty.call(E,I)},f.p='',f(f.s=145)})([function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);var I=h(12);f.BaseIncidentEventArgs=I.BaseIncidentEventArgs;var R=h(92);f.RequestNewIncidentEventArgs=R.RequestNewIncidentEventArgs;var A=h(89);f.RaiseNewIncidentEventArgs=A.RaiseNewIncidentEventArgs;var M=h(93);f.RespondedToIncidentEventArgs=M.RespondedToIncidentEventArgs;var N=h(88);f.NewIncidentMessageReceievedEventArgs=N.NewIncidentMessageReceievedEventArgs;var D=h(79);f.ChangeIncidentSeverityEventArgs=D.ChangeIncidentSeverityEventArgs;var B=h(85);f.IncidentChangeEventArgs=B.IncidentChangeEventArgs;var H=h(87);f.IncidentResponseEventArgs=H.IncidentResponseEventArgs;var z=h(82);f.CloseIncidentEventArgs=z.CloseIncidentEventArgs;var $=h(86);f.IncidentEventArgs=$.IncidentEventArgs;var Y=h(84);f.IncidentAlertEventArgs=Y.IncidentAlertEventArgs;var G=h(94);f.RoleSelectionEventArgs=G.RoleSelectionEventArgs;var J=h(80);f.ChangeResponderStateEventArgs=J.ChangeResponderStateEventArgs;var W=h(81);f.ChangeResponseCollectionStateEventArgs=W.ChangeResponseCollectionStateEventArgs;var X=h(83);f.GenerateReportEventArgs=X.GenerateReportEventArgs;var K=h(91);f.ReportEventArgs=K.ReportEventArgs;var Q=h(90);f.ReportDownloadEventArgs=Q.ReportDownloadEventArgs;class Z extends E.BaseEvents{}Z._Request_NewIncident='request-new-incident',Z._Request_LaunchNewIncidentModal='request-launch-new-incident-modal',Z._Request_LaunchOfflineModal='request-launch-offline-modal',Z._Request_LaunchCloseIncidentModal='request-launch-close-incident-modal',Z._Request_RaiseNewIncident='request-send-new-incident',Z._Request_RespondToIncident='request-respond-to-incident',Z._Request_AcknowledgeIncidentUpdate='request-acknowledged-incident-update',Z._Request_ChangeIncidentSeverity='request-change-incident-severity',Z._Request_CloseIncident='request-close-incident',Z._Request_ChangeResponderState='request-change-responder-state',Z._Request_ChangeResponseCollectionState='request-change-response-collection-state',Z._Request_JoinRole='request-join-role',Z._Request_LeaveRole='request-leave-role',Z._Request_GenerateReport='request-generate-report',Z.NewIncident='new-incident',Z.IncidentUpdated='incident-updated',Z.IncidentResponse='incident-response',Z.IncidentSeverityChanged='incident-severity-changed',Z.IncidentClosed='incident-closed',Z.IncidentAlert='incident-alert',Z.IncidentAlertChange='incident-alert-change',Z.IncidentAlertDismissed='incident-alert-dismissed',Z.ReportRequested='report-requested',Z.ReportReady='report-ready',Z.ReportFailed='report-failed',Z.ReportDownloaded='report-downloaded',Z.RoleSelection='role-selection',Z.OnCallUsersChange='on-call-users-change',Z.UserLastSeenChange='user-last-seen-change',f.IncidentEvents=Z},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(72);f.AppMode=E.AppMode;var I=h(32);f.DefaultAlerts=I.DefaultAlerts;var R=h(73);f.ConnectionStatus=R.ConnectionStatus;var A=h(33);f.Icons=A.Icons;var M=h(74);f.RoomRole=M.RoomRole;var N=h(75);f.UserAdditionalDetailsType=N.UserAdditionalDetailsType},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(61);f.prop=E.prop;var I=h(60);f.Stroolean=I.Stroolean,f.NullableNumber=I.NullableNumber;var R=h(29);f.CTBaseComponent=R.CTBaseComponent;var A=h(58);f.CTLayerComponent=A.CTLayerComponent;var M=h(57);f.BaseLayer=M.BaseLayer;var N=h(13);f.Logger=N.Logger},function(u,f,h){'use strict';function A(Z,ee){return null===Z||void 0===Z?'':Q(Z).format(ee)}function B(Z){return Z.map((ee)=>{return ee instanceof Array?B(ee):'object'==typeof ee?Object.assign({},ee):ee})}function z(Z){return Z&&'object'==typeof Z&&!Array.isArray(Z)}function $(Z,...ee){if(!ee.length)return Z;const te=ee.shift();if(z(Z)&&z(te))for(const ne in te)z(te[ne])?(Z[ne]||Object.assign(Z,{[ne]:{}}),$(Z[ne],te[ne])):Object.assign(Z,{[ne]:te[ne]});return $(Z,...ee)}var K=this&&this.__awaiter||function(Z,ee,te,ne){return new(te||(te=Promise))(function(se,oe){function ae(le){try{de(ne.next(le))}catch(ce){oe(ce)}}function ie(le){try{de(ne['throw'](le))}catch(ce){oe(ce)}}function de(le){le.done?se(le.value):new te(function(ce){ce(le.value)}).then(ae,ie)}de((ne=ne.apply(Z,ee||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const Q=h(143);f.padLeft=function(Z,ee,te=' '){let ne=Z;const se=ee-Z.length;return 0<se&&(ne=Array(se+1).join(te)+ne),ne},f.generateRandomSixString=function(){let Z=0|46656*Math.random(),ee=0|46656*Math.random();return Z=('000'+Z.toString(36)).slice(-3),ee=('000'+ee.toString(36)).slice(-3),Z+ee},f.tokenReplace=function(Z,ee){if(!Z)return'';if(void 0===ee||null===ee)return Z;if(-1===Z.indexOf('${'))return Z;const te=(ne,se)=>{const oe=se.split('.');do;while(oe.length&&(ne=ne[oe.shift()]));return ne};return Z.replace(/\${([^{}]*)}/g,(ne,se)=>{const oe=te(ee,se);return'string'==typeof oe||'number'==typeof oe?oe:ne})},f.formatDate=A,f.formatDateForTimeOrDate=function(Z,ee=!1){if(null===Z||Z===void 0)return'';const te=Q().date(),ne=Q(Z).date();return te===ne?(ee&&'Today, '||'')+A(Z,'HH:mm'):A(Z,'DD/MM/YYYY HH:mm')},f.prettyDuration=function(Z){if(1e3>Z)return'< 1s';const ee=~~(Z/1e3);if(60>ee)return`${ee}s`;const te=~~(Z/1e3/60),ne=~~((Z-1e3*(60*te))/1e3);if(60>te)return`${te}m`+(ne&&` ${ne}s`||'');const se=~~(Z/1e3/60/60),oe=~~((Z-1e3*(60*(60*se)))/1e3/60);if(24>se)return`${se}h`+(oe&&` ${oe}m`||'');return`${~~(Z/1e3/60/60/24)} days`},f.enumFromString=function(Z){return Z||null},f.deepCloneArray=B,f.deepCloneObject=function(Z){return JSON.parse(JSON.stringify(Z))},f.isObject=z,f.mergeDeep=$,f.getMessageType=function(Z){const ee=Object.keys(Z);return ee[0]||null},f.getUsernameFromJid=function(Z){return-1<Z.indexOf('@')?Z.substring(0,Z.indexOf('@')):Z},f.validateVCardObject=function(Z){return Z&&0<Object.keys(Z).length},f.randomNumberBetween=function(Z,ee){return _Mathfloor(Math.random()*ee)+Z},f.sleep=function(Z){return K(this,void 0,void 0,function*(){return new Promise((ee)=>{setTimeout(ee,Z)})})}},function(u,f){'use strict';function I(D,B,H){return D?B:H}function A(D){const B=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;D=D.replace(B,function(z,$,Y,G){return $+$+Y+Y+G+G});const H=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(D);return H?{r:parseInt(H[1],16),g:parseInt(H[2],16),b:parseInt(H[3],16)}:null}Object.defineProperty(f,'__esModule',{value:!0}),f.renderIf=function(D,B){return I(D,B,null)},f.renderIfElse=I,f.buildStyles=function(D){const B=document.createElement('div');return Object.assign({},B.style,D)},f.hexToRgbaString=function(D){const B=A(D);return`rgba(${B.r}, ${B.g}, ${B.b}, 1)`},f.decideTextColorFromBgColor=function(D){const B=A(D);return 186<0.299*B.r+0.587*B.g+0.114*B.b?'#000000':'#ffffff'}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(128);f.CTAlertModalManager=E.CTAlertModalManager;var I=h(129);f.CTAlertModal=I.CTAlertModal;var R=h(37);f.CTButton=R.CTButton;var A=h(130);f.CTFilePicker=A.CTFilePicker;var M=h(131);f.CTIcon=M.CTIcon;var N=h(132);f.CTLoginForm=N.CTLoginForm;var D=h(133);f.CTOnlineIndicator=D.CTOnlineIndicator;var B=h(134);f.CTSelectionList=B.CTSelectionList;var H=h(135);f.CTTextbox=H.CTTextbox;var z=h(136);f.CTUserDisplay=z.CTUserDisplay},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(14);f.BaseEventArgs=E.BaseEventArgs;var I=h(62);f.CommsEventArgs=I.CommsEventArgs;var R=h(65);f.UserActivityEventArgs=R.UserActivityEventArgs;var A=h(66);f.UserConnectionStatusEventArgs=A.UserConnectionStatusEventArgs;var M=h(64);f.RoomParticipantUpdateEventArgs=M.RoomParticipantUpdateEventArgs;var N=h(63);f.ConnectionStatusEventArgs=N.ConnectionStatusEventArgs;class D{}D._Request_RaiseAlert='request-raise-alert',D._Request_CloseAlert='request-close-alert',D._Request_UpdateUISuppression='request-update-ui-suppression',D._Request_RedrawAllUIs='_request-redraw-all-uis',D._Request_Logout='request-logout',D._Request_Component_Clear_Data='request-component-clear-data',D._Request_ThemeChange='request-theme-change',D.ConnectionStatusChange='connection-status-change',D.OtherUserConnectionStatusChange='other-user-connection-status-change',D.CurrentUserVCardUpdate='current-user-vcard-update',D.RoomParticipantUpdate='room-participant-update',D.UserActivity='user-activity',D.LoginResult='login-result',D.LogoutResult='logout-result',D.LoginFormResult='login-form-result',D.BotResponseReceived='bot-response-received',f.BaseEvents=D},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(113);f.ResponseCollectionState=E.ResponseCollectionState;var I=h(112);f.ResponderState=I.ResponderState;var R=h(114);f.ResponseStatus=R.ResponseStatus;var A=h(110);f.IncidentStatus=A.IncidentStatus;var M=h(109);f.IncidentAction=M.IncidentAction;var N=h(115);f.StateChangeType=N.StateChangeType;var D=h(111);f.ReportStatus=D.ReportStatus;var B=h(108);f.Icons=B.Icons},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const I=h(31),R=h(95),A=h(96),M=h(97),N=h(98),D=h(99),B=h(100),H=h(101),z=h(34),$=h(102),Y=h(107),G=h(35),J=h(104),W=h(105),X=h(106),K=h(103);class Q extends I.BaseMessageType{}Q.HelloFromBot='hellofrombot',Q.NewIncident='newincident',Q.IncidentResponse='incidentresponse',Q.ChangeIncidentSeverity='changeincidentseverity',Q.CloseIncident='closeincident',Q.SetRole='setrole',Q.RemoveFromRole='removefromrole',Q.ChangeResponderState='changeresponderstate',Q.ChangeResponseCollectionState='changeresponsecollectionstate',Q.AcknowledgeIncidentUpdate='acknowledgeincidentupdate',Q.RequestReport='requestreport',Q.ReportReady='reportready',Q.ReportFailed='reportfailed',f.IncidentMessageType=Q;class Z extends I.BaseBotCommand{}Z.CanRequestIncident='canrequestincident',Z.GetRoleUsers='getroleusers',Z.GetLastSeen='getlastseen',f.IncidentBotCommands=Z,f.get=function(ee){return[new R.AcknowledgeIncidentUpdateHandler(ee),new A.ChangeIncidentSeverityHandler(ee),new M.ChangeResponderStateHandler(ee),new N.ChangeResponseCollectionStateHandler(ee),new D.CloseIncidentHandler(ee),new B.CommsConnectionHandler(ee),new H.HelloFromBotHandler(ee),new z.IncidentResponseHandler(ee),new $.NewIncidentHandler(ee),new Y.RoleSelectionHandler(ee),new G.RemoveFromRoleHandler(ee),new J.ReportFailedHandler(ee),new W.ReportReadyHandler(ee),new X.RequestReportHandler(ee),new K.RaiseNewIncidentHandler(ee)]}},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(M,N,D,B){return new(D||(D=Promise))(function(H,z){function $(J){try{G(B.next(J))}catch(W){z(W)}}function Y(J){try{G(B['throw'](J))}catch(W){z(W)}}function G(J){J.done?H(J.value):new D(function(W){W(J.value)}).then($,Y)}G((B=B.apply(M,N||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(31),R=h(3);class A extends I.BaseHandler{constructor(M){super(M)}callCreateBotMessage(M,N){return E(this,void 0,void 0,function*(){const D=this.createBotMessage(M,N);if(!D)return null;const B=this.layer.getCurrentUser();return B?(D.version=A.VERSION,D.senderjid=B.jid,D.senderresource=this.layer.getCurrentUserResource(),D.sendername=B.displayName,D):null})}callHandleMessage(M){return E(this,void 0,void 0,function*(){this._ensureValidVersion(M),yield this.handleMessage(M)})}_ensureValidVersion(M){const N=R.getMessageType(M.data),D=M.data[N];if(!D||!D.version||D.version>A.VERSION){const B=`Invalid message version ${D.version} for message "${N}" - expected ${A.VERSION}`;throw this.layer.logger.error(B,M),new Error(B)}}}A.VERSION=1,f.BaseIncidentHandler=A},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(77);f.CTILComponent=E.CTILComponent},function(u,f,h){'use strict';function D(le,ce,ue){const pe=Z(le,(me)=>me.responder.jid===ce);return pe?ue&&pe.responder.roleId!==ue?null:pe:null}function K(le,ce,ue){const pe=ue.find((fe)=>fe.id===ce.responder.roleId),me=pe&&pe.id||'___other___',ge=pe&&pe.name||'Other';let _e=le.responses.find((fe)=>fe.id===me);return _e||(_e={id:me,name:ge,status:null,received:null,date:null,eta:0,responses:[],state:[],collectionState:[]},le.responses.push(_e)),_e}function Q(le,ce){const ue=le.responses.findIndex((pe)=>pe.responses.some(ce));return-1===ue?null:le.responses[ue]}function Z(le,ce){const ue=le.responses.findIndex((me)=>me.responses.some(ce));if(-1===ue)return null;const pe=le.responses[ue].responses.findIndex(ce);return-1===pe?null:le.responses[ue].responses[pe]}function ee(le,ce){return ce.map((ue)=>{return{received:null,status:null,date:null,eta:0,responder:se(le,ue),state:[]}})}function te(le,ce,ue){const pe=le.findIndex((me)=>me.state===ce.state);ue===ae.StateChangeType.Add?(()=>{-1===pe&&le.push(ce)})():ue===ae.StateChangeType.Remove?(()=>{-1!==pe&&le.splice(pe,1)})():ue===ae.StateChangeType.Update?(()=>{-1!==pe&&(le[pe]=ce)})():void 0}function ne(le){return le.map((ce)=>{return{id:ce.id,name:ce.name,status:null,received:null,date:null,eta:0,responses:ee(ce,ce.responders),state:[],collectionState:[]}})}function se(le,ce){return ce?{roleId:le.id,jid:ce.jid,name:ce.name,telephone:ce.telephone||null}:null}function oe(le){return le?{jid:le.jid,name:le.displayName||le.username,roleId:le.role&&le.role.id||null,telephone:le.telephone||null}:null}Object.defineProperty(f,'__esModule',{value:!0});const ae=h(7),ie=h(3),de=[ae.ResponseStatus.Transmitted,ae.ResponseStatus.Received,ae.ResponseStatus.Displayed,ae.ResponseStatus.Acknowledged,ae.ResponseStatus.Unable,ae.ResponseStatus.Attending];f.generatePrePopulatedResponders=function(le,ce){return le.map((ue)=>{const pe=ce.filter((me)=>me.role&&me.role.id===ue.id).map((me)=>{return{jid:me.jid,name:me.displayName||me.jid,telephone:me.telephone||null}});return{id:ue.id,name:ue.name,responders:pe}})},f.generateNewIncident=function(le,ce,ue,pe,me,ge,_e,fe,he,ye,Ce,Te){const ve=Te.config.roles,Se=!he?null:pe+he,be=ye.length?ne(ye):[];return{id:le,status:ae.IncidentStatus.Open,opened:{jid:ce,name:ue,date:pe},expirationDate:Se,closed:null,closedReasonId:null,priority:me,severity:ge,location:fe,patientType:_e,responses:be,actions:[],isTestIncident:Ce}},f.getAndUpdateResponseCollection=function(le,ce,ue,pe){let me=le.responses.find((_e)=>_e.id===ce.responder.roleId)||null;if(!me){if(!0===pe)return null;me=K(le,ce,ue)}let ge=me.responses.find((_e)=>_e.responder&&_e.responder.jid===ce.responder.jid);if(!ge){if(!0===pe)return null;ge=Object.assign({},ce),me.responses.push(ge)}return ge.date=ce.date,ge.status=ce.status,ge.eta=ce.eta,ce.status===ae.ResponseStatus.Received&&null===ge.received&&(ge.received=ce.date),me},f.aggregateResponseCollectionInformation=function(le){if(!le)return;let ce=null,ue=ae.ResponseStatus.Transmitted,pe=null,me=null,ge=[];le.responses.forEach((_e)=>{if((null==ce||_e.received<ce)&&(ce=_e.received),null!==_e.status){const fe=de.indexOf(ue),he=de.indexOf(_e.status);he>fe&&(ue=_e.status,pe=_e.date,me=_e.eta),he===fe&&((null===pe||_e.date<pe)&&(pe=_e.date),(null===me||_e.eta<me)&&(me=_e.eta))}ge=ge.concat(_e.state||[])}),le.received=ce,le.status=ue,le.date=pe,le.eta=me||0,ge.sort((_e,fe)=>fe.date-_e.date),le.state=ge},f.createUserResponse=function(le,ce,ue,pe){return ce?{status:ue,received:null,date:le,eta:pe,responder:oe(ce),state:[]}:null},f.findUserResponseCollection=function(le,ce){return Q(le,(ue)=>ue.responder.jid===ce)},f.findUserResponse=D,f.userHasResponded=function(le,ce){return!!Z(le,(ue)=>ue.responder.jid===ce)},f.isConcludedResponse=function(le){const ce=[ae.ResponseStatus.Acknowledged,ae.ResponseStatus.Unable,ae.ResponseStatus.Attending];return ce.includes(le)},f.processResponseCollectionStateChange=function(le,ce,ue,pe,me,ge,_e){const fe={jid:me,name:ge,date:_e,state:ce};null!==ue&&(fe.data=ue),te(le.collectionState,fe,pe)},f.processResponderStateChange=function(le,ce,ue,pe,me,ge,_e,fe){const he=D(le,ce);if(he){const ye={jid:ge,name:_e,date:fe,state:ue};null!==pe&&(ye.data=pe),te(he.state,ye,me)}},f.orderIncidents=function(le,ce,ue=!1){const pe=ie.deepCloneArray(le),me=ue?_NumberMAX_VALUE:_NumberMIN_VALUE,ge=ue?'':'\uE7FF';return pe.sort((_e,fe)=>{return'opened_date'===ce?fe.opened.date-_e.opened.date:'closed_date'===ce?(fe.closed&&fe.closed.date||me)-(_e.closed&&_e.closed.date||me):'expiration_date'===ce?(fe.expirationDate||me)-(_e.expirationDate||me):'priority'===ce?_e.priority.number-fe.priority.number:'severity'===ce?_e.severity.number-fe.severity.number:'patient_type'===ce?(_e.patientType&&_e.patientType.name||ge).localeCompare(fe.patientType&&fe.patientType.name||ge):'location'===ce?(_e.location&&_e.location.name||ge).localeCompare(fe.location&&fe.location.name||ge):0}),ue&&pe.reverse(),pe},f.filterIncidents=function(le,ce,ue){return le.filter((pe)=>{return'status'!==ce||('open'===ue?pe.status===ae.IncidentStatus.Open:'closed'!=ue||pe.status===ae.IncidentStatus.Closed)})},f.truncateIncidents=function(le,ce,ue,pe){let me=ie.deepCloneArray(le);if(0<ue&&0<pe){me=me.filter((_e)=>_e.opened.date>=pe-1e3*(60*(60*ue)))}return 0<ce&&(me=me.splice(0,ce)),me},f.orderIncidentRespondents=function(le,ce,ue=!1){const pe=ie.deepCloneArray(le),me=ue?_NumberMIN_VALUE:_NumberMAX_VALUE;return pe.sort((ge,_e)=>{return'date'===ce?(ge.date||me)-(_e.date||me):'eta'===ce?ge.eta-_e.eta:'status'===ce?de.indexOf(_e.status)-de.indexOf(ge.status):'as_supplied'===ce?0:0}),ue&&pe.reverse(),pe},f.filterIncidentResponses=function(le,ce,ue){return le.filter((pe)=>{return'status'!==ce||(()=>{const me=ue.split('|');if(me.includes('all'))return!0;const ge=me.map((_e)=>{return ie.enumFromString(_e)});return ge.includes(pe.status)})()})}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R){super(),this.incidentId=R}}f.BaseIncidentEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(3);var I;(function(A){A[A.Connectivity='connectivity']='Connectivity',A[A.MessageSent='message-sent']='MessageSent',A[A.MessageReceived='message-received']='MessageReceived',A[A.MessageUpdated='message-updated']='MessageUpdated',A[A.MessageChatMarker='message-chat-marker']='MessageChatMarker',A[A.IQSent='iq-sent']='IQSent',A[A.ProcessingReceived='processing-received']='ProcessingReceived',A[A.ProcessingUpdated='processing-updated']='ProcessingUpdated',A[A.ProcessingChatMarker='processing-chat-marker']='ProcessingChatMarker',A[A.Status='status']='Status',A[A.Presence='presence']='Presence',A[A.Participation='participation']='Participation',A[A.Mam='mam']='Mam',A[A.CleanUp='clean-up']='CleanUp',A[A.XmppClient='xmpp-client']='XmppClient',A[A.Events='events']='Events',A[A.DataStorage='data-storage']='DataStorage',A[A.Other='other']='Other'})(I=f.LoggerTypes||(f.LoggerTypes={}));f.Logger=class{constructor(A=null){this._types=A}log(A,...M){this.shouldLog(A)&&console.log.call(null,...M)}info(A,...M){this.shouldLog(A)&&console.info.call(null,...M)}debug(A,...M){this.shouldLog(A)&&console.debug.call(null,...M)}error(...A){console.error.call(null,...A)}getTypes(){return this._types}getTypesAsEnumValues(){return this._types.map((A)=>E.enumFromString(A))}setTypes(A){this._types=A||[]}shouldLog(A){return this._types&&this._types.length&&(!!this._types.includes('_all_')||this._types.includes(A.toString()))}}},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});f.BaseEventArgs=class{constructor(){this.eventDate=new Date().getTime()}}},function(u){u.exports=skate},function(u,f,h){'use strict';var E=this&&this.__decorate||function(z,$,Y,G){var J=arguments.length,W=3>J?$:null===G?G=Object.getOwnPropertyDescriptor($,Y):G,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,G);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>J?X(W):3<J?X($,Y,W):X($,Y))||W);return 3<J&&W&&Object.defineProperty($,Y,W),W},I=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(5),N=h(7),D=h(3),B=h(4);class H extends A.CTILComponent{static get is(){return'ct-il-incident-response-pill'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block}:host .response{position:relative;display:flex;align-items:center;font-size:14px;font-weight:400}:host .response .icon{flex:0 0 auto;display:flex;justify-content:center;align-items:center}:host .response .detail{flex:1;display:flex;justify-content:space-between}:host .response .detail .label{flex:1;text-align:left}:host .response .detail .time{flex:0 0 auto;text-align:right}:host .response.style-primary .icon{border-radius:15px;width:26px;height:26px;background-color:var(--response-status-empty-bg, #fff);border:var(--response-status-empty-border, 1px solid #ededed);color:var(--response-status-empty-color, #444)}:host .response.style-primary .detail .label{margin:0 5px}:host .response.style-primary.status-received .icon{background-color:var(--response-status-received-bg, #f2f2f2);border:var(--response-status-received-border, 1px solid #ededed);color:var(--response-status-received-color, #444)}:host .response.style-primary.status-acknowledged .icon{background-color:var(--response-status-acknowledged-bg, #797e80);border:var(--response-status-acknowledged-border, 1px solid #797e80);color:var(--response-status-acknowledged-color, #fff)}:host .response.style-primary.status-unable .icon{background-color:var(--response-status-declined-bg, #d0021c);border:var(--response-status-declined-border, 1px solid #d0021c);color:var(--response-status-declined-color, #fff)}:host .response.style-primary.status-attending .icon{background-color:var(--response-status-accepted-bg, #55950c);border:var(--response-status-accepted-border, 1px solid #55950c);color:var(--response-status-accepted-color, #fff)}:host .response.style-primary.status-arrived .icon{background-color:var(--response-status-arrived-bg, #55950c);border:var(--response-status-arrived-border, 1px solid #55950c);color:var(--response-status-arrived-color, #fff)}:host .response.style-primary.status-stand-in .icon{background-color:var(--response-status-stand-in-bg, #0fb1ca);border:var(--response-status-stand-in-border, 1px solid #0fb1ca);color:var(--response-status-stand-in-color, #fff)}:host .response.style-primary.status-off-duty .icon{background-color:var(--response-status-off-duty-bg, #9b9b9b);border:var(--response-status-off-duty-border, 1px solid #9b9b9b);color:var(--response-status-off-duty-color, #fff)}:host .response.style-secondary{padding:2px 10px;border-radius:15px;font-weight:400;background-color:var(--response-status-empty-bg, #fff);border:var(--response-status-empty-border, 1px solid #ededed);color:var(--response-status-empty-color, #444)}:host .response.style-secondary .detail{margin:0 5px}:host .response.style-secondary .detail .label{margin:0 5px}:host .response.style-secondary.icon-only{width:26px;height:26px;padding:0;justify-content:center}:host .response.style-secondary.status-received{background-color:var(--response-status-received-bg, #f2f2f2);border:var(--response-status-received-border, 1px solid #ededed);color:var(--response-status-received-color, #444)}:host .response.style-secondary.status-acknowledged{background-color:var(--response-status-acknowledged-bg, #797e80);border:var(--response-status-acknowledged-border, 1px solid #797e80);color:var(--response-status-acknowledged-color, #fff)}:host .response.style-secondary.status-unable{background-color:var(--response-status-declined-bg, #d0021c);border:var(--response-status-declined-border, 1px solid #d0021c);color:var(--response-status-declined-color, #fff)}:host .response.style-secondary.status-attending{background-color:var(--response-status-accepted-bg, #55950c);border:var(--response-status-accepted-border, 1px solid #55950c);color:var(--response-status-accepted-color, #fff)}:host .response.style-secondary.status-arrived{background-color:var(--response-status-arrived-bg, #55950c);border:var(--response-status-arrived-border, 1px solid #55950c);color:var(--response-status-arrived-color, #fff)}:host .response.style-secondary.status-stand-in{background-color:var(--response-status-stand-in-bg, #0fb1ca);border:var(--response-status-stand-in-border, 1px solid #0fb1ca);color:var(--response-status-stand-in-color, #fff)}:host .response.style-secondary.status-off-duty{background-color:var(--response-status-off-duty-bg, #9b9b9b);border:var(--response-status-off-duty-border, 1px solid #9b9b9b);color:var(--response-status-off-duty-color, #fff)}:host .response.style-simple{color:rgba(0,0,0,0.5)}:host .response.style-simple .icon{padding:5px 8px}:host .response.center .detail{justify-content:center}:host .response.center .detail .label{flex:none;text-align:right}:host .response.center .detail .time{flex:none;text-align:left}:host([collapsed]){display:inline-block}
        `}generateComponentMarkup(){if(null===this.status)return null;const z=''!==this.label,$=null!==this.date,Y=['response',`style-${this.pillStyle}`,`status-${this._getResponseStatusClassName()}`];this.center&&Y.push('center'),z||$||Y.push('icon-only');const G=this._getResponseStatusIcon();return window.__CTRender('div',{class:Y.join(' ')},window.__CTRender('div',{class:'icon'},window.__CTRender(M.CTIcon,{width:this.iconWidth,height:this.iconHeight,icon:G})),B.renderIf(z||$,window.__CTRender('div',{class:'detail'},B.renderIf(z,window.__CTRender('div',{class:'label'},this._getLabel())),B.renderIf($,window.__CTRender('div',{class:'time'},D.formatDate(this.date,'HH:mm'))))))}_getResponseStatusClassName(){switch(this.status){case N.ResponseStatus.Transmitted:return'transmitted';case N.ResponseStatus.Received:case N.ResponseStatus.Displayed:return'received';case N.ResponseStatus.Acknowledged:return'acknowledged';case N.ResponseStatus.Unable:return'unable';case N.ResponseStatus.Attending:return'attending';case N.ResponseStatus.Arrived:return'arrived';case N.ResponseStatus.StandIn:return'stand-in';case N.ResponseStatus.OffDuty:return'off-duty';default:return'unknown';}}_getResponseStatusIcon(){switch(this.status){case N.ResponseStatus.Transmitted:return N.Icons.STATUSES.Transmitted;case N.ResponseStatus.Received:case N.ResponseStatus.Displayed:return N.Icons.STATUSES.Received;case N.ResponseStatus.Acknowledged:return N.Icons.STATUSES.Acknowledged;case N.ResponseStatus.Unable:return N.Icons.STATUSES.Unable;case N.ResponseStatus.Attending:return N.Icons.STATUSES.Attending;case N.ResponseStatus.Arrived:return N.Icons.STATUSES.Arrived;case N.ResponseStatus.StandIn:return N.Icons.STATUSES.StandIn;case N.ResponseStatus.OffDuty:return N.Icons.STATUSES.OffDuty;default:return N.Icons.STATUSES.Transmitted;}}_getLabel(){if(this.label&&this.label.length)return this.label;switch(this.status){case N.ResponseStatus.Transmitted:return'Transmitted';case N.ResponseStatus.Received:case N.ResponseStatus.Displayed:return'Received';case N.ResponseStatus.Acknowledged:return'Acknowledged';case N.ResponseStatus.Unable:return'Unable';case N.ResponseStatus.Attending:return'Attend';case N.ResponseStatus.Arrived:return'Arrived';case N.ResponseStatus.StandIn:return'Stand In';case N.ResponseStatus.OffDuty:return'Off Duty';default:return'';}}}E([R.prop({type:Object,attribute:!0,default:null})],H.prototype,'status',void 0),E([R.prop({type:String,attribute:!0,default:null})],H.prototype,'label',void 0),E([R.prop({type:R.NullableNumber,attribute:!0,default:null})],H.prototype,'date',void 0),E([R.prop({type:String,attribute:!0,default:'primary'})],H.prototype,'pillStyle',void 0),E([R.prop({type:String,attribute:!0,default:'14px'})],H.prototype,'iconWidth',void 0),E([R.prop({type:String,attribute:!0,default:'14px'})],H.prototype,'iconHeight',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],H.prototype,'center',void 0),f.CTILIncidentResponsePill=H,H.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(H,z,$,Y){var G=arguments.length,J=3>G?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(J=(3>G?W(J):3<G?W(z,$,J):W(z,$))||J);return 3<G&&J&&Object.defineProperty(z,$,J),J},I=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(1),M=h(10),N=h(4),D=h(5);class B extends M.CTILComponent{static get is(){return'ct-il-online-status-pill'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:inline-flex}:host .indicator{position:relative;display:flex;align-items:center;padding:5px;border-radius:15px;font-size:14px;font-weight:300}:host .indicator.online{background:var(--primary-color, #15233b);color:var(--primary-font-color, #fff)}:host .indicator.offline{background:var(--primary-color-offline, #9b9b9b);color:var(--primary-font-color, #fff)}:host .indicator .label{margin:0 5px}
        `}generateComponentMarkup(){if(!this.status)return null;const H=this.status===A.ConnectionStatus.Connected,z=['indicator',H?'online':'offline'],$=H?A.Icons.COMMON.StatusOnline:A.Icons.COMMON.StatusOffline,Y=H?'Online':'Offline';return window.__CTRender('div',{class:z.join(' ')},window.__CTRender('div',{class:'icon'},window.__CTRender(D.CTIcon,{width:'16',height:'16',icon:$})),N.renderIf(this.showLabel,window.__CTRender('div',{class:'label'},Y)))}}E([R.prop({type:String,attribute:!0})],B.prototype,'status',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!0})],B.prototype,'showLabel',void 0),f.CTILOnlineStatusPill=B,B.register()},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(38),I=h(28),R=h(54),A=h(27),M=h(22),N=h(56),D=h(53),B=h(55),H=h(26);if(!window.Promise)throw new Error('ct-xmpp-client.js has a dependency on Promise, did you forget to include the polyfill?');if(!window.PouchDB)throw new Error('ct-xmpp-client.js has a dependency on PouchDB, please ensure PouchDB is included before ct-xmpp-client.js');class z{constructor($,Y,G){if(this._userDirectory=null,this._includeStanzaFilters=[],this._excludeStanzaFilters=[],this._pushNodeName=null,this._lastStatusId=null,this._pingInterval=null,this._pingTimeout=null,this._alreadyReLoggingIn=!1,this._reLoginTimeout=null,this._reLoginBackOff=3e3,this._forcedLogout=!1,this._sendTimeouts={},this._sendStanzaPromises={},this._destroyingDbs=!1,this._joinedRooms={},this._saveDebounce={},this._botCommandTimeouts={},this._botCommandPromises={},this._initialised=!1,!$)throw new Error('An instance ID must be provided.');this._instanceId=$;let J=localStorage.getItem(`${this._instanceId}_last_archive_id`);if(null===J&&(J='0'),this._lastArchiveId=J,!Y)throw new Error('XMPP server hostname must be provided.');this._serverTimeDiff=null,this._eventListeners={},this._options=z._merge({sendTimeout:3e5,debug:!1,perfLogging:!1,mucHost:null,uploadHost:null,echoHost:null,authAttachments:!1,mam:{auto:!0,defaultTimeLimit:2.628e9,pageSize:250},push:{enabled:!1,packageId:'',senderId:''},enablePing:!0,pingInterval:5e3,pingTimeout:1e4,connectTimeout:7e3,autoLogin:!1,autoReconnect:!0,autoMarkMessages:!0,encryption:!1,fileEncryption:!1,autoDownloadAttachmentTime:-1,autoPurgeOldMessagesAge:-1,autoPurgeOldMessagesCount:-1,streamResumption:!0,useEncodedJidAsResource:!1,adSpn:null,adSecurityPackage:null,adTokenPlaceholder:'[[AD_PASSWORD_TOKEN]]',updateUserDirectoryOnLogin:!1,enableMessageCarbons:!1,maxReconnectBackoff:3e5,stropheLogging:!1,forceIndexedDb:!1,bringToForegroundOnVoipPush:!0,updateUserDirectoryInterval:1800000,useConnectionEvents:!0,autoResumeTimers:!0,maxStreamResumptionTime:null},G),this._endpoint=Y,this._connection=null,this.connected=!1,this.loggedIn=!1,this._reLoggingIn=!1,this._loggingOut=!1,this._jid=null,this.resource=null,this._bareJid=null,this.username=null,this._userDirectory=new D.UsersDirectory(this._instanceId,this._options.debug),!0===this._options.stropheLogging&&(H.default.Strophe.log=(W,X)=>{this._log(`[${W}]: ${X}`)}),E.Promise.all([this._getInstallId(),this._initDbs()]).then(()=>{if(this._initialised=!0,this._log('XMPP client successfully initialised.'),this._dispatchEvent(z.EVENT_TYPES.INITIALISED,null),!0===this._options.autoLogin){const W=[this._getCacheItem('user_jid'),this._getCacheItem('user_password')];E.Promise.all(W).then((X)=>{const K=X[0],Q=X[1];void 0!==K&&void 0!==Q&&this._reLogin()}).catch((X)=>{this._onError('Unable to get jid/pw: '+X)})}}).catch((W)=>{throw new Error(W)}),this._options.useConnectionEvents&&(document.addEventListener('offline',()=>{this._onOffline()},!1),document.addEventListener('online',()=>{this._onOnline()},!1))}set sendTimeout($){$===this._options.sendTimeout||(this._options.sendTimeout=$)}get status(){return this._isMethodReady(!0),this._getCacheItem('connection_status')}get bareJid(){return this._bareJid}addIncludeStanzaFilter($){this._includeStanzaFilters.push($)}addExcludeStanzaFilter($){this._excludeStanzaFilters.push($)}_onOffline(){this._connection.disconnect('gone_offline')}_onOnline(){this.connected||this.reLoginNow()}_getInstallId(){const $='install_id';return new E.Promise((Y,G)=>{const J=localStorage.getItem(`${this._instanceId}_install_id`);if(null===J){let W=this;if('ios'===A.getPlatformName()){const X=M.getSource('securesettings');X.get((K)=>{if('string'==typeof K)W._installId=K,localStorage.setItem(`${W._instanceId}_install_id`,W._installId),Y();else{const Q=I.generateGuid();X.set(()=>{W._installId=Q,localStorage.setItem(`${W._instanceId}_install_id`,W._installId),Y()},(Z)=>{G(Z)},$,Q)}},(K)=>{W._log('Secure settings error:',K),G(K)},$)}else if('android'===A.getPlatformName()){const X=M.getSource('device');this._installId=X.uuid,localStorage.setItem(`${this._instanceId}_install_id`,this._installId),Y()}else{const X=I.generateGuid();W._installId=X,localStorage.setItem(`${this._instanceId}_install_id`,this._installId),Y()}}else return this._installId=J,Y()})}_initDbs(){return new E.Promise(($,Y)=>{const G={auto_compaction:!0,revs_limit:1};this._msgDb=new window.PouchDB(`${this._instanceId}_messages`,G),this._contactDb=new window.PouchDB(`${this._instanceId}_contacts`,G),this._cacheDb=new window.PouchDB(`${this._instanceId}_cache`,G),this._cache={},this._roomDb=new window.PouchDB(`${this._instanceId}_rooms`,G),this._participantDb=new window.PouchDB(`${this._instanceId}_participants`,G),!0===this._options.encryption?I.getEncryptionKey(this._instanceId).then((J)=>{this._cacheDb.crypto({key:J}),this._msgDb.crypto({key:J}),this._contactDb.crypto({key:J}),this._roomDb.crypto({key:J}),this._participantDb.crypto({key:J}),$()}).catch(Y):(console.warn('Encryption has not been enabled! If you have auto-reconnect, auto-login or authenticated attachments enabled your password will be stored unencrypted! \uD83D\uDE31'),$())})}_setStatus($,Y=!0,G=null){return new E.Promise((J,W)=>{if(this._lastStatusId===$)J();else{const X={id:$,label:null,reason:G};$===H.default.Strophe.Status.CONNECTING?X.label='Connecting':$===H.default.Strophe.Status.CONNFAIL?X.label='Connection failed':$===H.default.Strophe.Status.DISCONNECTING?X.label='Disconnecting':$===H.default.Strophe.Status.DISCONNECTED?X.label='Disconnected':$===H.default.Strophe.Status.CONNECTED?X.label='Connected':$===H.default.Strophe.Status.AUTHFAIL?X.label='Authentication failed.':$===H.default.Strophe.Status.ERROR?X.label=G||'An unknown error occurred.':void 0;this._lastStatusId!==X.id&&!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.STATUS,X),this._lastStatusId=X.id,this._setCacheItem('connection_status',X).then(J).catch(W)}})}static _isReasonToReconnect($){if(!$||'string'!=typeof $)return!0;let Y=!0;switch($.toLowerCase()){case'kicked by administrator':case'replaced by new connection':case'conflict':Y=!1;}return Y}static _translateCondition($){if(!$)return null;switch($.toLowerCase()){case'conflict':return'You already have an active session. Please log out of any previous sessions or wait for the previous login attempt to timeout.';case'system-shutdown':return'Remote server was shut down.';case'connection-timeout':return'The connection to the server timed out.';case'socket closed, probably due to no network connectivity.':case'invalid username or password':case'kicked by administrator':return $;default:return'Connection closed unexpectedly.';}}_connect($,Y){return new E.Promise((G,J)=>{this._connection&&this._connection.disconnect('make_sure',!0),this._connection=new H.default.Strophe.Connection(this._endpoint,{instance_id:this._instanceId}),this._connection.addHandler(this._onStanza.bind(this),null,'message'),this._connection.addHandler((K)=>{return this._onPresence(z.xmlToJson(K))},null,'presence');const W=setTimeout(()=>{this._connection._doDisconnect(),J('Connection took more than 5 seconds to be established, connection closed.')},this._options.connectTimeout),X=!0===this._options.streamResumption?this._getCacheItem('stream_management_id'):E.Promise.resolve();X.then((K)=>{this._connection.streamManagement.prevId=K;let Q=!1;this._forcedLogout&&(this._connection.override=!0,this._forcedLogout=!1),this._connection.connect($,Y,(Z,ee)=>{if(!0!==this._reLoggingIn&&this._setStatus(Z,!0,ee),!0==Q)return!1;switch(Z){case H.default.Strophe.Status.ERROR:case H.default.Strophe.Status.AUTHFAIL:case H.default.Strophe.Status.CONNFAIL:case H.default.Strophe.Status.DISCONNECTED:const te=z._translateCondition(ee);let ne='Connection Disconnected';Z===H.default.Strophe.Status.ERROR&&(ne='Connection Error',this._onError(ne,te)),Z===H.default.Strophe.Status.AUTHFAIL&&(ne='Authentication Failed'),Z===H.default.Strophe.Status.CONNFAIL&&(ne='Connection Failed'),null!==te&&(ne+=': '+te),0<Object.keys(this._sendTimeouts).length&&Object.keys(this._sendTimeouts).forEach((se)=>{this._log(`Pausing send timer for request with ID '${se}'...`);const oe=this._sendTimeouts[se];oe.paused||oe.pause()}),0<Object.keys(this._botCommandTimeouts).length&&Object.keys(this._botCommandTimeouts).forEach((se)=>{this._log(`Pausing bot command timer for request with ID '${se}'...`);const oe=this._botCommandTimeouts[se];oe.paused||oe.pause()}),clearTimeout(W),this.connected=!1,this._stopPing(),this._log('Disconnected:',ee),!1===this._loggingOut&&!0===this._options.autoReconnect&&Z!==H.default.Strophe.Status.AUTHFAIL&&!0===z._isReasonToReconnect(ee)&&(this._log('Attempting to re-login...'),this._reLogin()),Q=!0,J({msg:ne,status:Z,condition:ee});break;case H.default.Strophe.Status.CONNECTED:clearTimeout(W),this.connected=!0,G(ee);}})})})}_enableStreamManagement(){return new E.Promise(($,Y)=>{if(!1===this.connected||null===this._connection)Y('You must have an active connection to enable stream management');else{if(!this._connection.streamManagement)throw new Error('Stream management is required.');try{this._connection.addHandler((G)=>{return this._log('Stream resumption enabled!'),this._setCacheItem('stream_management_id',G.getAttribute('id')).then(()=>{$()}),!1},'urn:xmpp:sm:3','enabled'),this._connection.streamManagement.enable(this._options.maxStreamResumptionTime)}catch(G){console.error(G)}}})}_enableMessageCarbons(){return this.sendIq(null,'set',{enable:{$attributes:{xmlns:z.NAMESPACES.CARBONS},$value:''}})}_initialisePing(){return new E.Promise(($)=>{!0===this._options.enablePing&&(null!==this._pingInterval&&clearInterval(this._pingInterval),this._pingInterval=setTimeout(()=>{this._sendPing().then(()=>{this._initialisePing()}).catch(()=>{this._log('Ping failed.'),!0===this._options.autoReconnect&&(this._log('Auto-reconnect enabled, so let\'s try and reconnect!'),this._connection&&this._connection.disconnect('ping_timeout',!0),this._reLogin())})},this._options.pingInterval)),$()})}_sendPing(){return new E.Promise(($,Y)=>{this._pingTimeout=setTimeout(()=>{return this.connected?void(this.connected=!1,this._setStatus(H.default.Strophe.Status.DISCONNECTED),!0===this._options.autoReconnect&&this._setStatus(H.default.Strophe.Status.CONNECTING),Y()):void $()},this._options.pingTimeout),this.sendIq(this._domain,'get',{ping:{$attributes:{xmlns:z.NAMESPACES.PING}}}).then(()=>{clearTimeout(this._pingTimeout),$()}).catch(Y)})}_makeParticipantsOffline(){return new E.Promise(($,Y)=>{this._participantDb.allDocs({include_docs:!0}).then((G)=>{const J=G.rows.filter((W)=>{return!W.doc.language}).map((W)=>{return W.doc.online=!1,W.doc});this._participantDb.bulkDocs(J).then($).catch((W)=>{this._onError(`Unable to bulk update participants to offline status.`,W),Y(W)})}).catch((G)=>{this._onError(`Unable to get participants from database.`,G),Y(G)})})}_makeContactsOffline(){return new E.Promise(($,Y)=>{this.getContacts().then((G)=>{G.forEach((J)=>{J.online=!1}),this._contactDb.bulkDocs(G).then(function(){$()}).catch((J)=>{this._onError(`Unable to bulk update contacts to offline status.`,J),Y(J)})}).catch((G)=>{this._onError(`Unable to get contacts from database.`,G),Y(G)})})}resumeTimers(){0<Object.keys(this._sendTimeouts).length&&Object.keys(this._sendTimeouts).forEach(($)=>{const Y=this._sendTimeouts[$];Y.paused&&(this._log(`Resuming send timer for request with ID '${Y.id}'...`),Y.resume())}),0<Object.keys(this._botCommandTimeouts).length&&Object.keys(this._botCommandTimeouts).forEach(($)=>{const Y=this._botCommandTimeouts[$];Y.paused&&(this._log(`Resuming bot command timer for request with ID '${Y.id}'...`),Y.resume())})}reLoginNow(){if(!this._alreadyReLoggingIn){this._alreadyReLoggingIn=!0,this._clearReLoginTimeout();const $=[this._getCacheItem('user_jid'),this._getCacheItem('user_password')];E.Promise.all($).then((Y)=>{const G=Y[0],J=Y[1];void 0!==G&&void 0!==J&&(this._log(`Auto-logging in with JID '${G}'.`),this._setStatus(H.default.Strophe.Status.CONNECTING),this._login(G,J,!0).then((W)=>{this._reLoginBackOff=3e3,this._log(`Auto-login success.`),this._reLoggingIn=!1,this.connected=!0;const X=[];for(let K in this._joinedRooms)X.push(this.joinRoom(K));E.Promise.all(X).then(()=>{this._setStatus(H.default.Strophe.Status.CONNECTED).then(()=>{!1!==this._options.autoResumeTimers&&this.resumeTimers(),this._dispatchEvent(z.EVENT_TYPES.AUTO_RECONNECTED,{resumed:W}),this._alreadyReLoggingIn=!1}).catch((K)=>{this._alreadyReLoggingIn=!1,console.error('Couldn\'t set connection status:',K)})}).catch((K)=>{this._onError('Couldn\'t join all rooms on re-login, logging out.',K),this.logout(),this._alreadyReLoggingIn=!1})}).catch((W)=>{if(this._alreadyReLoggingIn=!1,W.status==H.default.Strophe.Status.AUTHFAIL){const X={id:H.default.Strophe.Status.DISCONNECTED,label:'Authentication Failed.',wontReconnect:!0,reason:W.condition};this._dispatchEvent(z.EVENT_TYPES.STATUS,X)}else this._reLoginBackOff+=3e3,this._reLoginBackOff>this._options.maxReconnectBackoff&&(this._reLoginBackOff=this._options.maxReconnectBackoff),this._log(`Couldn't re-login, trying again in ${this._reLoginBackOff/1e3} seconds...`),this._reLogin()}))})}}_reLogin(){if(!0!==this._loggingOut){if(this._reLoggingIn=!0,this._clearReLoginTimeout(),0<this._reLoginBackOff){const $={id:H.default.Strophe.Status.DISCONNECTED,label:'Disconnected',reconnectTime:this._reLoginBackOff};this._dispatchEvent(z.EVENT_TYPES.STATUS,$)}this._reLoginTimeout=setTimeout(()=>{this.reLoginNow()},this._reLoginBackOff)}}_clearReLoginTimeout(){null!==this._reLoginTimeout&&(clearTimeout(this._reLoginTimeout),this._reLoginTimeout=null)}_stopPing(){null!==this._pingTimeout&&clearTimeout(this._pingTimeout),null!==this._pingInterval&&clearInterval(this._pingInterval)}_createPresenceObject(){return new E.Promise(($)=>{const Y={$attributes:{from:this._jid,xmlns:z.NAMESPACES.JABBER_CLIENT}};Y.show='chat',Y.status='Available',this._getCacheItem('chat_status').then((G)=>{G!==void 0&&(G.status&&(Y.show=G.status),G.label&&(Y.status=G.label),G.metadata&&(Y.metadata=z._merge({$attributes:{xmlns:z.NAMESPACES.CT_METADATA}},G.metadata))),$(Y)})})}_sendPresence(){this._createPresenceObject().then(($)=>{if(this._connection.send(z.jsonToXml('presence',$)),!!this._options.mucHost)for(let Y in this._joinedRooms){$.$attributes.to=`${Y}@${this._options.mucHost}`,$.x={$attributes:{xmlns:z.NAMESPACES.MUC}};const G=z.jsonToXml('presence',$);this._connection.send(G)}})}getServerTime(){return this._isMethodReady(!0,!0),new E.Promise(($,Y)=>{this.sendIq(this._domain,'get',{time:{$attributes:{xmlns:z.NAMESPACES.TIME}}}).then((G)=>{if(void 0!==G.iq.time&&G.iq.time.utc){const J=new Date(G.iq.time.utc).valueOf(),W=Date.now();this._serverTimeDiff=J-W}$(this._serverTimeDiff)}).catch(Y)})}getSyncedTimestamp($){if(null===this._serverTimeDiff)return $;const Y=_Mathabs(this._serverTimeDiff);return 0<=this._serverTimeDiff?$+Y:$-Y}login($,Y){return this._login($,Y,!1)}_login($,Y,G=!1){if(this._isMethodReady(!0),!$)throw new Error('Parameter \'jid\' must be provided.');if(!Y)throw new Error('Parameter \'password\' must be provided.');return!0===this._reLoggingIn&&!1===G&&(this._clearReLoginTimeout(),this._reLoggingIn=!1),this._loggingOut=!1,new E.Promise((J,W)=>{this._getInstallId().then(()=>{this._getCacheItem('user_jid').then((X)=>{if(!0===this.connected&&!0===this.loggedIn&&X===H.default.Strophe.getBareJidFromJid($))J(!1);else{const K=H.default.Strophe.getResourceFromJid($);if(null!==K)this.resource=K,this._jid=$,this._bareJid=H.default.getBareJidFromJid(this._jid);else{if(this._bareJid=$,!0===this._options.useEncodedJidAsResource)this.resource=btoa(this._bareJid);else{const ee=localStorage.getItem(`${this._instanceId}_resource`);null===ee?(this.resource=this._installId,localStorage.setItem(`${this._instanceId}_resource`,this.resource)):this.resource=ee}this._jid=this._bareJid+'/'+this.resource}const Q=()=>{this.loggedIn=!0,localStorage.removeItem(`${this._instanceId}_logging_in`)};this.username=H.default.Strophe.getNodeFromJid(this._jid),this._domain=this._bareJid.split('@')[1];const Z=()=>{let ee=!1;const te=null!==localStorage.getItem(`${this._instanceId}_logging_in`);te&&this._log('Previous login attempt failed, calling a force logout to clean-up.'),this.logout(te,!0).then(()=>{return this._embellishPasswordWithAdToken(Y)}).then((ne)=>{return this._connect(this._jid,ne).then((se)=>{ee='resumed'===se,localStorage.setItem(`${this._instanceId}_logging_in`,'true')})}).then(()=>{return!1==ee?this._enableStreamManagement():E.Promise.resolve()}).then(()=>{return!1==ee&&!0===this._options.enableMessageCarbons?this._enableMessageCarbons():E.Promise.resolve()}).then(()=>{return!1==ee?this.getServerTime():E.Promise.resolve()}).then(()=>{return!1==ee?this._setCacheItem('user_jid',this._bareJid):E.Promise.resolve()}).then(()=>{return new E.Promise((ne,se)=>{!1==ee&&(!0===this._options.autoReconnect||!0===this._options.autoLogin||!0===this._options.authAttachments)?this._setCacheItem('user_password',Y,!0).then(ne).catch(se):ne()})}).then(()=>{return ee?void 0:E.Promise.all([this._makeContactsOffline(),this._makeParticipantsOffline()])}).then(()=>{return new E.Promise((ne)=>{A.isDevice()&&this._options.push.enabled?this._getPushToken().then((oe)=>{return this.registerForPush(oe)}).then(()=>{ne()}).catch((oe)=>{this._log('Failed to register for push: '+oe),ne()}):ne()})}).then(()=>{return this._initialisePing()}).then(()=>{return!0===this._options.updateUserDirectoryOnLogin?this.updateUserDirectory():E.Promise.resolve()}).then(()=>{return!1==ee?this._getCacheItem('roster_version').then((ne)=>{return this.sendIq(this._bareJid,'get',{query:{$attributes:{xmlns:'jabber:iq:roster',ver:ne||''}}})}):E.Promise.resolve()}).then((ne)=>{return this._processRoster(ne)}).then(()=>{return new E.Promise((ne,se)=>{if(!1==ee&&!1!==this._options.mam.auto){const oe=this.getLastArchiveId();this.listSubscriptions().then((ae)=>{const ie=[];ae.forEach((de)=>{ie.push(this.queryMamByRoomName(de.name,!0,oe))}),E.Promise.all(ie).then(()=>{this.queryMam(null,oe).then(ne).catch((de)=>{this._onError(`Unable to query the MAM for missed messages.`,de),se(de)})}).catch((de)=>{this._onError(`Unable to query the MAM for missed messages in a subscribed room.`,de),se(de)})}).catch((ae)=>{this._onError(`Unable to get a list of subscriptions.`,ae),se(ae)})}else ne()})}).then(()=>{!1==ee&&this._sendPresence(),Q(),J(ee)}).catch((ne)=>{null!==this._connection&&!0===this._connection.connected&&(this._connection.disconnect('fail_during_login'),this._connection=null),this._onError(`Unable to complete login process with JID '${$}'.`,ne.msg),W(ne)})};void 0!==X&&X!==this._bareJid?this._clearDbsForNewUser().then(()=>{Z()}):Z()}}).catch(W)}).catch(W)})}logout($=!1,Y=!1){return new E.Promise((G,J)=>{const W=()=>{this._joinedRooms={},this._reLoggingIn=!1,this.connected=!1,this.loggedIn=!1,this._stopPing(),this._clearReLoginTimeout(),localStorage.removeItem(`${this._instanceId}_logging_in`);const X=[this._deleteCacheItem('stream_management_id')];!0!==Y&&X.push(this._deleteCacheItem('user_password')),E.Promise.all(X).then(()=>{this._loggingOut=!1,G()}).catch(J)};if(!0!==$&&(!1===this.connected||!0===this._loggingOut))G();else if(null!==this._connection&&!0===this._connection.connected&&!1===this._loggingOut){this._loggingOut=!0;const X=()=>{this._stopPing(),this._clearReLoginTimeout(),this._connection.disconnect('user_logout'),this._connection=null,W()};A.isDevice()&&this._options.push.enabled?this.disablePush().then(()=>{X()}):X()}else W()})}forceLogout(){return new E.Promise(($,Y)=>{this._forcedLogout=!0,this._loggingOut=!0,this._joinedRooms={},this._reLoggingIn=!1,this.connected=!1,this.loggedIn=!1,this._stopPing(),this._clearReLoginTimeout(),localStorage.removeItem(`${this._instanceId}_logging_in`),this._connection&&(this._connection.disconnect('user_logout'),this._connection=null),E.Promise.all([this._deleteCacheItem('stream_management_id'),this._deleteCacheItem('user_password')]).then(()=>{this._loggingOut=!1,$()}).catch(Y)})}resendMessage($){return this._isMethodReady(!0,!0),new E.Promise((Y,G)=>{this.getMessageById($).then((J)=>{this._log(`Resending message with ID '${$}':`,J);const W={$attributes:{id:J._id,to:J.recipient_id,from:J.sender_id,type:J.type,xmlns:z.NAMESPACES.JABBER_CLIENT},markable:{$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}},body:J.body,data:J.data,attachments:[]};void 0!==J.addresses&&(W.addresses={$attributes:{xmlns:z.NAMESPACES.ADDRESS},address:J.addresses}),J.attachments.forEach((X)=>{W.attachments.push({name:X.name,type:X.type,size:''+X.size,get:X.get})}),this.sendStanza(W).then(()=>{Y(J)}).catch(G)}).catch(G)})}_stanzaResponseHandler($,Y){this._sendTimeouts[$]&&(this._log(`Clearing send timeout for message with ID '${$}'.`),this._sendTimeouts[$].cancel(),delete this._sendTimeouts[$]),Y?this._rejectSendStanzaPromise($,Y):this._resolveSendStanzaPromise($)}_resolveSendStanzaPromise($,Y){this._sendStanzaPromises[$]&&(this._log(`Resolving send stanza promise for message with ID '${$}'.`),this._sendStanzaPromises[$].resolve(Y),delete this._sendStanzaPromises[$],this._sendTimeouts[$]&&delete this._sendTimeouts[$])}_rejectSendStanzaPromise($,Y){this._sendStanzaPromises[$]&&(this._log(`Rejecting send stanza promise for message with ID '${$}'.`),this._sendStanzaPromises[$].reject(Y),delete this._sendStanzaPromises[$],this._sendTimeouts[$]&&delete this._sendTimeouts[$])}sendStanza($,Y=!0){return this._isMethodReady(!0,!0),new E.Promise((G,J)=>{$.$attributes||($.$attributes={}),void 0===$.$attributes.id&&($.$attributes.id=this.getUniqueId());let W=$.$attributes.id;if(!0===this.connected&&null!==this._connection){this._sendStanzaPromises[W]={resolve:G,reject:J},this._sendTimeouts[W]=new B.default(W,()=>{const X=`Message with ID '${W}' was not received by the server within ${this._options.sendTimeout}ms.`;this._log(X,$),this._rejectSendStanzaPromise(W,X)},this._options.sendTimeout);try{void 0===$.$attributes&&($.$attributes={}),void 0===$.$attributes.from&&($.$attributes.from=this._jid),!0===Y&&($.store={$attributes:{xmlns:z.NAMESPACES.HINTS},$value:''}),$.timestamp={$attributes:{xmlns:z.NAMESPACES.CT_CLIENT_TIMESTAMP},$value:Date.now()};const X=z.jsonToXml('message',$);this._connection.send(X)}catch(X){const K='Unable to send XMPP message';this._onError(K,X),this._rejectSendStanzaPromise(W,K)}}else{const X='You\'re not currently connected, please connect and try again.';this._onError(X),this._rejectSendStanzaPromise(W,X)}})}_sendMessageWithAttachments($,Y){if(!this._options.uploadHost)throw new Error('Cannot send attachments without a upload host configured.');this._log(`Sending message with ID ${$._id} with attachments:`,Y);let G=E.Promise.resolve({});return Y.forEach((J,W)=>{G=G.then(()=>{return new E.Promise((X,K)=>{R.getFileSize(J).then((Q)=>{const Z={$attributes:{id:this.getUniqueId(),to:this._options.uploadHost,from:this._jid,type:'get',xmlns:z.NAMESPACES.JABBER_CLIENT},request:{$attributes:{xmlns:z.NAMESPACES.HTTP_UPLOAD},filename:J.name.replace('.encrypted',''),size:''+Q,"content-type":J.type}};this.sendIq(this._options.uploadHost,'get',Z).then(X).catch(K)}).catch((Q)=>{console.error(`Couldn't get file size for file with name '${J.name}'.`,Q),K(Q)})})}).then((X)=>{return new E.Promise((K)=>{!0===this._options.authAttachments?this._getCacheItem('user_password').then((Q)=>{return this._embellishPasswordWithAdToken(Q)}).then((Q)=>{K([X,{Authorization:'Basic '+btoa(this._bareJid+':'+Q),"Content-Type":J.type}])}):K([X,{"Content-Type":J.type}])})}).then((X)=>{const K=X[0],Q=X[1];return new E.Promise((Z,ee)=>{const te=K.iq.slot.put,ne=K.iq.slot.get;R.upload(J.path,te,ne,Q).then(()=>{this._dispatchEvent(z.EVENT_TYPES.UPLOAD_SUCCESS,$),Z(['transferred',ne,te])}).catch((se)=>{this._dispatchEvent(z.EVENT_TYPES.UPLOAD_FAILED,$);const oe=`Couldn't successfully upload file '${J.path}' to the server:`;this._onError(oe,se),ee({error:oe,message:$})})})}).then((X)=>{const K=X[0],Q=X[1],Z=X[2];return new E.Promise((ee,te)=>{this.saveMessage($._id,(ne)=>{return ne.attachments[W].state=K,ne.attachments[W].get=Q,ne.attachments[W].put=Z,A.isBrowser()&&(ne.attachments[W].path=Q),ne}).then(ee).catch(te)})})}),G.then(()=>{return this.resendMessage($._id)})}_prepareMessageAttachmentsForSend($,Y){return this._log('Preparing to send the following attachments:',Y),new E.Promise((G,J)=>{const W=[];Y.forEach((X)=>{W.push(new E.Promise((K,Q)=>{this._log('Getting file information for file:',X),R.getFileInfo(X).then((Z)=>{this._log('Got file info for file:',Z),K(Object.assign({get:'',put:'',state:'transferring'},Z))}).catch(Q)}))}),E.Promise.all(W).then((X)=>{this._messageStanzaToDbObject({message:$},{mine:!0,attachments:X}).then((K)=>{this._dispatchEvent(z.EVENT_TYPES.UPLOAD_STARTED,K),this._sendMessageWithAttachments(K,X).then(G).catch(J)}).catch(J)})})}sendChatMessage($,Y,G,J=[],W=!0){if(this._isMethodReady(!0,!0),!$)throw new Error('Parameter \'to\' is required.');if(this._options.mucHost&&-1<$.indexOf(this._options.mucHost))throw new Error('You are trying to send a peer-to-peer chat message to a room, please use the \'sendGroupChatMessage\' method instead.');return new E.Promise((X,K)=>{const Q={$attributes:{id:this.getUniqueId(),from:this._jid,to:$,type:'chat',xmlns:z.NAMESPACES.JABBER_CLIENT}};!0===W&&(Q.markable={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}}),null!==Y&&(Q.body=Y),null!==G&&(Q.data=G),1>J.length?this.sendMessage(Q).then(X).catch(K):this._prepareMessageAttachmentsForSend(Q,J).then(X).catch(K)})}sendMulticastMessage($,Y,G,J=[],W=!0){return this._isMethodReady(!0,!0),new E.Promise((X,K)=>{const Q={$attributes:{id:this.getUniqueId(),from:this._jid,to:`${this._options.multicastHost}`,type:'chat',xmlns:z.NAMESPACES.JABBER_CLIENT},addresses:{$attributes:{xmlns:z.NAMESPACES.ADDRESS},address:$.map((Z)=>{return{$attributes:Z}})}};!0===W&&(Q.markable={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}}),null!==Y&&(Q.body=Y),null!==G&&(Q.data=G),1>J.length?this.sendMessage(Q).then(X).catch(K):this._prepareMessageAttachmentsForSend(Q,J).then(X).catch(K)})}sendGroupChatMessage($,Y,G,J=[],W=!0,X=!1){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' is required.');return new E.Promise((K,Q)=>{const Z={$attributes:{id:this.getUniqueId(),from:this._jid,to:`${$}@${this._options.mucHost}`,type:'groupchat',xmlns:z.NAMESPACES.JABBER_CLIENT}};!0===W&&(Z.markable={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS}}),null!==Y&&(Z.body=Y),null!==G&&(Z.data=G),!0!==X&&(Z.exclude={$attributes:{xmlns:z.NAMESPACES.INFINITY_MAM,archive:'user'}}),1>J.length?this.sendMessage(Z).then(K).catch(Q):this._prepareMessageAttachmentsForSend(Z,J).then(K).catch(Q)})}sendMessage($){return new E.Promise((Y,G)=>{this._messageStanzaToDbObject({message:$},{state:{sent:!1},mine:!0}).then((J)=>{this.sendStanza($).then(()=>{this.saveMessage(J._id,(W)=>{return W.state.sent=!0,W}).then(Y).catch(G)}).catch(G)}).catch(G)})}sendIq($,Y,G,J,W){this._isMethodReady(!0,!0);const X=W===void 0?this.getUniqueId():W;return new E.Promise((K,Q)=>{let Z=null;try{for(let ee in Z={$attributes:{id:X,type:Y,from:this._connection.jid}},$&&(Z.$attributes.to=$),G)Z[ee]=G[ee]}catch(ee){this._onError('Couldn\'t construct IQ message:',ee),Q(ee)}if(null!==Z){const ee=z.jsonToXml('iq',Z);this._connection.sendIQ(ee,(te)=>{try{K(z.xmlToJson(te))}catch(ne){this._onError('Couldn\'t convert IQ response to JSON.',ne),Q(ne)}},Q,J)}})}getPrivateData(){this._isMethodReady(!0,!0),this._log('Fetching Private XML Data for:',this._bareJid);const $={privatexmldata:{$attributes:{xmlns:z.NAMESPACES.CT_PRIVATE_XML_STORAGE}}};return new E.Promise((Y,G)=>{return this._getPrivateXMLStorage($).then((J)=>{J!==void 0&&J.privatexmldata!==void 0&&J.privatexmldata.json!==void 0?Y(JSON.parse(J.privatexmldata.json)):G('No private data found, or unable to fetch')})})}_getPrivateXMLStorage($){return this._log('Fetching Private XML Storage Data for: ',this._bareJid),new E.Promise((Y,G)=>{this.sendIq(this._bareJid,'get',{query:Object.assign({$attributes:{xmlns:z.NAMESPACES.PRIVATE_XML_STORAGE}},$)}).then((J)=>{this._log('Fetched Private XML Storage Data for:',this._bareJid),Y(J.iq.query)}).catch(()=>{G('Unable to send IQ for Private XML Storage')})})}setPrivateData($){this._isMethodReady(!0,!0),this._log('Setting Private XML data for:',this._bareJid);const Y=JSON.stringify($),G={privatexmldata:{$attributes:{xmlns:z.NAMESPACES.CT_PRIVATE_XML_STORAGE},json:Y}};return this._setPrivateXMLStorage(G)}_setPrivateXMLStorage($){const Y={query:Object.assign({$attributes:{xmlns:z.NAMESPACES.PRIVATE_XML_STORAGE}},$)};return new E.Promise((G,J)=>{this.sendIq(null,'set',Y).then(()=>{G(),this._log('Set Private XML Storage for:',this._bareJid)}).catch(J)})}_getvCard($){return this._log('\uD83C\uDCA1 Fetching vCard for:',$),new E.Promise((Y,G)=>{this.sendIq($,'get',{vCard:{$attributes:{xmlns:'vcard-temp'}}}).then((J)=>{this._log('Fetched vCard for:',$),Y(J.iq.vCard)}).catch(()=>{G('Unable to send IQ for vCard')})})}_setvCard($,Y){this._log('\uD83C\uDCA1 Setting vCard for:',$);const G=new DOMParser().parseFromString(Y,'text/xml'),J=z.xmlToJson(G);return new E.Promise((W,X)=>{this.sendIq(null,'set',J['#document']).then(()=>{W(),this._log('\uD83C\uDCA1 Set vCard for:',$)}).catch(X)})}addEventListener($,Y){if(!z._validateEventType($))throw new Error('Invalid event type provided.');$===z.EVENT_TYPES.INITIALISED&&!0===this._initialised?Y(null):(this._eventListeners[$]===void 0&&(this._eventListeners[$]=[]),this._eventListeners[$].push(Y))}removeEventListener($,Y){if(!z._validateEventType($))throw new Error('Invalid event type provided.');this._eventListeners[$]!==void 0&&this._eventListeners[$].forEach((G,J)=>{G===Y&&this._eventListeners[$].splice(J,1)})}_searchDb($,Y,G,J,W,X){return new E.Promise((K,Q)=>{const Z=[];for(let ee in Y)0===ee.indexOf('$')?-1<['$or','$and','$not','$nor','$all'].indexOf(ee)&&Array.isArray(Y[ee])&&0<Y[ee].length&&Y[ee].forEach((te)=>{for(let ne in te)Z.push(ne)}):Z.push(ee);0<Z.length&&$.createIndex({index:{fields:Z}}).then(()=>{let ee={selector:Y};Array.isArray(G)&&0<G.length&&(ee.sort=G),Array.isArray(J)&&0<J.length&&(ee.fields=J),X&&(ee.skip=X),W&&(ee.limit=W),$.find(ee).then((te)=>{K(te.docs)}).catch(Q)}).catch(Q)})}findMessages($,Y,G,J,W){return this._isMethodReady(!0),this._searchDb(this._msgDb,$,Y,G,J,W)}getAllMessageIds(){return this._isMethodReady(!0),new E.Promise(($,Y)=>{this._msgDb.allDocs().then((G)=>{let J=[];G.rows&&0<G.rows.length&&(J=G.rows.map((W)=>{return W.id})),$(J)}).catch(Y)})}getChatHistory($,Y,G,J,W){this._isMethodReady(!0);let X={$or:[{sender_id:$},{recipient_id:$}]};return!0===G&&(X['state.read']=!0),new E.Promise((K,Q)=>{this.findMessages(X,Y,null,J,W).then((Z)=>{const ee=Z.sort((te,ne)=>{return te.ts-ne.ts});K(ee)}).catch(Q)})}getMessagesById($){return this._msgDb.allDocs({include_docs:!0}).then((Y)=>{return Y.rows.filter((G)=>{return $.includes(G.id)})})}getMessageById($){if(this._isMethodReady(!0),!$)throw new Error(`A message ID must be provided.`);return this._msgDb.get($)}deleteMessage($,Y=!0){return this._isMethodReady(!0),new E.Promise((G,J)=>{if(!$)G();else{const W=[];Y&&void 0!==$.attachments&&$.attachments.forEach((X)=>{void 0!==X.path&&W.push(new E.Promise((K)=>{R.deleteFile(X.path).then(K).catch((Z)=>{this._onError(`Couldn't delete attachment: '${X.name}':`,Z),K()})}))}),E.Promise.all(W).then(()=>{this._msgDb.remove($).then(()=>{this._log('Message successfully deleted with ID:',$._id),G()}).catch((X)=>{this._onError(`Couldn't delete message with ID '${$._id}'.`,X),J(X)})}).catch((X)=>{this._onError(`Couldn't delete attachment(s) for message with ID '${$._id}':`,X),J(X)})}})}deleteMessageById($,Y=!0){return this._isMethodReady(!0),this._log('Deleting message with ID:',$),new E.Promise((G,J)=>{this.getMessageById($).then((W)=>{this.deleteMessage(W,Y).then(G).catch(J)}).catch((W)=>{this._onError(`Couldn't get message with ID '${$}' to delete it.`,W),J(W)})})}deleteMessages($){return this._isMethodReady(!0),new E.Promise((Y,G)=>{this._searchDb(this._msgDb,$).then((J)=>{this._log('\uD83D\uDDD1\uFE0F There are '+J.length+' messages to delete');const W=[];J.forEach((X)=>{W.push(this.deleteMessage(X))}),E.Promise.all(W).then(Y).catch((X)=>{this._onError(`Couldn't delete messages from database.`,X),G(X)})})})}deleteMessagesByRoom($){return console.warn('This method is going to be DEPRECATED, please use \'deleteMessagesByRoomName\' instead.'),this.deleteMessages({$or:[{sender_id:$},{recipient_id:$}]})}deleteMessagesByRoomName($){if(!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return this.deleteMessages({$or:[{sender_id:`${$}@${this._options.mucHost}`},{recipient_id:`${$}@${this._options.mucHost}`}]})}saveMessage($,Y){return this._isMethodReady(!0),new E.Promise((G,J)=>{this._saveObject(z.OBJECT_TYPES.MESSAGE,$,Y,(W)=>{G(W)},(W)=>{J(W)})})}_clearDbsForNewUser(){return new E.Promise(($,Y)=>{this.destroyDbs(!1).then(()=>{this._dispatchEvent(z.EVENT_TYPES.AUTO_DBS_DESTROYED,null),$()}).catch(Y)})}destroyDbs($=!0,Y=!1){return new E.Promise((G,J)=>{if(this._destroyingDbs)return void G();this._log('\uD83D\uDCA3 Destroying all databases and data...'),this._destroyingDbs=!0,this._lastArchiveId=null,localStorage.removeItem(`${this._instanceId}_last_archive_id`),this.resource=null,localStorage.removeItem(`${this._instanceId}_resource`),localStorage.removeItem(`${this._instanceId}_counters`),!0!==Y&&localStorage.removeItem(`${this._instanceId}_key`),localStorage.removeItem(`${this._instanceId}_logging_in`);const W=[this._msgDb.destroy(),this._contactDb.destroy(),this._roomDb.destroy(),this._participantDb.destroy()];!1!==M.getSource('file')&&W.push(R.deleteAttachments()),!0!==Y&&W.push(this._cacheDb.destroy()),W.push(new E.Promise((X,K)=>{this.initUserDirectory().then(()=>{localStorage.removeItem(`${this._instanceId}_ud_iv`),this._userDirectory.destroy().then(()=>{X()}).catch(K)})})),E.Promise.all(W).then(()=>{this._initDbs().then(()=>{!0===$&&this._dispatchEvent(z.EVENT_TYPES.DBS_DESTROYED,null),this._log('\u2705 Successfully destroyed all data.'),this._destroyingDbs=!1,G()}).catch((X)=>{this._destroyingDbs=!1,J(X)})}).catch((X)=>{this._destroyingDbs=!1,J(X)})})}deleteAttachments(){return R.deleteAttachments()}setChatStatus($,Y,G,J){return this._isMethodReady(!0),new E.Promise((W,X)=>{if(z._validateChatStatus($)){const K={status:$,label:Y,metadata:J};K.label||($===z.CHAT_STATUSES.CHAT?K.label='Available':$===z.CHAT_STATUSES.AWAY?K.label='Away':$===z.CHAT_STATUSES.XA?K.label='Extended Away':$===z.CHAT_STATUSES.DND?K.label='Do Not Disturb':void 0),this._setCacheItem('chat_status',K).then(()=>{!0===G&&this._sendPresence(),W(K)}).catch(X)}else X('Invalid chat status provided, one of \'away\', \'chat\', \'dnd\' or \'xa\' should be specified.')})}getChatStatus(){return this._isMethodReady(!0),this._getCacheItem('chat_status')}setClientState($){if(this._isMethodReady(!0,!0),!z._validateConstants(z.CLIENT_STATES,$))throw new Error('Invalid client state specified.');const Y=z.jsonToXml($,{$attributes:{xmlns:z.NAMESPACES.CLIENT_STATE_INDICATION}});return this._connection.send(Y)}findContacts($,Y,G,J,W){return this._isMethodReady(!0),this._searchDb(this._contactDb,$,Y,G,J,W)}getContacts(){return this._isMethodReady(!0),new E.Promise(($,Y)=>{this._contactDb.allDocs({include_docs:!0}).then((G)=>{const J=G.rows.filter((W)=>{return!W.doc.language}).map((W)=>{return W.doc});$(J)}).catch((G)=>{this._onError(`Unable to get contacts from database.`,G),Y(G)})})}_embellishPasswordWithAdToken($){if(!$)throw new Error('Password must be provided.');return new E.Promise((Y,G)=>{if(!0===A.isElectron()&&!0===A.isWindows()&&this._options.adTokenPlaceholder&&this._options.adSecurityPackage&&this._options.adSpn&&-1<$.indexOf(this._options.adTokenPlaceholder)){const J=M.getSource('sspiclient');!1===J?G('Couldn\'t access sspiclient plugin.'):J.Helper.getUserToken((W)=>{Y($.replace(this._options.adTokenPlaceholder,W))},G,this._options.adSpn,this._options.adSecurityPackage)}else Y($)})}_shouldMarkMessage($,Y){let G=!0;return!1!==$.markable&&($.state.markers.every((J)=>{if(J.type===Y){if('groupchat'===$.type&&J.sender_resource===this.username)return G=!1,!1;if(J.sender_id===this._jid)return G=!1,!1}return!0}),G)}_markMessage($,Y,G=!0){return new E.Promise((J,W)=>{if(!0===$.mine||!1===this._shouldMarkMessage($,Y))J($);else{const X={$attributes:{id:this.getUniqueId(),to:H.default.Strophe.getBareJidFromJid($.stanza.message.$attributes.from),from:this._connection.jid},timestamp:{$attributes:{xmlns:z.NAMESPACES.CT_CLIENT_TIMESTAMP},$value:Date.now()}};X[Y]={$attributes:{xmlns:z.NAMESPACES.CHAT_MARKERS,id:$._id}},'groupchat'===$.type&&(X.$attributes.type='groupchat'),this.sendStanza(X).then(()=>{this.saveMessage($._id,(K)=>{return K.state[Y]=!0,K}).then((K)=>{!1!==G&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,K),J(K)}).catch(W)}).catch(W)}})}markMessageRead($){return this._isMethodReady(!0,!0),this._markMessage($,z.MARKER_TYPES.READ)}markMessageReadById($){return this._isMethodReady(!0,!0),this.getMessageById($).then((Y)=>{return this.markMessageRead(Y)})}markMessageAcknowleged($){return this._isMethodReady(!0,!0),this._markMessage($,z.MARKER_TYPES.ACKNOWLEDGED)}markMessageAcknowledgedById($){return this._isMethodReady(!0,!0),this.getMessageById($).then((Y)=>{return this.markMessageAcknowleged(Y)})}_dispatchEvent($,Y){if(!z._validateEventType($))throw new Error('Invalid event type provided.');this._eventListeners[$]!==void 0&&this._eventListeners[$].forEach((G)=>{G(Y)})}createRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new E.Promise((Y,G)=>{const J=`${$}@${this._options.mucHost}`;let W={$attributes:{to:`${J}/${this.username}`,xmlns:z.NAMESPACES.JABBER_CLIENT},x:{$attributes:{xmlns:z.NAMESPACES.MUC}}};this._connection.addHandler((X)=>{const K=z.xmlToJson(X);if(void 0!==K.$attributes&&'error'===K.$attributes.type){const Q=new Error(`Failed to create room '${$}'.`);this._onError(`Unable to create room with name '${$}'.`,Q),G(Q)}else this.sendIq(J,'get',{query:{$attributes:{xmlns:z.NAMESPACES.MUC_OWNER}}}).then(()=>{this.sendIq(J,'set',{query:{$attributes:{xmlns:z.NAMESPACES.MUC_OWNER},x:{$attributes:{xmlns:z.NAMESPACES.X_DATA,type:'submit'},field:[{$attributes:{var:'muc#roomconfig_whois'},value:'anyone'}]}}}).then(()=>{this._log(`Room '${$}' successfully created.`),Y()}).catch(()=>G)}).catch(()=>G);return!1},z.NAMESPACES.MUC,'presence',null,null,`${J}/${this.username}`,{ignoreNamespaceFragment:!0}),this._connection.send(z.jsonToXml('presence',W))})}destroyRoom($){if(this._isMethodReady(!0,!0),!$)throw new Error('Parameter \'roomName\' must be provided.');if(!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new E.Promise((Y,G)=>{this.sendIq(`${$}@${this._options.mucHost}`,'set',{query:{$attributes:{xmlns:z.NAMESPACES.MUC_OWNER},destroy:{}}}).then(()=>{Y()}).catch(()=>G)})}listRooms($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new E.Promise((Y,G)=>{const J=()=>{this._roomDb.allDocs({include_docs:!0}).then((W)=>{const X=W.rows.map((K)=>{return K.doc});Y(X)}).catch((W)=>{this._onError(`Couldn't fetch list of rooms from database.`,W),G(W)})};!0===this.connected&&!1!==$?this.sendIq(this._options.mucHost,'get',{query:{$attributes:{xmlns:'http://jabber.org/protocol/disco#items'}}}).then((W)=>{if(W.iq&&W.iq.query&&W.iq.query.item){let X=[];X=Array.isArray(W.iq.query.item)?W.iq.query.item.map((K)=>{return{_id:K.$attributes.jid,name:H.default.Strophe.getNodeFromJid(K.$attributes.jid)}}):[{_id:W.iq.query.item.$attributes.jid,name:H.default.Strophe.getNodeFromJid(W.iq.query.item.$attributes.jid)}],this._roomDb.allDocs({include_docs:!0}).then((K)=>{const Q=[];K.rows.forEach((Z)=>{let ee=Z.doc,te=null;X.every((ne)=>{return ne._id!==ee._id||(te=ne,!1)}),null===te&&Q.push(this._roomDb.remove(ee))}),X.forEach((Z)=>{const ee=new E.Promise((te,ne)=>{this.saveRoom(Z._id,(se)=>{return void 0===se._id?se={_id:Z._id,name:Z.name,ts:this.getSyncedTimestamp(Date.now()),updated_at:null}:(se.name!==Z.name&&(se.name=Z.name),se.updated_at=this.getSyncedTimestamp(Date.now())),se}).then(te).catch(ne)});Q.push(ee)}),E.Promise.all(Q).then(()=>{J()}).catch((Z)=>{this._onError('Couldn\'t merge list of rooms from server with locally stored list of rooms.',Z),G(Z)})}),Y(X)}else Y([])}).catch(G):J()})}listSubscriptions(){return this._isMethodReady(!0,!0),new E.Promise(($,Y)=>{this._options.mucHost?this.sendIq(this._options.mucHost,'get',{subscriptions:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB}}}).then((G)=>{let J=[];G.iq&&G.iq.subscriptions&&G.iq.subscriptions.subscription&&(Array.isArray(G.iq.subscriptions.subscription)?J=G.iq.subscriptions.subscription.map((W)=>{if(W.$attributes&&W.$attributes.jid)return{name:H.default.Strophe.getNodeFromJid(W.$attributes.jid),jid:W.$attributes.jid}}):G.iq.subscriptions.subscription.$attributes&&G.iq.subscriptions.subscription.$attributes.jid&&(J=[{name:H.default.Strophe.getNodeFromJid(G.iq.subscriptions.subscription.$attributes.jid),jid:G.iq.subscriptions.subscription.$attributes.jid}])),$(J)}).catch(Y):$([])})}joinRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' must be provided.');return new E.Promise((Y,G)=>{const J=`${$}@${this._options.mucHost}`;this._createPresenceObject().then((W)=>{W.$attributes.to=`${J}/${this.username}`,W.x={$attributes:{xmlns:z.NAMESPACES.MUC},history:{$attributes:{maxchars:0}}},this._connection.addHandler((X)=>{try{const K=z.xmlToJson(X);K.presence&&void 0===K.presence.error?this.saveRoom(J,(Q)=>{return void 0===Q._id?Q={_id:J,name:$,ts:this.getSyncedTimestamp(Date.now()),updated_at:null}:Q.name!==$&&(Q.name=$,Q.updated_at=this.getSyncedTimestamp(Date.now())),Q}).then((Q)=>{this._joinedRooms[$]=Date.now(),!1===this._options.mam.auto?Y(Q):this.queryMamByRoomName($).then(()=>{Y(Q)}).catch(G)}).catch(G):(this._onError(`Couldn't join room '${$}' with nick '${this.username}'.`,X),G(X))}catch(K){this._onError('Couldn\'t convert stanza XML to JSON',K),G(K)}return!1},z.NAMESPACES.JABBER_CLIENT,'presence',null,null,`${$}@${this._options.mucHost}/${this.username}`,{ignoreNamespaceFragment:!0}),this._connection.send(z.jsonToXml('presence',W))})})}leaveRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' must be provided.');return new E.Promise((Y)=>{const G={$attributes:{from:this._jid,xmlns:z.NAMESPACES.JABBER_CLIENT,to:`${$}@${this._options.mucHost}/${this.username}`,type:'unavailable'}};this._connection.send(z.jsonToXml('presence',G)),delete this._joinedRooms[$],Y()})}subscribeToRoom($,Y){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');if(!$)throw new Error('Parameter \'roomName\' must be provided.');return new E.Promise((G,J)=>{const W={subscribe:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB,nick:this.username}}};if(!Y)for(let X in Y=[],z.MUC_NODES)Y.push(z.MUC_NODES[X]);0<Y.length&&(W.subscribe.event=[],Y.forEach((X)=>{W.subscribe.event.push({$attributes:{node:X}})})),this.sendIq(`${$}@${this._options.mucHost}`,'set',W).then((X)=>{X.iq&&X.iq.subscribe?G(X):this._onError(`Couldn't subscribe to room '${$}.'`,X)}).catch(J)})}listSubscribedUsersForRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new E.Promise((Y,G)=>{this.sendIq(`${$}@${this._options.mucHost}`,'get',{subscriptions:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB}}}).then((J)=>{let W=[];if(J.iq&&void 0!==J.iq.subscriptions)if(Array.isArray(J.iq.subscriptions.subscription))W=J.iq.subscriptions.subscription.map((X)=>{if(X.$attributes&&void 0!==X.$attributes.jid)return X.$attributes.jid});else if(void 0!==J.iq.subscriptions.subscription){const X=J.iq.subscriptions.subscription;X.$attributes&&void 0!==X.$attributes.jid&&(W=[X.$attributes.jid])}Y(W)}).catch(G)})}unsubscribeFromRoom($){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('mucHost must be provided as an option.');return new E.Promise((Y,G)=>{this.sendIq(`${$}@${this._options.mucHost}`,'set',{unsubscribe:{$attributes:{xmlns:z.NAMESPACES.MUC_SUB}}}).then(Y).catch(G)})}getRoomById($){if(this._isMethodReady(!0),!$)throw new Error(`A room ID must be provided.`);return this._log('Getting room with ID:',$),this._roomDb.get($)}findRooms($,Y,G,J,W){return this._isMethodReady(!0),this._searchDb(this._roomDb,$,Y,G,J,W)}saveRoom($,Y){return this._isMethodReady(!0),new E.Promise((G,J)=>{this._saveObject(z.OBJECT_TYPES.ROOM,$,Y,(W)=>{G(W)},(W)=>{J(W)})})}saveParticipant($,Y){return this._isMethodReady(!0),new E.Promise((G,J)=>{this._saveObject(z.OBJECT_TYPES.PARTICIPANT,$,Y,(W)=>{G(W)},(W)=>{J(W)})})}listParticipantsByRoom($){return this._isMethodReady(!0),this._searchDb(this._participantDb,{room_name:$})}getParticipantByRoomAndJid($,Y){return this._isMethodReady(!0),new E.Promise((G,J)=>{return this._searchDb(this._participantDb,{room_name:$,jid:Y}).then((W)=>{0<W.length?G(W[0]):G(null)}).catch(J)})}purgeParticipantsByUpdatedAt($){return this._isMethodReady(!0),new E.Promise((Y,G)=>{this._searchDb(this._participantDb,{updated_at:{$lt:$}}).then((J)=>{const W=J.map((X)=>{return this._participantDb.remove(X)});E.Promise.all(W).then(Y).catch(G)}).catch((J)=>{console.error(J)})})}_requestMessagesFromMam($,Y=null,G=!1,J=null,W,X=this._options.mam.pageSize){const K=(ee,te,ne,se,oe,ae=[],ie=null)=>{const de={query:{$attributes:{xmlns:z.NAMESPACES.MAM,queryid:ne},x:{$attributes:{xmlns:'jabber:x:data',type:'submit'},field:[{$attributes:{var:'FORM_TYPE',type:'hidden'},value:z.NAMESPACES.MAM}]},set:{$attributes:{xmlns:z.NAMESPACES.RESULT_SET_MANAGEMENT},max:''+X}}};if(this._log(`Querying the message archive for start date '${se}' and end date '${oe}'.`),null!==se||!0===G){let le='';!0===G&&(le+='inf_conv_mode'),null!==se&&(le+=se.toISOString()),de.query.x.field.push({$attributes:{var:'start'},value:le})}null!==oe&&de.query.x.field.push({$attributes:{var:'end'},value:oe.toISOString()}),null!==ie&&(de.query.set[!0===G?'before':'after']=ie),null!==J&&de.query.x.field.push({$attributes:{var:'with'},value:J}),this._connection.addHandler((le)=>{const ce=z.xmlToJson(le);try{if(void 0!==ce.message.result&&void 0!==ce.message.result.forwarded&&void 0!==ce.message.result.forwarded.message){const pe=ce.message.result.forwarded;void 0===ce.message.result.forwarded.message.archived&&void 0!==ce.message.result&&void 0!==ce.message.result.$attributes&&void 0!==ce.message.result.$attributes.id&&(pe.message.archived={$attributes:{by:H.default.Strophe.getBareJidFromJid(pe.message.$attributes.from),id:ce.message.result.$attributes.id,xmlns:z.NAMESPACES.MAM_TMP}}),ae.push(pe)}}catch(pe){return te(pe),!1}const ue=void 0!==ce.message.fin&&void 0!==ce.message.fin.$attributes&&ce.message.fin.$attributes.xmlns===z.NAMESPACES.MAM;return!0==ue&&('true'==ce.message.fin.$attributes.complete||!0===G?(this._log(`Finished paging through result set, got a total of '${ae.length}' items.`),ee(ae)):(this._log(`Paging through result set to get a total of '${ce.message.fin.set.count}' items.`),this._log(`Got '${ae.length}' items so far...`),K(ee,te,ne,se,oe,ae,ce.message.fin.set.last))),!ue},z.NAMESPACES.JABBER_CLIENT,'message',null,null,$),this.sendIq($,'set',de,null).catch((le)=>{this._onError('Couldn\'t query the MAM:',le),te(le)})};let Q=null,Z=null;if(null!==W){const ee=Date.now();if(W>=ee)throw new Error(`The start timestamp (${W}) cannot be equal to or larger than the end timestamp (${ee}).`);Q=new Date(W),Z=new Date(ee)}return new E.Promise((ee,te)=>{K(ee,te,this.getUniqueId(),Q,Z,[],Y)})}queryMam($,Y=null,G=null,J,W=!0){return this._isMethodReady(!0,!0),new E.Promise((X,K)=>{const Q=J||this._options.mam.defaultTimeLimit,Z=Date.now()-Q,ee=this.getSyncedTimestamp(Z-6e4);this._log(`Starting the MAM query process...`),this._perfStart('requestMessagesFromMam','Starting the first request for MAM messages','color: blue;'),this._requestMessagesFromMam($,Y,!1,G,ee).then((te)=>{this._perfEnd('requestMessagesFromMam','Finished getting all messages from the MAM','color: blue;'),this._processMamStanzas(te,W,!1).then(X).catch(K)}).then(()=>{if(0<this._options.autoPurgeOldMessagesAge)return this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}).then(()=>{if(0<this._options.autoPurgeOldRetainMessageCount)return this.purgeOldestMessagesLeavingCount(this._options.autoPurgeOldRetainMessageCount)}).catch(K)})}_processMamStanzas($,Y=!0,G=!1,J=!1){return new E.Promise((W,X)=>{const K=[],Q=[];if(0===$.length)W([]);else{this._perfStart('processMamMessages','Starting to process all messages received from the MAM','color: yellow; background: black;'),this._perfStart('preProcessMamMessages','Starting to pre-process all messages received from the MAM','color: darkgreen; background: grey;');let Z='0';$.forEach((se)=>{const oe={state:{sent:!0},fromMam:!1===G,injected:!0===G};let ae=!1;try{ae=void 0!==se.message.timestamp}catch(de){}if(!1==ae&&se.delay&&se.delay.$attributes.stamp){let de=null;try{de=new Date(se.delay.$attributes.stamp).getTime()}catch(le){console.error('Couldn\'t parse stanza timestamp to integer.')}null!==de&&(oe.ts=de)}const ie=this._getArchiveIdFromStanza(se);ie>Z&&(Z=ie),z._isMarkerMessage(se)?(this._stanzaResponseHandler(se.message.$attributes.id),Q.push(se)):se.message.$attributes&&'chat'===se.message.$attributes.type?K.push(this._messageDelta(se,{},oe)):se.message.$attributes&&'groupchat'===se.message.$attributes.type?(this._stanzaResponseHandler(se.message.$attributes.id),K.push(this._messageDelta(se,{},oe))):se.message.call&&se.message.call.$attributes&&se.message.call.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT?(this._log(`Processing bot command response from the MAM with request ID '${se.message.call.$attributes['request-id']}':`,se),this._botCommandResponseHandler(se.message.call.$attributes['request-id'],se)):se.message.error&&se.message.error.$attributes&&se.message.error.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT?this._botCommandResponseHandler(se.message.error.$attributes['request-id'],se):se.message.ack&&se.message.ack.$attributes&&se.message.ack.$attributes.xmlns===z.NAMESPACES.INFINITY_ACK&&this._stanzaResponseHandler(se.message.ack.$attributes['original-id'])}),this._perfEnd('preProcessMamMessages','Finished pre-processing messages from the MAM.','color: darkgreen; background: grey;'),this._perfStart('postProcessMamMessages','Start post-processing messages received from the MAM','color: lightgreen; background: grey;'),this._perfStart('addMarkersToMamMessages','Adding markers to messages','color: brown; background: #E1E1E1;');const ee=[];let te={};const ne={};for(let se in Q.forEach((se)=>{const oe=z._getMarkerType(se),ae=z._getMarkerMessageId(se,oe);ne[ae]||(ne[ae]=[]),ne[ae].push(se)}),ne){const oe=ne[se];let ae=null;K.every((ie)=>{return ie._id!==se||(ae=ie,!1)}),null===ae?ee.push(new E.Promise((ie)=>{this.getMessageById(se).then((de)=>{oe.forEach((le)=>{const ce=z._getMarkerType(le),ue=z._getMarkerMessageId(le,ce),pe=this._updateMessageMarkers(le,ce,de);!1===pe?this._setLastArchiveId(this._getArchiveIdFromStanza(le)):K.push(pe)}),ie()}).catch(()=>{this._log(`Not found message with id '${se}', creating message placeholder...`);let de=Object.assign({},z._messageSkeleton(),{_id:se,placeholder:!0,markable:!0,type:null});oe.forEach((le)=>{const ce=z._getMarkerType(le),ue=z._getMarkerMessageId(le,ce),pe=this._updateMessageMarkers(le,ce,de);!1!==pe&&(de=pe)}),K.push(de),ie()})})):oe.forEach((ie)=>{const de=z._getMarkerType(ie),le=z._getMarkerMessageId(ie,de),ce=this._updateMessageMarkers(ie,de,ae);!1!==ce&&(te[ae._id]=!0,ae=ce)})}E.Promise.all(ee).then(()=>{if(this._log('Messages to save from the MAM:',K),0===K.length)W([]);else{this._perfEnd('addMarkersToMamMessages','Finished adding markers to messages','color: brown; background: #E1E1E1;');const se=[];!0===J&&K.forEach((oe,ae,ie)=>se.push(this.saveMessage(oe._id,(de)=>{if(de._id)return ie.splice(ae,1),delete oe.state,Object.assign({},de,oe)}))),E.Promise.all(se).then(()=>{this._msgDb.bulkDocs(K).then((ae)=>{this._setLastArchiveId(Z),this._msgDb.bulkGet({docs:ae}).then((ie)=>{const de=ie.results.map((le)=>{const ce=le.docs[0].ok;return void 0===ce?null:(!1!==Y&&(null===ce.updated_at||!0===te[ce._id]?this._dispatchEvent(z.EVENT_TYPES.NEW_MESSAGE,ce):this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,ce)),!0===this._options.autoMarkMessages&&this._markMessage(ce,z.MARKER_TYPES.RECEIVED,Y),ce)});te={},this._perfEnd('postProcessMamMessages','Finished post-processing messages received from the MAM','color: lightgreen; background: grey;'),this._perfEnd('processMamMessages','Finished processing messages received from the MAM','color: yellow; background: black;'),W(de.filter((le)=>{return null!==le}))})}).catch((ae)=>{console.error(ae),X(ae)})})}})}})}processXmlStanzaStringsFromMam($,Y=!0){const G=new DOMParser,J=$.map((Q)=>G.parseFromString(Q,'text/xml').childNodes[0]),W=J.map((Q)=>z.xmlToJson(Q)),X={};W.forEach((Q)=>{try{const Z=Q.message.$attributes.id,ee=Q.message.$attributes.to.split('@')[0];X[ee]===void 0&&(X[ee]=[]),X[ee].push(Z)}catch(Z){console.error('The stanza wasn\'t in the expected format:',Z)}});const K=Object.keys(X).map((Q)=>{return this.getMessagesById(X[Q]).then((Z)=>{if(!(0<Z.length))return this._log(`Deleting all messages in room '${Q}' because it looks like there might be a gap in history...`),this.deleteMessagesByRoomName(Q)})});return E.Promise.all(K).then(()=>{return this._processMamStanzas(W,Y,!0)})}purgeOldMessages(){return this._isMethodReady(!0),this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}purgeMessagesOlderThan($){return this._isMethodReady(!0),this._log('\uD83D\uDDD1\uFE0F Removing messages older than: '+$),this.purgeMessagesFromBefore(this.getSyncedTimestamp(Date.now())-$)}purgeMessagesFromBefore($){return this._isMethodReady(!0),this._log('\uD83D\uDDD1\uFE0F Removing messages with timestamp before: '+new Date().toISOString()),this.deleteMessages({ts:{$lt:$}})}purgeOldestMessagesLeavingCount($){return this._isMethodReady(!0),this._log('\uD83D\uDDD1\uFE0F Want to restrict to: '+$+' messages in DB'),this._msgDb.info().then((Y)=>{this._log('\uD83D\uDDD1\uFE0F There are: '+Y.doc_count+' messages in DB');const G=Y.doc_count-$;if(0<G)return this._log('\uD83D\uDDD1\uFE0F Going to delete: '+G+' messages from DB'),this.purgeOldestMessagesCount(G)})}purgeOldestMessagesCount($){return this._isMethodReady(!0),this._msgDb.createIndex({index:{fields:['ts']}}).then(()=>{this._msgDb.find({selector:{},sort:['ts'],limit:$,fields:['_id']}).then((Y)=>{let G=E.Promise.resolve();return Y.docs.forEach((J)=>{G=G.then(()=>{return this._log('\uD83D\uDDD1\uFE0F Deleting message: '+J._id),this.deleteMessageById(J._id).then(()=>{this._log('\uD83D\uDDD1\uFE0F Deleted message: '+J._id)})})}),G})})}_setLastArchiveId($){$>this._lastArchiveId&&(this._lastArchiveId=$,localStorage.setItem(`${this._instanceId}_last_archive_id`,$))}getLastArchiveId(){return this._lastArchiveId}getLastArchiveIdForRoom($){if(this._isMethodReady(!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return new E.Promise((Y,G)=>{const J=`${$}@${this._options.mucHost}`;let W='0';this.getChatHistory(J).then((X)=>{if(0<X.length){const K=X.sort((Z,ee)=>{const te=ee.updated_at-Z.updated_at;return 0==te?ee.ts-Z.ts:te}),Q=K[0];W=Q.archive_id}Y(W)}).catch(G)})}getFirstArchiveIdForRoom($){if(this._isMethodReady(!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return new E.Promise((Y,G)=>{const J=`${$}@${this._options.mucHost}`;let W='0';this.getChatHistory(J).then((X)=>{if(0<X.length){const K=X.sort((Z,ee)=>{return Z.ts-ee.ts}),Q=K[0];W=Q.archive_id}Y(W)}).catch(G)})}queryMamByRoomName($,Y=!0,G=null){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return this._perfStart('queryMamByRoomName',`- Querying the MAM for room '${$}'`,'color: green;'),new E.Promise((J,W)=>{const X=`${$}@${this._options.mucHost}`,K=(Q)=>{this.queryMam(X,Q,null,null,Y).then((Z)=>{this._perfEnd('queryMamByRoomName',`- Finished querying the MAM for message in room '${$}'.`,'color: green;'),J(Z)}).catch(W)};null===G?this.getLastArchiveIdForRoom($).then((Q)=>{K(Q)}).catch(J):K(G)})}queryMamRoomHistoryByName($,Y=null,G=5,J=!0){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error('\'mucHost\' must be provided as an option.');return this._perfStart('queryMamRoomHistoryByName',`Querying MAM history for room '${$}'`,'color: purple;'),new E.Promise((W,X)=>{const K=`${$}@${this._options.mucHost}`;this._requestMessagesFromMam(K,Y,!0,null,null,G).then((Q)=>{this._perfEnd('queryMamRoomHistoryByName',`Finished querying the MAM history for '${G}' messages in the '${$}' room.`,'color: purple;'),this._processMamStanzas(Q,J,!1,!0).then(W).catch(X)}).then(()=>{if(0<this._options.autoPurgeOldMessagesAge)return this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}).then(()=>{if(0<this._options.autoPurgeOldRetainMessageCount)return this.purgeOldestMessagesLeavingCount(this._options.autoPurgeOldRetainMessageCount)}).catch(X)})}queryMamByRecipient($,Y=!0){return this._isMethodReady(!0,!0),new E.Promise((G,J)=>{this.getChatHistory($).then((W)=>{let X=null;if(0<W.length){const K=W.sort((Z,ee)=>{const te=ee.updated_at-Z.updated_at;return 0==te?ee.ts-Z.ts:te}),Q=K[0];X=Q.archive_id}this.queryMam(null,X,$,null,Y).then(G).catch(J)}).catch(()=>console.error)})}_saveObject($,Y,G,J,W){if(this._destroyingDbs){const K=`Couldn't save '${$}' because the databases are being destroyed.`;return this._log(K),void(W&&W(K))}let X=null;if($===z.OBJECT_TYPES.MESSAGE?X=this._msgDb:$===z.OBJECT_TYPES.CONTACT?X=this._contactDb:$===z.OBJECT_TYPES.ROOM?X=this._roomDb:$===z.OBJECT_TYPES.PARTICIPANT?X=this._participantDb:$===z.OBJECT_TYPES.CACHE_ITEM?X=this._cacheDb:void 0,null===X)throw new Error(`The object type provided (${$}) is not valid.`);void 0===this._saveDebounce[$]&&(this._saveDebounce[$]={}),this._saveDebounce[$][Y]?setTimeout(()=>{this._saveObject($,Y,G,J,W)},250):(this._saveDebounce[$][Y]=!0,X.upsert(Y,G).then((K)=>{void 0===K.rev?(delete this._saveDebounce[$][Y],J&&J(null)):X.get(Y).then((Q)=>{delete this._saveDebounce[$][Y],J&&J(Q)}).catch((Q)=>{this._onError(`Couldn't get ${$} with ID '${Y}' after performing an update.`,Q),delete this._saveDebounce[$][Y],W&&W(Q)})}).catch((K)=>{this._log(`Couldn't update ${$} with ID '${Y}'.`,K),delete this._saveDebounce[$][Y],W&&W(K)}))}doDownload($){return new E.Promise((Y,G)=>{const J=(W)=>{R.download($,W).then((X)=>{var K=M.getSource('fileEncryption');A.isDevice()&&this._options.fileEncryption&&K?K.encrypt(function(Q){X.source=Q,Y(X)},function(Q){G(Q)},X.source):Y(X)}).catch(G)};!0===this._options.authAttachments?this._getCacheItem('user_password').then((W)=>{return this._embellishPasswordWithAdToken(W)}).then((W)=>{J({Authorization:'Basic '+btoa(this._bareJid+':'+W)})}):J(null)})}downloadAttachment($,Y,G=!0){return this._isMethodReady(!0,!0),new E.Promise((J,W)=>{if(Y>$.attachments.length-1)return W('No such attachment: '+Y);const X=$.attachments[Y];void 0===X.path?this.doDownload(X.get).then((K)=>{X.path=K.source,X.state='transferred',this.saveMessage($._id,(Q)=>{return Q.attachments[Y]=X,Q}).then((Q)=>{!1!==G&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,Q),J()})}).catch(W):J()})}initUserDirectory(){return new E.Promise(($,Y)=>{if(!0===this._userDirectory.initialised)$();else{let G=null,J=localStorage.getItem(`${this._instanceId}_ud_iv`);if(null==J){G=window.crypto.getRandomValues(new Uint8Array(16));let W=[];for(let K=0;16>K;K++)W.push(_StringfromCharCode(G[K]));const X=W.join('');localStorage.setItem(`${this._instanceId}_ud_iv`,X)}else{const W=new Uint8Array(16);for(let X=0;X<J.length;X++)W[X]=J.charCodeAt(X);G=W}I.getEncryptionKey(this._instanceId).then((W)=>{this._userDirectory.initialise(W,G,this._options.userDirectoryEncryptionBlockSize||2e3).then($).catch(Y)})}})}_updateUserDirectoryTimer(){setTimeout(()=>{this.updateUserDirectory().then(($)=>{this._log(`👱🏼 Updated user directory: ${$}`)}).catch(($)=>{this._log(`👱🏼 Couldn't update user directory: ${$.message}`)})},this._options.updateUserDirectoryInterval)}updateUserDirectory(){return this.initUserDirectory().then(()=>{return this._log('\uD83D\uDC71\uD83C\uDFFC Updating user directory...'),this._getCacheItem('user_directory_hash').then(($)=>{const Y={query:{$attributes:{xmlns:z.NAMESPACES.DIRECTORY}}};return $&&(Y.query.$attributes.hash=$),this.sendIq(this._domain,'get',Y).then((G)=>{try{const J=G.iq.query.$attributes.url;return void 0===J?(this._updateUserDirectoryTimer(),`No change since last update.`):this._getCacheItem('user_password').then((W)=>{return this._embellishPasswordWithAdToken(W)}).then((W)=>{return this._userDirectory.update(this._bareJid,W,J).then((X)=>{return this._setCacheItem('user_directory_hash',X.hash).then(()=>{return this._log('\u2705 User directory successfully updated.'),this._updateUserDirectoryTimer(),X.msg})})})}catch(J){return this._updateUserDirectoryTimer(),E.Promise.reject('Couldn\'t obtain directory URL from server.')}})})}).catch(($)=>{return this._getCacheItem('user_directory_hash').then((Y)=>{return void 0===Y?E.Promise.reject($):this._deleteCacheItem('user_directory_hash').then(()=>{return this.updateUserDirectory().then((G)=>{return E.Promise.resolve(G)}).catch((G)=>{return E.Promise.reject(G)})})})})}searchUsers($,Y){return this.initUserDirectory().then(()=>{return this._userDirectory.search($,Y)})}getAllUsers(){return this.initUserDirectory().then(()=>{return this._userDirectory.getAllUsers()})}getUserByJid($){return this.initUserDirectory().then(()=>{return this._userDirectory.getUserByJid($)})}downloadAttachments($,Y=!0){return new E.Promise((G,J)=>{if(Array.isArray($.attachments)&&0<$.attachments.length){let W=E.Promise.resolve({});$.attachments.forEach((X,K)=>{W=W.then(()=>{return new E.Promise((Q,Z)=>{X.path===void 0?this.doDownload(X.get).then((ee)=>{$.attachments[K].path=ee.source,$.attachments[K].mediaType=R.getMediaTypeFromExtension(ee.source),$.attachments[K].state='transferred',Q()}).catch(Z):Q()})})}),W.then(()=>{this.saveMessage($._id,()=>{return $}).then((X)=>{!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,X),this._log(`Successfully updated message '${X._id}' with attachments.`,X),G(X)}).catch((X)=>{this._onError(`Unable to update message '${$._id}' with attachments:`,X),J(X)})}).catch((X)=>{this._onError('Unable to download all message attachments:',X),J(X)})}else G($)})}_processNewMessage($,Y,G=!0,J=!0){return this._perfStart(`processNewMessage (${$.message.$attributes.id.split('-')[0]})`,'Starting to process a new message','color: purple;'),new E.Promise((W,X)=>{this._setLastArchiveId(this._getArchiveIdFromStanza($)),this._messageStanzaToDbObject($,Y).then((K)=>{!1!==J&&(null===K.updated_at?this._dispatchEvent(z.EVENT_TYPES.NEW_MESSAGE,K):this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,K));const Q=this.getSyncedTimestamp(new Date().getTime())-K.ts;return Q<this._options.autoDownloadAttachmentTime||-1==this._options.autoDownloadAttachmentTime?this.downloadAttachments(K,J):K}).then((K)=>{$.message.markable&&!0===G&&!0===this._options.autoMarkMessages?this._markMessage(K,z.MARKER_TYPES.RECEIVED,J).then((Q)=>{this._perfEnd(`processNewMessage (${$.message.$attributes.id.split('-')[0]})`,'Finished processing a new message','color: purple;'),W(Q)}).catch(X):(this._perfEnd(`processNewMessage (${$.message.$attributes.id.split('-')[0]})`,'Finished processing a new message','color: purple;'),W(K))}).catch(X)})}_processGroupMessage($,Y,G=!0,J=!0){const W=z._merge({type:'groupchat',mine:H.default.Strophe.getBareJidFromJid($.message.$attributes.from)===this._bareJid||H.default.Strophe.getResourceFromJid($.message.$attributes.from)===this.username},Y);try{this._stanzaResponseHandler($.message.$attributes.id)}catch(X){this._onError(`Couldn't process stanza response handler for stanza:`,$)}return this._processNewMessage($,W,G,J)}_updateMessageMarkers($,Y,G){if(!G._id)return!1;if(!G.markable)return!1;const J=H.default.Strophe.getBareJidFromJid($.message.$attributes.from),W=H.default.Strophe.getResourceFromJid($.message.$attributes.from),X=G.state.markers.some((Q)=>{if(Q.type===Y&&(Q.sender_id===J&&Q.sender_resource===W||Q.sender_resource===this.bareJid))return!0});if(!0===X)return!1;const K={type:Y,sender_id:J,sender_resource:W,recipient_id:$.message.$attributes.to,ts:this._getTimestampFromStanza($),priority:z.MARKER_PRIORITIES[Y]};return G.state.markers.push(K),G.state.markers=G.state.markers.sort(function(Q,Z){return Q.priority===Z.priority?null!==Z.ts&&null!==Q.ts?Z.ts-Q.ts:void 0:Q.priority-Z.priority}),G.state[Y]=!0,!0!==G.state.sent&&(G.state.sent=!0),G.updated_at=this.getSyncedTimestamp(Date.now()),G}static _getMarkerType($){let Y=null;return $.message.received?Y=z.MARKER_TYPES.RECEIVED:$.message.read?Y=z.MARKER_TYPES.READ:$.message.acknowledged&&(Y=z.MARKER_TYPES.ACKNOWLEDGED),Y}static _getMarkerMessageId($,Y){return $.message[Y].$attributes!==void 0&&$.message[Y].$attributes.id!==void 0?$.message[Y].$attributes.id:null}_processMarkerMessage($,Y=!0){return new E.Promise((G,J)=>{this._setLastArchiveId(this._getArchiveIdFromStanza($));const W=z._getMarkerType($);if(null!==W){const X=z._getMarkerMessageId($,W);if(null!==X){this._log(`Processing marker of type '${W}' for message with ID '${X}':`,$),this._stanzaResponseHandler($.message.$attributes.id);const K=H.default.Strophe.getBareJidFromJid($.message.$attributes.from),Q=H.default.Strophe.getResourceFromJid($.message.$attributes.from);this.saveMessage(X,(Z)=>{return this._updateMessageMarkers($,W,Z)}).then((Z)=>{if(null!==Z){const ee={message_id:Z._id,message:Z,type:W,sender_id:K,sender_resource:Q};!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.RECEIPT_RECEIVED,ee),!1!==Y&&this._dispatchEvent(z.EVENT_TYPES.MESSAGE_UPDATED,Z),G(ee)}else G(null)}).catch(J)}}})}_processErrorMessage($){return new E.Promise((Y,G)=>{const J=$.message.$attributes&&$.message.$attributes.id?$.message.$attributes.id:null;if(null!==J){const W=$.message.error&&$.message.error.text&&$.message.error.text.$value?$.message.error.text.$value:`The server returned an error for stanza with ID '${J}'.`;this._onError(W,Object.assign({},$.message.error,{messageId:J})),this._stanzaResponseHandler(J,W),this.saveMessage(J,(X)=>{return void 0!==X._id&&(!0!==X.state.read&&!0!==X.state.received&&!0!==X.state.acknowledged?X.state.sent=!1:!0!==X.state.sent&&(X.state.sent=!0),X)}).then(()=>{Y({id:J,msg:W})}).catch(G)}else Y()})}_processAckMessage($){return new E.Promise((Y,G)=>{if($.message.ack&&$.message.ack.$attributes&&$.message.ack.$attributes['original-id']){const J=$.message.ack.$attributes['original-id'];this._stanzaResponseHandler(J),this._dispatchEvent(z.EVENT_TYPES.ACK_RECEIVED,J),this.saveMessage(J,(W)=>{return void 0!==W._id&&(!0!==W.state.sent&&(W.state.sent=!0),W)}).then(Y).catch(G)}else Y()})}_onStanza($){this.connected=!0,this._setStatus(H.default.Strophe.Status.CONNECTED);try{const Y=z.xmlToJson($);if(this._isFilteredOut(Y))return!0;if(this._log(`[1] - Processing stanza with ID '${Y.message.$attributes.id}':`,Y),Y.message.$attributes&&'chat'===Y.message.$attributes.type&&void 0!==Y.message.sent&&void 0!==Y.message.sent.$attributes&&Y.message.sent.$attributes.xmlns===z.NAMESPACES.CARBONS&&void 0!==Y.message.sent.forwarded)this._processNewMessage(Y.message.sent.forwarded,{state:{sent:!0}});else if(Y.message.$attributes&&'chat'===Y.message.$attributes.type)this._processNewMessage(Y);else if(Y.message.event&&Y.message.event.items){const G=(J)=>{z._isMarkerMessage(J)?(this._log(`[2] - Processing stanza with ID '${Y.message.$attributes.id}':`,Y),this._processMarkerMessage(J)):this._processGroupMessage(J)};Array.isArray(Y.message.event.items.item)?Y.message.event.items.forEach((J)=>{J.message&&J.message.$attributes&&'groupchat'===J.message.$attributes.type?G(J):J.presence&&this._onPresence(J)}):'object'==typeof Y.message.event.items.item&&Y.message.event.items.item.message&&Y.message.event.items.item.message.$attributes&&'groupchat'===Y.message.event.items.item.message.$attributes.type?G(Y.message.event.items.item):'object'==typeof Y.message.event.items.item&&Y.message.event.items.item.presence&&this._onPresence(Y.message.event.items.item)}else z._isMarkerMessage(Y)?(this._log(`[3] - Processing stanza with ID '${Y.message.$attributes.id}':`,Y),this._processMarkerMessage(Y)):Y.message.$attributes&&'groupchat'===Y.message.$attributes.type&&Y.message.$attributes.id?this._processGroupMessage(Y):Y.message.$attributes&&'error'===Y.message.$attributes.type?this._processErrorMessage(Y):void 0===Y.message.ack?Y.message.call&&Y.message.call.$attributes&&Y.message.call.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT?(this._log(`Processing bot command response with request ID '${Y.message.call.$attributes['request-id']}':`,Y),this._botCommandResponseHandler(Y.message.call.$attributes['request-id'],Y)):Y.message.error&&Y.message.error.$attributes&&Y.message.error.$attributes.xmlns===z.NAMESPACES.INFINITY_BOT&&this._botCommandResponseHandler(Y.message.error.$attributes['request-id'],Y):this._processAckMessage(Y)}catch(Y){this._onError('An error occurred when processing an incoming message stanza:',Y)}return!0}_isFilteredOut($){let Y=!0;return 0<this._includeStanzaFilters.length&&(Y=!1,this._includeStanzaFilters.some((G)=>{try{return G($)}catch(J){return this._log('Include filter function failed: '+J),this._onError('Include filter function failed: '+J),!1}})&&(Y=!0)),this._excludeStanzaFilters.some((G)=>{try{return G($)}catch(J){return this._log('Exclude filter function failed: '+J),this._onError('Exclude filter function failed: '+J),!1}})&&(Y=!1),!Y}_messageIsGroupChat($){return this._options.mucHost&&$.$attributes&&'string'==typeof $.$attributes.from&&-1<$.$attributes.from.indexOf(this._options.mucHost)}_onPresence($){if($.presence!==void 0){const Y=$.presence;if(Y.$attributes!==void 0&&Y.$attributes.from!==void 0){if('error'===Y.$attributes.type)return this._onError('An error from the server was received in a presence stanza:',Y),!0;const G=H.default.Strophe.getBareJidFromJid(Y.$attributes.from);if(!G)return!0;if(G===this._bareJid)this.setChatStatus(Y.show,Y.status,!1,Y.metadata);else{const J=z.getDomainFromJid(G);this._options.mucHost===J?this.saveParticipant(Y.$attributes.from,(W)=>{if(void 0!==W._id)try{if(W.show=Y.show,W.status=Y.status,W.online='unavailable'!==Y.$attributes.type,W.affiliation=Y.x.item.$attributes.affiliation,W.room_role=Y.x.item.$attributes.role,W.last_stanza=Y,void 0!==Y.metadata){const X=Y.metadata;delete X.$attributes,W.metadata=X}W.updated_at=this.getSyncedTimestamp(Date.now())}catch(X){this._onError(`Presence stanza wasn't in the expected format when trying to update participant with ID '${W._id}' and JID '${W.jid}'.`,X)}else try{if(W._id=Y.$attributes.from,W.jid=H.default.Strophe.getBareJidFromJid(Y.x.item.$attributes.jid),W.is_current_user=W.jid===this._jid,W.username=H.default.Strophe.getNodeFromJid(W.jid),W.room_name=H.default.Strophe.getNodeFromJid(Y.$attributes.from),W.affiliation=Y.x.item.$attributes.affiliation,W.room_role=Y.x.item.$attributes.role,W.online='unavailable'!==Y.$attributes.type,W.show=Y.show,W.status=Y.status,W.ts=this.getSyncedTimestamp(Date.now()),void 0!==Y.metadata){const X=Y.metadata;delete X.$attributes,W.metadata=X}W.updated_at=null,W.last_stanza=Y}catch(X){this._onError(`Presence stanza wasn't in the expected format when trying to create a new participant with ID '${W._id}' and JID '${W.jid}'.`,X)}return W}).then((W)=>{null===W.updated_at?this._dispatchEvent(z.EVENT_TYPES.NEW_PARTICIPANT,W):this._dispatchEvent(z.EVENT_TYPES.PARTICIPANT_UPDATED,W)}).catch((W)=>{this._onError('Couldn\'t upsert participant database.',W)}):this._saveObject(z.OBJECT_TYPES.CONTACT,G,(W)=>{if(void 0!==W&&(W.online='unavailable'!==Y.$attributes.type,void 0!==Y.show&&(W.show=Y.show),void 0!==Y.status&&(W.status=Y.status),void 0!==Y.metadata)){const X=Y.metadata;delete X.$attributes,W.metadata=X}return W},(W)=>{let X=!1;Y.x&&Y.x.$attributes&&Y.x.$attributes.xmlns&&Y.x.$attributes.xmlns===z.NAMESPACES.VCARD_UPDATE&&void 0!==Y.x.photo&&'string'==typeof Y.x.photo&&(void 0===W.avatarHash||W.avatarHash!==Y.x.photo)&&(X=!0,this._log('\uD83C\uDCA1 Avatar update for:',G),this._log('\uD83C\uDCA1 New avatar hash:',Y.x.photo),this.updatevCardForContact(G).then(()=>{this._saveObject(z.OBJECT_TYPES.CONTACT,G,(K)=>{return K.avatarHash=Y.x.photo,K},(K)=>{this._dispatchEvent(z.EVENT_TYPES.PRESENCE_UPDATE,K)},(K)=>{this._onError('Couldn\'t update contact with vCard: ',K)})}).catch((K)=>{this._onError('Couldn\'t get updated vCard for contact: ',K)})),!1==X&&this._dispatchEvent(z.EVENT_TYPES.PRESENCE_UPDATE,W)},(W)=>{this._onError('Couldn\'t upsert contacts database.',W)})}}}return!0}getContactByJid($){return this._isMethodReady(!0),new E.Promise((Y,G)=>{this.findContacts({id:$}).then((J)=>{let W=J[0];void 0===W?G('No contact found: '+$):Y(W)}).catch(G)})}updatevCardForContact($){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Updating vCard for Contact:',$),new E.Promise((Y,G)=>{this.findContacts({id:$}).then((J)=>{let W=J[0];return void 0===W?void(this._log('\uD83C\uDCA1 No contact:',$),G('No contact found: '+$)):W}).then(()=>{this._getvCard($).then((W)=>{if(void 0!==W){const X=N.VCardSimple.fromXml(W);void 0===X?(this._log('\uD83C\uDCA1 Bad vCard:',$),G('Bad vCard')):this._saveObject(z.OBJECT_TYPES.CONTACT,$,(K)=>{return K.vCard=X.toJSON(),K},(K)=>{this._log('\uD83C\uDCA1 vCard Updated:',$),Y(K)},(K)=>{this._log('\uD83C\uDCA1 Couldn\'t save contact:',$),G('Couldn\'t save contact: '+K)})}else this._log('\uD83C\uDCA1 No vCard:',$),Y(null)}).catch(G)}).catch(G)})}_processRoster($){return new E.Promise((Y,G)=>{if(void 0===$||void 0===$.iq||void 0===$.iq.query)Y();else if(void 0!==$.iq.query.$attributes&&void 0!==$.iq.query.$attributes.ver&&this._setCacheItem('roster_version',$.iq.query.$attributes.ver).catch(G),void 0!==$.iq.query.item){const J=Array.isArray($.iq.query.item)?$.iq.query.item:[$.iq.query.item],W=[];J.forEach((X)=>{if(void 0!==X.$attributes.jid){const K={id:X.$attributes.jid,subscription:X.$attributes.subscription,online:!1};void 0!==X.group&&('string'==typeof X.group?K.groups=[X.group]:Array.isArray(X.group)&&(K.groups=X.group)),W.push(K)}}),this._contactDb.allDocs({include_docs:!0}).then((X)=>{const K=[];X.rows.forEach((Q)=>{let Z=Q.doc,ee=null;W.every((te,ne)=>{return te.id!==Z.id||(ee=te,delete W[ne],!1)}),null===ee?K.push(this._contactDb.remove(Z)):(Z.subscription!==ee.subscription||!z._arraysEqual(Z.groups,ee.groups))&&(Z=z._merge(Z,ee),this._log('MERGED CONTACT:',Z),K.push(this._contactDb.post(Z)))}),W.forEach((Q)=>{this._log('ADDING NEW CONTACT:',Q),K.push(new E.Promise((Z,ee)=>{this._saveObject(z.OBJECT_TYPES.CONTACT,Q.id,()=>{return Q},(te)=>{this._log('CONTACT ADDED:',Q.id),Z(te)},(te)=>{this._log('CONTACT ADD FAILED:'+Q.id+': '+te),ee(te)})}))}),E.Promise.all(K).then(Y).catch((Q)=>{this._onError('Couldn\'t merge contacts from server with locally sorted contacts.',Q),G(Q)})})}else Y()})}getvCardsForAllContacts(){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Fetching all vCards...'),new E.Promise(($,Y)=>{this.getContacts().then((G)=>{const J=[];G.forEach((W)=>{this._log('\uD83C\uDCA1 Fetching vCard for:',W.id),J.push(new E.Promise((K)=>{this.updatevCardForContact(W.id).then(()=>{this._log('\uD83C\uDCA1 Fetched vCard for:',W.id),K()}).catch(()=>{K()})}))}),E.Promise.all(J).then($).catch(Y)})})}getOurvCard(){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Fetching vCard for:',this._bareJid),new E.Promise(($,Y)=>{this._getvCard(this._bareJid).then((G)=>{if(void 0===G||1>G.length)return Y('No vCard');const J=N.VCardSimple.fromXml(G);void 0===J?(this._log('\uD83C\uDCA1 Bad vCard: ',this._bareJid),Y('Bad vCard')):(this._log('\uD83C\uDCA1 Fetched vCard: ',J.toJSON()),$(J.toJSON()))}).catch(Y)})}saveOurvCard($){return this._isMethodReady(!0,!0),this._log('\uD83C\uDCA1 Saving vCard for:',this._bareJid),new E.Promise((Y,G)=>{const J=N.VCardSimple.fromJSON($);this._setvCard(this._bareJid,J.toXML(!0)).then(()=>{this._log('\uD83C\uDCA1 Saved vCard for:',this._bareJid),Y()}).catch(G)})}_onError($,Y){console.error($,Y||''),this._dispatchEvent(z.EVENT_TYPES.ERROR,Y)}_setCacheItem($,Y,G=!1){return new E.Promise((J,W)=>{const X=()=>{this._saveObject(z.OBJECT_TYPES.CACHE_ITEM,$,(K)=>{return K.value!==Y&&(K.value=Y,K.secret=!0===G,K)},(K)=>{const Q=K.value;!1===K.secret&&(this._cache[$]=Q),J(K.value)},(K)=>{this._onError(`Couldn't set cache item '${$}' with value '${Y}'.`),W(K)})};this._getCacheItem($).then((K)=>{K===Y?J(K):X()}).catch(X)})}_getCacheItem($,Y=0){return new E.Promise((J)=>{this._cache[$]===void 0?this._cacheDb.get($).then((W)=>{if(this._options.encryption&&!W.hasOwnProperty('value'))++Y,Y===5?J():setTimeout(()=>{this._getCacheItem($,Y).then(J)},100);else{const X=W.value;!1===W.secret&&(this._cache[$]=X),J(X)}}).catch(()=>{J()}):J(this._cache[$])})}_deleteCacheItem($){return new E.Promise((Y,G)=>{this._cacheDb.get($).then((J)=>{this._cacheDb.remove(J).then(()=>{delete this._cache[$],Y()}).catch(G)}).catch(()=>{Y()})})}_messageDelta($,Y,G){const J=$.message.$attributes.from,W=H.default.Strophe.getBareJidFromJid(J),X=H.default.Strophe.getResourceFromJid(J);if(void 0!==Y._id)$!==Y.stanza&&(Y.stanza=$),void 0!==$.message.body&&$.message.body!==Y.body&&(Y.body=$.message.body),null===Y.type&&(Y.type=$.message.$attributes.type),'groupchat'===Y.type&&(Y.state.sent=!0),null===Y.jid&&(Y.jid=J),null===Y.sender_id&&(Y.sender_id=W),null===Y.sender_resource&&(Y.sender_resource=X),null===Y.recipient_id&&(Y.recipient_id=$.message.$attributes.to),void 0!==$.message.data&&$.message.data!==Y.data&&(Y.data=$.message.data),(null===Y.ts||$.message.timestamp&&1<$.message.timestamp.length)&&(Y.ts=this._getTimestampFromStanza($)),null===Y.mine&&(Y.mine=W===this._bareJid),Y.placeholder=!1,Y.archive_id=this._getArchiveIdFromStanza($),Y.updated_at=this.getSyncedTimestamp(Date.now()),Y=z._merge(Y,G);else{let K=[];void 0!==$.message.attachments&&(Array.isArray($.message.attachments)?K=$.message.attachments:K.push($.message.attachments));let Q={_id:$.message.$attributes.id,stanza:$,archive_id:this._getArchiveIdFromStanza($),jid:J,sender_id:W,sender_resource:X,recipient_id:$.message.$attributes.to,body:$.message.body||null,updated_at:null,ts:this._getTimestampFromStanza($),state:{sent:null,markers:[],received:null,read:null,acknowledged:null},data:$.message.data||{},attachments:K,type:$.message.$attributes.type||'chat',mine:W===this._bareJid,markable:void 0!==$.message.markable,fromMam:!1,injected:!1,placeholder:!1},Z=[];void 0!==$.message.addresses&&(Array.isArray($.message.addresses.address)?Z=$.message.addresses.address:Z.push($.message.addresses.address)),Y=Object.assign({},z._messageSkeleton(),{_id:$.message.$attributes.id,stanza:$,archive_id:this._getArchiveIdFromStanza($),jid:J,sender_id:W,sender_resource:X,recipient_id:$.message.$attributes.to,body:$.message.body,ts:this._getTimestampFromStanza($),data:$.message.data,attachments:K,type:$.message.$attributes.type,mine:W===this._bareJid,markable:void 0!==$.message.markable,addresses:Z})}return $.message.$attributes&&'groupchat'===$.message.$attributes.type&&(Y.type='groupchat',Y.mine=H.default.Strophe.getBareJidFromJid($.message.$attributes.from)===this._bareJid||H.default.Strophe.getResourceFromJid($.message.$attributes.from)===this.username),z._merge(Y,G)}static _messageSkeleton(){return{_id:null,stanza:null,archive_id:null,jid:null,sender_id:null,sender_resource:null,recipient_id:null,body:null,updated_at:null,ts:null,state:{sent:null,markers:[],received:null,read:null,acknowledged:null},data:{},attachments:[],type:'chat',mine:null,markable:!1,fromMam:!1,placeholder:!1,injected:!1}}_messageStanzaToDbObject($,Y){return new E.Promise((G,J)=>{if($.message!==void 0&&$.message.$attributes!==void 0)this.saveMessage($.message.$attributes.id,(W)=>{return this._messageDelta($,W,Y)}).then(G).catch((W)=>{this._onError('Unable to convert message stanza to DB object.',W),J(W)});else{const W='No message part present in the stanza.';this._onError(W),J(W)}})}_getTimestampFromStanza($){let Y=null;if(void 0!==$.message&&void 0!==$.message.timestamp)if(Array.isArray($.message.timestamp)){const G=$.message.timestamp.filter((J)=>{return void 0!==J.$attributes&&J.$attributes.xmlns===z.NAMESPACES.CT_SERVER_TIMESTAMP});void 0!==G[0]&&(Y=parseInt(G[0].$value))}else void 0!==$.message.timestamp.$value&&(Y=parseInt($.message.timestamp.$value));return null===Y&&(Y=this.getSyncedTimestamp(Date.now())),Y}_getArchiveIdFromStanza($){let Y=null;if($.message.archived!==void 0){const G=Array.isArray($.message.archived)?$.message.archived[0]:$.message.archived;G.$attributes!==void 0&&G.$attributes.id!==void 0&&(Y=G.$attributes.id)}return Y}_log($,Y){!0===this._options.debug&&console.debug('['+new Date().toString()+'] ',$,Y||'')}getUniqueId(){return this._isMethodReady(!0,!0),this._connection.getUniqueId(`${this._instanceId}-${performance.now()}`)}_clearBotTimeout($){this._botCommandTimeouts[$]&&(this._log(`Bot command response verified, removing bot timeout for request '${$}'.`),this._botCommandTimeouts[$].cancel(),delete this._botCommandTimeouts[$])}_clearBotPromise($){this._botCommandPromises[$]&&(this._log(`Clearing bot command promise for request '${$}'.`),delete this._botCommandPromises[$])}_botCommandResponseHandler($,Y){if(!this._botCommandPromises[$])return!1;if(void 0!==Y.message&&void 0!==Y.message.$attributes&&'error'===Y.message.$attributes.type){const G=void 0!==Y.message.error&&void 0!==Y.message.error.$attributes&&Y.message.error.$attributes['request-id']?Y.message.error.$attributes['request-id']:null;if(G===$){this._clearBotTimeout(G);const J=void 0!==Y.message.error&&void 0!==Y.message.error.text?Y.message.error.text.$value:'An unexpected error occurred';this._botCommandPromises[$].reject(J),this._clearBotPromise($)}}else if(void 0!==Y.message&&void 0!==Y.message.call&&void 0!==Y.message.call.$attributes&&'result'===Y.message.call.$attributes.type&&Y.message.call.$attributes['request-id']===$){if(this._clearBotTimeout($),void 0!==Y.message.call.json&&void 0!==Y.message.call.json.$value){let G=null;try{G=JSON.parse(Y.message.call.json.$value)}catch(J){this._onError('Couldn\'t parse JSON from bot command response:',J),this._botCommandPromises[$].reject(J),this._clearBotPromise($)}null!==G&&(this._botCommandPromises[$].resolve(G),this._clearBotPromise($))}return!1}return!0}sendBotCommand($,Y,G,J=5e3){return this._isMethodReady(!0,!0),new E.Promise((W,X)=>{const K=this.getUniqueId(),Q={$attributes:{to:$,type:'normal'},call:{$attributes:{xmlns:z.NAMESPACES.INFINITY_BOT,"request-id":K,type:'get',name:Y}}};let Z=null;try{Z=JSON.stringify(G)}catch(ee){this._onError('Couldn\'t stringify JSON:',ee)}null!==Z&&(Q.call.json={$attributes:{xmlns:'urn:xmpp:json:0'},$value:Z}),this._botCommandPromises[K]={resolve:W,reject:X},this.sendStanza(Q,!1).then(()=>{this._log(`Creating bot command timer for request '${K}'...`),this._botCommandTimeouts[K]=new B.default(K,()=>{this._log(`Bot command timer finished for request '${K}'.`),this._onError(`Didn't get a response from the bot within ${J}ms.`,{operationName:Y}),this._botCommandPromises[K].reject('Your request took longer then expected, please try again.')},J)}).catch((ee)=>{this._onError('Couldn\'t send bot command:',ee),X(ee)})})}_pushHandler($){this._log('Push Received: ',$)}_getPushToken(){return new E.Promise(($,Y)=>{var G=null;if('android'===A.getPlatformName()?G={senderID:this._options.push.senderId}:'ios'===A.getPlatformName()&&(G={badge:'true',sound:'true',alert:'true'}),null!==G)if(this._options.push.voip&&'ios'===A.getPlatformName()){const J=this,W=M.getSource('VoIPPushNotification');if(!1!==W){const X=W.init();X.on('registration',function(K){J._log('Registered for push: ',K.deviceToken),J._setCacheItem('push_token',K.deviceToken).then(()=>{$(K.deviceToken)})}),X.on('notification',function(K){const Q=M.getSource('insomnia');Q&&!1!==J._options.bringToForegroundOnVoipPush&&(Q.switchOnScreenAndForeground(),J._pushHandler(K)),J.connected||J.reLoginNow()}),X.on('error',function(K){J._log('VOIP Push Error: '+K)})}else this._log('Could not find VOIP Push plugin'),Y('Could not find VOIP Push plugin')}else{const J=M.getSource('notification');if(!1!==J){this._log('Registering for push notifications...');const W=this;J.registerForPush(function(X){W._log('Registered for push:',X),J.on('pushReceived',function(K){W._pushHandler(K)}),W._setCacheItem('push_token',X).then(()=>{$(X)})},function(X){W._log('Error registering for push:',X),Y(X)},G)}else this._log('Could not find Push plugin'),Y('Could not find Push plugin')}})}registerForPush($){if(!A.isDevice())throw new Error('This platform does not support push notifications.');return new E.Promise((Y,G)=>{this.sendIq(null,'set',{push:{$attributes:{xmlns:z.NAMESPACES.CT_PUSH},notification:{package:this._options.push.packageId,type:'ios'===A.getPlatformName()?'apns':'gcm',token:$,installation_id:this._installId}}}).then((J)=>{let W=null;try{W=J.iq.push.notification.$attributes.jid,this._pushNodeName=J.iq.push.notification.$attributes.node}catch(X){this._onError('Couldn\'t enable push notifications.',X),G(X)}null!==W&&this._setCacheItem('push_jid',W).then(()=>{this.enablePush().then(Y).catch(G)})}).catch((J)=>{this._onError('Couldn\'t register for push notifications:',J),G(J)})})}enablePush(){return new E.Promise(($,Y)=>{this._getCacheItem('push_jid').then((G)=>{G===void 0?(this._onError('\'registerForPush\' must be called before \'enablePush\'.'),Y()):this.sendIq(null,'set',{enable:{$attributes:{xmlns:z.NAMESPACES.PUSH,jid:G,node:this._pushNodeName}}}).then($).catch((J)=>{this._onError('Unable to enable push notifications:',J),Y(J)})})})}disablePush(){return new E.Promise(($,Y)=>{this._getCacheItem('push_jid').then((G)=>{G===void 0?$():this.sendIq(null,'set',{disable:{$attributes:{xmlns:z.NAMESPACES.PUSH,jid:G,node:this._pushNodeName}}}).then($).catch((J)=>{this._onError('Unable to disable push notifications:',J),Y(J)})})})}_perfStart($,Y,G){!0!==this._options.perfLogging||(console.log(`%c[START: ${$}] ${Y}`,G),console.time($))}_perfEnd($,Y,G){!0!==this._options.perfLogging||(console.log(`%c[END: ${$}] ${Y}`,G),console.timeEnd($))}static jsonToXml($,Y){return z._parseJsonNode(Y,z._createElement($,Y.$attributes))}static _parseJsonNode($,Y){for(let G in $){let J=$[G];if(0!==G.indexOf('$')){if(Array.isArray(J)&&0<J.length)J.forEach((W)=>{let X=z._createElement(G,W.$attributes);X=z._parseJsonNode(W,X),Y.appendChild(X)});else{const W='object'==typeof J&&null!==J?J.$attributes:void 0;let X=z._createElement(G,W);if('object'==typeof J&&null!==J&&0<Object.keys(J).length)X=z._parseJsonNode(J,X);else if('string'==typeof J){const K=z.doc.createTextNode(J);X.appendChild(K)}Y.appendChild(X)}}else if('$value'==G){const W=z.doc.createTextNode(J);Y.appendChild(W)}else if('$cdata'==G){const W=z.doc.createCDATASection(J);Y.appendChild(W)}}return Y}static xmlToJson($){return z._parseXmlNode($,{})}static _parseXmlNode($,Y){let G={};if(void 0!==$.attributes&&0<$.attributes.length){G.$attributes={};for(let J=0;J<$.attributes.length;J++){const W=$.attributes[J];G.$attributes[W.nodeName]=W.value}}if(0<$.childNodes.length)for(let J=0;J<$.childNodes.length;J++){const W=$.childNodes[J];if(3===W.nodeType)void 0===G.$attributes?G=W.textContent:G.$value=W.textContent;else if(4===W.nodeType)G.$cdata=W.textContent;else{if('\n'===G)continue;z._parseXmlNode(W,G)}}return void 0!==Y[$.nodeName]&&!1===Array.isArray(Y[$.nodeName])&&(Y[$.nodeName]=[Y[$.nodeName]]),Array.isArray(Y[$.nodeName])?Y[$.nodeName].push(G):Y[$.nodeName]=G,Y}static _createElement($,Y){null===z.doc&&(z.doc=document.implementation.createDocument('ct:xmpp:client','infinity',null));const G=z.doc.createElement($);if(Y!==void 0&&0<Object.keys(Y).length)for(let J in Y)G.setAttribute(J,Y[J]);return G}static _getContactFromRosterByJid($,Y){let G=null;return void 0!==Y&&void 0!==Y.contacts&&0<Y.contacts.length&&Y.contacts.forEach((J)=>{J.jid===$&&(G=J)}),G}static _isObject($){return $&&'object'==typeof $&&!Array.isArray($)}static _merge($,...Y){if(!Y.length)return $;const G=Y.shift();if(z._isObject($)&&z._isObject(G))for(const J in G)z._isObject(G[J])?($[J]||Object.assign($,{[J]:{}}),z._merge($[J],G[J])):Object.assign($,{[J]:G[J]});return z._merge($,...Y)}static _arraysEqual($,Y){if(!Array.isArray($)||!Array.isArray(Y))return $===Y;if($.length!==Y.length)return!1;for(let G=$.length;G--;)if($[G]!==Y[G])return!1;return!0}static _validateEventType($){return z._validateConstants(z.EVENT_TYPES,$)}static _validateChatStatus($){return z._validateConstants(z.CHAT_STATUSES,$)}static _validateConstants($,Y){for(let G in $)if($[G]===Y)return!0;return!1}static getDomainFromJid($){const Y=H.default.Strophe.getBareJidFromJid($);return Y.split('@')[1]}static _isMarkerMessage($){return $.message.received&&$.message.received.$attributes&&$.message.received.$attributes.xmlns===z.NAMESPACES.CHAT_MARKERS||$.message.read&&$.message.read.$attributes&&$.message.read.$attributes.xmlns===z.NAMESPACES.CHAT_MARKERS||$.message.acknowledged&&$.message.acknowledged.$attributes&&$.message.acknowledged.$attributes.xmlns===z.NAMESPACES.CHAT_MARKERS}static getNodeFromJid($){return H.default.Strophe.getNodeFromJid($)}static pickFile($={}){return R.pickFile($)}_isMethodReady($=!0,Y=!1){if(!0===$&&!0!==this._initialised)throw new Error(`XMPP client has not yet been fully initialised.`);if(!0===Y&&!1===this.connected)throw new Error(`An active connection is required to perform this action.`)}}z.doc=null,z.MARKER_TYPES={RECEIVED:'received',READ:'read',ACKNOWLEDGED:'acknowledged'},z.EVENT_TYPES={INITIALISED:'initialised',STATUS:'status',NEW_MESSAGE:'newmessage',ERROR:'error',MESSAGE_UPDATED:'messageupdated',PRESENCE_UPDATE:'presenceupdate',NEW_PARTICIPANT:'newparticipant',PARTICIPANT_UPDATED:'participantupdated',RECEIPT_RECEIVED:'receiptreceived',AUTO_RECONNECTED:'autoreconnected',DBS_DESTROYED:'dbsdestroyed',AUTO_DBS_DESTROYED:'autodbsdestroyed',ACK_RECEIVED:'ackreceived',UPLOAD_STARTED:'uploadstarted',UPLOAD_SUCCESS:'uploadsuccess',UPLOAD_FAILED:'uploadfailed'},z.CHAT_STATUSES={AWAY:'away',CHAT:'chat',DND:'dnd',XA:'xa'},z.NAMESPACES={MUC:'http://jabber.org/protocol/muc',MUC_SUB:'urn:xmpp:mucsub:0',MUC_OWNER:'http://jabber.org/protocol/muc#owner',X_DATA:'jabber:x:data',DISCO_INFO:'http://jabber.org/protocol/disco#info',DISCO_ITEMS:'http://jabber.org/protocol/disco#items',JABBER_CLIENT:'jabber:client',MAM:'urn:xmpp:mam:0',MAM_TMP:'urn:xmpp:mam:tmp',RESULT_SET_MANAGEMENT:'http://jabber.org/protocol/rsm',CHAT_MARKERS:'urn:xmpp:chat-markers:0',CT_METADATA:'ct:metadata:0',HINTS:'urn:xmpp:hints',CT_CLIENT_TIMESTAMP:'ct:client-timestamp:0',CT_SERVER_TIMESTAMP:'urn:commontime:infinity:timestamps',HTTP_UPLOAD:'urn:xmpp:http:upload',PING:'urn:xmpp:ping',CLIENT_STATE_INDICATION:'urn:xmpp:csi:0',ADDRESS:'http://jabber.org/protocol/address',VCARD_UPDATE:'vcard-temp:x:update',TIME:'urn:xmpp:time',INFINITY_BOT:'urn:commontime:infinity:api',PRIVATE_XML_STORAGE:'jabber:iq:private',CT_PRIVATE_XML_STORAGE:'ct:private-xml-data',CT_PUSH:'urn:commontime:infinity:push',PUSH:'urn:xmpp:push:0',DIRECTORY:'urn:commontime:infinity:directory',CARBONS:'urn:xmpp:carbons:2',INFINITY_MAM:'urn:commontime:infinity:mam',INFINITY_ACK:'urn:commontime:infinity:ack'},z.MUC_NODES={PRESENCE:'urn:xmpp:mucsub:nodes:presence',MESSAGES:'urn:xmpp:mucsub:nodes:messages',AFFILIATIONS:'urn:xmpp:mucsub:nodes:affiliations',CONFIG:'urn:xmpp:mucsub:nodes:config',SUBJECT:'urn:xmpp:mucsub:nodes:subject',SYSTEM:'urn:xmpp:mucsub:nodes:system'},z.MARKER_PRIORITIES={received:3,read:2,acknowledged:1},z.OBJECT_TYPES={MESSAGE:'message',CONTACT:'contact',ROOM:'room',PARTICIPANT:'participant',CACHE_ITEM:'cache_item',OBJECT_URL:'object_url'},z.CLIENT_STATES={ACTIVE:'active',INACTIVE:'inactive'},f.CtXmppClient=z,window.CtXmppClient=z},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(23);class I extends E.ViewBase{constructor(R){super(R)}}f.IncidentViewBase=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(1),I=h(7),R=h(0),A=h(11),M=h(3),N=h(4),D=h(25),B=h(24),H=h(16),z=h(5);class ${static getDefaultOptions(Y){return M.mergeDeep({},{layout:'inline',showPriority:!0,showSeverity:!0,showPatientType:!0,showLocation:!0,showCreator:!0,showSeverityChange:!0,showOpenDuration:!0,showClosedTime:!0,showCurrentUserResponse:!1,allowSeverityChange:!1,allowClose:!1},Y||{})}static generateHeader(Y,G,J){const W=['header',J.layout];return G.status===I.IncidentStatus.Closed&&W.push('closed'),G.isTestIncident&&W.push('test'),window.__CTRender('div',{class:W.join(' ')},window.__CTRender('div',{class:'header-group header-group-start'},this._severity(Y,G,J)),window.__CTRender('div',{class:'header-group header-group-details'},this._location(Y,G,J),this._priority(Y,G,J),this._patientType(Y,G,J),this._creator(Y,G,J),this._severityChange(Y,G,J),this._spacer(),this._openedDuration(Y,G,J,'desktop')),window.__CTRender('div',{class:'header-group header-group-end'},this._actions(Y,G,J),this._closedTime(Y,G,J),this._currentUserResponse(Y,G,J)))}static generateMobileHeader(Y,G,J,W,X){const K=['header','mobile'];W&&K.push('expanded'),G.status===I.IncidentStatus.Closed&&K.push('closed'),G.isTestIncident&&K.push('test');const Q=[];return Q.push(window.__CTRender('div',{class:'mobile-header-row',onClick:()=>X&&X()},this._severity(Y,G,J),this._location(Y,G,J),this._openedDuration(Y,G,J,'mobile'),this._closedTime(Y,G,J))),W&&(Q.push(window.__CTRender('div',{class:'mobile-header-row'},this._currentUserResponse(Y,G,J),this._priority(Y,G,J),this._patientType(Y,G,J),this._creator(Y,G,J),this._severityChange(Y,G,J))),this._shouldRenderActions(G,J)&&Q.push(window.__CTRender('div',{class:'mobile-header-row'},this._actions(Y,G,J)))),window.__CTRender('div',{class:K.join(' ')},Q)}static _priority(Y,G,J){return J.showPriority?G.priority?window.__CTRender('div',{class:'header-item data-item priority'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender('div',{class:'heading'},'Type'),window.__CTRender('div',{class:'text'},G.priority.name))):null:null}static _severity(Y,G,J){return J.showSeverity?window.__CTRender('div',{class:'header-item severity'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender(B.CTILIncidentSeverityPill,{incident:G}))):null}static _patientType(Y,G,J){return J.showPatientType?G.patientType?window.__CTRender('div',{class:'header-item data-item patient-type'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender('div',{class:'heading'},'Patient'),window.__CTRender('div',{class:'text'},G.patientType.name))):null:null}static _location(Y,G,J){return J.showLocation?G.location?window.__CTRender('div',{class:'header-item data-item location'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender('div',{class:'heading'},'Where'),window.__CTRender('div',{class:'text'},G.location.name))):null:null}static _creator(Y,G,J){return J.showCreator?window.__CTRender('div',{class:'header-item data-item creator'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender('div',{class:'heading'},'Raised By'),window.__CTRender('div',{class:'text'},G.opened.name))):null}static _severityChange(Y,G,J){if(!J.showSeverityChange)return null;const W=(G.actions||[]).filter((Q)=>Q.action===I.IncidentAction.ChangeSeverity);W.sort((Q,Z)=>Z.date-Q.date);const X=W[0]||null;if(!X)return null;const K=`${X.data} ${M.formatDate(X.date,'HH:mm')}`;return window.__CTRender('div',{class:'header-item data-item severity-change'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender('div',{class:'heading'},'Status'),window.__CTRender('div',{class:'text'},K)))}static _openedDuration(Y,G,J,W){return G.status!==I.IncidentStatus.Open||null===G.opened?void 0:'desktop'===W?window.__CTRender('div',{class:'header-item data-item opened'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender('div',{class:'heading'},'Open'),window.__CTRender('div',{class:'text'},window.__CTRender(D.CTILTimeDiffDisplay,{ts:G.opened.date})))):'mobile'===W?window.__CTRender('div',{class:'header-item data-item opened'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender(D.CTILTimeDiffDisplay,{ts:G.opened.date,showLabel:!1}),window.__CTRender('div',{class:'label'},'Mins'))):null}static _closedTime(Y,G){if(G.status!==I.IncidentStatus.Closed&&null===G.closed)return null;const W=G.closedReasonId&&(Y.layer.config.closeReasons||[]).find((K)=>K.id===G.closedReasonId),X=!W?'Closed':W.label||'Closed';return window.__CTRender('div',{class:'header-item data-item closed'},window.__CTRender('div',{class:'header-item-content'},window.__CTRender('div',{class:'heading right'},X),window.__CTRender('div',{class:'text'},M.formatDate(G.closed.date,'HH:mm'))))}static _currentUserResponse(Y,G,J){if(!J.showCurrentUserResponse)return null;const W=Y.layer.getCurrentUser(),X=!W?null:A.findUserResponse(G,W.jid),K=null===X?I.ResponseStatus.OffDuty:X.status||I.ResponseStatus.Transmitted,Q=K===I.ResponseStatus.Acknowledged?'Ack':null;return window.__CTRender('div',{class:'header-item data-item user-response'},window.__CTRender('div',{class:'header-item-content'},N.renderIf(!!W,window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'primary',status:K,label:Q,collapsed:!0}))))}static _actions(Y,G,J){return this._shouldRenderActions(G,J)?window.__CTRender('div',{class:'header-item actions'},this._renderActions(Y,G,J)):null}static _spacer(){return window.__CTRender('div',{class:'header-item header-spacer'})}static _shouldRenderActions(Y,G){if(Y.status===I.IncidentStatus.Closed)return!1;let J=!1;return G.allowSeverityChange&&Y.severity.changes&&Y.severity.changes.length&&(J=!0),this._allowCloseIncident(Y,G)&&(J=!0),J}static _renderActions(Y,G,J){const W=Y.layer.getConnectionStatus(),X=W===E.ConnectionStatus.Connected,K=[];return J.allowSeverityChange&&(G.severity.changes||[]).forEach((Q)=>{K.push(window.__CTRender(z.CTButton,{type:'secondary',disabled:!X,onClick:()=>$._raiseSeverityChange(Y,G,Q)},Q.name))}),this._allowCloseIncident(G,J)&&K.push(window.__CTRender(z.CTButton,{type:'secondary',disabled:!X,onClick:()=>$._raiseClose(Y,G)},'Close')),K}static _allowCloseIncident(Y,G){if('boolean'==typeof G.allowClose)return G.allowClose;if('string'==typeof G.allowClose){if(['true','all'].includes(G.allowClose.toLowerCase()))return!0;if('test-only'===G.allowClose.toLowerCase())return Y.isTestIncident;if('non-test'===G.allowClose.toLowerCase())return!Y.isTestIncident}return!1}static _raiseSeverityChange(Y,G,J){const W=J.confirmationTitle||J.name,X=J.confirmationMessage;if(!!X){const Q=E.DefaultAlerts.AlertYesNoQuestion(W,X,1,{yes:()=>{Y.emitEvent(R.IncidentEvents._Request_ChangeIncidentSeverity,new R.ChangeIncidentSeverityEventArgs(G.id,J))}});Y.launchModal(Q)}else Y.emitEvent(R.IncidentEvents._Request_ChangeIncidentSeverity,new R.ChangeIncidentSeverityEventArgs(G.id,J))}static _raiseClose(Y,G){Y.emitEvent(R.IncidentEvents._Request_LaunchCloseIncidentModal,G)}}f.IncidentHeader=$},function(u,f,h){'use strict';var E=this&&this.__decorate||function(H,z,$,Y){var G=arguments.length,J=3>G?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(J=(3>G?W(J):3<G?W(z,$,J):W(z,$))||J);return 3<G&&J&&Object.defineProperty(z,$,J),J},I=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(121),N=h(0),D=h(3);class B extends A.CTILComponent{constructor(){super(...arguments),this._initialized=!1}static get is(){return'ct-il-incident-display'}initialize(){return I(this,void 0,void 0,function*(){if(this.view){const H=this.viewOptions?JSON.parse(this.viewOptions):{};this._view||(this._view=M.getView(this.view,this,H)),this._view&&(yield this._view.initialize(),this._initialized=!0,this.forceRedraw())}})}setupListeners(){this.addListener(N.IncidentEvents.IncidentUpdated,(H)=>{H.incident.id===this.incident.id&&this.debounce('update',()=>I(this,void 0,void 0,function*(){this.incident=D.deepCloneObject(H.incident)}))}),this._view&&this._view.setupListeners()}get generateComponentStyles(){return null}generateComponentMarkup(){return this._initialized?this._view?this.incident?window.__CTRender('div',{class:`incident-display view-${this.view}`},window.__CTRender('style',null,this._view.renderStyles()),this._view.renderIncident(this.incident)):null:null:null}}E([R.prop({type:String,attribute:!0})],B.prototype,'view',void 0),E([R.prop({type:String,attribute:!0})],B.prototype,'viewOptions',void 0),E([R.prop({type:Object,attribute:!1,default:null})],B.prototype,'incident',void 0),f.CTILIncidentDisplay=B,B.register()},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const I=window,R=window;f.getSource=function(A){if(I[A]!==void 0)return I[A];if(void 0!==I.cordova&&void 0!==I.cordova[A])return I.cordova[A];if(void 0!==I.cordova&&void 0!==I.cordova.plugins&&void 0!==I.cordova.plugins[A])return I.cordova.plugins[A];if(void 0!==I.plugins&&void 0!==I.plugins[A])return I.plugins[A];if(void 0!==navigator&&void 0!==navigator[A])return navigator[A];if(void 0!==R.require){let M=!1;try{return M=R.require(A),M}catch(N){if(!1==M||void 0===M){const D=A.replace(/\-/g,'').toLowerCase();try{return R.require('@commontimeltd/com.commontime.'+D)}catch(B){return!1}}return!1}}else return console.warn(`Plugin '${A}' is not available.`),!1}},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});class E{constructor(I){this.hostComponent=I}redrawComponent(){this.hostComponent.forceRedraw()}addListener(I,R){this.hostComponent.addListener(I,R)}addListeners(I,R){this.hostComponent.addListeners(I,R)}emitEvent(I,R){this.hostComponent.emitEvent(I,R)}emitComponentEvent(I,R){this.hostComponent.emitComponentEvent(I,R)}get layer(){return this.hostComponent.layer}}f.ViewBase=E},function(u,f,h){'use strict';var E=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,G=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(J=B[W])&&(G=(3>Y?J(G):3<Y?J(H,z,G):J(H,z))||G);return 3<Y&&G&&Object.defineProperty(H,z,G),G},I=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(4),N=h(3);class D extends A.CTILComponent{static get is(){return'ct-il-incident-severity-pill'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{font-size:inherit}:host .severity{display:inline-flex;align-items:center;min-width:8.5em;padding:0.3em 1em;margin:0;border-radius:0 20px 20px 0;color:#fff}:host .severity .time{font-weight:700;margin:0 0.5em 0 0}:host .severity .label{font-weight:400}
        `}generateComponentMarkup(){if(!this.incident)return null;const B=M.buildStyles({backgroundColor:this.incident.severity.colorCode});return window.__CTRender('div',{class:'severity',style:B},window.__CTRender('span',{class:'time'},N.formatDate(this.incident.opened.date,'HH:mm')),window.__CTRender('span',{class:'label'},this.incident.severity.name))}}E([R.prop({type:Object,attribute:!1})],D.prototype,'incident',void 0),f.CTILIncidentSeverityPill=D,D.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(N,D,B,H){var z=arguments.length,$=3>z?D:null===H?H=Object.getOwnPropertyDescriptor(D,B):H,Y;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)$=Reflect.decorate(N,D,B,H);else for(var G=N.length-1;0<=G;G--)(Y=N[G])&&($=(3>z?Y($):3<z?Y(D,B,$):Y(D,B))||$);return 3<z&&$&&Object.defineProperty(D,B,$),$},I=this&&this.__awaiter||function(N,D,B,H){return new(B||(B=Promise))(function(z,$){function Y(W){try{J(H.next(W))}catch(X){$(X)}}function G(W){try{J(H['throw'](W))}catch(X){$(X)}}function J(W){W.done?z(W.value):new B(function(X){X(W.value)}).then(Y,G)}J((H=H.apply(N,D||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10);class M extends A.CTILComponent{constructor(){super(...arguments),this._updateTimeout=null}static get is(){return'ct-il-time-diff-display'}initialize(){return I(this,void 0,void 0,function*(){clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout(()=>this._update(),1e3*this.refreshInterval)})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block;font-size:inherit;font-weight:inherit}
        `}generateComponentMarkup(){if(null!==this.ts){const N=this.layer.getSyncedTimestamp(),D=_Mathmin(N,this.ts),B=_Mathmax(N,this.ts),z=_Mathfloor((B-D)/1e3/60),$=1>z?'< 1':z.toString(),Y=this.showLabel?1>=z?' min':' mins':'';return window.__CTRender('span',null,$,Y)}}disconnectedCallback(){clearTimeout(this._updateTimeout)}_update(){this.forceRedraw(),clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout(()=>this._update(),1e3*this.refreshInterval)}}E([R.prop({type:R.NullableNumber,attribute:!0,default:null})],M.prototype,'ts',void 0),E([R.prop({type:Number,attribute:!0,default:15})],M.prototype,'refreshInterval',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!0})],M.prototype,'showLabel',void 0),f.CTILTimeDiffDisplay=M,M.register()},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(51),I=h.n(E),R=h(52);f['default']=h.i(R.a)(I.a)},function(u,f){'use strict';function E(){const B=window.navigator.userAgent;return /Android/i.test(B)?'android':/iPhone|iPad|iPod/i.test(B)?'ios':/Electron/i.test(B)?'electron':/Chrome/i.test(B)?'chrome':/Safari/i.test(B)?'safari':/Edge/i.test(B)?'edge':N.MSInputMethodContext&&D.documentMode?'ie':null}Object.defineProperty(f,'__esModule',{value:!0});const N=window,D=document;f.getPlatformName=E,f.isElectron=function(){return'electron'===E()},f.isWindows=function(){return-1!==navigator.userAgent.toUpperCase().indexOf('WINDOWS')},f.isDevice=function(){const B=E();return'android'===B||'ios'===B},f.isBrowser=function(){const B=E();return'chrome'===B||'safari'===B||'ie'===B||'edge'===B}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const A=h(22),M=h(138);f.isNumber=function(N){return!isNaN(parseFloat(N))&&isFinite(N)},f.generateGuid=function(){let N=Date.now();return window.performance&&'function'==typeof window.performance.now&&(N+=performance.now()),'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(D){const B=0|(N+16*Math.random())%16;return N=_Mathfloor(N/16),('x'===D?B:8|3&B).toString(16)})},f.getEncryptionKey=function(N){return new Promise((D,B)=>{const H=A.getSource('securesettings');if(!1!==H)H.getOrCreateCryptographicKey(function($){const G=M.Buffer.from(function(J){let W=[];for(let X=0;X<J.length;X+=2)W.push(parseInt(J.substr(X,2),16));return W}($));D(G)},B,N,256);else{console.warn('Oh no! \uD83D\uDE31 Your databases are encrypted but the key couldn\'t be secured because this platform doesn\'t support secure settings.');const $=localStorage.getItem(`${N}_key`);if(null!==$){const Y=M.Buffer.from(JSON.parse($));D(Y)}else{let Y=[],G;if(window.crypto&&window.crypto.getRandomValues){var z=new Uint8Array(32);for(window.crypto.getRandomValues(z),G=0;32>G;G++)Y[G]=z[G]}else for(let W=0;32>W;W++)Y[W]=_Mathfloor(256*Math.random());localStorage.setItem(`${N}_key`,JSON.stringify(Y));const J=M.Buffer.from(Y);D(J)}}})}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(15),I=h(69),R=h(3);window.__CTRender=window.skate.h;const A=[I.OverridingStylesMixin,I.ComponentStylesMixin,I.RenderMixin],M=A.reduce((D,B)=>B(D),E.Component);class N extends M{renderHtml(D){(void 0===D||null===D)&&(D='');const B=-1!==D.indexOf('<')&&-1!==D.indexOf('>');if(!B)return D;const H=`html_${R.generateRandomSixString()}_${R.generateRandomSixString()}`;return this.onRenderComplete(()=>{const z=this.shadowRoot.querySelector(`#${H}`);z&&(z.innerHTML=D)},!0),E.h('span',{id:H,class:'user-html',style:{display:'inline-block'}})}onRenderComplete(D,B=!1){this.shadowRoot&&this.addEventListener('render-complete',function H(){D(),B&&this.removeEventListener('render-complete',H)})}renderedCallback(){super.renderedCallback(),this.dispatchEvent(new CustomEvent('render-complete'))}static register(){if(null===this.is)return void console.error('Could not register component, please ensure that it has a static is property');const D=customElements.get(this.is);D||customElements.define(this.is,this)}}N.is=null,f.CTBaseComponent=N},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});class E{static addInstance(I,R){E.ensureRegistrationsObject(),window.__CTLayers[I]={instance:R,isReady:!1}}static getInstance(I){E.ensureRegistrationsObject();const R=window.__CTLayers[I];return!R?null:R.instance}static onReady(I,R){E.ensureRegistrationsObject();const A=window.__CTLayers[I],M=!!A&&A.isReady;M?setTimeout(()=>{R()},0):document.addEventListener(`base-layer-ready:${I}`,()=>{setTimeout(()=>{R()},0)})}static fireReady(I){E.ensureRegistrationsObject();const R=window.__CTLayers[I];!R||(R.isReady=!0),document.dispatchEvent(new CustomEvent(`base-layer-ready:${I}`))}static ensureRegistrationsObject(){window.__CTLayers||(window.__CTLayers={})}}f.LayerRegistration=E,window.CtLayerRegistration=E},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});f.BaseMessageType=class{};f.BaseBotCommand=class{},f.get=function(){return[]};var A=h(67);f.BaseHandler=A.BaseHandler},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){function R(){return'alert_'+new Date().getTime().toString()}I.generateId=R,I.AlertWaiting=function(H){return{id:R(),raisedOn:new Date().getTime(),priority:1,type:'info',title:'Please wait...',body:H,showLoadingAnimation:!0}},I.AlertErrorWithOkayButton=function(H='Error',z='An error occurred',$=1,Y={}){return{id:R(),raisedOn:new Date().getTime(),priority:$,type:'error',title:H,body:z,buttons:[{text:'Okay',action:Y.okay,type:'primary'}]}},I.AlertYesNoQuestion=function(H,z,$=0,Y={}){return{id:R(),raisedOn:new Date().getTime(),priority:$,type:'question',title:H,body:z,buttons:[{text:'No',action:Y.no,type:'primary'},{text:'Yes',action:Y.yes,type:'primary'}]}},I.AlertQuestion=function(H,z,$=0,Y,G){return{id:R(),raisedOn:new Date().getTime(),priority:$,type:'question',title:H,body:z,buttons:Y,overrideHeaderColour:G}},I.AlertAcknowledge=function(H,z,$=0,Y={},G){return{id:R(),raisedOn:new Date().getTime(),priority:$,type:'success',title:H,body:z,buttons:[{text:G||'Okay',action:Y.okay,type:'primary'}]}}})(E=f.DefaultAlerts||(f.DefaultAlerts={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I.COMMON={StatusOnline:{viewBox:'0 0 1024 1024',paths:['M470.923457,555.52087 L517.156966,555.52087 L678.97425,987.033627 L309.106173,987.033627 L470.923457,555.52087 Z M581.144144,581.041767 L537.561355,537.458979 C548.780687,526.239647 555.684891,510.828477 555.684891,493.87619 C555.684891,459.848327 528.068075,432.231511 494.040212,432.231511 C459.950704,432.231511 432.395532,459.848327 432.395532,493.87619 C432.395532,510.828477 439.238091,526.239647 450.457423,537.458979 L406.874635,581.041767 C384.559261,558.726393 370.750852,527.904054 370.750852,493.87619 C370.750852,425.75882 425.922841,370.586831 494.040212,370.586831 C562.095938,370.586831 617.329571,425.75882 617.329571,493.87619 C617.329571,527.904054 603.459518,558.726393 581.144144,581.041767 Z M494.040212,185.652792 L493.916922,185.652792 C664.179527,185.652792 802.14032,323.67523 802.14032,493.87619 C802.14032,579.007493 767.680944,656.063343 711.892509,711.851778 L668.309721,668.268989 C712.940469,623.638241 740.495641,561.993561 740.495641,493.937835 C740.495641,357.764738 630.213309,247.359117 494.040212,247.359117 C357.80547,247.359117 247.461493,357.764738 247.461493,493.937835 C247.461493,561.993561 274.95502,623.638241 319.647413,668.268989 L276.064625,711.851778 C220.337834,656.063343 185.816814,579.007493 185.816814,493.87619 C185.816814,323.67523 323.777607,185.652792 494.040212,185.652792 Z M494.040212,0.718753674 C766.386406,0.718753674 987.197648,221.529996 987.197648,493.87619 C987.197648,630.049288 931.964016,753.338647 842.702519,842.600143 L799.119731,799.017354 C877.22354,720.97519 925.552969,613.097001 925.552969,493.87619 C925.552969,255.557859 732.296898,62.3634333 494.040212,62.3634333 C255.72188,62.3634333 62.5274544,255.557859 62.5274544,493.87619 C62.5274544,613.097001 110.733594,720.97519 188.899048,799.017354 L145.316259,842.600143 C56.0547631,753.338647 0.882774838,630.049288 0.882774838,493.87619 C0.882774838,221.529996 221.632372,0.718753674 494.040212,0.718753674 Z']},StatusOffline:{viewBox:'0 0 1024 1024',paths:['M586.678306,210.286115 C562.139482,203.996961 536.419525,200.652792 509.916922,200.652792 L510.040212,200.652792 C339.777607,200.652792 201.816814,338.67523 201.816814,508.87619 C201.816814,535.342777 205.153389,561.028843 211.426433,585.537988 L264.560722,532.403699 C263.833299,524.67956 263.461493,516.852047 263.461493,508.937835 C263.461493,372.764738 373.80547,262.359117 510.040212,262.359117 C517.95418,262.359117 525.7807,262.732021 533.503206,263.461215 L586.678306,210.286115 Z M806.86787,425.990261 C814.213724,452.364232 818.14032,480.162284 818.14032,508.87619 C818.14032,594.007493 783.680944,671.063343 727.892509,726.851778 L684.309721,683.268989 C728.940469,638.638241 756.495641,576.993561 756.495641,508.937835 C756.495641,498.546495 755.853446,488.305204 754.606559,478.251572 L806.86787,425.990261 Z','M729.725748,67.238671 C663.573003,34.2656239 588.970927,15.7187537 510.040212,15.7187537 C237.632372,15.7187537 16.8827748,236.529996 16.8827748,508.87619 C16.8827748,587.810373 35.420918,662.415536 68.3909758,728.573445 L114.711707,682.252714 C91.4312107,629.204161 78.5274544,570.558265 78.5274544,508.87619 C78.5274544,270.557859 271.72188,77.3634333 510.040212,77.3634333 C571.684303,77.3634333 630.316005,90.2960769 683.367584,113.596835 L729.725747,67.2386739 L729.725748,67.238671 Z M948.986253,283.87188 C983.639793,351.333945 1003.19765,427.822772 1003.19765,508.87619 C1003.19765,645.049288 947.964016,768.338647 858.702519,857.600143 L815.119731,814.017354 C893.22354,735.97519 941.552969,628.097001 941.552969,508.87619 C941.552969,445.074231 927.701805,384.506419 902.844202,330.013931 L948.98625,283.871881 L948.986253,283.87188 Z','M568.387956,664.470175 L694.97425,1002.03363 L325.106173,1002.03363 L381.675174,851.182956 L568.387956,664.470175 Z M38.537334,1018.85532 L3.14468065,983.537334 L984.462666,0.144680652 L1019.85532,35.462666 L38.537334,1018.85532 Z']},LoadingSpinner:{viewBox:'0 0 1024 1024',paths:['M1005.714 512c0 272.571-221.143 493.714-493.714 493.714s-493.714-221.143-493.714-493.714c0-248 182.857-453.143 420.571-488.571v130.286c-166.857 33.714-292.571 181.714-292.571 358.286 0 201.714 164 365.714 365.714 365.714s365.714-164 365.714-365.714c0-176.571-125.714-324.571-292.571-358.286v-130.286c237.714 35.429 420.571 240.571 420.571 488.571z']},ChevronDown:{viewBox:'0 0 1024 1024',paths:['M614.286 420.571q0 7.429-5.714 13.143l-266.286 266.286q-5.714 5.714-13.143 5.714t-13.143-5.714l-266.286-266.286q-5.714-5.714-5.714-13.143t5.714-13.143l28.571-28.571q5.714-5.714 13.143-5.714t13.143 5.714l224.571 224.571 224.571-224.571q5.714-5.714 13.143-5.714t13.143 5.714l28.571 28.571q5.714 5.714 5.714 13.143z']},ChevonLeft:{viewBox:'0 0 1024 1024',paths:['M669.143 172l-303.429 303.429 303.429 303.429q10.857 10.857 10.857 25.714t-10.857 25.714l-94.857 94.857q-10.857 10.857-25.714 10.857t-25.714-10.857l-424-424q-10.857-10.857-10.857-25.714t10.857-25.714l424-424q10.857-10.857 25.714-10.857t25.714 10.857l94.857 94.857q10.857 10.857 10.857 25.714t-10.857 25.714z']},ChevronRight:{viewBox:'0 0 1024 1024',paths:['M632.571 501.143l-424 424q-10.857 10.857-25.714 10.857t-25.714-10.857l-94.857-94.857q-10.857-10.857-10.857-25.714t10.857-25.714l303.429-303.429-303.429-303.429q-10.857-10.857-10.857-25.714t10.857-25.714l94.857-94.857q10.857-10.857 25.714-10.857t25.714 10.857l424 424q10.857 10.857 10.857 25.714t-10.857 25.714z']},ChevronUp:{viewBox:'0 0 1024 1024',paths:['M614.286 676.571q0 7.429-5.714 13.143l-28.571 28.571q-5.714 5.714-13.143 5.714t-13.143-5.714l-224.571-224.571-224.571 224.571q-5.714 5.714-13.143 5.714t-13.143-5.714l-28.571-28.571q-5.714-5.714-5.714-13.143t5.714-13.143l266.286-266.286q5.714-5.714 13.143-5.714t13.143 5.714l266.286 266.286q5.714 5.714 5.714 13.143z']},ClearTextbox:{viewBox:'0 0 1024 1024',paths:['M1014.662 822.66c-0.004-0.004-0.008-0.008-0.012-0.010l-310.644-310.65 310.644-310.65c0.004-0.004 0.008-0.006 0.012-0.010 3.344-3.346 5.762-7.254 7.312-11.416 4.246-11.376 1.824-24.682-7.324-33.83l-146.746-146.746c-9.148-9.146-22.45-11.566-33.828-7.32-4.16 1.55-8.070 3.968-11.418 7.31 0 0.004-0.004 0.006-0.008 0.010l-310.648 310.652-310.648-310.65c-0.004-0.004-0.006-0.006-0.010-0.010-3.346-3.342-7.254-5.76-11.414-7.31-11.38-4.248-24.682-1.826-33.83 7.32l-146.748 146.748c-9.148 9.148-11.568 22.452-7.322 33.828 1.552 4.16 3.97 8.072 7.312 11.416 0.004 0.002 0.006 0.006 0.010 0.010l310.65 310.648-310.65 310.652c-0.002 0.004-0.006 0.006-0.008 0.010-3.342 3.346-5.76 7.254-7.314 11.414-4.248 11.376-1.826 24.682 7.322 33.83l146.748 146.746c9.15 9.148 22.452 11.568 33.83 7.322 4.16-1.552 8.070-3.97 11.416-7.312 0.002-0.004 0.006-0.006 0.010-0.010l310.648-310.65 310.648 310.65c0.004 0.002 0.008 0.006 0.012 0.008 3.348 3.344 7.254 5.762 11.414 7.314 11.378 4.246 24.684 1.826 33.828-7.322l146.746-146.748c9.148-9.148 11.57-22.454 7.324-33.83-1.552-4.16-3.97-8.068-7.314-11.414z']},ShowPassword:{viewBox:'0 0 1024 1024',paths:['M512 192c-223.318 0-416.882 130.042-512 320 95.118 189.958 288.682 320 512 320 223.312 0 416.876-130.042 512-320-95.116-189.958-288.688-320-512-320zM764.45 361.704c60.162 38.374 111.142 89.774 149.434 150.296-38.292 60.522-89.274 111.922-149.436 150.296-75.594 48.218-162.89 73.704-252.448 73.704-89.56 0-176.858-25.486-252.452-73.704-60.158-38.372-111.138-89.772-149.432-150.296 38.292-60.524 89.274-111.924 149.434-150.296 3.918-2.5 7.876-4.922 11.86-7.3-9.96 27.328-15.41 56.822-15.41 87.596 0 141.382 114.616 256 256 256 141.382 0 256-114.618 256-256 0-30.774-5.452-60.268-15.408-87.598 3.978 2.378 7.938 4.802 11.858 7.302v0zM512 416c0 53.020-42.98 96-96 96s-96-42.98-96-96 42.98-96 96-96 96 42.982 96 96z']},AlertQuestion:{viewBox:'0 0 1024 1024',paths:['M512 786.286v-109.714q0-8-5.143-13.143t-13.143-5.143h-109.714q-8 0-13.143 5.143t-5.143 13.143v109.714q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143zM658.286 402.286q0-50.286-31.714-93.143t-79.143-66.286-97.143-23.429q-138.857 0-212 121.714-8.571 13.714 4.571 24l75.429 57.143q4 3.429 10.857 3.429 9.143 0 14.286-6.857 30.286-38.857 49.143-52.571 19.429-13.714 49.143-13.714 27.429 0 48.857 14.857t21.429 33.714q0 21.714-11.429 34.857t-38.857 25.714q-36 16-66 49.429t-30 71.714v20.571q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143q0-10.857 12.286-28.286t31.143-28.286q18.286-10.286 28-16.286t26.286-20 25.429-27.429 16-34.571 7.143-46.286zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z']},AlertWarning:{viewBox:'0 0 1024 1024',paths:['M585.143 785.714v-108.571c0-10.286-8-18.857-18.286-18.857h-109.714c-10.286 0-18.286 8.571-18.286 18.857v108.571c0 10.286 8 18.857 18.286 18.857h109.714c10.286 0 18.286-8.571 18.286-18.857zM584 572l10.286-262.286c0-3.429-1.714-8-5.714-10.857-3.429-2.857-8.571-6.286-13.714-6.286h-125.714c-5.143 0-10.286 3.429-13.714 6.286-4 2.857-5.714 8.571-5.714 12l9.714 261.143c0 7.429 8.571 13.143 19.429 13.143h105.714c10.286 0 18.857-5.714 19.429-13.143zM576 38.286l438.857 804.571c12.571 22.286 12 49.714-1.143 72s-37.143 36-62.857 36h-877.714c-25.714 0-49.714-13.714-62.857-36s-13.714-49.714-1.143-72l438.857-804.571c12.571-23.429 37.143-38.286 64-38.286s51.429 14.857 64 38.286z']},Search:{viewBox:'0 0 1024 1024',paths:['M658.286 475.429c0-141.143-114.857-256-256-256s-256 114.857-256 256 114.857 256 256 256 256-114.857 256-256zM950.857 950.857c0 40-33.143 73.143-73.143 73.143-19.429 0-38.286-8-51.429-21.714l-196-195.429c-66.857 46.286-146.857 70.857-228 70.857-222.286 0-402.286-180-402.286-402.286s180-402.286 402.286-402.286 402.286 180 402.286 402.286c0 81.143-24.571 161.143-70.857 228l196 196c13.143 13.143 21.143 32 21.143 51.429z']},UserIconEmpty:{viewBox:'0 0 1024 1024',paths:['M686.286 448c80.571 23.429 191.429 102.857 191.429 362.857 0 117.714-87.429 213.143-194.857 213.143h-488c-107.429 0-194.857-95.429-194.857-213.143 0-260 110.857-339.429 191.429-362.857-28.571-45.143-45.143-98.286-45.143-155.429 0-161.143 131.429-292.571 292.571-292.571s292.571 131.429 292.571 292.571c0 57.143-16.571 110.286-45.143 155.429zM438.857 73.143c-121.143 0-219.429 98.286-219.429 219.429s98.286 219.429 219.429 219.429 219.429-98.286 219.429-219.429-98.286-219.429-219.429-219.429zM682.857 950.857c66.857 0 121.714-62.286 121.714-140 0-180-60.571-292.571-173.714-298.286-51.429 45.143-118.286 72.571-192 72.571s-140.571-27.429-192-72.571c-113.143 5.714-173.714 118.286-173.714 298.286 0 77.714 54.857 140 121.714 140h488z']},PlusSign:{viewBox:'0 0 1024 1024',paths:['M804.571 420.571v109.714q0 22.857-16 38.857t-38.857 16h-237.714v237.714q0 22.857-16 38.857t-38.857 16h-109.714q-22.857 0-38.857-16t-16-38.857v-237.714h-237.714q-22.857 0-38.857-16t-16-38.857v-109.714q0-22.857 16-38.857t38.857-16h237.714v-237.714q0-22.857 16-38.857t38.857-16h109.714q22.857 0 38.857 16t16 38.857v237.714h237.714q22.857 0 38.857 16t16 38.857z']}}})(E=f.Icons||(f.Icons={}))},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(8),A=h(9),M=h(0),N=h(11),D=h(3);class B extends A.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=R.IncidentMessageType.IncidentResponse,this.eventType=[M.IncidentEvents._Request_RespondToIncident]}createBotMessage(H){return{incidentid:H.incidentId,response:H.response.toString(),eta:H.eta,autoresponse:H.autoResponse}}handleFailedBotResponse(H,z){return E(this,void 0,void 0,function*(){return new Promise(($)=>E(this,void 0,void 0,function*(){if('incident_update_denied'===z.data.reason){const Y=z.data.reasonMessage||'Incident update denied.';this.layer.emit(M.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton('Cannot update Incident',Y,1)),yield this._dismissIncidentAlert(H.incidentId),$(!1)}}))})}handleMessage(H){return E(this,void 0,void 0,function*(){const z=H.data[this.messageKey],$=yield this.layer.getIncidentById(z.incidentid);if($){const Y=yield this.layer.getUserByJid(z.senderjid);if(Y){const G=D.enumFromString(z.response),J=N.createUserResponse(H.ts,Y,G,z.eta);yield this._addIncidentResponse($,J),yield this.layer.updateUsersLastSeenMappings()}}})}handleEvent(H,z){return E(this,void 0,void 0,function*(){if(H===M.IncidentEvents._Request_RespondToIncident){const $=z,Y=yield this.layer.getIncidentById($.incidentId);if(!Y)return;const G=this.layer.getCurrentUser();if(!G)return;try{const J={incidentId:Y.id,response:$.responseStatus,eta:$.eta,autoResponse:$.autoResponse};yield this.layer.sendMessageViaBot(R.IncidentMessageType.IncidentResponse,J)}catch(J){this.layer.error('Error sending response',J)}}})}_addIncidentResponse(H,z){return E(this,void 0,void 0,function*(){const $=this.layer.getCurrentUser();if($&&$.jid===z.responder.jid){const J=N.isConcludedResponse(z.status);J&&(yield this._dismissIncidentAlert(H.id))}const Y=N.getAndUpdateResponseCollection(H,z,this.layer.config.roles,this.layer.config.behaviour.restrictToPreConfiguredResponses);if(Y){N.aggregateResponseCollectionInformation(Y),yield this.layer.store.updateIncident(H);const G=N.findUserResponse(H,z.responder.jid);this.layer.emit(M.IncidentEvents.IncidentUpdated,new M.IncidentEventArgs(H)),this.layer.emit(M.IncidentEvents.IncidentResponse,new M.IncidentResponseEventArgs(H,G)),$&&$.jid===z.responder.jid&&N.isConcludedResponse(G.status)&&(yield this._dismissIncidentAlert(H.id))}})}_dismissIncidentAlert(H){return E(this,void 0,void 0,function*(){yield this.layer.store.removePendingAlert(H),this.layer.emit(M.IncidentEvents.IncidentAlertChange)})}}f.IncidentResponseHandler=B},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(D,B,H,z){return new(H||(H=Promise))(function($,Y){function G(X){try{W(z.next(X))}catch(K){Y(K)}}function J(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(G,J)}W((z=z.apply(D,B||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(9),A=h(8),M=h(0);class N extends R.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=A.IncidentMessageType.RemoveFromRole,this.eventType=[M.IncidentEvents._Request_LeaveRole]}createBotMessage(D){return{roleid:D.role.id,rolename:D.role.name,removeuserjid:D.removeUser&&D.removeUser.jid||null,newuserjid:D.newUser&&D.newUser.jid||null,newusername:D.newUser&&D.newUser.displayName||null}}handleMessage(D){return E(this,void 0,void 0,function*(){const B=this.layer.getCurrentUser();if(!B)return;const H=D.data[this.messageKey];if(this._shouldKickUser(B,H.removeuserjid,H.roleid,D.ts)){const z=this.layer.config.roles.find(($)=>$.id===H.roleid);if(!z)throw new Error(`Unable to find role with id: ${H.roleid} (role name: ${H.rolename})`);H.newuserjid&&this._showKickedOffMessage(z,B,H.newusername),yield this.layer.comms.leaveRole(),yield this.layer.logout()}else yield this.layer.updateAllStateFromBot()})}handleEvent(D){return E(this,void 0,void 0,function*(){if(D===M.IncidentEvents._Request_LeaveRole){const H=this.layer.getCurrentUser();if(!H||!H.role)return;const z={role:H.role,removeUser:H};yield this.layer.sendMessageViaBot(A.IncidentMessageType.RemoveFromRole,z)}})}_shouldKickUser(D,B,H,z){return B&&B!==D.jid?!1:D.role&&D.role.id===H&&!!D.isOnCall&&(D.cameOnCall&&D.cameOnCall>z?!1:!0)}_showKickedOffMessage(D,B,H){const z=this.layer.getLabel('LABEL_USER_KICKED_TITLE',{role:D&&D.name||'',currentUser:B.displayName,newUser:H})||'Attention',$=this.layer.getLabel('LABEL_USER_KICKED_MESSAGE',{role:D&&D.name||'',currentUser:B.displayName,newUser:H})||'You have been replaced in this role by another user.',Y=I.DefaultAlerts.AlertAcknowledge(z,$,1,{},'Acknowledge');this.layer.emit(M.IncidentEvents._Request_RaiseAlert,Y)}}f.RemoveFromRoleHandler=N},function(u,f,h){'use strict';function I(N){if(!N)return null;const D=[M.ResponseStatus.Unable,M.ResponseStatus.Attending,M.ResponseStatus.Acknowledged];return D.includes(N.status)?N.status:null}function R(N){return N===M.ResponseStatus.Unable?'Unable:':N===M.ResponseStatus.Attending?'Attend:':N===M.ResponseStatus.Acknowledged?'Ack:':''}Object.defineProperty(f,'__esModule',{value:!0});const A=h(1),M=h(7);f.incidentResponseCollectionToRoleResponse=function(N,D,B,H){const z=D.responses[0]||null,$=null!==z&&!!z.responder,Y=H.find((ae)=>ae.name===D.name),G=Y&&Y.attender,J=$&&B&&B.find((ae)=>ae.jid===z.responder.jid),X=B&&B.some((ae)=>$&&ae.jid===z.responder.jid&&ae.role.id===z.responder.roleId),K=J&&J.connectionStatus===A.ConnectionStatus.Connected,Q=$?z.responder.name||z.responder.jid||'-':'Off Duty',Z=$?z.responder.telephone||'-':'',ee=I(z),te=null===ee?null:z.date,ne=R(ee),se=z&&(z.state||[]).find((ae)=>ae.state===M.ResponderState.Arrived)||null,oe=(D.collectionState||[]).find((ae)=>ae.state===M.ResponseCollectionState.StandInArranged)||null;return{jid:$&&z.responder.jid,isAttender:G,wasOnCall:$,isCurrentlyOnCall:X,isOnline:K,roleId:D.id,roleName:D.name,onCallUserName:Q,onCallUserTelephone:Z,transmittedDate:$&&N.opened.date||null,receivedDate:$&&z.received||null,responseDate:te,responseType:ee,responseLabel:ne,arrivedDate:se&&se.date||null,standInDate:oe&&oe.date||null}}},function(u,f,h){'use strict';var E=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,G=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(J=B[W])&&(G=(3>Y?J(G):3<Y?J(H,z,G):J(H,z))||G);return 3<Y&&G&&Object.defineProperty(H,z,G),G},I=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(1),M=h(4),N=h(5);class D extends R.CTLayerComponent{constructor(){super(...arguments),this._rippleTimeout=null}static get is(){return'ct-button'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}@keyframes ripple{100%{transform:scale(2);opacity:0}}:host{display:block;position:relative}:host button{position:relative;background:transparent;color:#000;padding:0.55em 1em;border:1px solid transparent;border-radius:0;font-size:inherit;font-weight:inherit;outline:none;cursor:pointer;overflow:hidden;width:100%;height:100%}:host button .button-content{pointer-events:none;display:inline-flex;justify-content:center;align-items:center}:host button .button-content .icon{display:block}:host button .button-content .label{display:block}:host button .button-content .icon+.label{margin:0 0 0 5px}:host button .ripple{background-color:white;border-radius:50%;opacity:0.4;transform:scale(0.01);position:absolute;pointer-events:none}:host button .ripple.animate{animation:ripple 0.6s ease-out}:host button.primary{background-color:var(--button-primary-bg, #000);border:var(--button-primary-border, 1px solid #000);color:var(--button-primary-text, #fff);width:var(--button-primary-width, 100%);height:var(--button-primary-height, 100%);border-radius:var(--button-primary-border-radius, 0);font-size:var(--button-primary-font-size, inherit);font-weight:var(--button-primary-font-weight, inherit)}:host button.primary .ripple{background-color:var(--button-primary-ripple, #fff)}:host button.secondary{background-color:var(--button-secondary-bg, transparent);border:var(--button-secondary-border, 1px solid #000);color:var(--button-secondary-text, #000)}:host button.secondary .ripple{background-color:var(--button-secondary-ripple, #000)}:host button.tertiary{background-color:var(--button-tertiary-bg, #ddd);border:var(--button-tertiary-border, 1px solid #ddd);color:var(--button-tertiary-text, #000)}:host button.tertiary .ripple{background-color:var(--button-tertiary-ripple, #fff)}:host button.invert-primary{background:var(--button-invert-primary-bg, #fff);border:var(--button-invert-primary-border, 1px solid #fff);color:var(--button-invert-primary-text, #2c394e)}:host button.invert-primary .ripple{background-color:var(--button-invert-primary-ripple, #2c394e)}:host button.invert-secondary{background:var(--button-invert-secondary-bg, transparent);border:var(--button-invert-secondary-border, 1px solid #fff);color:var(--button-invert-secondary-text, #fff)}:host button.invert-secondary .ripple{background-color:var(--button-invert-secondary-ripple, #fff)}:host button.selected{background-color:var(--button-selected-bg, #15233b);border:var(--button-selected-border, 1px solid #15233b);color:var(--button-selected-text, #fff)}:host button.selected .ripple{background-color:var(--button-selected-ripple, #fff)}:host button.cancel{background-color:var(--button-cancel-bg, transparent);border:var(--button-cancel-border, 1px solid #fff);color:var(--button-cancel-text, #000)}:host button.cancel .ripple{background-color:var(--button-cancel-ripple, #000)}:host button.warning{background-color:var(--button-warning-bg, #fdb851);border:var(--button-warning-border, #fdb851);color:var(--button-warning-text, #fff)}:host button.warning .ripple{background-color:var(--button-warning-ripple, #fff)}:host button.dangerous{background-color:var(--button-dangerous-bg, #f24647);border:var(--button-dangerous-border, #f24647);color:var(--button-dangerous-text, #fff)}:host button.dangerous .ripple{background-color:var(--button-dangerous-ripple, #fff)}:host button.headerBack{background-color:#231f20;border:none;color:white}:host button.headerBack .ripple{background-color:white}:host button.transparent{background-color:transparent;border:none}:host button.large{padding:1.25em 1em}:host button[disabled]{opacity:0.5;cursor:not-allowed}
        `}generateComponentMarkup(){const B=[this.type];this.selected&&B.push('selected'),this.large&&B.push('large'),this.isWaiting&&B.push('waiting'),this.isTransparent&&B.push('transparent');const H=A.Icons.COMMON.LoadingSpinner,z=M.buildStyles(!this.textColor?{}:{color:this.textColor});return window.__CTRender('button',{class:B.join(' '),style:z,disabled:this.isWaiting||this.disabled,onClick:($)=>this.handleButtonClick($)},window.__CTRender('div',{class:'button-content'},M.renderIf(!this.isWaiting&&!!this.icon,window.__CTRender(N.CTIcon,{icon:this.icon,color:this.iconColor,width:this.iconWidth,height:this.iconHeight,class:'icon'})),M.renderIfElse(this.isWaiting,window.__CTRender(N.CTIcon,{icon:H,color:this.iconColor,width:this.iconHeight,height:this.iconHeight,spin:!0,class:'icon'}),window.__CTRender('div',{class:'label'},window.__CTRender('slot',null)))))}handleButtonClick(B){if(!this.disabled&&(this._ripple(B.offsetX,B.offsetY,B.target),'function'==typeof this.onClick)){const H=Object.create(B,{target:{value:this}});this.onClick(H)}}_ripple(B,H,z){const $=z.querySelector('.ripple');$&&$.remove();const Y=z.clientWidth,G=z.clientHeight,J=_Mathmax(Y,G);clearTimeout(this._rippleTimeout),this._rippleTimeout=setTimeout(()=>{const K=document.createElement('span');K.classList.add('ripple'),K.style.width=`${J}px`,K.style.height=`${J}px`,K.style.left=`${B-J/2}px`,K.style.top=`${H-J/2}px`,z.insertBefore(K,z.firstChild),K.addEventListener('animationend',()=>{K.remove()}),K.classList.add('animate')},0)}}E([R.prop({type:String,attribute:!0,default:'primary'})],D.prototype,'type',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],D.prototype,'selected',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],D.prototype,'disabled',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],D.prototype,'large',void 0),E([R.prop({type:String,attribute:!0})],D.prototype,'textColor',void 0),E([R.prop({type:String,attribute:!0,default:'auto'})],D.prototype,'iconColor',void 0),E([R.prop({type:String,attribute:!0,default:'18px'})],D.prototype,'iconWidth',void 0),E([R.prop({type:String,attribute:!0,default:'18px'})],D.prototype,'iconHeight',void 0),E([R.prop({type:Function,attribute:!0})],D.prototype,'onClick',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],D.prototype,'isTransparent',void 0),E([R.prop({type:Object,attribute:!1,default:null})],D.prototype,'icon',void 0),E([R.prop({type:R.Stroolean,attribute:!1,default:!1})],D.prototype,'isWaiting',void 0),f.CTButton=D,D.register()},function(u,f,h){(function(E,I){var R;(function(A,M){u.exports=M()})(this,function(){'use strict';function A(Ge){return'function'==typeof Ge||'object'==typeof Ge&&null!==Ge}function M(Ge){return'function'==typeof Ge}function H(){return'undefined'==typeof xe?Y():function(){xe(G)}}function Y(){var Ge=setTimeout;return function(){return Ge(G,1)}}function G(){for(var Ge=0;Ge<we;Ge+=2){var Je=Be[Ge],We=Be[Ge+1];Je(We),Be[Ge]=void 0,Be[Ge+1]=void 0}we=0}function W(Ge,Je){var We=arguments,Xe=this,Ke=new this.constructor(K);void 0===Ke[je]&&he(Ke);var Qe=Xe._state;return Qe?function(){var Ze=We[Qe-1];Pe(function(){return ge(Qe,Ke,Ze,Xe._result)})}():ce(Xe,Ke,Ge,Je),Ke}function X(Ge){var Je=this;if(Ge&&'object'==typeof Ge&&Ge.constructor===Je)return Ge;var We=new Je(K);return ae(We,Ge),We}function K(){}function Q(){return new TypeError('You cannot resolve a promise with itself')}function Z(){return new TypeError('A promises callback cannot return that same promise.')}function ee(Ge){try{return Ge.then}catch(Je){return $e.error=Je,$e}}function te(Ge,Je,We,Xe){try{Ge.call(Je,We,Xe)}catch(Ke){return Ke}}function ne(Ge,Je,We){Pe(function(Xe){var Ke=!1,Qe=te(We,Je,function(Ze){Ke||(Ke=!0,Je===Ze?de(Xe,Ze):ae(Xe,Ze))},function(Ze){Ke||(Ke=!0,le(Xe,Ze))},'Settle: '+(Xe._label||' unknown promise'));!Ke&&Qe&&(Ke=!0,le(Xe,Qe))},Ge)}function se(Ge,Je){Je._state===Fe?de(Ge,Je._result):Je._state===ze?le(Ge,Je._result):ce(Je,void 0,function(We){return ae(Ge,We)},function(We){return le(Ge,We)})}function oe(Ge,Je,We){Je.constructor===Ge.constructor&&We===W&&Je.constructor.resolve===X?se(Ge,Je):We===$e?(le(Ge,$e.error),$e.error=null):void 0===We?de(Ge,Je):M(We)?ne(Ge,Je,We):de(Ge,Je)}function ae(Ge,Je){Ge===Je?le(Ge,Q()):A(Je)?oe(Ge,Je,ee(Je)):de(Ge,Je)}function ie(Ge){Ge._onerror&&Ge._onerror(Ge._result),ue(Ge)}function de(Ge,Je){Ge._state!==He||(Ge._result=Je,Ge._state=Fe,0!==Ge._subscribers.length&&Pe(ue,Ge))}function le(Ge,Je){Ge._state!==He||(Ge._state=ze,Ge._result=Je,Pe(ie,Ge))}function ce(Ge,Je,We,Xe){var Ke=Ge._subscribers,Qe=Ke.length;Ge._onerror=null,Ke[Qe]=Je,Ke[Qe+Fe]=We,Ke[Qe+ze]=Xe,0===Qe&&Ge._state&&Pe(ue,Ge)}function ue(Ge){var Je=Ge._subscribers,We=Ge._state;if(0!==Je.length){for(var Xe=void 0,Ke=void 0,Qe=Ge._result,Ze=0;Ze<Je.length;Ze+=3)Xe=Je[Ze],Ke=Je[Ze+We],Xe?ge(We,Xe,Ke,Qe):Ke(Qe);Ge._subscribers.length=0}}function pe(){this.error=null}function me(Ge,Je){try{return Ge(Je)}catch(We){return Ve.error=We,Ve}}function ge(Ge,Je,We,Xe){var Ke=M(We),Qe,Ze,et,nt;if(!Ke)Qe=Xe,et=!0;else if(Qe=me(We,Xe),Qe===Ve?(nt=!0,Ze=Qe.error,Qe.error=null):et=!0,Je===Qe)return void le(Je,Z());Je._state!==He||(Ke&&et?ae(Je,Qe):nt?le(Je,Ze):Ge===Fe?de(Je,Qe):Ge===ze&&le(Je,Qe))}function _e(Ge,Je){try{Je(function(Xe){ae(Ge,Xe)},function(Xe){le(Ge,Xe)})}catch(We){le(Ge,We)}}function fe(){return Ye++}function he(Ge){Ge[je]=Ye++,Ge._state=void 0,Ge._result=void 0,Ge._subscribers=[]}function ye(Ge,Je){this._instanceConstructor=Ge,this.promise=new Ge(K),this.promise[je]||he(this.promise),Me(Je)?(this._input=Je,this.length=Je.length,this._remaining=Je.length,this._result=Array(this.length),0===this.length?de(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&de(this.promise,this._result))):le(this.promise,Ce())}function Ce(){return new Error('Array Methods must be provided an Array')}function be(){throw new TypeError('You must pass a resolver function as the first argument to the promise constructor')}function Ee(){throw new TypeError('Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.')}function Ie(Ge){this[je]=fe(),this._result=this._state=void 0,this._subscribers=[],K!==Ge&&('function'!=typeof Ge&&be(),this instanceof Ie?_e(this,Ge):Ee())}var Ae=Array.isArray?Array.isArray:function(Ge){return'[object Array]'===Object.prototype.toString.call(Ge)};var Me=Ae,we=0,Pe=function(Je,We){Be[we]=Je,Be[we+1]=We,we+=2,2==we&&(Ne?Ne(G):qe())},Le='undefined'==typeof window?void 0:window,De=Le||{},Oe=De.MutationObserver||De.WebKitMutationObserver,ke='undefined'==typeof self&&'undefined'!=typeof E&&'[object process]'==={}.toString.call(E),Ue='undefined'!=typeof Uint8ClampedArray&&'undefined'!=typeof importScripts&&'undefined'!=typeof MessageChannel,Be=Array(1e3),xe,Ne,qe;qe=ke?function(){return function(){return E.nextTick(G)}}():Oe?function(){var Ge=0,Je=new Oe(G),We=document.createTextNode('');return Je.observe(We,{characterData:!0}),function(){We.data=Ge=++Ge%2}}():Ue?function(){var Ge=new MessageChannel;return Ge.port1.onmessage=G,function(){return Ge.port2.postMessage(0)}}():void 0!==Le||0?Y():function(){try{var Je=h(144);return xe=Je.runOnLoop||Je.runOnContext,H()}catch(We){return Y()}}();var je=Math.random().toString(36).substring(16),Fe=1,ze=2,$e=new pe,Ve=new pe,Ye=0,He;return ye.prototype._enumerate=function(){for(var Ge=this.length,Je=this._input,We=0;this._state===He&&We<Ge;We++)this._eachEntry(Je[We],We)},ye.prototype._eachEntry=function(Ge,Je){var We=this._instanceConstructor,Xe=We.resolve;if(Xe===X){var Ke=ee(Ge);if(Ke===W&&Ge._state!==He)this._settledAt(Ge._state,Je,Ge._result);else if('function'!=typeof Ke)this._remaining--,this._result[Je]=Ge;else if(We===Ie){var Qe=new We(K);oe(Qe,Ge,Ke),this._willSettleAt(Qe,Je)}else this._willSettleAt(new We(function(Ze){return Ze(Ge)}),Je)}else this._willSettleAt(Xe(Ge),Je)},ye.prototype._settledAt=function(Ge,Je,We){var Xe=this.promise;Xe._state===He&&(this._remaining--,Ge===ze?le(Xe,We):this._result[Je]=We),0===this._remaining&&de(Xe,this._result)},ye.prototype._willSettleAt=function(Ge,Je){var We=this;ce(Ge,void 0,function(Xe){return We._settledAt(Fe,Je,Xe)},function(Xe){return We._settledAt(ze,Je,Xe)})},Ie.all=function(Ge){return new ye(this,Ge).promise},Ie.race=function(Ge){var Je=this;return Me(Ge)?new Je(function(We,Xe){for(var Ke=Ge.length,Qe=0;Qe<Ke;Qe++)Je.resolve(Ge[Qe]).then(We,Xe)}):new Je(function(We,Xe){return Xe(new TypeError('You must pass an array to race.'))})},Ie.resolve=X,Ie.reject=function(Ge){var Je=this,We=new Je(K);return le(We,Ge),We},Ie._setScheduler=function(Ge){Ne=Ge},Ie._setAsap=function(Ge){Pe=Ge},Ie._asap=Pe,Ie.prototype={constructor:Ie,then:W,catch:function(Je){return this.then(null,Je)}},Ie.polyfill=function(){var Ge;if('undefined'!=typeof I)Ge=I;else if('undefined'!=typeof self)Ge=self;else try{Ge=Function('return this')()}catch(Xe){throw new Error('polyfill failed because global object is unavailable in this environment')}var Je=Ge.Promise;if(Je){var We=null;try{We=Object.prototype.toString.call(Je.resolve())}catch(Xe){}if('[object Promise]'===We&&!Je.cast)return}Ge.Promise=Ie},Ie.Promise=Ie,Ie})}).call(f,h(141),h(39))},function(u){var h=function(){return this}();try{h=h||Function('return this')()||(1,eval)('this')}catch(E){'object'==typeof window&&(h=window)}u.exports=h},function(u,f,h){'use strict';var E=this&&this.__decorate||function(z,$,Y,G){var J=arguments.length,W=3>J?$:null===G?G=Object.getOwnPropertyDescriptor($,Y):G,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,G);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>J?X(W):3<J?X($,Y,W):X($,Y))||W);return 3<J&&W&&Object.defineProperty($,Y,W),W},I=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(1),M=h(10),N=h(0),D=h(7),B=h(5);class H extends M.CTILComponent{static get is(){return'ct-il-close-incident-modal'}initialize(){return I(this,void 0,void 0,function*(){this.connectionStatus=this.layer.getConnectionStatus()})}setupListeners(){this.addListener(N.IncidentEvents._Request_LaunchCloseIncidentModal,(z)=>{const $=(this.layer.config.closeReasons||[]).findIndex((Y)=>Y.default);-1!==$&&(this.selectionIdx=$,this.isValid=!0),this._launch(z)}),this.addListener(N.IncidentEvents.ConnectionStatusChange,(z)=>{this.connectionStatus=z.status})}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:none;width:100%;height:100%;background:var(--modal-overlay, rgba(0,0,0,0.5));position:fixed;z-index:1000;padding:20px;overflow:auto}:host .container{display:flex;flex-direction:column;margin:auto;width:100%;max-width:420px;background:var(--modal-bg, #fff)}:host .container .title{display:flex;justify-content:center;font-size:15px;text-transform:uppercase;padding:10px;text-align:center;background:var(--alert-error-bg, #c80031);color:var(--alert-error-text, #fff)}:host .container .content .close-reason{display:flex;flex-direction:row;align-items:center;padding:10px;background:#f0f0f0}:host .container .content .close-reason .label{margin-right:10px;flex:none}:host .container .content .close-reason .choices{flex:1 1}:host .container .content .message{padding:20px 50px;font-size:18px;font-weight:300;text-align:center}:host .container .buttons{padding:10px 5px;flex:0 0 auto;display:flex;flex-direction:row;justify-content:space-between}:host .container .buttons ct-button{flex:1;margin:0 5px}@media screen and (max-width: 640px){:host .container .content .close-reason .label{font-size:12px}}:host([showing]){display:flex}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:`container ${this.connectionStatus}`},window.__CTRender('div',{class:'title'},'Close Incident'),window.__CTRender('div',{class:'content'},this._renderChoices(),this._renderMessage()),window.__CTRender('div',{class:'buttons'},window.__CTRender(B.CTButton,{type:'primary',onClick:()=>this._close()},'No'),window.__CTRender(B.CTButton,{type:'primary',disabled:!this.isValid||this.connectionStatus===A.ConnectionStatus.Disconnected,onClick:()=>this._closeIncident()},'Yes')))}_renderChoices(){if(!0===this.incident.isTestIncident)return null;const z=(this.layer.config.closeReasons||[]).filter(($)=>!0!==$.unavailable).map(($,Y)=>{return{key:Y,value:$.buttonLabel||$.label}});return 1<z.length?window.__CTRender('div',{class:'close-reason'},window.__CTRender('div',{class:'label'},'Reason'),window.__CTRender('div',{class:'choices'},window.__CTRender(B.CTSelectionList,{options:z,onSelect:($)=>this._onSelection($),selected:this.selectionIdx}))):null}_renderMessage(){const z=this.getLabel('LABEL_CONFIRM_CLOSE_INCIDENT',{priority:this.incident.priority&&this.incident.priority.name||'',severity:this.incident.severity&&this.incident.severity.name||'',patientType:this.incident.patientType&&this.incident.patientType.name||'',location:this.incident.location&&this.incident.location.name||''})||'You are about to close this incident. Is this correct?';return window.__CTRender('div',{class:'message'},this.renderHtml(z))}_launch(z){z&&z.status===D.IncidentStatus.Open?(this.showing=!0,this.incident=z):(this.showing=!0,this.incident=null)}_onSelection(z){this.selectionIdx=z,this.isValid=!0}_closeIncident(){if(this.incident){const z=(this.layer.config.closeReasons||[])[this.selectionIdx];z&&this.emitEvent(N.IncidentEvents._Request_CloseIncident,new N.CloseIncidentEventArgs(this.incident.id,z))}this._close()}_close(){this.showing=!1}}E([R.prop({type:Boolean,attribute:!0,default:!1})],H.prototype,'showing',void 0),E([R.prop({type:Object,attribute:!1})],H.prototype,'incident',void 0),E([R.prop({type:R.NullableNumber,attribute:!1})],H.prototype,'selectionIdx',void 0),E([R.prop({type:Boolean,attribute:!1})],H.prototype,'isValid',void 0),E([R.prop({type:String,attribute:!1,default:A.ConnectionStatus.Disconnected})],H.prototype,'connectionStatus',void 0),f.CTILCloseIncidentModal=H,H.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(J,W,X,K){var Q=arguments.length,Z=3>Q?W:null===K?K=Object.getOwnPropertyDescriptor(W,X):K,ee;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Z=Reflect.decorate(J,W,X,K);else for(var te=J.length-1;0<=te;te--)(ee=J[te])&&(Z=(3>Q?ee(Z):3<Q?ee(W,X,Z):ee(W,X))||Z);return 3<Q&&Z&&Object.defineProperty(W,X,Z),Z},I=this&&this.__awaiter||function(J,W,X,K){return new(X||(X=Promise))(function(Q,Z){function ee(se){try{ne(K.next(se))}catch(oe){Z(oe)}}function te(se){try{ne(K['throw'](se))}catch(oe){Z(oe)}}function ne(se){se.done?Q(se.value):new X(function(oe){oe(se.value)}).then(ee,te)}ne((K=K.apply(J,W||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(1),M=h(10),N=h(7),D=h(0),B=h(11),H=h(3),z=h(4),$=h(5),Y=h(1);class G extends M.CTILComponent{constructor(){super(...arguments),this.TIMER_ID='incidentModalTimer',this.previousData=null,this._confirmationAlert=null}static get is(){return'ct-il-incident-alert'}initialize(){return I(this,void 0,void 0,function*(){const J=this.layer.getConnectionStatus();yield this._handleConnectionStatus(J)})}setupListeners(){this.addListener(D.IncidentEvents.BotResponseReceived,(J)=>I(this,void 0,void 0,function*(){this.incident&&this.incident.id===J.data.incidentId&&(yield H.sleep(1e3),this.responded=!1)})),this.addListener(D.IncidentEvents.ConnectionStatusChange,(J)=>I(this,void 0,void 0,function*(){yield this._handleConnectionStatus(J.status)})),this.addListener(D.IncidentEvents.IncidentUpdated,(J)=>I(this,void 0,void 0,function*(){this.incident&&this.incident.id===J.incident.id&&this.debounce('update',()=>{this._establishIncidentToDisplay()})})),this.addListener(D.IncidentEvents.IncidentClosed,(J)=>I(this,void 0,void 0,function*(){this.incident&&this.incident.id===J.incident.id&&this.debounce('update',()=>{this._establishIncidentToDisplay()})})),this.addListener(D.IncidentEvents.IncidentAlertChange,()=>I(this,void 0,void 0,function*(){this.debounce('update',()=>{this._establishIncidentToDisplay()})})),this.addListener(D.IncidentEvents.OnCallUsersChange,()=>I(this,void 0,void 0,function*(){this.forceRedraw()}))}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{height:100%;width:100%;display:flex;flex-direction:column;transform:translateY(100%);will-change:transform;transition:transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);visibility:hidden;position:fixed;top:0;z-index:1}:host .container{position:relative;height:100%;width:100%;display:flex;flex-direction:column;padding:5px;font-size:20px}:host .container .watermark,:host .container .fade-overlay{display:block;position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}:host .container .watermark{z-index:1;color:#ffffff;opacity:0.1}:host .container .watermark .icon{position:absolute;bottom:20px;right:0}:host .container .fade-overlay{z-index:2;background:linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0) 60%, currentColor 75%)}:host .container .header{display:flex;justify-content:space-between;align-items:center;color:#ffffff;font-size:12px;font-weight:300;flex:none;padding:10px 15px;z-index:3}:host .container .header .user{margin:0 0 0 auto;display:flex;align-items:center}:host .container .header .user .label{margin:0 5px 0 0;font-weight:100}:host .container .header .user .username{font-weight:400}:host .container .content{flex:1 1;display:flex;flex-direction:column;overflow:auto;z-index:3}:host .container .content .data{display:flex;flex-direction:row;align-items:center;flex:none;margin:0 0 1px 0;padding:10px 15px;color:white;text-transform:uppercase;background:rgba(255,255,255,0.25)}:host .container .content .data .label{display:flex;flex-direction:row;flex:1 1}:host .container .content .data .icon{text-align:center;flex:0 0 40px;margin:0 0 0 10px}:host .container .content .data .icon.initials-icon{display:flex;justify-content:center;align-items:center;background:#ffffff;min-width:40px;height:40px;border-radius:50%;font-weight:700}:host .container .content .data.severity{text-indent:0}:host .container .content .data.severity .label{align-items:center}:host .container .content .data.severity .label .change{font-size:12px;text-transform:uppercase;border-radius:15px;padding:0 5px;margin:0 5px}:host .container .content .data.severity .label .time{margin:0 0 0 auto;font-weight:300}:host .container .content .data.priority .label,:host .container .content .data.patient-type .label,:host .container .content .data.location .label{margin:0 20px 0 0}:host .container .content .data.closed{height:180px;display:flex;justify-content:center;align-items:center;text-align:center}:host .container .buttons{display:flex;flex:0 0 auto;flex-direction:column;padding:5px;z-index:3}:host .container .buttons ct-button.yes{font-weight:400}:host .container .buttons ct-button.no{font-weight:300}:host .container .buttons ct-button+ct-button{margin:10px 0 0 0}:host([showing]){visibility:visible;transform:translateY(0)}
        `}generateComponentMarkup(){if(!this.showing)return null;if(!this.incident)return null;const J=this.layer.getCurrentUser();if(!J||!J.isOnCall)return null;const W=B.findUserResponse(this.incident,J.jid);if(W&&W.status===N.ResponseStatus.Unable){const Z=(this.incident.actions||[]).filter((te)=>te.action===N.IncidentAction.ChangeSeverity);Z.sort((te,ne)=>ne.date-te.date);const ee=Z[0]||null;if(ee){const te=this.layer.config.severities.find((se)=>{const oe=se.changes.find((ae)=>ae.id===ee.reference);return void 0!==oe}),ne=te.changes.find((se)=>se.id===ee.reference);if(ne&&!ne.unableToAttendNotified)return null}}const X=this.incident,K=X.severity.colorCode,Q=z.buildStyles({backgroundColor:K,color:K});return this.onRenderComplete(()=>{const Z=this.shadowRoot.querySelector('.container');if(Z){const ee=Z.style.display;Z.style.display='none',Z.offsetHeight,Z.style.display=ee}},!0),this._raiseEventIfChanged(this.incident),window.__CTRender('div',{class:'container',style:Q},window.__CTRender('div',{class:'watermark'},window.__CTRender($.CTIcon,{class:'icon',width:'200%',height:'200%',icon:N.Icons.INCIDENT_ALERT.Watermark})),window.__CTRender('div',{class:'fade-overlay'}),window.__CTRender('div',{class:'header'},window.__CTRender('div',{class:'online-status'},window.__CTRender($.CTOnlineIndicator,null)),window.__CTRender('div',{class:'user'},window.__CTRender('span',{class:'label'},'User:'),window.__CTRender($.CTUserDisplay,{class:'username',showIcon:!1}))),this._renderAlertContent(X),window.__CTRender('div',{class:'buttons'},this._renderButtons(X,J,W)))}_renderAlertContent(J){return this.incident.status===N.IncidentStatus.Open?this._renderOpenIncidentDetails(J):this._renderClosedIncidentDetails(J)}_renderOpenIncidentDetails(J){return window.__CTRender('div',{class:'content'},this._renderSeverity(J),this._renderPriority(J),this._renderPatientType(J),this._renderLocation(J))}_renderClosedIncidentDetails(J){return window.__CTRender('div',{class:'content'},this._renderSeverity(J),this._renderClosedNotice(J))}_renderSeverity(J){const W=(J.actions||[]).filter((Z)=>Z.action===N.IncidentAction.ChangeSeverity);W.sort((Z,ee)=>ee.date-Z.date);const X=W[0]||null,K=X?X.data:null,Q=z.buildStyles({backgroundColor:'#ffffff',color:J.severity.colorCode});return window.__CTRender('div',{class:'data severity'},window.__CTRender('div',{class:'label'},window.__CTRender('div',{class:'name'},J.severity.name),z.renderIf(!!K,window.__CTRender('div',{class:'change',style:Q},K)),window.__CTRender('div',{class:'time'},H.formatDate(J.opened.date,'HH:mm'))),window.__CTRender($.CTIcon,{class:'icon',width:'20',height:'20',icon:N.Icons.INCIDENT_ALERT.BellFilled}))}_renderPriority(J){return J.priority?!1===J.priority.display?null:window.__CTRender('div',{class:'data priority'},window.__CTRender('div',{class:'label'},J.priority.name)):null}_renderPatientType(J){return J.patientType?window.__CTRender('div',{class:'data patient-type'},window.__CTRender('div',{class:'label'},J.patientType.name),window.__CTRender($.CTIcon,{class:'icon',width:'20',height:'20',icon:N.Icons.INCIDENT_ALERT.PatientType})):null}_renderLocation(J){if(!J.location)return null;const W=z.buildStyles({backgroundColor:'#ffffff',color:J.severity.colorCode});return window.__CTRender('div',{class:'data location'},window.__CTRender('div',{class:'label'},J.location.name),window.__CTRender('div',{class:'icon initials-icon',style:W},J.location.initials||J.location.shortName||J.location.name))}_renderClosedNotice(J){const W=J.closedReasonId&&(this.layer.config.closeReasons||[]).find((K)=>K.id===J.closedReasonId),X=!W?'Closed':W.label||'Closed';return window.__CTRender('div',{class:'data closed'},'Incident',window.__CTRender('br',null),X)}_renderButtons(J,W,X){const K=J.severity.colorCode,Q=[N.ResponseStatus.Acknowledged,N.ResponseStatus.Attending,N.ResponseStatus.Unable],Z=X&&Q.includes(X.status),ee=J.status===N.IncidentStatus.Closed;let te=!1;if(ee)te=!0;else if(Z&&(te=!0),X&&X.status===N.ResponseStatus.Unable){const ne=(J.actions||[]).filter((oe)=>oe.action===N.IncidentAction.ChangeSeverity);ne.sort((oe,ae)=>ae.date-oe.date);const se=ne[0]||null;if(se){const oe=this.layer.config.severities.find((ie)=>{const de=ie.changes.find((le)=>le.id===se.reference);return void 0!==de}),ae=oe.changes.find((ie)=>ie.id===se.reference);Z&&ae.unableToAttendReRespond&&(te=!1)}}return te?[window.__CTRender($.CTButton,{class:'yes',type:'invert-primary',textColor:K,disabled:!this.connected||this.responded,onClick:()=>this._acknowledgeAndDismiss()},'ACKNOWLEDGE')]:!J.isTestIncident&&W.role&&W.role.attender?[window.__CTRender($.CTButton,{class:'yes',type:'invert-primary',textColor:K,large:!0,disabled:!this.connected||this.responded,onClick:()=>this._confirmAttendance('ATTENDING?','Attend').then((se)=>{se&&this._sendResponse(N.ResponseStatus.Attending)})},'ATTEND'),window.__CTRender($.CTButton,{class:'no',type:'invert-secondary',disabled:!this.connected||this.responded,onClick:()=>this._confirmAttendance('CAN\'T ATTEND','Unable').then((se)=>{se&&this._sendResponse(N.ResponseStatus.Unable)})},'UNABLE')]:[window.__CTRender($.CTButton,{class:'yes',type:'invert-primary',textColor:K,disabled:!this.connected||this.responded,onClick:()=>this._sendResponse(N.ResponseStatus.Acknowledged)},'ACKNOWLEDGE')]}_confirmAttendance(J,W){return new Promise((X)=>{return this.layer.config.behaviour.noConfirmAttendanceDialog?X(!0):void(this._confirmationAlert=Y.DefaultAlerts.AlertQuestion(J,`Are you sure you want to choose <strong>${W}</strong>?`,1,[{text:'No',type:'primary',action:()=>{this._confirmationAlert=void 0,X(!1)}},{text:'Yes',type:'primary',action:()=>{this._confirmationAlert=void 0,X(!0)}}],''),this.launchModal(this._confirmationAlert))})}_setConfirmationAlertOffline(J){if(this._confirmationAlert){const W=this._confirmationAlert.buttons.find((Q)=>'Yes'===Q.text);if(W.disabled&&!J)return;this.closeModal(this._confirmationAlert);const X=W.action,K=this._confirmationAlert.buttons.find((Q)=>'No'===Q.text).action;this._confirmationAlert=Y.DefaultAlerts.AlertQuestion(this._confirmationAlert.title,this._confirmationAlert.body,1,[{text:'No',type:'primary',action:K},{text:'Yes',type:'primary',disabled:!J,action:X}],''),this.launchModal(this._confirmationAlert)}}_handleConnectionStatus(J){return I(this,void 0,void 0,function*(){this.connected=J===A.ConnectionStatus.Connected,this._setConfirmationAlertOffline(this.connected);const W=this.layer.getCurrentUser();W||(this.incident=null,this.showing=!1),this.connected&&(yield this._establishIncidentToDisplay())})}_establishIncidentToDisplay(){return I(this,void 0,void 0,function*(){const J=this.layer.getCurrentUser(),W=H.deepCloneObject(this.incident),X=yield this.layer.getPendingAlerts();if(J&&J.isOnCall&&0<X.length){const K=X[0];this.incident=yield this.layer.getIncidentById(K),this.showing=null!==this.incident,this.responded=!1}else this.incident=null,this.showing=!1;if(null!==W&&!X.includes(W.id)){const K=B.findUserResponse(W,J.jid,J.role&&J.role.id);this.emitEvent(D.IncidentEvents.IncidentAlertDismissed,new D.IncidentAlertEventArgs(W,K))}})}_sendResponse(J){return I(this,void 0,void 0,function*(){this.incident&&(this.responded=!0,this.emitEvent(D.IncidentEvents._Request_RespondToIncident,new D.RespondedToIncidentEventArgs(this.incident.id,J,0)),setTimeout(()=>{this.responded=!1},5e3))})}_acknowledgeAndDismiss(){return I(this,void 0,void 0,function*(){this.incident&&(this.responded=!0,this.emitEvent(D.IncidentEvents._Request_AcknowledgeIncidentUpdate,new D.IncidentEventArgs(this.incident)),setTimeout(()=>{this.responded=!1},5e3))})}_raiseEventIfChanged(){if(this.incident){const W=H.deepCloneObject(this.incident);delete W.responses;const X=JSON.stringify(W);if(X!==this.previousData){const K=this.layer.getCurrentUser(),Q=B.findUserResponse(this.incident,K.jid,K.role&&K.role.id);this.emitEvent(D.IncidentEvents.IncidentAlert,new D.IncidentAlertEventArgs(this.incident,Q)),this.previousData=X}}}}E([R.prop({type:Boolean,attribute:!0,default:!1})],G.prototype,'showing',void 0),E([R.prop({type:Object,attribute:!1,default:null})],G.prototype,'incident',void 0),E([R.prop({type:Boolean,attribute:!1,default:!1})],G.prototype,'connected',void 0),E([R.prop({type:Boolean,attribute:!1,default:!1})],G.prototype,'responded',void 0),f.CTILIncidentAlert=G,G.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(z,$,Y,G){var J=arguments.length,W=3>J?$:null===G?G=Object.getOwnPropertyDescriptor($,Y):G,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,G);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>J?X(W):3<J?X($,Y,W):X($,Y))||W);return 3<J&&W&&Object.defineProperty($,Y,W),W},I=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(21),N=h(0),D=h(11),B=h(4);class H extends A.CTILComponent{constructor(){super(...arguments),this._initialized=!1}static get is(){return'ct-il-incident-list'}initialize(){return I(this,void 0,void 0,function*(){this.incidents=yield this.layer.getIncidents()})}setupListeners(){this.addListeners([N.IncidentEvents.NewIncident,N.IncidentEvents.IncidentUpdated,N.IncidentEvents.IncidentClosed],()=>I(this,void 0,void 0,function*(){this.debounce('update',()=>I(this,void 0,void 0,function*(){this.incidents=yield this.layer.getIncidents()}))}))}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host .no-incidents{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;font-size:18px;font-weight:400}
        `}generateComponentMarkup(){const z=this._getFilteredSortedIncidents();return B.renderIfElse(0<z.length,this._renderIncidents(z),this._renderEmpty())}_renderIncidents(z){return window.__CTRender('div',{class:'incident-list'},z.map(($)=>window.__CTRender(M.CTILIncidentDisplay,{incident:$,view:this.view,viewOptions:this.viewOptions})))}_renderEmpty(){return B.renderIf(!!this.noIncidentsMessage,window.__CTRender('div',{class:'no-incidents'},this.noIncidentsMessage))}_getFilteredSortedIncidents(){let z=[...(this.incidents||[])];this.showTestIncidents||(z=z.filter((Y)=>!Y.isTestIncident));const $=this.layer.getSyncedTimestamp();return z=D.filterIncidents(z,'status',this.statusFilter),z=D.orderIncidents(z,this.orderBy,this.orderByReverse),z=D.truncateIncidents(z,this.maxIncidents,this.maxIncidentAge,$),z}}E([R.prop({type:Number,attribute:!0,default:0})],H.prototype,'maxIncidents',void 0),E([R.prop({type:Number,attribute:!0,default:0})],H.prototype,'maxIncidentAge',void 0),E([R.prop({type:String,attribute:!0,default:'all'})],H.prototype,'statusFilter',void 0),E([R.prop({type:String,attribute:!0,default:'opened_date'})],H.prototype,'orderBy',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],H.prototype,'orderByReverse',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],H.prototype,'showTestIncidents',void 0),E([R.prop({type:String,attribute:!0})],H.prototype,'noIncidentsMessage',void 0),E([R.prop({type:String,attribute:!0})],H.prototype,'view',void 0),E([R.prop({type:String,attribute:!0})],H.prototype,'viewOptions',void 0),E([R.prop({type:Array,attribute:!1,default:[]})],H.prototype,'incidents',void 0),f.CTILIncidentList=H,H.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(H,z,$,Y){var G=arguments.length,J=3>G?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(J=(3>G?W(J):3<G?W(z,$,J):W(z,$))||J);return 3<G&&J&&Object.defineProperty(z,$,J),J},I=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(0),N=h(21),D=h(4);class B extends A.CTILComponent{static get is(){return'ct-il-last-incident-display'}initialize(){return I(this,void 0,void 0,function*(){this.incident=yield this.layer.getCurrentIncident()})}setupListeners(){this.addListeners([M.IncidentEvents.NewIncident,M.IncidentEvents.IncidentUpdated,M.IncidentEvents.IncidentClosed],()=>I(this,void 0,void 0,function*(){this.debounce('update',()=>I(this,void 0,void 0,function*(){this.incident=yield this.layer.getCurrentIncident()}))}))}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host .no-incidents{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;font-size:18px;font-weight:400}
        `}generateComponentMarkup(){const H={view:'responsesummary',viewOptions:JSON.stringify({headerOptions:{layout:'stacked',showSeverity:!0,showLocation:!0,showPriority:!0,showPatientType:!1,showCreator:!0,showStatus:!0,allowSeverityChange:!1,allowClose:!1},showRespondents:!1,respondentOrderBy:'date',respondentOrderByReverse:!1,respondentStatusFilter:'all',showIndividualResponses:!1,showCurrentUserResponse:!0})};return D.renderIfElse(!!this.incident,window.__CTRender(N.CTILIncidentDisplay,Object.assign({incident:this.incident},H)),window.__CTRender('div',{class:'no-incidents'},'No incident to display'))}}E([R.prop({type:Object,attribute:!1,default:null})],B.prototype,'incident',void 0),f.CTILLastIncidentDisplay=B,B.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,G=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(J=B[W])&&(G=(3>Y?J(G):3<Y?J(H,z,G):J(H,z))||G);return 3<Y&&G&&Object.defineProperty(H,z,G),G},I=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(0),N=h(5);class D extends A.CTILComponent{static get is(){return'ct-il-new-incident-button'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block}
        `}generateComponentMarkup(){return window.__CTRender(N.CTButton,{type:this.type,onClick:()=>this._triggerRequestNewIncident()},window.__CTRender('slot',null,'New Incident'))}_triggerRequestNewIncident(){const B=this.predefinedIncidentId&&this.layer.config.predefinedIncidents.find((H)=>H.id===this.predefinedIncidentId)||null;this.emitEvent(M.IncidentEvents._Request_NewIncident,new M.RequestNewIncidentEventArgs(B))}}E([R.prop({type:String,attribute:!0,default:'primary'})],D.prototype,'type',void 0),E([R.prop({type:String,attribute:!0})],D.prototype,'predefinedIncidentId',void 0),f.CTILNewIncidentButton=D,D.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(z,$,Y,G){var J=arguments.length,W=3>J?$:null===G?G=Object.getOwnPropertyDescriptor($,Y):G,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,G);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>J?X(W):3<J?X($,Y,W):X($,Y))||W);return 3<J&&W&&Object.defineProperty($,Y,W),W},I=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(1),M=h(10),N=h(0),D=h(4),B=h(5);class H extends M.CTILComponent{constructor(){super(...arguments),this._prioritySelectionItems=[],this._severitySelectionItems=[],this._patientTypeSelectionItems=[],this._locationSelectionItems=[],this._previousApplicableLocationIds=[]}static get is(){return'ct-il-new-incident-modal'}initialize(){return I(this,void 0,void 0,function*(){this._availablePriorities=this.layer.config.priorities.filter((z)=>!z.unavailable),this._availableSeverities=this.layer.config.severities.filter((z)=>!z.unavailable),this._availablePatientTypes=this.layer.config.patientTypes.filter((z)=>!z.unavailable),this._prioritySelectionItems=(this.layer.config.priorities||[]).filter((z)=>!0!==z.unavailable).map((z,$)=>{return{key:$,value:this._getItemName(z)}}),this._severitySelectionItems=(this.layer.config.severities||[]).filter((z)=>!0!==z.unavailable).map((z,$)=>{return{key:$,value:this._getItemName(z)}}),this._patientTypeSelectionItems=(this.layer.config.patientTypes||[]).filter((z)=>!0!==z.unavailable).map((z,$)=>{return{key:$,value:this._getItemName(z)}}),this._updateConnectionStatus(this.layer.getConnectionStatus())})}setupListeners(){this.addListener(N.IncidentEvents._Request_LaunchNewIncidentModal,()=>{this._launch()}),this.addListener(N.IncidentEvents._Request_LaunchOfflineModal,()=>{this._launchOffline()}),this.addListener(N.IncidentEvents.ConnectionStatusChange,(z)=>{this._updateConnectionStatus(z.status),!0===this.offlineMode&&z.status===A.ConnectionStatus.Connected&&this._close()})}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{width:100%;height:100%;display:flex;background:var(--modal-overlay, rgba(0,0,0,0.5));opacity:0;visibility:hidden;position:fixed;z-index:1}:host .container{display:flex;flex-direction:column;margin:auto;width:400px;height:90vh;background:var(--modal-bg, #fff);transform:translateY(100%);will-change:transform;transition:transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);visibility:hidden}:host .container .title{display:flex;justify-content:space-between;align-items:center;font-size:12px;font-weight:300;flex:none;flex-basis:var(--header-height, 50px);background-color:var(--primary-color, #15233b);color:var(--primary-font-color, #fff);padding:0 15px}:host .container .sub-title{flex:none;background-color:var(--sub-header-bg, #000);color:var(--sub-header-text, #fff);padding:10px 15px;text-align:center;font-size:18px;font-weight:300}:host .container .content{flex:1 1 auto;overflow:auto}:host .container .content .selection{position:relative}:host .container .content .selection .heading{position:relative;text-align:center;z-index:1}:host .container .content .selection .heading:before{content:"";margin:0 auto;position:absolute;top:50%;left:0;right:0;bottom:0;border-top:1px solid #9b9b9b;z-index:-1}:host .container .content .selection .heading .label{font-size:15px;font-weight:400;padding:0 20px;background-color:var(--modal-bg, #fff)}:host .container .content .selection .choices{padding:20px}:host .container .content .offline{padding:20px}:host .container .buttons{padding:5px 0;flex:0 0 auto;display:flex;flex-direction:row;justify-content:space-between}:host .container .buttons ct-button{flex:1;margin:0 5px}:host .container .buttons.stack-buttons{flex-direction:column}:host .container .buttons.stack-buttons ct-button{margin-top:5px}:host .container.disconnected{height:auto}:host .container.disconnected .title{background-color:var(--primary-color-offline, #9b9b9b)}:host .container.disconnected .sub-title{background-color:var(--alert-error-bg, #c80031)}:host .container.disconnected .content{padding:20px;text-align:center}@media screen and (max-width: 640px){:host .container{width:100%;height:100%;min-width:100%;max-height:100%}}:host([showing]){visibility:visible;transition:opacity 0.25s ease-in;opacity:1}:host([showing]) div.container{visibility:visible;transform:translateY(0)}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:`container ${this.connectionStatus}`},window.__CTRender('div',{class:'title'},this._renderTitle()),window.__CTRender('div',{class:'sub-title'},this._renderSubtitle()),window.__CTRender('div',{class:'content'},this._renderBody()),window.__CTRender('div',{class:`buttons ${this.layer.config.raiseNewIncidentOptions.stackButtons?'stack-buttons':''}`},this._renderButtons()))}_renderTitle(){return window.__CTRender(B.CTOnlineIndicator,null)}_renderSubtitle(){return D.renderIfElse(this.connectionStatus===A.ConnectionStatus.Connected&&!1===this.offlineMode,window.__CTRender('div',null,'New Incident'),window.__CTRender('div',null,'SYSTEM OFFLINE'))}_renderBody(){if(this.connectionStatus===A.ConnectionStatus.Connected&&!1===this.offlineMode)return[this._renderSelectionRow(this._prioritySelectionItems,'priority'),this._renderSelectionRow(this._severitySelectionItems,'severity'),this._renderSelectionRow(this._patientTypeSelectionItems,'patientType'),this._renderSelectionRow(this._locationSelectionItems,'location')].filter((z)=>null!==z);const z=this.getLabel('LABEL_NO_CONNECTIVITY')||'The system is offline and trying to reconnect. Please contact your system administrator if this issue persists.';return[window.__CTRender('div',{class:'offline'},window.__CTRender('div',{class:'icon'},window.__CTRender(B.CTIcon,{icon:A.Icons.COMMON.StatusOffline,width:'64px',height:'64px'})),window.__CTRender('p',null,this.renderHtml(z)))]}_renderButtons(){return!1===this.offlineMode?[window.__CTRender(B.CTButton,{type:'secondary',onClick:()=>this._close()},'Cancel'),window.__CTRender(B.CTButton,{type:'primary',disabled:this.disableSend||this.connectionStatus===A.ConnectionStatus.Disconnected,onClick:()=>this._sendNewIncident()},this.layer.config.raiseNewIncidentOptions&&this.layer.config.raiseNewIncidentOptions.sendButtonLabel||'Send')]:[window.__CTRender(B.CTButton,{type:'primary',onClick:()=>this._close()},'Okay')]}_renderSelectionRow(z,$){if(!z||0===z.length)return null;if(!this.newIncident||!this.newIncident[$])return null;const Y=D.buildStyles({display:this.newIncident[$].show?'block':'none'});let G='';const J=this.layer.config.raiseNewIncidentOptions||{};return'priority'===$?G=this._getHeading(J.prioritySelectionHeading,'Select Priority'):'severity'===$?G=this._getHeading(J.severitySelectionHeading,'Select Severity'):'patientType'===$?G=this._getHeading(J.patientTypeSelectionHeading,'Select Patient Type'):'location'===$?G=this._getHeading(J.locationSelectionHeading,'Select Location'):void 0,window.__CTRender('div',{class:'selection',style:Y},D.renderIf(!!G,window.__CTRender('div',{class:'heading'},window.__CTRender('span',{class:'label'},G))),window.__CTRender('div',{class:'choices'},window.__CTRender(B.CTSelectionList,{options:z,onSelect:(W)=>this._onSelection($,W),selected:this.newIncident[$].value})))}_launch(){this.offlineMode=!1,this.newIncident={priority:{show:!this.layer.config.raiseNewIncidentOptions.impliedSelectionForSingleItems||1<this._prioritySelectionItems.length,value:this._getDefaultValueIdx(this._availablePriorities)},severity:{show:!this.layer.config.raiseNewIncidentOptions.impliedSelectionForSingleItems||1<this._severitySelectionItems.length,value:this._getDefaultValueIdx(this._availableSeverities)},patientType:{show:!this.layer.config.raiseNewIncidentOptions.impliedSelectionForSingleItems||1<this._patientTypeSelectionItems.length,value:this._getDefaultValueIdx(this._availablePatientTypes)},location:{show:!0,value:null},isTest:!1},this._determineCorrectLocations(),this._validate(),this.showing=!0}_launchOffline(){this.offlineMode=!0,this.showing=!0}_getHeading(z,$){return null===z||z===void 0?$:z}_getItemName(z){return z.name.length<=15?z.name:z.shortName||z.name}_getDefaultValueIdx(z){const $=z.filter((G)=>!0!==G.unavailable);if(this.layer.config.raiseNewIncidentOptions.impliedSelectionForSingleItems&&1===$.length)return 0;const Y=$.findIndex((G)=>G.default);return-1===Y?null:Y}_determineCorrectLocations(){const z=this.layer.config.locations||[];let $=[];const Y=z.some((W)=>!!W.restrictions&&0<Object.keys(W.restrictions).length);if(Y){const W=this.newIncident.priority&&null!==this.newIncident.priority.value?this._availablePriorities[this.newIncident.priority.value].id:null,X=this.newIncident.severity&&null!==this.newIncident.severity.value?this._availableSeverities[this.newIncident.severity.value].id:null,K=this.newIncident.patientType&&null!==this.newIncident.patientType.value?this._availablePatientTypes[this.newIncident.patientType.value].id:null;z.forEach((Q)=>{const Z=Q.restrictions&&Q.restrictions.priorityIds||null,ee=Q.restrictions&&Q.restrictions.severityIds||null,te=Q.restrictions&&Q.restrictions.patientTypeIds||null;let ne=!0;Z&&0<Z.length&&!Z.includes(W)&&(ne=!1),ee&&0<ee.length&&!ee.includes(X)&&(ne=!1),te&&0<te.length&&!te.includes(K)&&(ne=!1),ne&&$.push(Q)})}else $=[...z];const G=$.map((W)=>W.id);this._previousApplicableLocationIds.join(',')!==G.join(',')&&(this._locationSelectionItems=$.map((W,X)=>{return{key:X,value:this._getItemName(W)}}),this._previousApplicableLocationIds=G);const J=this.newIncident.location&&null!==this.newIncident.location.value?this.layer.config.locations[this.newIncident.location.value].id:null;G.includes(J)||(this.newIncident.location={show:!this.layer.config.raiseNewIncidentOptions.impliedSelectionForSingleItems||1<this._locationSelectionItems.length,value:this._getDefaultValueIdx($)})}_onSelection(z,$){this.newIncident=Object.assign({},this.newIncident,{[z]:{show:this.newIncident[z].show,value:$}}),'location'!==z&&this._determineCorrectLocations(),this._validate()}_validateForCollection(z,$){let Y=!1;return z&&null!==z.value||1===$.length&&$[0].default&&$[0].unavailable||(Y=!0),Y}_validate(){let z=!1;this._validateForCollection(this.newIncident.priority,this.layer.config.priorities)&&(z=!0),this._validateForCollection(this.newIncident.severity,this.layer.config.severities)&&(z=!0),this._validateForCollection(this.newIncident.patientType,this.layer.config.patientTypes)&&(z=!0),this._validateForCollection(this.newIncident.location,this.layer.config.locations)&&(z=!0),this.disableSend=z}_updateConnectionStatus(z){this.connectionStatus=z}_sendNewIncident(){return I(this,void 0,void 0,function*(){const z=this._availablePriorities[this.newIncident.priority.value],$=this._availableSeverities[this.newIncident.severity.value],Y=this._availablePatientTypes[this.newIncident.patientType.value],G=this.layer.config.locations[this.newIncident.location.value],J=this.getLabel('LABEL_CONFIRM_RAISE_INCIDENT',{priority:z&&z.name||'',severity:$&&$.name||'',patientType:Y&&Y.name||'',location:G&&G.name||''})||'Are you sure you wish to raise this incident?',W=A.DefaultAlerts.AlertQuestion('Raise New Incident?',J,1,[{text:'Cancel',type:'primary',action:()=>{}},{text:'Confirm',type:'primary',action:()=>{this.emitEvent(N.IncidentEvents._Request_RaiseNewIncident,new N.RaiseNewIncidentEventArgs(z,$,Y,G,!1)),this._close()}}],$.colorCode);this.launchModal(W)})}_close(){this.showing=!1,this.disableSend=!0}}E([R.prop({type:Boolean,attribute:!0,default:!1})],H.prototype,'showing',void 0),E([R.prop({type:Object,attribute:!1})],H.prototype,'newIncident',void 0),E([R.prop({type:Boolean,attribute:!1,default:!0})],H.prototype,'disableSend',void 0),E([R.prop({type:String,attribute:!1,default:A.ConnectionStatus.Disconnected})],H.prototype,'connectionStatus',void 0),E([R.prop({type:Boolean,attribute:!1,default:!1})],H.prototype,'offlineMode',void 0),f.CTILNewIncidentModal=H,H.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(H,z,$,Y){var G=arguments.length,J=3>G?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(J=(3>G?W(J):3<G?W(z,$,J):W(z,$))||J);return 3<G&&J&&Object.defineProperty(z,$,J),J},I=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(0),N=h(124),D=h(4);class B extends A.CTILComponent{constructor(){super(...arguments),this._initialized=!1}static get is(){return'ct-il-report-list'}initialize(){return I(this,void 0,void 0,function*(){if(this.view){this.reports=yield this.layer.getReports();const H=this.viewOptions?JSON.parse(this.viewOptions):{};this._view||(this._view=N.getView(this.view,this,H)),this._view&&(yield this._view.initialize(),this._initialized=!0,this.forceRedraw())}})}setupListeners(){this.addListeners([M.IncidentEvents.ReportRequested,M.IncidentEvents.ReportReady,M.IncidentEvents.ReportFailed],()=>I(this,void 0,void 0,function*(){this.reports=yield this.layer.getReports()})),this._view&&this._view.setupListeners()}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:flex}:host .report-list{flex:1}:host .report-list .no-reports{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;font-size:18px;font-weight:400}
        `}generateComponentMarkup(){if(!this._initialized)return null;if(!this._view)return null;const H=this._getFilteredSortedReports();return window.__CTRender('div',{class:`report-list view-${this.view}`},window.__CTRender('style',null,this._view.renderStyles()),D.renderIfElse(0<H.length,this._view.render(H),this._renderEmpty()))}_renderEmpty(){return D.renderIf(!!this.noReportsMessage,window.__CTRender('div',{class:'no-reports'},this.noReportsMessage))}_getFilteredSortedReports(){let H=[...(this.reports||[])];const z=this.layer.getSyncedTimestamp(),$=this.layer.getCurrentUser();if($&&this.ownReportsOnly&&(H=H.filter((Y)=>Y.requested.jid===$.jid)),H.sort((Y,G)=>G.requested.date-Y.requested.date),0<this.maxReportAge&&0<z){const Y=z-1e3*(60*(60*this.maxReportAge));H=H.filter((G)=>G.requested.date>=Y)}return 0<this.maxReports&&(H=H.splice(0,this.maxReports)),H}}E([R.prop({type:Number,attribute:!0,default:0})],B.prototype,'maxReports',void 0),E([R.prop({type:Number,attribute:!0,default:0})],B.prototype,'maxReportAge',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],B.prototype,'ownReportsOnly',void 0),E([R.prop({type:String,attribute:!0})],B.prototype,'noReportsMessage',void 0),E([R.prop({type:String,attribute:!0})],B.prototype,'view',void 0),E([R.prop({type:String,attribute:!0})],B.prototype,'viewOptions',void 0),E([R.prop({type:Array,attribute:!1,default:[]})],B.prototype,'reports',void 0),f.CTILReportList=B,B.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(G,J,W,X){var K=arguments.length,Q=3>K?J:null===X?X=Object.getOwnPropertyDescriptor(J,W):X,Z;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Q=Reflect.decorate(G,J,W,X);else for(var ee=G.length-1;0<=ee;ee--)(Z=G[ee])&&(Q=(3>K?Z(Q):3<K?Z(J,W,Q):Z(J,W))||Q);return 3<K&&Q&&Object.defineProperty(J,W,Q),Q},I=this&&this.__awaiter||function(G,J,W,X){return new(W||(W=Promise))(function(K,Q){function Z(ne){try{te(X.next(ne))}catch(se){Q(se)}}function ee(ne){try{te(X['throw'](ne))}catch(se){Q(se)}}function te(ne){ne.done?K(ne.value):new W(function(se){se(ne.value)}).then(Z,ee)}te((X=X.apply(G,J||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(6),M=h(1),N=h(10),D=h(0),B=h(7),H=h(4),z=h(3),$=h(5);class Y extends N.CTILComponent{static get is(){return'ct-il-role-selection'}initialize(){return I(this,void 0,void 0,function*(){this.roles=this.layer.config.roles||[],this.notConnected=this.layer.getConnectionStatus()!==M.ConnectionStatus.Connected})}setupListeners(){this.addListener(A.BaseEvents.ConnectionStatusChange,(G)=>{this.notConnected=G.status!==M.ConnectionStatus.Connected})}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:flex;height:100%}:host .role-selection{flex:1;display:flex;height:100%;flex-direction:column}:host .role-selection .role-list{flex:1 1;overflow:auto;list-style-type:none;margin:0;padding:10px 0 0 10px}:host .role-selection .role-list .role{margin:0;padding:0;display:flex;align-items:center;flex-direction:row}:host .role-selection .role-list .role .selected{flex:0 0 30px;display:flex;justify-content:center;color:var(--primary-font-color, #fff)}:host .role-selection .role-list .role .selected .icon{background:var(--primary-color, #15233b);width:16px;height:16px;border-radius:50%}:host .role-selection .role-list .role .role-name{cursor:pointer;padding:10px 0;flex:1 1;border-bottom:3px solid #f2f2f2}:host .role-selection .role-list .role:last-child .role-name{border-bottom:0}:host .role-selection .buttons{flex:none;padding:10px}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:'role-selection'},window.__CTRender('ul',{class:'role-list'},this.roles.map((G)=>this._renderRoleOption(G))),window.__CTRender('div',{class:'buttons'},window.__CTRender($.CTButton,{type:'primary',onClick:()=>this._chooseRole(),disabled:this.disabled||this.notConnected},'On-call')))}_renderRoleOption(G){return window.__CTRender('li',{class:'role',onClick:()=>this._onSelectRole(G)},window.__CTRender('div',{class:'selected'},H.renderIf(this.selectedRoleId&&this.selectedRoleId===G.id,window.__CTRender($.CTIcon,{class:'icon',icon:B.Icons.UI.Tick,width:'8px',height:'8px'}))),window.__CTRender('div',{class:'role-name'},G.name))}_onSelectRole(G){this.selectedRoleId=G.id,this.disabled=!1}_chooseRole(){const G=this.layer.config.roles.find((W)=>W.id===this.selectedRoleId);if(G){const J=`${D.IncidentEvents.RoleSelection}:${z.generateRandomSixString()}`;this.addListener(J,()=>{this.emitComponentEvent(D.IncidentEvents.RoleSelection,new D.RoleSelectionEventArgs(G)),this.selectedRoleId=null},{onceOnly:!0,dontSuppress:!0}),this.emitEvent(D.IncidentEvents._Request_JoinRole,new D.RoleSelectionEventArgs(G,J))}}}E([R.prop({type:Array,attribute:!1,default:[]})],Y.prototype,'roles',void 0),E([R.prop({type:String,attribute:!1,default:null})],Y.prototype,'selectedRoleId',void 0),E([R.prop({type:Boolean,attribute:!1,default:!0})],Y.prototype,'disabled',void 0),E([R.prop({type:Boolean,attribute:!1,default:!0})],Y.prototype,'notConnected',void 0),f.CTILRoleSelection=Y,Y.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(D,B,H,z){var $=arguments.length,Y=3>$?B:null===z?z=Object.getOwnPropertyDescriptor(B,H):z,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Y=Reflect.decorate(D,B,H,z);else for(var J=D.length-1;0<=J;J--)(G=D[J])&&(Y=(3>$?G(Y):3<$?G(B,H,Y):G(B,H))||Y);return 3<$&&Y&&Object.defineProperty(B,H,Y),Y},I=this&&this.__awaiter||function(D,B,H,z){return new(H||(H=Promise))(function($,Y){function G(X){try{W(z.next(X))}catch(K){Y(K)}}function J(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(G,J)}W((z=z.apply(D,B||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(10),M=h(127);class N extends A.CTILComponent{constructor(){super(...arguments),this._initialized=!1}static get is(){return'ct-il-user-list'}initialize(){return I(this,void 0,void 0,function*(){if(this.view){const D=this.viewOptions?JSON.parse(this.viewOptions):{};this._view||(this._view=M.getView(this.view,this,D)),this._view&&(yield this._view.initialize(),this._initialized=!0,this.forceRedraw())}})}setupListeners(){this._view&&this._view.setupListeners()}get generateComponentStyles(){return null}generateComponentMarkup(){return this._initialized?this._view?window.__CTRender('div',{class:`user-list view-${this.view}`},window.__CTRender('style',null,this._view.renderStyles()),this._view.render()):null:null}}E([R.prop({type:String,attribute:!0})],N.prototype,'view',void 0),E([R.prop({type:String,attribute:!0})],N.prototype,'viewOptions',void 0),f.CTILUserList=N,N.register()},function(u,f,h){'use strict';var E=this&&this.__awaiter||function($,Y,G,J){return new(G||(G=Promise))(function(W,X){function K(ee){try{Z(J.next(ee))}catch(te){X(te)}}function Q(ee){try{Z(J['throw'](ee))}catch(te){X(te)}}function Z(ee){ee.done?W(ee.value):new G(function(te){te(ee.value)}).then(K,Q)}Z((J=J.apply($,Y||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(2),R=h(1),A=h(78),M=h(116),N=h(7),D=h(0),B=h(8),H=h(3);class z extends I.BaseLayer{constructor($,Y,G){super($,Y),this.VERSION='1.0.0',this._waitingAlertId=void 0,this.name=$,Y.xmpp.autoResumeTimers=!1,this.config=Y;const J=G&&G.store||new M.Store($,this.logger,Y),W=G&&G.comms||new A.Comms($,Y.xmpp,J,this.logger,this);W.onStartFetchingMissedMessages(()=>{this.showWaitingMessage('Updating...')}),W.onFinishedFetchingMissedMessages(()=>{this.on(D.IncidentEvents._Request_RedrawAllUIs,()=>E(this,void 0,void 0,function*(){yield this.updateAllStateFromBot(),this.dismissWaitingMessage()}),!0)}),this.bootstrap(W,J)}sendMessageViaBot($,Y){const G=(J)=>super[J];return E(this,void 0,void 0,function*(){yield G('sendMessageToBot').call(this,$,Y)})}getIncidents(){return E(this,void 0,void 0,function*(){const $=yield this.store.getIncidents();return H.deepCloneArray($)})}getOpenIncidents(){return E(this,void 0,void 0,function*(){const $=yield this.getIncidents();return $.filter((Y)=>Y.status===N.IncidentStatus.Open)})}getIncidentById($){return E(this,void 0,void 0,function*(){const Y=yield this.getIncidents(),G=Y.find((J)=>J.id===$);return!G?null:Object.assign({},G)})}getCurrentIncident(){return E(this,void 0,void 0,function*(){const $=yield this.getIncidents();return $[0]||null})}getPendingAlerts(){return E(this,void 0,void 0,function*(){const $=yield this.store.getPendingAlerts();return H.deepCloneArray($)})}getReports(){return E(this,void 0,void 0,function*(){const $=yield this.store.getReports();return H.deepCloneArray($)})}getReportById($){return E(this,void 0,void 0,function*(){const Y=yield this.getReports(),G=Y.find((J)=>J.id===$);return!G?null:Object.assign({},G)})}getUsers(){return E(this,void 0,void 0,function*(){const $=yield this._getRosterUsers();return[...$].filter((Y)=>null!==Y)})}getOnCallUsers(){return E(this,void 0,void 0,function*(){const $=yield this.getUsers();return $.filter((Y)=>Y.isOnCall)})}getUserByJid($){return E(this,void 0,void 0,function*(){if($===this.getCurrentUserJid())return this.getCurrentUser();const Y=yield this.getUsers(),G=Y.find((J)=>J.jid===$);return!G?null:Object.assign({},G)})}getCurrentUser(){return this.comms.user}getAllUsersRoleInfo(){return E(this,void 0,void 0,function*(){return(yield this._getRoleUserMappings())||{}})}getUserRoleInfo($){return E(this,void 0,void 0,function*(){const Y=(yield this._getRoleUserMappings())||{},G=Object.keys(Y).find((X)=>Y[X].some((K)=>K.jid===$.jid));if(!G)return null;const J=this.config.roles.find((X)=>X.id===G);if(!J)return null;const W=Y[G].find((X)=>X.jid===$.jid);return W?{role:J,jid:W.jid,cameOnCall:W.cameOnCall}:null})}updateAllStateFromBot($=!1,Y=!1){return E(this,void 0,void 0,function*(){try{yield Promise.all([this.updateRoleUserMappings($,!0),this.updateUsersLastSeenMappings($,!0)])}catch(G){if(Y)throw G;else this.error('Error updating state','There was an error obtaining the state from the bot. Please try again.')}})}updateRoleUserMappings($=!1,Y=!1){return E(this,void 0,void 0,function*(){!0===this.suppressMode&&!0!==$||(yield this._fetchRoleUserMappings(Y))})}updateUsersLastSeenMappings($=!1,Y=!1){return E(this,void 0,void 0,function*(){!0===this.suppressMode&&!0!==$||(yield this._fetchUserLastSeenMappings(Y))})}getUserLastSeen($){return E(this,void 0,void 0,function*(){if(!$)return null;const Y=yield this._getUserLastSeenMappings();return Y?Y[$.jid]||null:null})}getCurrentXmppDisplayName(){const $=this.getCurrentUser();return $&&$.displayName||''}generateCommonComponents($){return E(this,void 0,void 0,function*(){!0===this.config.isBroadcaster&&(this._newIncidentModal=document.querySelector('ct-il-new-incident-modal'),!this._newIncidentModal&&(this._newIncidentModal=document.createElement('ct-il-new-incident-modal'),this._newIncidentModal.owner=this.name,$.appendChild(this._newIncidentModal)),this._closeIncidentModal=document.querySelector('ct-il-close-incident-modal'),!this._closeIncidentModal&&(this._closeIncidentModal=document.createElement('ct-il-close-incident-modal'),this._closeIncidentModal.owner=this.name,$.appendChild(this._closeIncidentModal))),!1===this.config.isBroadcaster&&(this._incidentResponseModal=document.querySelector('ct-il-incident-alert'),!this._incidentResponseModal&&(this._incidentResponseModal=document.createElement('ct-il-incident-alert'),this._incidentResponseModal.owner=this.name,$.appendChild(this._incidentResponseModal)))})}getHandlers(){return B.get(this)}_getRosterUsers(){return E(this,void 0,void 0,function*(){return this.getConnectionStatus()===R.ConnectionStatus.Connected?yield this.comms.getAllContacts():[]})}_getRoleUserMappings(){return E(this,void 0,void 0,function*(){return this._roleUserMappings?this._roleUserMappings:yield this._fetchRoleUserMappings()})}_fetchRoleUserMappings($=!1){return E(this,void 0,void 0,function*(){const Y=yield this.sendBotCommand(B.IncidentBotCommands.GetRoleUsers,null,$);if(Y&&!1===Y.success)throw new Error(`Invalid response for command ${B.IncidentBotCommands.GetRoleUsers}: ${JSON.stringify(Y)}`);return this.emit(D.IncidentEvents.OnCallUsersChange),this._roleUserMappings=Y&&Y.data||{},this._roleUserMappings})}_getUserLastSeenMappings(){return E(this,void 0,void 0,function*(){return this._userLastSeenMappings?this._userLastSeenMappings:yield this._fetchUserLastSeenMappings(!0)})}_fetchUserLastSeenMappings($=!1){return E(this,void 0,void 0,function*(){const Y=yield this.sendBotCommand(B.IncidentBotCommands.GetLastSeen,null,$);if(Y&&!1===Y.success)throw new Error(`Invalid response for command ${B.IncidentBotCommands.GetLastSeen}: ${JSON.stringify(Y)}`);return this.emit(D.IncidentEvents.UserLastSeenChange),this._userLastSeenMappings=Y&&Y.data||{},this._userLastSeenMappings})}}f.IncidentLayer=z,window.CtIncidentLayer=z},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0}),f['default']=function(){function I(Z){return btoa(unescape(encodeURIComponent(Z)))}function A(){(function(Z){function ee(Oe){return parseInt(Oe)===Oe}function te(Oe){if(!ee(Oe.length))return!1;for(var ke=0;ke<Oe.length;ke++)if(!ee(Oe[ke])||0>Oe[ke]||255<Oe[ke])return!1;return!0}function ne(Oe,ke){if(Oe.buffer&&ArrayBuffer.isView(Oe)&&'Uint8Array'===Oe.name)return ke&&(Oe.slice?Oe=Oe.slice():Oe=Array.prototype.slice.call(Oe)),Oe;if(Array.isArray(Oe)){if(!te(Oe))throw new Error('Array contains invalid value: '+Oe);return new Uint8Array(Oe)}if(ee(Oe.length)&&te(Oe))return new Uint8Array(Oe);throw new Error('unsupported array-like object')}function se(Oe){return new Uint8Array(Oe)}function oe(Oe,ke,Ue,Be,qe){(null!=Be||null!=qe)&&(Oe.slice?Oe=Oe.slice(Be,qe):Oe=Array.prototype.slice.call(Oe,Be,qe)),ke.set(Oe,Ue)}function ae(Oe){for(var ke=[],Ue=0;Ue<Oe.length;Ue+=4)ke.push(Oe[Ue]<<24|Oe[Ue+1]<<16|Oe[Ue+2]<<8|Oe[Ue+3]);return ke}var le=function(){return{toBytes:function(Ue){var Be=[],qe=0;for(Ue=encodeURI(Ue);qe<Ue.length;){var je=Ue.charCodeAt(qe++);37===je?(Be.push(parseInt(Ue.substr(qe,2),16)),qe+=2):Be.push(je)}return ne(Be)},fromBytes:function(Ue){for(var Be=[],qe=0,je;qe<Ue.length;)je=Ue[qe],128>je?(Be.push(_StringfromCharCode(je)),qe++):191<je&&224>je?(Be.push(_StringfromCharCode((31&je)<<6|63&Ue[qe+1])),qe+=2):(Be.push(_StringfromCharCode((15&je)<<12|(63&Ue[qe+1])<<6|63&Ue[qe+2])),qe+=3);return Be.join('')}}}(),ce=function(){var Ue='0123456789abcdef';return{toBytes:function(Be){for(var qe=[],je=0;je<Be.length;je+=2)qe.push(parseInt(Be.substr(je,2),16));return qe},fromBytes:function(Be){for(var qe=[],je=0,He;je<Be.length;je++)He=Be[je],qe.push(Ue[(240&He)>>4]+Ue[15&He]);return qe.join('')}}}(),ue={16:10,24:12,32:14},pe=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],me=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ge=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],_e=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],fe=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],he=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],ye=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ce=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],Te=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],ve=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239000,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],Se=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998000,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],be=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ee=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239000,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Re=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998000,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925],Ae=function(Oe){if(!(this instanceof Ae))throw Error('AES must be instanitated with `new`');Object.defineProperty(this,'key',{value:ne(Oe,!0)}),this._prepare()};Ae.prototype._prepare=function(){var Oe=ue[this.key.length];if(null==Oe)throw new Error('invalid key size (must be 16, 24 or 32 bytes)');this._Ke=[],this._Kd=[];for(var ke=0;ke<=Oe;ke++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var Ue=4*(Oe+1),Be=this.key.length/4,qe=ae(this.key),ke=0,je;ke<Be;ke++)je=ke>>2,this._Ke[je][ke%4]=qe[ke],this._Kd[Oe-je][ke%4]=qe[ke];for(var He=0,Fe=Be,ze;Fe<Ue;){if(ze=qe[Be-1],qe[0]^=me[255&ze>>16]<<24^me[255&ze>>8]<<16^me[255&ze]<<8^me[255&ze>>24]^pe[He]<<24,He+=1,8!=Be)for(var ke=1;ke<Be;ke++)qe[ke]^=qe[ke-1];else{for(var ke=1;ke<Be/2;ke++)qe[ke]^=qe[ke-1];ze=qe[Be/2-1],qe[Be/2]^=me[255&ze]^me[255&ze>>8]<<8^me[255&ze>>16]<<16^me[255&ze>>24]<<24;for(var ke=Be/2+1;ke<Be;ke++)qe[ke]^=qe[ke-1]}for(var ke=0,$e,Ve;ke<Be&&Fe<Ue;)$e=Fe>>2,Ve=Fe%4,this._Ke[$e][Ve]=qe[ke],this._Kd[Oe-$e][Ve]=qe[ke++],Fe++}for(var $e=1;$e<Oe;$e++)for(var Ve=0;4>Ve;Ve++)ze=this._Kd[$e][Ve],this._Kd[$e][Ve]=be[255&ze>>24]^Ee[255&ze>>16]^Ie[255&ze>>8]^Re[255&ze]},Ae.prototype.encrypt=function(Oe){if(16!=Oe.length)throw new Error('invalid plaintext size (must be 16 bytes)');for(var ke=this._Ke.length-1,Ue=[0,0,0,0],Be=ae(Oe),qe=0;4>qe;qe++)Be[qe]^=this._Ke[0][qe];for(var je=1;je<ke;je++){for(var qe=0;4>qe;qe++)Ue[qe]=_e[255&Be[qe]>>24]^fe[255&Be[(qe+1)%4]>>16]^he[255&Be[(qe+2)%4]>>8]^ye[255&Be[(qe+3)%4]]^this._Ke[je][qe];Be=Ue.slice()}for(var He=se(16),qe=0,Fe;4>qe;qe++)Fe=this._Ke[ke][qe],He[4*qe]=255&(me[255&Be[qe]>>24]^Fe>>24),He[4*qe+1]=255&(me[255&Be[(qe+1)%4]>>16]^Fe>>16),He[4*qe+2]=255&(me[255&Be[(qe+2)%4]>>8]^Fe>>8),He[4*qe+3]=255&(me[255&Be[(qe+3)%4]]^Fe);return He},Ae.prototype.decrypt=function(Oe){if(16!=Oe.length)throw new Error('invalid ciphertext size (must be 16 bytes)');for(var ke=this._Kd.length-1,Ue=[0,0,0,0],Be=ae(Oe),qe=0;4>qe;qe++)Be[qe]^=this._Kd[0][qe];for(var je=1;je<ke;je++){for(var qe=0;4>qe;qe++)Ue[qe]=Ce[255&Be[qe]>>24]^Te[255&Be[(qe+3)%4]>>16]^ve[255&Be[(qe+2)%4]>>8]^Se[255&Be[(qe+1)%4]]^this._Kd[je][qe];Be=Ue.slice()}for(var He=se(16),qe=0,Fe;4>qe;qe++)Fe=this._Kd[ke][qe],He[4*qe]=255&(ge[255&Be[qe]>>24]^Fe>>24),He[4*qe+1]=255&(ge[255&Be[(qe+3)%4]>>16]^Fe>>16),He[4*qe+2]=255&(ge[255&Be[(qe+2)%4]>>8]^Fe>>8),He[4*qe+3]=255&(ge[255&Be[(qe+1)%4]]^Fe);return He};var Me=function(Oe){if(!(this instanceof Me))throw Error('AES must be instanitated with `new`');this.description='Electronic Code Block',this.name='ecb',this._aes=new Ae(Oe)};Me.prototype.encrypt=function(Oe){if(Oe=ne(Oe),0!=Oe.length%16)throw new Error('invalid plaintext size (must be multiple of 16 bytes)');for(var ke=se(Oe.length),Ue=se(16),Be=0;Be<Oe.length;Be+=16)oe(Oe,Ue,0,Be,Be+16),Ue=this._aes.encrypt(Ue),oe(Ue,ke,Be);return ke},Me.prototype.decrypt=function(Oe){if(Oe=ne(Oe),0!=Oe.length%16)throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');for(var ke=se(Oe.length),Ue=se(16),Be=0;Be<Oe.length;Be+=16)oe(Oe,Ue,0,Be,Be+16),Ue=this._aes.decrypt(Ue),oe(Ue,ke,Be);return ke};var we=function(Oe,ke){if(!(this instanceof we))throw Error('AES must be instanitated with `new`');if(this.description='Cipher Block Chaining',this.name='cbc',!ke)ke=se(16);else if(16!=ke.length)throw new Error('invalid initialation vector size (must be 16 bytes)');this._lastCipherblock=ne(ke,!0),this._aes=new Ae(Oe)};we.prototype.encrypt=function(Oe){if(Oe=ne(Oe),0!=Oe.length%16)throw new Error('invalid plaintext size (must be multiple of 16 bytes)');for(var ke=se(Oe.length),Ue=se(16),Be=0;Be<Oe.length;Be+=16){oe(Oe,Ue,0,Be,Be+16);for(var qe=0;16>qe;qe++)Ue[qe]^=this._lastCipherblock[qe];this._lastCipherblock=this._aes.encrypt(Ue),oe(this._lastCipherblock,ke,Be)}return ke},we.prototype.decrypt=function(Oe){if(Oe=ne(Oe),0!=Oe.length%16)throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');for(var ke=se(Oe.length),Ue=se(16),Be=0;Be<Oe.length;Be+=16){oe(Oe,Ue,0,Be,Be+16),Ue=this._aes.decrypt(Ue);for(var qe=0;16>qe;qe++)ke[Be+qe]=Ue[qe]^this._lastCipherblock[qe];oe(Oe,this._lastCipherblock,0,Be,Be+16)}return ke};var xe=function(Oe,ke,Ue){if(!(this instanceof xe))throw Error('AES must be instanitated with `new`');if(this.description='Cipher Feedback',this.name='cfb',!ke)ke=se(16);else if(16!=ke.length)throw new Error('invalid initialation vector size (must be 16 size)');Ue||(Ue=1),this.segmentSize=Ue,this._shiftRegister=ne(ke,!0),this._aes=new Ae(Oe)};xe.prototype.encrypt=function(Oe){if(0!=Oe.length%this.segmentSize)throw new Error('invalid plaintext size (must be segmentSize bytes)');for(var ke=ne(Oe,!0),Be=0,Ue;Be<ke.length;Be+=this.segmentSize){Ue=this._aes.encrypt(this._shiftRegister);for(var qe=0;qe<this.segmentSize;qe++)ke[Be+qe]^=Ue[qe];oe(this._shiftRegister,this._shiftRegister,0,this.segmentSize),oe(ke,this._shiftRegister,16-this.segmentSize,Be,Be+this.segmentSize)}return ke},xe.prototype.decrypt=function(Oe){if(0!=Oe.length%this.segmentSize)throw new Error('invalid ciphertext size (must be segmentSize bytes)');for(var ke=ne(Oe,!0),Be=0,Ue;Be<ke.length;Be+=this.segmentSize){Ue=this._aes.encrypt(this._shiftRegister);for(var qe=0;qe<this.segmentSize;qe++)ke[Be+qe]^=Ue[qe];oe(this._shiftRegister,this._shiftRegister,0,this.segmentSize),oe(Oe,this._shiftRegister,16-this.segmentSize,Be,Be+this.segmentSize)}return ke};var Ne=function(Oe,ke){if(!(this instanceof Ne))throw Error('AES must be instanitated with `new`');if(this.description='Output Feedback',this.name='ofb',!ke)ke=se(16);else if(16!=ke.length)throw new Error('invalid initialation vector size (must be 16 bytes)');this._lastPrecipher=ne(ke,!0),this._lastPrecipherIndex=16,this._aes=new Ae(Oe)};Ne.prototype.encrypt=function(Oe){for(var ke=ne(Oe,!0),Ue=0;Ue<ke.length;Ue++)16===this._lastPrecipherIndex&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),ke[Ue]^=this._lastPrecipher[this._lastPrecipherIndex++];return ke},Ne.prototype.decrypt=Ne.prototype.encrypt;var Pe=function(Oe){if(!(this instanceof Pe))throw Error('Counter must be instanitated with `new`');0===Oe||Oe||(Oe=1),'number'==typeof Oe?(this._counter=se(16),this.setValue(Oe)):this.setBytes(Oe)};Pe.prototype.setValue=function(Oe){if('number'!=typeof Oe||parseInt(Oe)!=Oe)throw new Error('invalid counter value (must be an integer)');if(Oe>Number.MAX_SAFE_INTEGER)throw new Error('integer value out of safe range');for(var ke=15;0<=ke;--ke)this._counter[ke]=Oe%256,Oe=parseInt(Oe/256)},Pe.prototype.setBytes=function(Oe){if(Oe=ne(Oe,!0),16!=Oe.length)throw new Error('invalid counter bytes size (must be 16 bytes)');this._counter=Oe},Pe.prototype.increment=function(){for(var Oe=15;0<=Oe;Oe--)if(255===this._counter[Oe])this._counter[Oe]=0;else{this._counter[Oe]++;break}};var Le=function(Oe,ke){if(!(this instanceof Le))throw Error('AES must be instanitated with `new`');this.description='Counter',this.name='ctr',ke instanceof Pe||(ke=new Pe(ke)),this._counter=ke,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new Ae(Oe)};Le.prototype.encrypt=function(Oe){for(var ke=ne(Oe,!0),Ue=0;Ue<ke.length;Ue++)16===this._remainingCounterIndex&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),ke[Ue]^=this._remainingCounter[this._remainingCounterIndex++];return ke},Le.prototype.decrypt=Le.prototype.encrypt;var De={AES:Ae,Counter:Pe,ModeOfOperation:{ecb:Me,cbc:we,cfb:xe,ofb:Ne,ctr:Le},utils:{hex:ce,utf8:le},padding:{pkcs7:{pad:function(Oe){Oe=ne(Oe,!0);var ke=16-Oe.length%16,Ue=se(Oe.length+ke);oe(Oe,Ue);for(var Be=Oe.length;Be<Ue.length;Be++)Ue[Be]=ke;return Ue},strip:function(Oe){if(Oe=ne(Oe,!0),16>Oe.length)throw new Error('PKCS#7 invalid length');var ke=Oe[Oe.length-1];if(16<ke)throw new Error('PKCS#7 padding byte out of range');for(var Ue=Oe.length-ke,Be=0;Be<ke;Be++)if(Oe[Ue+Be]!==ke)throw new Error('PKCS#7 invalid padding byte');var qe=se(Ue);return oe(Oe,qe,0,0,Ue),qe}}},_arrayTest:{coerceArray:ne,createArray:se,copyArray:oe}};'undefined'!=typeof exports||('function'==typeof define&&h(142)?define(De):(Z.aesjs&&(De._aesjs=Z.aesjs),Z.aesjs=De))})(this)}let N=!1,D=null,B=null,H=null,z='lunr_index',$='idxBlock',Y='docBlock';const G=function(){function Z(te){if(null===te||'object'!=typeof te)return te;var ne=te.constructor();for(var se in te)te.hasOwnProperty(se)&&(ne[se]=te[se]);return ne}var ee=function(te){var ne=new ee.Index;return ne.pipeline.add(ee.trimmer,ee.stopWordFilter,ee.stemmer),te&&te.call(ne,ne),ne};return ee.version='0.9.5',lunr=ee,ee.utils={},ee.utils.warn=function(te){return function(ne){te.console&&console.warn&&console.warn(ne)}}(this),ee.utils.toString=function(te){return void 0===te||null===te?'':te.toString()},ee.EventEmitter=function(){this.events={}},ee.EventEmitter.prototype.addListener=function(){var te=Array.prototype.slice.call(arguments),ne=te.pop();if('function'!=typeof ne)throw new TypeError('last argument must be a function');te.forEach(function(oe){this.hasHandler(oe)||(this.events[oe]=[]),this.events[oe].push(ne)},this)},ee.EventEmitter.prototype.removeListener=function(te,ne){if(this.hasHandler(te)){var se=this.events[te].indexOf(ne);-1===se||(this.events[te].splice(se,1),0==this.events[te].length&&delete this.events[te])}},ee.EventEmitter.prototype.emit=function(te){if(this.hasHandler(te)){var ne=Array.prototype.slice.call(arguments,1);this.events[te].forEach(function(se){se.apply(void 0,ne)},this)}},ee.EventEmitter.prototype.hasHandler=function(te){return te in this.events},ee.tokenizer=function(te){if(!arguments.length||null===te||void 0===te)return[];if(Array.isArray(te)){var ne=te.filter(function(oe){return null===oe||void 0===oe?!1:!0});ne=ne.map(function(oe){return ee.utils.toString(oe).toLowerCase()});var se=[];return ne.forEach(function(oe){var ae=oe.split(ee.tokenizer.seperator);se=se.concat(ae)},this),se}return te.toString().trim().toLowerCase().split(ee.tokenizer.seperator)},ee.tokenizer.defaultSeperator=/[\s\-]+/,ee.tokenizer.seperator=ee.tokenizer.defaultSeperator,ee.tokenizer.setSeperator=function(te){null!==te&&void 0!==te&&'object'==typeof te&&(ee.tokenizer.seperator=te)},ee.tokenizer.resetSeperator=function(){ee.tokenizer.seperator=ee.tokenizer.defaultSeperator},ee.tokenizer.getSeperator=function(){return ee.tokenizer.seperator},ee.Pipeline=function(){this._queue=[]},ee.Pipeline.registeredFunctions={},ee.Pipeline.registerFunction=function(te,ne){ne in ee.Pipeline.registeredFunctions&&ee.utils.warn('Overwriting existing registered function: '+ne),te.label=ne,ee.Pipeline.registeredFunctions[ne]=te},ee.Pipeline.getRegisteredFunction=function(te){return!0==te in ee.Pipeline.registeredFunctions?ee.Pipeline.registeredFunctions[te]:null},ee.Pipeline.warnIfFunctionNotRegistered=function(te){var ne=te.label&&te.label in this.registeredFunctions;ne||ee.utils.warn('Function is not registered with pipeline. This may cause problems when serialising the index.\n',te)},ee.Pipeline.load=function(te){var ne=new ee.Pipeline;return te.forEach(function(se){var oe=ee.Pipeline.getRegisteredFunction(se);if(oe)ne.add(oe);else throw new Error('Cannot load un-registered function: '+se)}),ne},ee.Pipeline.prototype.add=function(){var te=Array.prototype.slice.call(arguments);te.forEach(function(ne){ee.Pipeline.warnIfFunctionNotRegistered(ne),this._queue.push(ne)},this)},ee.Pipeline.prototype.after=function(te,ne){ee.Pipeline.warnIfFunctionNotRegistered(ne);var se=this._queue.indexOf(te);if(-1===se)throw new Error('Cannot find existingFn');this._queue.splice(se+1,0,ne)},ee.Pipeline.prototype.before=function(te,ne){ee.Pipeline.warnIfFunctionNotRegistered(ne);var se=this._queue.indexOf(te);if(-1===se)throw new Error('Cannot find existingFn');this._queue.splice(se,0,ne)},ee.Pipeline.prototype.remove=function(te){var ne=this._queue.indexOf(te);-1===ne||this._queue.splice(ne,1)},ee.Pipeline.prototype.run=function(te){for(var ne=[],se=te.length,oe=this._queue.length,ae=0,ie;ae<se;ae++){ie=te[ae];for(var de=0;de<oe&&(ie=this._queue[de](ie,ae,te),void 0!==ie&&null!==ie);de++);void 0!==ie&&null!==ie&&ne.push(ie)}return ne},ee.Pipeline.prototype.reset=function(){this._queue=[]},ee.Pipeline.prototype.get=function(){return this._queue},ee.Pipeline.prototype.toJSON=function(){return this._queue.map(function(te){return ee.Pipeline.warnIfFunctionNotRegistered(te),te.label})},ee.Index=function(){this._fields=[],this._ref='id',this.pipeline=new ee.Pipeline,this.documentStore=new ee.DocumentStore,this.index={},this.eventEmitter=new ee.EventEmitter,this._idfCache={},this.on('add','remove','update',function(){this._idfCache={}}.bind(this))},ee.Index.prototype.on=function(){var te=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,te)},ee.Index.prototype.off=function(te,ne){return this.eventEmitter.removeListener(te,ne)},ee.Index.load=function(te){te.version!==ee.version&&ee.utils.warn('version mismatch: current '+ee.version+' importing '+te.version);var ne=new this;for(var se in ne._fields=te.fields,ne._ref=te.ref,ne.documentStore=ee.DocumentStore.load(te.documentStore),ne.pipeline=ee.Pipeline.load(te.pipeline),ne.index={},te.index)ne.index[se]=ee.InvertedIndex.load(te.index[se]);return ne},ee.Index.prototype.addField=function(te){return this._fields.push(te),this.index[te]=new ee.InvertedIndex,this},ee.Index.prototype.setRef=function(te){return this._ref=te,this},ee.Index.prototype.saveDocument=function(te){return this.documentStore=new ee.DocumentStore(te),this},ee.Index.prototype.addDoc=function(te,ne){if(te){var ne=void 0===ne||ne,se=te[this._ref];this.documentStore.addDoc(se,te),this._fields.forEach(function(oe){var ae=this.pipeline.run(ee.tokenizer(te[oe]));this.documentStore.addFieldLength(se,oe,ae.length);var ie={};for(var de in ae.forEach(function(ce){ce in ie?ie[ce]+=1:ie[ce]=1},this),ie){var le=ie[de];le=_Mathsqrt(le),this.index[oe].addToken(de,{ref:se,tf:le})}},this),ne&&this.eventEmitter.emit('add',te,this)}},ee.Index.prototype.removeDocByRef=function(te){if(te&&!1!==this.documentStore.isDocStored()&&this.documentStore.hasDoc(te)){var se=this.documentStore.getDoc(te);this.removeDoc(se,!1)}},ee.Index.prototype.removeDoc=function(te,ne){if(te){var ne=void 0===ne||ne,se=te[this._ref];this.documentStore.hasDoc(se)&&(this.documentStore.removeDoc(se),this._fields.forEach(function(oe){var ae=this.pipeline.run(ee.tokenizer(te[oe]));ae.forEach(function(ie){this.index[oe].removeToken(ie,se)},this)},this),ne&&this.eventEmitter.emit('remove',te,this))}},ee.Index.prototype.updateDoc=function(te,ne){var ne=void 0===ne||ne;this.removeDocByRef(te[this._ref],!1),this.addDoc(te,!1),ne&&this.eventEmitter.emit('update',te,this)},ee.Index.prototype.idf=function(te,ne){var se='@'+ne+'/'+te;if(Object.prototype.hasOwnProperty.call(this._idfCache,se))return this._idfCache[se];var oe=this.index[ne].getDocFreq(te),ae=1+_Mathlog(this.documentStore.length/(oe+1));return this._idfCache[se]=ae,ae},ee.Index.prototype.getFields=function(){return this._fields.slice()},ee.Index.prototype.search=function(te,ne){if(!te)return[];te='string'==typeof te?{any:te}:JSON.parse(JSON.stringify(te));var se=null;null!=ne&&(se=JSON.stringify(ne));for(var oe=new ee.Configuration(se,this.getFields()).get(),ae={},ie=Object.keys(te),de=0,le;de<ie.length;de++)le=ie[de],ae[le]=this.pipeline.run(ee.tokenizer(te[le]));var ce={};for(var ue in oe){var pe=ae[ue]||ae.any;if(pe){var me=this.fieldSearch(pe,ue,oe),ge=oe[ue].boost;for(var _e in me)me[_e]*=ge;for(var _e in me)_e in ce?ce[_e]+=me[_e]:ce[_e]=me[_e]}}var fe=[],he;for(var _e in ce)he={ref:_e,score:ce[_e]},this.documentStore.hasDoc(_e)&&(he.doc=this.documentStore.getDoc(_e)),fe.push(he);return fe.sort(function(ye,Ce){return Ce.score-ye.score}),fe},ee.Index.prototype.fieldSearch=function(te,ne,se){var oe=se[ne].bool,ae=se[ne].expand,ie=se[ne].boost,de=null,le={};if(0!==ie)return te.forEach(function(ce){var ue=[ce];!0==ae&&(ue=this.index[ne].expandToken(ce));var pe={};ue.forEach(function(me){var ge=this.index[ne].getDocs(me),_e=this.idf(me,ne);if(de&&'AND'==oe){var fe={};for(var he in de)he in ge&&(fe[he]=ge[he]);ge=fe}for(var he in me==ce&&this.fieldSearchStats(le,me,ge),ge){var ye=this.index[ne].getTermFrequency(me,he),Ce=this.documentStore.getFieldLength(he,ne),Te=1;0!=Ce&&(Te=1/_Mathsqrt(Ce));var ve=1;me!=ce&&(ve=0.15*(1-(me.length-ce.length)/me.length));var Se=ye*_e*Te*ve;he in pe?pe[he]+=Se:pe[he]=Se}},this),de=this.mergeScores(de,pe,oe)},this),de=this.coordNorm(de,le,te.length),de},ee.Index.prototype.mergeScores=function(te,ne,se){if(!te)return ne;if('AND'==se){var oe={};for(var ae in ne)ae in te&&(oe[ae]=te[ae]+ne[ae]);return oe}for(var ae in ne)ae in te?te[ae]+=ne[ae]:te[ae]=ne[ae];return te},ee.Index.prototype.fieldSearchStats=function(te,ne,se){for(var oe in se)oe in te?te[oe].push(ne):te[oe]=[ne]},ee.Index.prototype.coordNorm=function(te,ne,se){for(var oe in te)if(oe in ne){var ae=ne[oe].length;te[oe]=te[oe]*ae/se}return te},ee.Index.prototype.toJSON=function(){var te={};return this._fields.forEach(function(ne){te[ne]=this.index[ne].toJSON()},this),{version:ee.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),index:te,pipeline:this.pipeline.toJSON()}},ee.Index.prototype.use=function(te){var ne=Array.prototype.slice.call(arguments,1);ne.unshift(this),te.apply(this,ne)},ee.DocumentStore=function(te){this._save=null===te||void 0===te||te,this.docs={},this.docInfo={},this.length=0},ee.DocumentStore.load=function(te){var ne=new this;return ne.length=te.length,ne.docs=te.docs,ne.docInfo=te.docInfo,ne._save=te.save,ne},ee.DocumentStore.prototype.isDocStored=function(){return this._save},ee.DocumentStore.prototype.addDoc=function(te,ne){this.hasDoc(te)||this.length++,this.docs[te]=!0===this._save?Z(ne):null},ee.DocumentStore.prototype.getDoc=function(te){return!1===this.hasDoc(te)?null:this.docs[te]},ee.DocumentStore.prototype.hasDoc=function(te){return te in this.docs},ee.DocumentStore.prototype.removeDoc=function(te){this.hasDoc(te)&&(delete this.docs[te],delete this.docInfo[te],this.length--)},ee.DocumentStore.prototype.addFieldLength=function(te,ne,se){null===te||void 0===te||!1==this.hasDoc(te)||(!this.docInfo[te]&&(this.docInfo[te]={}),this.docInfo[te][ne]=se)},ee.DocumentStore.prototype.updateFieldLength=function(te,ne,se){null===te||void 0===te||!1==this.hasDoc(te)||this.addFieldLength(te,ne,se)},ee.DocumentStore.prototype.getFieldLength=function(te,ne){return null===te||void 0===te?0:te in this.docs?ne in this.docInfo[te]?this.docInfo[te][ne]:0:0},ee.DocumentStore.prototype.toJSON=function(){return{docs:this.docs,docInfo:this.docInfo,length:this.length,save:this._save}},ee.stemmer=function(){var te={ational:'ate',tional:'tion',enci:'ence',anci:'ance',izer:'ize',bli:'ble',alli:'al',entli:'ent',eli:'e',ousli:'ous',ization:'ize',ation:'ate',ator:'ate',alism:'al',iveness:'ive',fulness:'ful',ousness:'ous',aliti:'al',iviti:'ive',biliti:'ble',logi:'log'},ne={icate:'ic',ative:'',alize:'al',iciti:'ic',ical:'ic',ful:'',ness:''},oe='[aeiouy]',ae='[^aeiou]'+'[^aeiouy]*',ie=oe+'[aeiou]*',pe=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,me=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,ge=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,_e=/^([^aeiou][^aeiouy]*)?[aeiouy]/,fe=/^(.+?)(ss|i)es$/,he=/^(.+?)([^s])s$/,ye=/^(.+?)eed$/,Ce=/^(.+?)(ed|ing)$/,Te=/.$/,ve=/(at|bl|iz)$/,Se=/([^aeiouylsz])\1$/,be=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,Ee=/^(.+?[^aeiou])y$/,Ie=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,Re=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,Ae=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,Me=/^(.+?)(s|t)(ion)$/,we=/^(.+?)e$/,xe=/ll$/,Ne=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/;return function(De){var Oe,ke,Ue,Be,qe,je,He;if(3>De.length)return De;if(Ue=De.substr(0,1),'y'==Ue&&(De=Ue.toUpperCase()+De.substr(1)),Be=fe,qe=he,Be.test(De)?De=De.replace(Be,'$1$2'):qe.test(De)&&(De=De.replace(qe,'$1$2')),Be=ye,qe=Ce,Be.test(De)){var Fe=Be.exec(De);Be=pe,Be.test(Fe[1])&&(Be=Te,De=De.replace(Be,''))}else if(qe.test(De)){var Fe=qe.exec(De);Oe=Fe[1],qe=_e,qe.test(Oe)&&(De=Oe,qe=ve,je=Se,He=be,qe.test(De)?De+='e':je.test(De)?(Be=Te,De=De.replace(Be,'')):He.test(De)&&(De+='e'))}if(Be=Ee,Be.test(De)){var Fe=Be.exec(De);Oe=Fe[1],De=Oe+'i'}if(Be=Ie,Be.test(De)){var Fe=Be.exec(De);Oe=Fe[1],ke=Fe[2],Be=pe,Be.test(Oe)&&(De=Oe+te[ke])}if(Be=Re,Be.test(De)){var Fe=Be.exec(De);Oe=Fe[1],ke=Fe[2],Be=pe,Be.test(Oe)&&(De=Oe+ne[ke])}if(Be=Ae,qe=Me,Be.test(De)){var Fe=Be.exec(De);Oe=Fe[1],Be=me,Be.test(Oe)&&(De=Oe)}else if(qe.test(De)){var Fe=qe.exec(De);Oe=Fe[1]+Fe[2],qe=me,qe.test(Oe)&&(De=Oe)}if(Be=we,Be.test(De)){var Fe=Be.exec(De);Oe=Fe[1],Be=me,qe=ge,je=Ne,(Be.test(Oe)||qe.test(Oe)&&!je.test(Oe))&&(De=Oe)}return Be=xe,qe=me,Be.test(De)&&qe.test(De)&&(Be=Te,De=De.replace(Be,'')),'y'==Ue&&(De=Ue.toLowerCase()+De.substr(1)),De}}(),ee.Pipeline.registerFunction(ee.stemmer,'stemmer'),ee.stopWordFilter=function(te){if(te&&!0!==ee.stopWordFilter.stopWords[te])return te},ee.clearStopWords=function(){ee.stopWordFilter.stopWords={}},ee.addStopWords=function(te){null==te||!1===Array.isArray(te)||te.forEach(function(ne){ee.stopWordFilter.stopWords[ne]=!0},this)},ee.resetStopWords=function(){ee.stopWordFilter.stopWords=ee.defaultStopWords},ee.defaultStopWords={"":!0,a:!0,able:!0,about:!0,across:!0,after:!0,all:!0,almost:!0,also:!0,am:!0,among:!0,an:!0,and:!0,any:!0,are:!0,as:!0,at:!0,be:!0,because:!0,been:!0,but:!0,by:!0,can:!0,cannot:!0,could:!0,dear:!0,did:!0,do:!0,does:!0,either:!0,else:!0,ever:!0,every:!0,for:!0,from:!0,get:!0,got:!0,had:!0,has:!0,have:!0,he:!0,her:!0,hers:!0,him:!0,his:!0,how:!0,however:!0,i:!0,if:!0,in:!0,into:!0,is:!0,it:!0,its:!0,just:!0,least:!0,let:!0,like:!0,likely:!0,may:!0,me:!0,might:!0,most:!0,must:!0,my:!0,neither:!0,no:!0,nor:!0,not:!0,of:!0,off:!0,often:!0,on:!0,only:!0,or:!0,other:!0,our:!0,own:!0,rather:!0,said:!0,say:!0,says:!0,she:!0,should:!0,since:!0,so:!0,some:!0,than:!0,that:!0,the:!0,their:!0,them:!0,then:!0,there:!0,these:!0,they:!0,this:!0,tis:!0,to:!0,too:!0,twas:!0,us:!0,wants:!0,was:!0,we:!0,were:!0,what:!0,when:!0,where:!0,which:!0,while:!0,who:!0,whom:!0,why:!0,will:!0,with:!0,would:!0,yet:!0,you:!0,your:!0},ee.stopWordFilter.stopWords=ee.defaultStopWords,ee.Pipeline.registerFunction(ee.stopWordFilter,'stopWordFilter'),ee.trimmer=function(te){if(null===te||void 0===te)throw new Error('token should not be undefined');return te.replace(/^\W+/,'').replace(/\W+$/,'')},ee.Pipeline.registerFunction(ee.trimmer,'trimmer'),ee.InvertedIndex=function(){this.root={docs:{},df:0}},ee.InvertedIndex.load=function(te){var ne=new this;return ne.root=te.root,ne},ee.InvertedIndex.prototype.addToken=function(te,ne,se){for(var se=se||this.root,oe=0,ae;oe<=te.length-1;)ae=te[oe],ae in se||(se[ae]={docs:{},df:0}),oe+=1,se=se[ae];var ie=ne.ref;se.docs[ie]?se.docs[ie]={tf:ne.tf}:(se.docs[ie]={tf:ne.tf},se.df+=1)},ee.InvertedIndex.prototype.hasToken=function(te){if(!te)return!1;for(var ne=this.root,se=0;se<te.length;se++){if(!ne[te[se]])return!1;ne=ne[te[se]]}return!0},ee.InvertedIndex.prototype.getNode=function(te){if(!te)return null;for(var ne=this.root,se=0;se<te.length;se++){if(!ne[te[se]])return null;ne=ne[te[se]]}return ne},ee.InvertedIndex.prototype.getDocs=function(te){var ne=this.getNode(te);return null==ne?{}:ne.docs},ee.InvertedIndex.prototype.getTermFrequency=function(te,ne){var se=this.getNode(te);return null==se?0:ne in se.docs?se.docs[ne].tf:0},ee.InvertedIndex.prototype.getDocFreq=function(te){var ne=this.getNode(te);return null==ne?0:ne.df},ee.InvertedIndex.prototype.removeToken=function(te,ne){if(te){var se=this.getNode(te);null==se||ne in se.docs&&(delete se.docs[ne],se.df-=1)}},ee.InvertedIndex.prototype.expandToken=function(te,ne,se){if(null==te||''==te)return[];var ne=ne||[];if(void 0==se&&(se=this.getNode(te),null==se))return ne;for(var oe in 0<se.df&&ne.push(te),se)'docs'!=oe&&('df'==oe||this.expandToken(te+oe,ne,se[oe]));return ne},ee.InvertedIndex.prototype.toJSON=function(){return{root:this.root}},ee.Configuration=function(te,ne){var te=te||'';if(void 0==ne||null==ne)throw new Error('fields should not be null');this.config={};var se;try{se=JSON.parse(te),this.buildUserConfig(se,ne)}catch(oe){ee.utils.warn('user configuration parse failed, will use default configuration'),this.buildDefaultConfig(ne)}},ee.Configuration.prototype.buildDefaultConfig=function(te){this.reset(),te.forEach(function(ne){this.config[ne]={boost:1,bool:'OR',expand:!1}},this)},ee.Configuration.prototype.buildUserConfig=function(te,ne){var se='OR',oe=!1;if(this.reset(),'bool'in te&&(se=te.bool||se),'expand'in te&&(oe=te.expand||oe),'fields'in te){for(var ae in te.fields)if(-1<ne.indexOf(ae)){var ie=te.fields[ae],de=oe;void 0!=ie.expand&&(de=ie.expand),this.config[ae]={boost:ie.boost||0===ie.boost?ie.boost:1,bool:ie.bool||se,expand:de}}else ee.utils.warn('field name in user configuration not found in index instance fields');}else this.addAllFields2UserConfig(se,oe,ne)},ee.Configuration.prototype.addAllFields2UserConfig=function(te,ne,se){se.forEach(function(oe){this.config[oe]={boost:1,bool:te,expand:ne}},this)},ee.Configuration.prototype.get=function(){return this.config},ee.Configuration.prototype.reset=function(){this.config={}},lunr.SortedSet=function(){this.length=0,this.elements=[]},lunr.SortedSet.load=function(te){var ne=new this;return ne.elements=te,ne.length=te.length,ne},lunr.SortedSet.prototype.add=function(){var te,ne;for(te=0;te<arguments.length;te++)ne=arguments[te],~this.indexOf(ne)||this.elements.splice(this.locationFor(ne),0,ne);this.length=this.elements.length},lunr.SortedSet.prototype.toArray=function(){return this.elements.slice()},lunr.SortedSet.prototype.map=function(te,ne){return this.elements.map(te,ne)},lunr.SortedSet.prototype.forEach=function(te,ne){return this.elements.forEach(te,ne)},lunr.SortedSet.prototype.indexOf=function(te){for(var ne=0,se=this.elements.length,oe=se-ne,ae=ne+_Mathfloor(oe/2),ie=this.elements[ae];1<oe;){if(ie===te)return ae;ie<te&&(ne=ae),ie>te&&(se=ae),oe=se-ne,ae=ne+_Mathfloor(oe/2),ie=this.elements[ae]}return ie===te?ae:-1},lunr.SortedSet.prototype.locationFor=function(te){for(var ne=0,se=this.elements.length,oe=se-ne,ae=ne+_Mathfloor(oe/2),ie=this.elements[ae];1<oe;)ie<te&&(ne=ae),ie>te&&(se=ae),oe=se-ne,ae=ne+_Mathfloor(oe/2),ie=this.elements[ae];return ie>te?ae:ie<te?ae+1:void 0},lunr.SortedSet.prototype.intersect=function(te){for(var ne=new lunr.SortedSet,se=0,oe=0,ae=this.length,ie=te.length,de=this.elements,le=te.elements;!(se>ae-1||oe>ie-1);){if(de[se]===le[oe]){ne.add(de[se]),se++,oe++;continue}if(de[se]<le[oe]){se++;continue}if(de[se]>le[oe]){oe++;continue}}return ne},lunr.SortedSet.prototype.clone=function(){var te=new lunr.SortedSet;return te.elements=this.toArray(),te.length=te.elements.length,te},lunr.SortedSet.prototype.union=function(te){var ne,se,oe;this.length>=te.length?(ne=this,se=te):(ne=te,se=this),oe=ne.clone();for(var ae=0,ie=se.toArray();ae<ie.length;ae++)oe.add(ie[ae]);return oe},lunr.SortedSet.prototype.toJSON=function(){return this.toArray()},ee}();let K=!0,Q='pureJs';self.onmessage=function(Z){function ee(pe){return new Promise((me,ge)=>{de(JSON.stringify(pe)).then((_e)=>{if(this.subtle)this.subtle.encrypt({name:'AES-CBC',iv:this._iv},this._key,_e).then((fe)=>{me(fe)}).catch(ge);else{const fe=new aesjs.ModeOfOperation.ctr(this._key),he=fe.encrypt(_e);me(he)}}).catch(ge)})}function te(pe){return new Promise((me,ge)=>{if(this.subtle)this.subtle.decrypt({name:'AES-CBC',iv:this._iv},this._key,pe).then((_e)=>{const fe=new Uint8Array(_e);le(fe).then((he)=>{me(JSON.parse(he))}).catch(ge)}).catch(ge);else{const _e=new aesjs.ModeOfOperation.ctr(this._key),fe=_e.decrypt(pe);le(fe).then((he)=>{me(JSON.parse(he))}).catch(ge)}})}function ne(pe,me){return new Promise((ge,_e)=>{const fe=B.transaction([H],'readwrite');fe.oncomplete=function(){ge()},fe.onerror=function(ye){_e(ye)};const he=fe.objectStore(H);he.put(me,pe)})}function se(pe){return new Promise((me,ge)=>{const _e=B.transaction([H]).objectStore(H),fe=_e.get(pe);fe.onsuccess=function(){const he=fe.result;me(he)},fe.onerror=function(he){ge(he)}})}function oe(pe=1e3){return K&&console.time('encrypt'),new Promise((me,ge)=>{function _e(){if(0===ve.length)K&&console.timeEnd('encrypt'),K&&console.time('index'),Te.documentStore.docs={},K&&console.time('index2'),fe();else{const be=ve.splice(0,pe),Ee={};be.forEach((Ie)=>{const Re=Ce.documentStore.docs[Ie];Ee[Ie]=Re}),K&&console.time('block'),ee(Ee).then((Ie)=>{ne(Y+he++,Ie).then(()=>{K&&console.timeEnd('block'),_e()}).catch(ge)}).catch(ge)}}function fe(){if(0===Se.length)Te.index={},ee(Te).then((be)=>{K&&console.timeEnd('index2'),ne(z,be).then(me).catch(ge)});else{const be=Se.shift();K&&console.time('chunk'),ee({prop:be,data:Te.index[be]}).then((Ee)=>{ne($+ye++,Ee).then(()=>{K&&console.timeEnd('chunk'),fe()})})}}let he=0,ye=0;const Ce=D.toJSON(),Te=JSON.parse(JSON.stringify(Ce)),ve=Object.keys(Te.documentStore.docs),Se=Object.keys(Te.index);_e()})}function ae(){return new Promise((pe,me)=>{function ge(){se(Y+he).then((Ce)=>{return Ce?void te(Ce).then((Te)=>{fe.documentStore.docs=Object.assign(fe.documentStore.docs,Te),he++,ge()}).catch(me):_e()}).catch(me)}function _e(){se($+ye).then((Ce)=>{return Ce?void te(Ce).then((Te)=>{fe.index[Te.prop]=Te.data,ye++,_e()}).catch(me):pe(fe)}).catch(me)}let fe=null,he=0,ye=0;se(z).then((Ce)=>{return Ce?void te(Ce).then((Te)=>{fe=Te,ge()}).catch(me):pe(fe)}).catch(me)})}function ie(){return new Promise((pe)=>{se(Q).then((ge)=>{if(ge===void 0){const _e=self.crypto.subtle===void 0;ne(Q,_e).then(()=>{pe(_e)})}else pe(ge)})})}function de(pe){return new Promise((me)=>{let _e=new Blob([pe],{type:'text/plain'}),fe=new FileReader;fe.onload=(he)=>{me(new Uint8Array(he.target.result))},fe.readAsArrayBuffer(_e)})}function le(pe,me){return new Promise((ge)=>{let fe=new Blob([pe],{type:'application/octet-stream'}),he=new FileReader;he.onload=(ye)=>{ge(ye.target.result)},me?he.readAsText(fe,me):he.readAsText(fe)})}function ce(pe){return new Promise((me)=>{this.subtle?this.subtle.importKey('raw',pe,{name:'AES-CBC'},!1,['encrypt','decrypt']).then((_e)=>{me(_e)}):me(pe)})}switch(Z.data.action){case'initialise':const pe=()=>{N=!0,self.postMessage({_id:Z.data._id,action:'initialisation-complete',success:!0,msg:'Successfully initialised the user index.'})},me=(Ee)=>{self.postMessage({_id:Z.data._id,action:'initialisation-complete',success:!1,msg:Ee})};if(!Z.data.instanceId)return void me('Error initialising user index database.');K=!0===Z.data.debug,H=`${Z.data.instanceId}_user_index`;const ge=indexedDB.open(H);this._blockSize=Z.data.blockSize||this._blockSize;var ue=this;ge.onupgradeneeded=function(Ee){Ee.target.result.createObjectStore(H)},ge.onerror=function(){me('Failed opening database.')},ge.onsuccess=function(Ee){B=Ee.target.result,ie().then((Ie)=>{Ie?(A(),ue.subtle=null):ue.subtle=self.crypto.subtle,ce(Z.data.key).then((Re)=>{ue._key=Re,ue._iv=Z.data.iv,ae().then((Ae)=>{Ae&&(D=G.Index.load(Ae)),pe()}).catch(()=>{me('Failed reading database for previously stored index.')})}).catch(()=>{me('Failed importing key for previously stored index.')})}).catch(()=>{me('Failed detecting crypto type for previously stored index')})};break;case'fetch':if(!1==N)return void self.postMessage({_id:Z.data._id,success:!1,action:'index-complete',msg:'Initialisation must be completed before the \'fetch\' action can take place.'});const _e=Date.now();fetch(Z.data.endpoint,{method:'GET',headers:{Authorization:'Basic '+I(`${Z.data.jid}:${Z.data.pass}`)}}).then((Ee)=>{return Ee.json()}).then((Ee)=>{const Ie={added:Ee.added||[],updated:Ee.updated||[],removed:Ee.removed||[]};void 0!==Ee.full&&(D=null,Ie.added=Ee.full);const Re=Date.now()-_e,Ae=[`Downloaded '${Ie.added.length}' additions, '${Ie.updated.length}' updates and '${Ie.removed.length}' deletions in ${Re}ms`];null===D&&(D=G(function(){this.setRef('jid'),this.addField('jid'),this.addField('firstName'),this.addField('lastName'),this.addField('jobTitle'),this.addField('telephone'),this.addField('group'),this.saveDocument(!0)}),Ae.push(`Created a fresh index`)),0<Ie.added.length&&(Ie.added.forEach((Me)=>D.addDoc(Me)),Ae.push(`Added '${Ie.added.length}' users to index`)),0<Ie.updated.length&&(Ie.updated.forEach((Me)=>D.updateDoc(Me)),Ae.push(`Updated '${Ie.updated.length}' users in index`)),0<Ie.removed.length&&(Ie.removed.forEach((Me)=>D.removeDoc(Me)),Ae.push(`Removed '${Ie.removed.length}' users from index`)),oe(2e3).then(()=>{self.postMessage({_id:Z.data._id,success:!0,action:'index-complete',hash:Ee.hash||null,msg:`${Ae.join(', ')} | Completed in ${Date.now()-_e}ms.`})}).catch(()=>{self.postMessage({_id:Z.data._id,success:!1,action:'index-complete',msg:'Couldn\'t persist updated index.'})})}).catch((Ee)=>{const Ie=`Unable to download user directory from location '${Z.data.endpoint}'`;console.error(Ie,Ee),self.postMessage({_id:Z.data._id,success:!1,action:'index-complete',msg:Ie})});break;case'search':if(G.clearStopWords(),!1==N)return void self.postMessage({_id:Z.data._id,success:!1,action:'search-complete',msg:'Initialisation must be completed before the \'search\' action can take place.'});if(null===D)return void self.postMessage({_id:Z.data._id,success:!1,action:'search-complete',msg:'There is no index to be searched, have you updated the index yet?'});const fe=Date.now();let he=null;if(Array.isArray(Z.data.fields)&&0<Z.data.fields.length){const Ee={fields:{},bool:'OR',expand:!0};Z.data.fields.forEach((Ie)=>{Ee.fields[Ie]={}}),he=D.search(Z.data.query,Ee)}else he=D.search(Z.data.query,{expand:!0});const ye=he.map((Ee)=>{return Ee.doc});self.postMessage({_id:Z.data._id,success:!0,action:'search-complete',msg:`Found ${ye.length} users in ${Date.now()-fe}ms.`,results:ye});break;case'jid-search':if(!1==N)return void self.postMessage({_id:Z.data._id,success:!1,action:'jid-search-complete',msg:'Initialisation must be completed before the \'jid-search\' action can take place.'});if(null===D)return void self.postMessage({_id:Z.data._id,success:!1,action:'jid-search-complete',msg:'There is no index to be searched, have you updated the index yet?'});const Ce=Date.now(),Te=D.search(Z.data.jid,{expand:!0})[0],ve=void 0===Te?null:Te.doc;self.postMessage({_id:Z.data._id,success:!0,action:'jid-search-complete',msg:null===ve?`No user with JID '${Z.data.jid}' could be found.`:`Found user with JID '${Z.data.jid}' in ${Date.now()-Ce}ms.`,result:ve});break;case'get-all-users':if(!1==N)return void self.postMessage({_id:Z.data._id,success:!1,action:'get-all-users-complete',msg:'Initialisation must be completed before the \'get-all-users\' action can take place.'});if(null===D)return void self.postMessage({_id:Z.data._id,success:!1,action:'get-all-users-complete',msg:'There is no index available, have you updated the index yet?'});const Se=Date.now(),be=[];for(let Ee in D.documentStore.docs)be.push(D.documentStore.docs[Ee]);self.postMessage({_id:Z.data._id,success:!0,action:'get-all-users-complete',msg:`Fetched '${be.length}' users in ${Date.now()-Se}ms.`,results:be});break;case'destroy':if(null!==B){B.close();const Ee=indexedDB.deleteDatabase(H);Ee.onerror=function(){self.postMessage({_id:Z.data._id,success:!1,action:'destroy-complete',msg:'Error deleting user directory database.'})},Ee.onsuccess=function(){N=!1,D=null,B=null,H=null,self.postMessage({_id:Z.data._id,success:!0,action:'destroy-complete',msg:null}),self.close()},Ee.onblocked=function(){self.postMessage({_id:Z.data._id,success:!1,action:'destroy-complete',msg:'Couldn\'t delete user directory database due to the operation being blocked.'})}}else self.postMessage({_id:Z.data._id,success:!0,action:'destroy-complete',msg:'Database not yet initialised, so nothing to destroy.'}),self.close();break;default:self.postMessage({_id:Z.data._id,success:!0,msg:`Invalid action '${Z.data.action}' was specified.`});}}}},function(u,f,h){var E,I,R,A,M,N,D,B,H,z,H,$,H,Y,H,G,H,J;(function(W,X){I={id:'strophe-base64',exports:{},loaded:!1},E=function(){return X()}.call(I.exports,h,I.exports,I),I.loaded=!0,!(E===void 0&&(E=I.exports))})(this,function(){var W='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return{encode:function(K){var Q='',Z,ee,te,ne,se,oe,ae,ie=0;do Z=K.charCodeAt(ie++),ee=K.charCodeAt(ie++),te=K.charCodeAt(ie++),ne=Z>>2,se=(3&Z)<<4|ee>>4,oe=(15&ee)<<2|te>>6,ae=63&te,isNaN(ee)?(se=(3&Z)<<4,oe=ae=64):isNaN(te)&&(ae=64),Q=Q+W.charAt(ne)+W.charAt(se)+W.charAt(oe)+W.charAt(ae);while(ie<K.length);return Q},decode:function(K){var Q='',Z,ee,te,ne,se,oe,ae,ie=0;K=K.replace(/[^A-Za-z0-9\+\/\=]/g,'');do ne=W.indexOf(K.charAt(ie++)),se=W.indexOf(K.charAt(ie++)),oe=W.indexOf(K.charAt(ie++)),ae=W.indexOf(K.charAt(ie++)),Z=ne<<2|se>>4,ee=(15&se)<<4|oe>>2,te=(3&oe)<<6|ae,Q+=_StringfromCharCode(Z),64!=oe&&(Q+=_StringfromCharCode(ee)),64!=ae&&(Q+=_StringfromCharCode(te));while(ie<K.length);return Q}}}),function(W,X){A={id:'strophe-sha1',exports:{},loaded:!1},R=function(){return X()}.call(A.exports,h,A.exports,A),A.loaded=!0,!(R===void 0&&(R=A.exports))}(this,function(){function W(oe,ae){oe[ae>>5]|=128<<24-ae%32,oe[(ae+64>>9<<4)+15]=ae;var ie=Array(80),de=1732584193,le=-271733879,ce=-1732584194,ue=271733878,pe=-1009589776,me,ge,_e,fe,he,ye,Ce,Te;for(me=0;me<oe.length;me+=16){for(fe=de,he=le,ye=ce,Ce=ue,Te=pe,ge=0;80>ge;ge++)ie[ge]=16>ge?oe[me+ge]:ee(ie[ge-3]^ie[ge-8]^ie[ge-14]^ie[ge-16],1),_e=Z(Z(ee(de,5),X(ge,le,ce,ue)),Z(Z(pe,ie[ge]),K(ge))),pe=ue,ue=ce,ce=ee(le,30),le=de,de=_e;de=Z(de,fe),le=Z(le,he),ce=Z(ce,ye),ue=Z(ue,Ce),pe=Z(pe,Te)}return[de,le,ce,ue,pe]}function X(oe,ae,ie,de){return 20>oe?ae&ie|~ae&de:40>oe?ae^ie^de:60>oe?ae&ie|ae&de|ie&de:ae^ie^de}function K(oe){return 20>oe?1518500249:40>oe?1859775393:60>oe?-1894007588:-899497514}function Q(oe,ae){var ie=te(oe);16<ie.length&&(ie=W(ie,8*oe.length));for(var de=Array(16),le=Array(16),ce=0;16>ce;ce++)de[ce]=909522486^ie[ce],le[ce]=1549556828^ie[ce];var ue=W(de.concat(te(ae)),512+8*ae.length);return W(le.concat(ue),672)}function Z(oe,ae){var ie=(65535&oe)+(65535&ae);return(oe>>16)+(ae>>16)+(ie>>16)<<16|65535&ie}function ee(oe,ae){return oe<<ae|oe>>>32-ae}function te(oe){for(var ae=[],de=0;de<8*oe.length;de+=8)ae[de>>5]|=(oe.charCodeAt(de/8)&255)<<24-de%32;return ae}function ne(oe){for(var ae='',de=0;de<32*oe.length;de+=8)ae+=_StringfromCharCode(oe[de>>5]>>>24-de%32&255);return ae}function se(oe){for(var ie='',ce=0,de,le;ce<4*oe.length;ce+=3)for(de=(255&oe[ce>>2]>>8*(3-ce%4))<<16|(255&oe[ce+1>>2]>>8*(3-(ce+1)%4))<<8|255&oe[ce+2>>2]>>8*(3-(ce+2)%4),le=0;4>le;le++)ie+=8*ce+6*le>32*oe.length?'=':'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.charAt(63&de>>6*(3-le));return ie}return{b64_hmac_sha1:function(oe,ae){return se(Q(oe,ae))},b64_sha1:function(oe){return se(W(te(oe),8*oe.length))},binb2str:ne,core_hmac_sha1:Q,str_hmac_sha1:function(oe,ae){return ne(Q(oe,ae))},str_sha1:function(oe){return ne(W(te(oe),8*oe.length))}}}),function(W,X){N={id:'strophe-md5',exports:{},loaded:!1},M=function(){return X()}.call(N.exports,h,N.exports,N),N.loaded=!0,!(M===void 0&&(M=N.exports))}(this,function(){var X=function(le,ce){var ue=(65535&le)+(65535&ce);return(le>>16)+(ce>>16)+(ue>>16)<<16|65535&ue},K=function(le,ce){return le<<ce|le>>>32-ce},Q=function(le){for(var ce=[],ue=0;ue<8*le.length;ue+=8)ce[ue>>5]|=(255&le.charCodeAt(ue/8))<<ue%32;return ce},Z=function(le){for(var ce='',ue=0;ue<32*le.length;ue+=8)ce+=_StringfromCharCode(255&le[ue>>5]>>>ue%32);return ce},ee=function(le){for(var ce='0123456789abcdef',ue='',pe=0;pe<4*le.length;pe++)ue+=ce.charAt(15&le[pe>>2]>>8*(pe%4)+4)+ce.charAt(15&le[pe>>2]>>8*(pe%4));return ue},te=function(le,ce,ue,pe,me,ge){return X(K(X(X(ce,le),X(pe,ge)),me),ue)},ne=function(le,ce,ue,pe,me,ge,_e){return te(ce&ue|~ce&pe,le,ce,me,ge,_e)},se=function(le,ce,ue,pe,me,ge,_e){return te(ce&pe|ue&~pe,le,ce,me,ge,_e)},oe=function(le,ce,ue,pe,me,ge,_e){return te(ce^ue^pe,le,ce,me,ge,_e)},ae=function(le,ce,ue,pe,me,ge,_e){return te(ue^(ce|~pe),le,ce,me,ge,_e)},ie=function(le,ce){le[ce>>5]|=128<<ce%32,le[(ce+64>>>9<<4)+14]=ce;for(var ue=1732584193,pe=-271733879,me=-1732584194,ge=271733878,Ce=0,_e,fe,he,ye;Ce<le.length;Ce+=16)_e=ue,fe=pe,he=me,ye=ge,ue=ne(ue,pe,me,ge,le[Ce+0],7,-680876936),ge=ne(ge,ue,pe,me,le[Ce+1],12,-389564586),me=ne(me,ge,ue,pe,le[Ce+2],17,606105819),pe=ne(pe,me,ge,ue,le[Ce+3],22,-1044525330),ue=ne(ue,pe,me,ge,le[Ce+4],7,-176418897),ge=ne(ge,ue,pe,me,le[Ce+5],12,1200080426),me=ne(me,ge,ue,pe,le[Ce+6],17,-1473231341),pe=ne(pe,me,ge,ue,le[Ce+7],22,-45705983),ue=ne(ue,pe,me,ge,le[Ce+8],7,1770035416),ge=ne(ge,ue,pe,me,le[Ce+9],12,-1958414417),me=ne(me,ge,ue,pe,le[Ce+10],17,-42063),pe=ne(pe,me,ge,ue,le[Ce+11],22,-1990404162),ue=ne(ue,pe,me,ge,le[Ce+12],7,1804603682),ge=ne(ge,ue,pe,me,le[Ce+13],12,-40341101),me=ne(me,ge,ue,pe,le[Ce+14],17,-1502002290),pe=ne(pe,me,ge,ue,le[Ce+15],22,1236535329),ue=se(ue,pe,me,ge,le[Ce+1],5,-165796510),ge=se(ge,ue,pe,me,le[Ce+6],9,-1069501632),me=se(me,ge,ue,pe,le[Ce+11],14,643717713),pe=se(pe,me,ge,ue,le[Ce+0],20,-373897302),ue=se(ue,pe,me,ge,le[Ce+5],5,-701558691),ge=se(ge,ue,pe,me,le[Ce+10],9,38016083),me=se(me,ge,ue,pe,le[Ce+15],14,-660478335),pe=se(pe,me,ge,ue,le[Ce+4],20,-405537848),ue=se(ue,pe,me,ge,le[Ce+9],5,568446438),ge=se(ge,ue,pe,me,le[Ce+14],9,-1019803690),me=se(me,ge,ue,pe,le[Ce+3],14,-187363961),pe=se(pe,me,ge,ue,le[Ce+8],20,1163531501),ue=se(ue,pe,me,ge,le[Ce+13],5,-1444681467),ge=se(ge,ue,pe,me,le[Ce+2],9,-51403784),me=se(me,ge,ue,pe,le[Ce+7],14,1735328473),pe=se(pe,me,ge,ue,le[Ce+12],20,-1926607734),ue=oe(ue,pe,me,ge,le[Ce+5],4,-378558),ge=oe(ge,ue,pe,me,le[Ce+8],11,-2022574463),me=oe(me,ge,ue,pe,le[Ce+11],16,1839030562),pe=oe(pe,me,ge,ue,le[Ce+14],23,-35309556),ue=oe(ue,pe,me,ge,le[Ce+1],4,-1530992060),ge=oe(ge,ue,pe,me,le[Ce+4],11,1272893353),me=oe(me,ge,ue,pe,le[Ce+7],16,-155497632),pe=oe(pe,me,ge,ue,le[Ce+10],23,-1094730640),ue=oe(ue,pe,me,ge,le[Ce+13],4,681279174),ge=oe(ge,ue,pe,me,le[Ce+0],11,-358537222),me=oe(me,ge,ue,pe,le[Ce+3],16,-722521979),pe=oe(pe,me,ge,ue,le[Ce+6],23,76029189),ue=oe(ue,pe,me,ge,le[Ce+9],4,-640364487),ge=oe(ge,ue,pe,me,le[Ce+12],11,-421815835),me=oe(me,ge,ue,pe,le[Ce+15],16,530742520),pe=oe(pe,me,ge,ue,le[Ce+2],23,-995338651),ue=ae(ue,pe,me,ge,le[Ce+0],6,-198630844),ge=ae(ge,ue,pe,me,le[Ce+7],10,1126891415),me=ae(me,ge,ue,pe,le[Ce+14],15,-1416354905),pe=ae(pe,me,ge,ue,le[Ce+5],21,-57434055),ue=ae(ue,pe,me,ge,le[Ce+12],6,1700485571),ge=ae(ge,ue,pe,me,le[Ce+3],10,-1894986606),me=ae(me,ge,ue,pe,le[Ce+10],15,-1051523),pe=ae(pe,me,ge,ue,le[Ce+1],21,-2054922799),ue=ae(ue,pe,me,ge,le[Ce+8],6,1873313359),ge=ae(ge,ue,pe,me,le[Ce+15],10,-30611744),me=ae(me,ge,ue,pe,le[Ce+6],15,-1560198380),pe=ae(pe,me,ge,ue,le[Ce+13],21,1309151649),ue=ae(ue,pe,me,ge,le[Ce+4],6,-145523070),ge=ae(ge,ue,pe,me,le[Ce+11],10,-1120210379),me=ae(me,ge,ue,pe,le[Ce+2],15,718787259),pe=ae(pe,me,ge,ue,le[Ce+9],21,-343485551),ue=X(ue,_e),pe=X(pe,fe),me=X(me,he),ge=X(ge,ye);return[ue,pe,me,ge]};return{hexdigest:function(le){return ee(ie(Q(le),8*le.length))},hash:function(le){return Z(ie(Q(le),8*le.length))}}}),function(W,X){B={id:'strophe-utils',exports:{},loaded:!1},D=function(){return X()}.call(B.exports,h,B.exports,B),B.loaded=!0,!(D===void 0&&(D=B.exports))}(this,function(){return{utf16to8:function(X){var K,Q,Z='',ee=X.length;for(K=0;K<ee;K++)Q=X.charCodeAt(K),0<=Q&&127>=Q?Z+=X.charAt(K):2047<Q?(Z+=_StringfromCharCode(224|15&Q>>12),Z+=_StringfromCharCode(128|63&Q>>6),Z+=_StringfromCharCode(128|63&Q>>0)):(Z+=_StringfromCharCode(192|31&Q>>6),Z+=_StringfromCharCode(128|63&Q>>0));return Z},addCookies:function(X){var K,Q,Z,ee,te,ne,se;for(K in X||{})te='',ne='',se='',Q=X[K],Z='object'==typeof Q,ee=escape(unescape(Z?Q.value:Q)),Z&&(te=Q.expires?';expires='+Q.expires:'',ne=Q.domain?';domain='+Q.domain:'',se=Q.path?';path='+Q.path:''),document.cookie=K+'='+ee+te+ne+se}}}),function(W,X){H=[],!(z=function(){return X()}.apply(f,H))}(this,function(){Function.prototype.bind||(Function.prototype.bind=function(W){var X=this,K=Array.prototype.slice,Q=Array.prototype.concat,Z=K.call(arguments,1);return function(){return X.apply(W?W:this,Q.call(Z,K.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(W){return'[object Array]'===Object.prototype.toString.call(W)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(W){var X=this.length,K=+arguments[1]||0;for(K=0>K?Math.ceil(K):_Mathfloor(K),0>K&&(K+=X);K<X;K++)if(K in this&&this[K]===W)return K;return-1})}),Array.prototype.forEach||(Array.prototype.forEach=function(W,X){var K,Q;if(null===this)throw new TypeError(' this is null or not defined');var Z=Object(this),ee=Z.length>>>0;if('function'!=typeof W)throw new TypeError(W+' is not a function');for(1<arguments.length&&(K=X),Q=0;Q<ee;){var te;Q in Z&&(te=Z[Q],W.call(K,te,Q,Z)),Q++}}),function(W,X){H=[R,E,M,D,z],!($=function(){return X.apply(this,arguments)}.apply(f,H))}(this,function(W,X,K,Q){function Z(oe,ae){return new se.Builder(oe,ae)}function te(oe){return new se.Builder('iq',oe)}function ne(oe){return new se.Builder('presence',oe)}var se;return se={VERSION:'1.2.12',NS:{HTTPBIND:'http://jabber.org/protocol/httpbind',BOSH:'urn:xmpp:xbosh',CLIENT:'jabber:client',AUTH:'jabber:iq:auth',ROSTER:'jabber:iq:roster',PROFILE:'jabber:iq:profile',DISCO_INFO:'http://jabber.org/protocol/disco#info',DISCO_ITEMS:'http://jabber.org/protocol/disco#items',MUC:'http://jabber.org/protocol/muc',SASL:'urn:ietf:params:xml:ns:xmpp-sasl',STREAM:'http://etherx.jabber.org/streams',FRAMING:'urn:ietf:params:xml:ns:xmpp-framing',BIND:'urn:ietf:params:xml:ns:xmpp-bind',SESSION:'urn:ietf:params:xml:ns:xmpp-session',VERSION:'jabber:iq:version',STANZAS:'urn:ietf:params:xml:ns:xmpp-stanzas',XHTML_IM:'http://jabber.org/protocol/xhtml-im',XHTML:'http://www.w3.org/1999/xhtml'},XHTML:{tags:['a','blockquote','br','cite','em','img','li','ol','p','span','strong','ul','body'],attributes:{a:['href'],blockquote:['style'],br:[],cite:['style'],em:[],img:['src','alt','style','height','width'],li:['style'],ol:['style'],p:['style'],span:['style'],strong:[],ul:['style'],body:[]},css:['background-color','color','font-family','font-size','font-style','font-weight','margin-left','margin-right','text-align','text-decoration'],validTag:function(oe){for(var ae=0;ae<se.XHTML.tags.length;ae++)if(oe==se.XHTML.tags[ae])return!0;return!1},validAttribute:function(oe,ae){if('undefined'!=typeof se.XHTML.attributes[oe]&&0<se.XHTML.attributes[oe].length)for(var ie=0;ie<se.XHTML.attributes[oe].length;ie++)if(ae==se.XHTML.attributes[oe][ie])return!0;return!1},validCSS:function(oe){for(var ae=0;ae<se.XHTML.css.length;ae++)if(oe==se.XHTML.css[ae])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,addNamespace:function(oe,ae){se.NS[oe]=ae},forEachChild:function(oe,ae,ie){var de,le;for(de=0;de<oe.childNodes.length;de++)le=oe.childNodes[de],le.nodeType==se.ElementType.NORMAL&&(!ae||this.isTagEqual(le,ae))&&ie(le)},isTagEqual:function(oe,ae){return oe.tagName==ae},_xmlGenerator:null,_makeGenerator:function(){var oe;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&10>document.documentMode?(oe=this._getIEXmlDom(),oe.appendChild(oe.createElement('strophe'))):oe=document.implementation.createDocument('jabber:client','strophe',null),oe},xmlGenerator:function(){return se._xmlGenerator||(se._xmlGenerator=se._makeGenerator()),se._xmlGenerator},_getIEXmlDom:function(){for(var oe=null,ae=['Msxml2.DOMDocument.6.0','Msxml2.DOMDocument.5.0','Msxml2.DOMDocument.4.0','MSXML2.DOMDocument.3.0','MSXML2.DOMDocument','MSXML.DOMDocument','Microsoft.XMLDOM'],ie=0;ie<ae.length&&null==oe;ie++)try{oe=new ActiveXObject(ae[ie])}catch(de){oe=null}return oe},xmlElement:function(oe){if(!oe)return null;var ae=se.xmlGenerator().createElement(oe),ie,de,le;for(ie=1;ie<arguments.length;ie++){var ce=arguments[ie];if(ce)if('string'==typeof ce||'number'==typeof ce)ae.appendChild(se.xmlTextNode(ce));else if('object'==typeof ce&&'function'==typeof ce.sort)for(de=0;de<ce.length;de++){var ue=ce[de];'object'==typeof ue&&'function'==typeof ue.sort&&void 0!==ue[1]&&null!==ue[1]&&ae.setAttribute(ue[0],ue[1])}else if('object'==typeof ce)for(le in ce)ce.hasOwnProperty(le)&&void 0!==ce[le]&&null!==ce[le]&&ae.setAttribute(le,ce[le])}return ae},xmlescape:function(oe){return oe=oe.replace(/\&/g,'&amp;'),oe=oe.replace(/</g,'&lt;'),oe=oe.replace(/>/g,'&gt;'),oe=oe.replace(/'/g,'&apos;'),oe=oe.replace(/"/g,'&quot;'),oe},xmlunescape:function(oe){return oe=oe.replace(/\&amp;/g,'&'),oe=oe.replace(/&lt;/g,'<'),oe=oe.replace(/&gt;/g,'>'),oe=oe.replace(/&apos;/g,'\''),oe=oe.replace(/&quot;/g,'"'),oe},xmlTextNode:function(oe){return se.xmlGenerator().createTextNode(oe)},xmlHtmlNode:function(oe){var ae;if(window.DOMParser){var ie=new DOMParser;ae=ie.parseFromString(oe,'text/xml')}else ae=new ActiveXObject('Microsoft.XMLDOM'),ae.async='false',ae.loadXML(oe);return ae},getText:function(oe){if(!oe)return null;var ae='';0===oe.childNodes.length&&oe.nodeType==se.ElementType.TEXT&&(ae+=oe.nodeValue);for(var ie=0;ie<oe.childNodes.length;ie++)oe.childNodes[ie].nodeType==se.ElementType.TEXT&&(ae+=oe.childNodes[ie].nodeValue);return se.xmlescape(ae)},copyElement:function(oe){var ae,ie;if(oe.nodeType==se.ElementType.NORMAL){for(ie=se.xmlElement(oe.tagName),ae=0;ae<oe.attributes.length;ae++)ie.setAttribute(oe.attributes[ae].nodeName,oe.attributes[ae].value);for(ae=0;ae<oe.childNodes.length;ae++)ie.appendChild(se.copyElement(oe.childNodes[ae]))}else oe.nodeType==se.ElementType.TEXT&&(ie=se.xmlGenerator().createTextNode(oe.nodeValue));return ie},createHtml:function(oe){var ae,ie,de,le,ce,ue,pe,me,ge,_e,fe;if(oe.nodeType==se.ElementType.NORMAL){if(le=oe.nodeName.toLowerCase(),se.XHTML.validTag(le))try{for(ie=se.xmlElement(le),ae=0;ae<se.XHTML.attributes[le].length;ae++)if(ce=se.XHTML.attributes[le][ae],ue=oe.getAttribute(ce),'undefined'!=typeof ue&&null!==ue&&''!==ue&&!1!==ue&&0!==ue)if('style'==ce&&'object'==typeof ue&&'undefined'!=typeof ue.cssText&&(ue=ue.cssText),'style'==ce){for(pe=[],me=ue.split(';'),de=0;de<me.length;de++)ge=me[de].split(':'),_e=ge[0].replace(/^\s*/,'').replace(/\s*$/,'').toLowerCase(),se.XHTML.validCSS(_e)&&(fe=ge[1].replace(/^\s*/,'').replace(/\s*$/,''),pe.push(_e+': '+fe));0<pe.length&&(ue=pe.join('; '),ie.setAttribute(ce,ue))}else ie.setAttribute(ce,ue);for(ae=0;ae<oe.childNodes.length;ae++)ie.appendChild(se.createHtml(oe.childNodes[ae]))}catch(he){ie=se.xmlTextNode('')}else for(ie=se.xmlGenerator().createDocumentFragment(),ae=0;ae<oe.childNodes.length;ae++)ie.appendChild(se.createHtml(oe.childNodes[ae]));}else if(oe.nodeType==se.ElementType.FRAGMENT)for(ie=se.xmlGenerator().createDocumentFragment(),ae=0;ae<oe.childNodes.length;ae++)ie.appendChild(se.createHtml(oe.childNodes[ae]));else oe.nodeType==se.ElementType.TEXT&&(ie=se.xmlTextNode(oe.nodeValue));return ie},escapeNode:function(oe){return'string'==typeof oe?oe.replace(/^\s+|\s+$/g,'').replace(/\\/g,'\\5c').replace(/ /g,'\\20').replace(/\"/g,'\\22').replace(/\&/g,'\\26').replace(/\'/g,'\\27').replace(/\//g,'\\2f').replace(/:/g,'\\3a').replace(/</g,'\\3c').replace(/>/g,'\\3e').replace(/@/g,'\\40'):oe},unescapeNode:function(oe){return'string'==typeof oe?oe.replace(/\\20/g,' ').replace(/\\22/g,'"').replace(/\\26/g,'&').replace(/\\27/g,'\'').replace(/\\2f/g,'/').replace(/\\3a/g,':').replace(/\\3c/g,'<').replace(/\\3e/g,'>').replace(/\\40/g,'@').replace(/\\5c/g,'\\'):oe},getNodeFromJid:function(oe){return 0>oe.indexOf('@')?null:oe.split('@')[0]},getDomainFromJid:function(oe){var ae=se.getBareJidFromJid(oe);if(0>ae.indexOf('@'))return ae;var ie=ae.split('@');return ie.splice(0,1),ie.join('@')},getResourceFromJid:function(oe){var ae=oe.split('/');return 2>ae.length?null:(ae.splice(0,1),ae.join('/'))},getBareJidFromJid:function(oe){return oe?oe.split('/')[0]:null},_handleError:function(oe){'undefined'!=typeof oe.stack&&se.fatal(oe.stack),oe.sourceURL?se.fatal('error: '+this.handler+' '+oe.sourceURL+':'+oe.line+' - '+oe.name+': '+oe.message):oe.fileName?se.fatal('error: '+this.handler+' '+oe.fileName+':'+oe.lineNumber+' - '+oe.name+': '+oe.message):se.fatal('error: '+oe.message)},log:function(){},debug:function(oe){this.log(this.LogLevel.DEBUG,oe)},info:function(oe){this.log(this.LogLevel.INFO,oe)},warn:function(oe){this.log(this.LogLevel.WARN,oe)},error:function(oe){this.log(this.LogLevel.ERROR,oe)},fatal:function(oe){this.log(this.LogLevel.FATAL,oe)},serialize:function(oe){var ae;if(!oe)return null;'function'==typeof oe.tree&&(oe=oe.tree());var ie=oe.nodeName,de,le;for(oe.getAttribute('_realname')&&(ie=oe.getAttribute('_realname')),ae='<'+ie,de=0;de<oe.attributes.length;de++)'_realname'!=oe.attributes[de].nodeName&&(ae+=' '+oe.attributes[de].nodeName+'=\''+se.xmlescape(oe.attributes[de].value)+'\'');if(0<oe.childNodes.length){for(ae+='>',de=0;de<oe.childNodes.length;de++)switch(le=oe.childNodes[de],le.nodeType){case se.ElementType.NORMAL:ae+=se.serialize(le);break;case se.ElementType.TEXT:ae+=se.xmlescape(le.nodeValue);break;case se.ElementType.CDATA:ae+='<![CDATA['+le.nodeValue+']]>';}ae+='</'+ie+'>'}else ae+='/>';return ae},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(oe,ae){se._connectionPlugins[oe]=ae}},se.Builder=function(oe,ae){('presence'==oe||'message'==oe||'iq'==oe)&&(ae&&!ae.xmlns?ae.xmlns=se.NS.CLIENT:!ae&&(ae={xmlns:se.NS.CLIENT})),this.nodeTree=se.xmlElement(oe,ae),this.node=this.nodeTree},se.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return se.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(oe){for(var ae in oe)oe.hasOwnProperty(ae)&&(void 0===oe[ae]?this.node.removeAttribute(ae):this.node.setAttribute(ae,oe[ae]));return this},c:function(oe,ae,ie){var de=se.xmlElement(oe,ae,ie);return this.node.appendChild(de),'string'!=typeof ie&&'number'!=typeof ie&&(this.node=de),this},cnode:function(oe){var ie=se.xmlGenerator(),ae;try{ae=void 0!==ie.importNode}catch(le){ae=!1}var de=ae?ie.importNode(oe,!0):se.copyElement(oe);return this.node.appendChild(de),this.node=de,this},t:function(oe){var ae=se.xmlTextNode(oe);return this.node.appendChild(ae),this},h:function(oe){var ae=document.createElement('body');ae.innerHTML=oe;for(var ie=se.createHtml(ae);0<ie.childNodes.length;)this.node.appendChild(ie.childNodes[0]);return this}},se.Handler=function(oe,ae,ie,de,le,ce,ue){this.handler=oe,this.ns=ae,this.name=ie,this.type=de,this.id=le,this.options=ue||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(se.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.from=this.options.matchBareFromJid?ce?se.getBareJidFromJid(ce):null:ce,this.user=!0},se.Handler.prototype={getNamespace:function(oe){var ae=oe.getAttribute('xmlns');return ae&&this.options.ignoreNamespaceFragment&&(ae=ae.split('#')[0]),ae},namespaceMatch:function(oe){var ae=!1;if(!this.ns)return!0;var ie=this;return se.forEachChild(oe,null,function(de){ie.getNamespace(de)===ie.ns&&(ae=!0)}),ae=ae||this.getNamespace(oe)===this.ns,ae},isMatch:function(oe){var ae=oe.getAttribute('from');this.options.matchBareFromJid&&(ae=se.getBareJidFromJid(ae));var ie=oe.getAttribute('type');return!this.namespaceMatch(oe)||this.name&&!se.isTagEqual(oe,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(ie):ie!=this.type)||this.id&&oe.getAttribute('id')!=this.id||this.from&&ae!=this.from?!1:!0},run:function(oe){var ae=null;try{ae=this.handler(oe)}catch(ie){throw se._handleError(ie),ie}return ae},toString:function(){return'{Handler: '+this.handler+'('+this.name+','+this.id+','+this.ns+')}'}},se.TimedHandler=function(oe,ae){this.period=oe,this.handler=ae,this.lastCalled=new Date().getTime(),this.user=!0},se.TimedHandler.prototype={run:function(){return this.lastCalled=new Date().getTime(),this.handler()},reset:function(){this.lastCalled=new Date().getTime()},toString:function(){return'{TimedHandler: '+this.handler+'('+this.period+')}'}},se.Connection=function(oe,ae){this.service=oe,this.options=ae||{};var ie=this.options.protocol||'';for(var de in this._proto=0===oe.indexOf('ws:')||0===oe.indexOf('wss:')||0===ie.indexOf('ws')?new se.Websocket(this):new se.Bosh(this),this.jid='',this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),Q.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),se._connectionPlugins)if(se._connectionPlugins.hasOwnProperty(de)){var le=se._connectionPlugins[de],ce=function(){};ce.prototype=le,this[de]=new ce,this[de].init(this)}},se.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this.override=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(oe){var ae='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(ie){var de=0|16*Math.random(),le='x'==ie?de:8|3&de;return le.toString(16)});return'string'==typeof oe||'number'==typeof oe?ae+':'+oe:ae+''},addProtocolErrorHandler:function(oe,ae,ie){this.protocolErrorHandlers[oe][ae]=ie},connect:function(oe,ae,ie,de,le,ce,ue){this.jid=oe,this.authzid=se.getBareJidFromJid(this.jid),this.authcid=ue||se.getNodeFromJid(this.jid),this.pass=ae,this.servtype='xmpp',this.connect_callback=ie,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=se.getDomainFromJid(this.jid),this._changeConnectStatus(se.Status.CONNECTING,null),this._proto._connect(de,le,ce)},attach:function(oe,ae,ie,de,le,ce,ue){if(this._proto instanceof se.Bosh)this._proto._attach(oe,ae,ie,de,le,ce,ue);else throw{name:'StropheSessionError',message:'The "attach" method can only be used with a BOSH connection.'}},restore:function(oe,ae,ie,de,le){if(this._sessionCachingSupported())this._proto._restore(oe,ae,ie,de,le);else throw{name:'StropheSessionError',message:'The "restore" method can only be used with a BOSH connection.'}},_sessionCachingSupported:function(){if(this._proto instanceof se.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem('_strophe_','_strophe_'),window.sessionStorage.removeItem('_strophe_')}catch(oe){return!1}return!0}return!1},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},nextValidRid:function(){},send:function(oe){if(null!==oe){if('function'==typeof oe.sort)for(var ae=0;ae<oe.length;ae++)this._queueData(oe[ae]);else'function'==typeof oe.tree?this._queueData(oe.tree()):this._queueData(oe);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(oe,ae,ie,de){var le=null,ce=this;'function'==typeof oe.tree&&(oe=oe.tree());var ue=oe.getAttribute('id');if(ue||(ue=this.getUniqueId('sendPresence'),oe.setAttribute('id',ue)),'function'==typeof ae||'function'==typeof ie){var pe=this.addHandler(function(me){le&&ce.deleteTimedHandler(le);var ge=me.getAttribute('type');'error'==ge?ie&&ie(me):ae&&ae(me)},null,'presence',null,ue);de&&(le=this.addTimedHandler(de,function(){return ce.deleteHandler(pe),ie&&ie(null),!1}))}return this.send(oe),ue},sendIQ:function(oe,ae,ie,de){var le=null,ce=this;'function'==typeof oe.tree&&(oe=oe.tree());var ue=oe.getAttribute('id');if(ue||(ue=this.getUniqueId('sendIQ'),oe.setAttribute('id',ue)),'function'==typeof ae||'function'==typeof ie){var pe=this.addHandler(function(me){le&&ce.deleteTimedHandler(le);var ge=me.getAttribute('type');if('result'==ge)ae&&ae(me);else if('error'==ge)ie&&ie(me);else throw{name:'StropheError',message:'Got bad IQ type of '+ge}},null,'iq',['error','result'],ue);de&&(le=this.addTimedHandler(de,function(){return ce.deleteHandler(pe),ie&&ie(null),!1}))}return this.send(oe),ue},_queueData:function(oe){if(null===oe||!oe.tagName||!oe.childNodes)throw{name:'StropheError',message:'Cannot queue non-DOMElement.'};this._data.push(oe)},_sendRestart:function(){this._data.push('restart'),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(oe,ae){var ie=new se.TimedHandler(oe,ae);return this.addTimeds.push(ie),ie},deleteTimedHandler:function(oe){this.removeTimeds.push(oe)},addHandler:function(oe,ae,ie,de,le,ce,ue){var pe=new se.Handler(oe,ae,ie,de,le,ce,ue);return this.addHandlers.push(pe),pe},deleteHandler:function(oe){this.removeHandlers.push(oe);var ae=this.addHandlers.indexOf(oe);0<=ae&&this.addHandlers.splice(ae,1)},registerSASLMechanisms:function(oe){this.mechanisms={},oe=oe||[se.SASLAnonymous,se.SASLExternal,se.SASLMD5,se.SASLOAuthBearer,se.SASLPlain,se.SASLSHA1],oe.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(oe){this.mechanisms[oe.prototype.name]=oe},disconnect:function(oe,ae){if(se.info('Disconnect was called because: '+oe),this.connected){this._changeConnectStatus(se.Status.DISCONNECTING,oe);var ie=!1;this.disconnecting=!0,this.authenticated&&(ie=ne({xmlns:se.NS.CLIENT,type:'unavailable'})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(ie,ae)}else se.info('Disconnect was called before Strophe connected to the server'),this._proto._abortAllRequests(),this._doDisconnect(oe)},_changeConnectStatus:function(oe,ae){for(var ie in se._connectionPlugins)if(se._connectionPlugins.hasOwnProperty(ie)){var de=this[ie];if(de.statusChanged)try{de.statusChanged(oe,ae)}catch(le){se.error(''+ie+' plugin caused an exception changing status: '+le)}}if(this.connect_callback)try{this.connect_callback(oe,ae)}catch(le){se._handleError(le),se.error('User connection callback caused an exception: '+le)}},_doDisconnect:function(oe){'number'==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),se.info('_doDisconnect was called'),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(se.Status.DISCONNECTED,oe),this.connected=!1},_dataRecv:function(oe,ae){se.info('_dataRecv called');var ie=this._proto._reqToData(oe);if(null!==ie){this.xmlInput!==se.Connection.prototype.xmlInput&&(ie.nodeName===this._proto.strip&&ie.childNodes.length?this.xmlInput(ie.childNodes[0]):this.xmlInput(ie)),this.rawInput!==se.Connection.prototype.rawInput&&(ae?this.rawInput(ae):this.rawInput(se.serialize(ie)));for(var de,le;0<this.removeHandlers.length;)le=this.removeHandlers.pop(),de=this.handlers.indexOf(le),0<=de&&this.handlers.splice(de,1);for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var ce=ie.getAttribute('type'),ue,pe;if(null!==ce&&'terminate'==ce)return this.disconnecting?void 0:(ue=ie.getAttribute('condition'),pe=ie.getElementsByTagName('conflict'),null===ue?this._changeConnectStatus(se.Status.CONNFAIL,'unknown'):('remote-stream-error'==ue&&0<pe.length&&(ue='conflict'),this._changeConnectStatus(se.Status.CONNFAIL,ue)),void this._doDisconnect(ue));var me=this;se.forEachChild(ie,null,function(ge){var _e,fe;for(fe=me.handlers,me.handlers=[],_e=0;_e<fe.length;_e++){var he=fe[_e];try{he.isMatch(ge)&&(me.authenticated||!he.user)?he.run(ge)&&me.handlers.push(he):me.handlers.push(he)}catch(ye){se.warn('Removing Strophe handlers due to uncaught exception: '+ye.message)}}})}},mechanisms:{},_connect_cb:function(oe,ae,ie){se.info('_connect_cb was called'),this.connected=!0;var de;try{de=this._proto._reqToData(oe)}catch(_e){if('badformat'!=_e)throw _e;this._changeConnectStatus(se.Status.CONNFAIL,'bad-format'),this._doDisconnect('bad-format')}if(de){this.xmlInput!==se.Connection.prototype.xmlInput&&(de.nodeName===this._proto.strip&&de.childNodes.length?this.xmlInput(de.childNodes[0]):this.xmlInput(de)),this.rawInput!==se.Connection.prototype.rawInput&&(ie?this.rawInput(ie):this.rawInput(se.serialize(de)));var le=this._proto._connect_cb(de);if(le!==se.Status.CONNFAIL){var ce;if(ce=de.getElementsByTagNameNS?0<de.getElementsByTagNameNS(se.NS.STREAM,'features').length:0<de.getElementsByTagName('stream:features').length||0<de.getElementsByTagName('features').length,!ce)return void this._proto._no_auth_received(ae);var ue=[],ge=de.getElementsByTagName('mechanism'),pe,me;if(0<ge.length)for(pe=0;pe<ge.length;pe++)me=se.getText(ge[pe]),this.mechanisms[me]&&ue.push(this.mechanisms[me]);return 0===ue.length&&0===de.getElementsByTagName('auth').length?void this._proto._no_auth_received(ae):void(!1!==this.do_authentication&&this.authenticate(ue))}}},sortMechanismsByPriority:function(oe){var ae,ie,de,le;for(ae=0;ae<oe.length-1;++ae){for(de=ae,ie=ae+1;ie<oe.length;++ie)oe[ie].prototype.priority>oe[de].prototype.priority&&(de=ie);de!=ae&&(le=oe[ae],oe[ae]=oe[de],oe[de]=le)}return oe},_attemptSASLAuth:function(oe){oe=this.sortMechanismsByPriority(oe||[]);var ae=0,ie=!1;for(ae=0;ae<oe.length;++ae)if(oe[ae].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,'success',null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,'failure',null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,'challenge',null,null),this._sasl_mechanism=new oe[ae],this._sasl_mechanism.onStart(this);var de=Z('auth',{xmlns:se.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var le=this._sasl_mechanism.onChallenge(this,null);de.t(X.encode(le))}this.send(de.tree()),ie=!0;break}return ie},_attemptLegacyAuth:function(){null===se.getNodeFromJid(this.jid)?(this._changeConnectStatus(se.Status.CONNFAIL,'x-strophe-bad-non-anon-jid'),this.disconnect('x-strophe-bad-non-anon-jid')):(this._changeConnectStatus(se.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,'_auth_1'),this.send(te({type:'get',to:this.domain,id:'_auth_1'}).c('query',{xmlns:se.NS.AUTH}).c('username',{}).t(se.getNodeFromJid(this.jid)).tree()))},authenticate:function(oe){this._attemptSASLAuth(oe)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(oe){var ae=X.decode(se.getText(oe)),ie=this._sasl_mechanism.onChallenge(this,ae),de=Z('response',{xmlns:se.NS.SASL});return''!==ie&&de.t(X.encode(ie)),this.send(de.tree()),!0},_auth1_cb:function(){var ae=te({type:'set',id:'_auth_2'}).c('query',{xmlns:se.NS.AUTH}).c('username',{}).t(se.getNodeFromJid(this.jid)).up().c('password').t(this.pass);return se.getResourceFromJid(this.jid)||(this.jid=se.getBareJidFromJid(this.jid)+'/strophe'),ae.up().c('resource',{}).t(se.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,'_auth_2'),this.send(ae.tree()),!1},_sasl_success_cb:function(oe){if(this._sasl_data['server-signature']){var ie=X.decode(se.getText(oe)),de=/([a-z]+)=([^,]+)(,|$)/,le=ie.match(de),ae;if('v'==le[1]&&(ae=le[2]),ae!=this._sasl_data['server-signature'])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}se.info('SASL authentication succeeded.'),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var ce=[],ue=function(pe,me){for(;pe.length;)this.deleteHandler(pe.pop());return this._sasl_auth1_cb.bind(this)(me),!1};return ce.push(this._addSysHandler(function(pe){ue.bind(this)(ce,pe)}.bind(this),null,'stream:features',null,null)),ce.push(this._addSysHandler(function(pe){ue.bind(this)(ce,pe)}.bind(this),se.NS.STREAM,'features',null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(oe){this.features=oe;var ae,ie;for(ae=0;ae<oe.childNodes.length;ae++)ie=oe.childNodes[ae],'bind'==ie.nodeName&&(this.do_bind=!0),'session'==ie.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(se.Status.AUTHFAIL,null),!1;var de=this,le=function(){de._addSysHandler(de._sasl_bind_cb.bind(de),null,null,null,'_bind_auth_2'),de.override&&(de.send(Z('override',{"resource-conflict":'closeold',xmlns:'urn:commontime:infinity:bind'})),de.override=!1);var ce=se.getResourceFromJid(de.jid);ce?de.send(te({type:'set',id:'_bind_auth_2'}).c('bind',{xmlns:se.NS.BIND}).c('resource',{}).t(ce).tree()):de.send(te({type:'set',id:'_bind_auth_2'}).c('bind',{xmlns:se.NS.BIND}).tree())};return void 0!==this.streamManagement&&void 0!==this.streamManagement.prevId?(this._addSysHandler(function(){return de.authenticated=!0,de._changeConnectStatus(se.Status.CONNECTED,'resumed'),!1},'urn:xmpp:sm:3','resumed'),this._addSysHandler(function(){return le(),!1},'urn:xmpp:sm:3','failed'),this.send(Z('resume',{xmlns:'urn:xmpp:sm:3',previd:this.streamManagement.prevId,h:this.streamManagement.getIncomingCounter()||0}))):le(),!1},_sasl_bind_cb:function(oe){if('error'==oe.getAttribute('type')){se.info('SASL binding failed.');var ae=oe.getElementsByTagName('conflict'),ie;return 0<ae.length&&(ie='conflict',this._doDisconnect(ie)),this._changeConnectStatus(se.Status.AUTHFAIL,ie),!1}var de=oe.getElementsByTagName('bind'),le;return 0<de.length?void(le=de[0].getElementsByTagName('jid'),0<le.length&&(this.jid=se.getText(le[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,'_session_auth_2'),this.send(te({type:'set',id:'_session_auth_2'}).c('session',{xmlns:se.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(se.Status.CONNECTED,null)))):(se.info('SASL binding failed.'),this._changeConnectStatus(se.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(oe){if('result'==oe.getAttribute('type'))this.authenticated=!0,this._changeConnectStatus(se.Status.CONNECTED,null);else if('error'==oe.getAttribute('type'))return se.info('Session creation failed.'),this._changeConnectStatus(se.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(oe){this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure();const ae=oe.getElementsByTagName('text')[0];let ie=null;return void 0!==ae&&(ie=ae.innerHTML||null),this._changeConnectStatus(se.Status.AUTHFAIL,ie),this.disconnect(ie),!1},_auth2_cb:function(oe){return'result'==oe.getAttribute('type')?(this.authenticated=!0,this._changeConnectStatus(se.Status.CONNECTED,null)):'error'==oe.getAttribute('type')&&(this._changeConnectStatus(se.Status.AUTHFAIL,null),this.disconnect('authentication failed')),!1},_addSysTimedHandler:function(oe,ae){var ie=new se.TimedHandler(oe,ae);return ie.user=!1,this.addTimeds.push(ie),ie},_addSysHandler:function(oe,ae,ie,de,le){var ce=new se.Handler(oe,ae,ie,de,le);return ce.user=!1,this.addHandlers.push(ce),ce},_onDisconnectTimeout:function(){return se.info('_onDisconnectTimeout was called'),this._changeConnectStatus(se.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var oe,ae,ie,de;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;)ae=this.removeTimeds.pop(),oe=this.timedHandlers.indexOf(ae),0<=oe&&this.timedHandlers.splice(oe,1);var le=new Date().getTime();for(de=[],oe=0;oe<this.timedHandlers.length;oe++)ae=this.timedHandlers[oe],(this.authenticated||!ae.user)&&(ie=ae.lastCalled+ae.period,0>=ie-le?ae.run()&&de.push(ae):de.push(ae));this.timedHandlers=de,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},se.SASLMechanism=function(oe,ae,ie){this.name=oe,this.isClientFirst=ae,this.priority=ie},se.SASLMechanism.prototype={test:function(){return!0},onStart:function(oe){this._connection=oe},onChallenge:function(){throw new Error('You should implement challenge handling!')},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},se.SASLAnonymous=function(){},se.SASLAnonymous.prototype=new se.SASLMechanism('ANONYMOUS',!1,20),se.SASLAnonymous.prototype.test=function(oe){return null===oe.authcid},se.SASLPlain=function(){},se.SASLPlain.prototype=new se.SASLMechanism('PLAIN',!0,30),se.SASLPlain.prototype.test=function(oe){return null!==oe.authcid},se.SASLPlain.prototype.onChallenge=function(oe){var ae=oe.authzid;return ae+='\0',ae+=oe.authcid,ae+='\0',ae+=oe.pass,Q.utf16to8(ae)},se.SASLSHA1=function(){},se.SASLSHA1.prototype=new se.SASLMechanism('SCRAM-SHA-1',!0,50),se.SASLSHA1.prototype.test=function(oe){return null!==oe.authcid},se.SASLSHA1.prototype.onChallenge=function(oe,ae,ie){var de=ie||K.hexdigest(1234567890*Math.random()),le='n='+Q.utf16to8(oe.authcid);return le+=',r=',le+=de,oe._sasl_data.cnonce=de,oe._sasl_data['client-first-message-bare']=le,le='n,,'+le,this.onChallenge=function(ce,ue){for(var Ee='c=biws,',Ie=ce._sasl_data['client-first-message-bare']+','+ue+',',Re=ce._sasl_data.cnonce,Ae=/([a-z]+)=([^,]+)(,|$)/,pe,me,ge,_e,fe,he,ye,Ce,Te,ve,Se,be,Me;ue.match(Ae);)switch(Me=ue.match(Ae),ue=ue.replace(Me[0],''),Me[1]){case'r':pe=Me[2];break;case's':me=Me[2];break;case'i':ge=Me[2];}if(pe.substr(0,Re.length)!==Re)return ce._sasl_data={},ce._sasl_failure_cb();for(Ee+='r='+pe,Ie+=Ee,me=X.decode(me),me+='\0\0\0\x01',Te=Q.utf16to8(ce.pass),_e=he=W.core_hmac_sha1(Te,me),ye=1;ye<ge;ye++){for(fe=W.core_hmac_sha1(Te,W.binb2str(he)),Ce=0;5>Ce;Ce++)_e[Ce]^=fe[Ce];he=fe}for(_e=W.binb2str(_e),ve=W.core_hmac_sha1(_e,'Client Key'),Se=W.str_hmac_sha1(_e,'Server Key'),be=W.core_hmac_sha1(W.str_sha1(W.binb2str(ve)),Ie),ce._sasl_data['server-signature']=W.b64_hmac_sha1(Se,Ie),Ce=0;5>Ce;Ce++)ve[Ce]^=be[Ce];return Ee+=',p='+X.encode(W.binb2str(ve)),Ee}.bind(this),le},se.SASLMD5=function(){},se.SASLMD5.prototype=new se.SASLMechanism('DIGEST-MD5',!1,40),se.SASLMD5.prototype.test=function(oe){return null!==oe.authcid},se.SASLMD5.prototype._quote=function(oe){return'"'+oe.replace(/\\/g,'\\\\').replace(/"/g,'\\"')+'"'},se.SASLMD5.prototype.onChallenge=function(oe,ae,ie){for(var de=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,le=ie||K.hexdigest(''+1234567890*Math.random()),ce='',ue=null,pe='',ge;ae.match(de);)switch(ge=ae.match(de),ae=ae.replace(ge[0],''),ge[2]=ge[2].replace(/^"(.+)"$/,'$1'),ge[1]){case'realm':ce=ge[2];break;case'nonce':pe=ge[2];break;case'qop':ge[2];break;case'host':ue=ge[2];}var _e=oe.servtype+'/'+oe.domain;null!==ue&&(_e=_e+'/'+ue);var fe=Q.utf16to8(oe.authcid+':'+ce+':'+this._connection.pass),he=K.hash(fe)+':'+pe+':'+le,ye='AUTHENTICATE:'+_e,Ce='';return Ce+='charset=utf-8,',Ce+='username='+this._quote(Q.utf16to8(oe.authcid))+',',Ce+='realm='+this._quote(ce)+',',Ce+='nonce='+this._quote(pe)+',',Ce+='nc=00000001,',Ce+='cnonce='+this._quote(le)+',',Ce+='digest-uri='+this._quote(_e)+',',Ce+='response='+K.hexdigest(K.hexdigest(he)+':'+pe+':00000001:'+le+':auth:'+K.hexdigest(ye))+',',Ce+='qop=auth',this.onChallenge=function(){return''},Ce},se.SASLOAuthBearer=function(){},se.SASLOAuthBearer.prototype=new se.SASLMechanism('OAUTHBEARER',!0,60),se.SASLOAuthBearer.prototype.test=function(oe){return null!==oe.authcid},se.SASLOAuthBearer.prototype.onChallenge=function(oe){var ae='n,a=';return ae+=oe.authzid,ae+=',',ae+='\x01',ae+='auth=Bearer ',ae+=oe.pass,ae+='\x01',ae+='\x01',Q.utf16to8(ae)},se.SASLExternal=function(){},se.SASLExternal.prototype=new se.SASLMechanism('EXTERNAL',!0,10),se.SASLExternal.prototype.onChallenge=function(oe){return oe.authcid===oe.authzid?'':oe.authzid},{Strophe:se,$build:Z,$msg:function(oe){return new se.Builder('message',oe)},$iq:te,$pres:ne,SHA1:W,Base64:X,MD5:K}}),function(W,X){H=[$],!(Y=function(K){return X(K.Strophe,K.$build)}.apply(f,H))}(this,function(W,X){return W.Request=function(K,Q,Z,ee){this.id=++W._requestId,this.xmlData=K,this.data=W.serialize(K),this.origFunc=Q,this.func=Q,this.rid=Z,this.date=NaN,this.sends=ee||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var te=new Date;return(te-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var te=new Date;return(te-this.dead)/1e3},this.xhr=this._newXHR()},W.Request.prototype={getResponse:function(){var K=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(K=this.xhr.responseXML.documentElement,'parsererror'==K.tagName)throw W.error('invalid response received'),W.error('responseText: '+this.xhr.responseText),W.error('responseXML: '+W.serialize(this.xhr.responseXML)),'parsererror';}else if(this.xhr.responseText)throw W.error('invalid response received'),W.error('responseText: '+this.xhr.responseText),'badformat';return K},_newXHR:function(){var K=null;return window.XMLHttpRequest?(K=new XMLHttpRequest,K.overrideMimeType&&K.overrideMimeType('text/xml; charset=utf-8')):window.ActiveXObject&&(K=new ActiveXObject('Microsoft.XMLHTTP')),K.onreadystatechange=this.func.bind(null,this),K}},W.Bosh=function(K){this._conn=K,this.rid=_Mathfloor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this._requests=[]},W.Bosh.prototype={strip:null,_buildBody:function(){var K=X('body',{rid:this.rid++,xmlns:W.NS.HTTPBIND});return null!==this.sid&&K.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),K},_reset:function(){this.rid=_Mathfloor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem('strophe-bosh-session'),this._conn.nextValidRid(this.rid)},_connect:function(K,Q,Z){this.wait=K||this.wait,this.hold=Q||this.hold,this.errors=0;var ee=this._buildBody().attrs({to:this._conn.domain,"xml:lang":'en',wait:this.wait,hold:this.hold,content:'text/xml; charset=utf-8',ver:'1.6',"xmpp:version":'1.0',"xmlns:xmpp":W.NS.BOSH});Z&&ee.attrs({route:Z});var te=this._conn._connect_cb;this._requests.push(new W.Request(ee.tree(),this._onRequestStateChange.bind(this,te.bind(this._conn)),ee.tree().getAttribute('rid'))),this._throttledRequestHandler()},_attach:function(K,Q,Z,ee,te,ne,se){this._conn.jid=K,this.sid=Q,this.rid=Z,this._conn.connect_callback=ee,this._conn.domain=W.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=te||this.wait,this.hold=ne||this.hold,this.window=se||this.window,this._conn._changeConnectStatus(W.Status.ATTACHED,null)},_restore:function(K,Q,Z,ee,te){var ne=JSON.parse(window.sessionStorage.getItem('strophe-bosh-session'));if('undefined'!=typeof ne&&null!==ne&&ne.rid&&ne.sid&&ne.jid&&('undefined'==typeof K||null===K||W.getBareJidFromJid(ne.jid)==W.getBareJidFromJid(K)||null===W.getNodeFromJid(K)&&W.getDomainFromJid(ne.jid)==K))this._conn.restored=!0,this._attach(ne.jid,ne.sid,ne.rid,Q,Z,ee,te);else throw{name:'StropheSessionError',message:'_restore: no restoreable session.'}},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem('strophe-bosh-session',JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem('strophe-bosh-session')},_connect_cb:function(K){var Q=K.getAttribute('type'),Z,ee;if(null!==Q&&'terminate'==Q)return Z=K.getAttribute('condition'),W.error('BOSH-Connection failed: '+Z),ee=K.getElementsByTagName('conflict'),null===Z?this._conn._changeConnectStatus(W.Status.CONNFAIL,'unknown'):('remote-stream-error'==Z&&0<ee.length&&(Z='conflict'),this._conn._changeConnectStatus(W.Status.CONNFAIL,Z)),this._conn._doDisconnect(Z),W.Status.CONNFAIL;this.sid||(this.sid=K.getAttribute('sid'));var te=K.getAttribute('requests');te&&(this.window=parseInt(te,10));var ne=K.getAttribute('hold');ne&&(this.hold=parseInt(ne,10));var se=K.getAttribute('wait');se&&(this.wait=parseInt(se,10));var oe=K.getAttribute('inactivity');oe&&(this.inactivity=parseInt(oe,10))},_disconnect:function(K){this._sendTerminate(K)},_doDisconnect:function(){this.sid=null,this.rid=_Mathfloor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem('strophe-bosh-session'),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(K){var Q=this._getRequestStatus(K),Z;Z=this._conn.protocolErrorHandlers.HTTP[Q],Z&&Z.call(this,Q)},_hitError:function(K){this.errors++,W.warn('request errored, status: '+K+', number of errors: '+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(K){K=K?K.bind(this._conn):this._conn._connect_cb.bind(this._conn);var Q=this._buildBody();this._requests.push(new W.Request(Q.tree(),this._onRequestStateChange.bind(this,K.bind(this._conn)),Q.tree().getAttribute('rid'))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var Q;0<this._requests.length;)Q=this._requests.pop(),Q.abort=!0,Q.xhr.abort(),Q.xhr.onreadystatechange=function(){}},_onIdle:function(){var K=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===K.length&&!this._conn.disconnecting&&(W.info('no requests during idle cycle, sending blank request'),K.push(null)),!this._conn.paused){if(2>this._requests.length&&0<K.length){for(var Q=this._buildBody(),Z=0;Z<K.length;Z++)null!==K[Z]&&('restart'===K[Z]?Q.attrs({to:this._conn.domain,"xml:lang":'en',"xmpp:restart":'true',"xmlns:xmpp":W.NS.BOSH}):Q.cnode(K[Z]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new W.Request(Q.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Q.tree().getAttribute('rid'))),this._throttledRequestHandler()}if(0<this._requests.length){var ee=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>_Mathfloor(W.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),ee>_Mathfloor(W.TIMEOUT*this.wait)&&(W.warn('Request '+this._requests[0].id+' timed out, over '+_Mathfloor(W.TIMEOUT*this.wait)+' seconds since last activity'),this._throttledRequestHandler())}}},_getRequestStatus:function(K,Q){var Z;if(4==K.xhr.readyState)try{Z=K.xhr.status}catch(ee){W.error('Caught an error while retrieving a request\\\'s status, reqStatus: '+Z)}return'undefined'==typeof Z&&(Z='number'==typeof Q?Q:0),Z},_onRequestStateChange:function(K,Q){if(W.debug('request id '+Q.id+'.'+Q.sends+' state changed to '+Q.xhr.readyState),Q.abort)return void(Q.abort=!1);if(4===Q.xhr.readyState){var Z=this._getRequestStatus(Q);if(this.disconnecting&&400<=Z)return this._hitError(Z),void this._callProtocolErrorHandlers(Q);if((0<Z&&500>Z||5<Q.sends)&&(this._removeRequest(Q),W.debug('request id '+Q.id+' should now be removed')),200==Z){var ee=this._requests[0]==Q,te=this._requests[1]==Q;(te||ee&&0<this._requests.length&&this._requests[0].age()>_Mathfloor(W.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(+Q.rid+1),W.debug('request id '+Q.id+'.'+Q.sends+' got 200'),K(Q),this.errors=0}else 0===Z||400<=Z&&600>Z||12000<=Z?(W.error('request id '+Q.id+'.'+Q.sends+' error '+Z+' happened'),this._hitError(Z),this._callProtocolErrorHandlers(Q),400<=Z&&500>Z&&(this._conn._changeConnectStatus(W.Status.DISCONNECTING,null),this._conn._doDisconnect())):W.error('request id '+Q.id+'.'+Q.sends+' error '+Z+' happened');(!(0<Z&&500>Z)||5<Q.sends)&&this._throttledRequestHandler()}},_processRequest:function(K){var Q=this,Z=this._requests[K],ee=this._getRequestStatus(Z,-1);if(Z.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var te=Z.age(),ne=!isNaN(te)&&te>_Mathfloor(W.TIMEOUT*this.wait),se=null!==Z.dead&&Z.timeDead()>_Mathfloor(W.SECONDARY_TIMEOUT*this.wait),oe=4==Z.xhr.readyState&&(1>ee||500<=ee);if((ne||se||oe)&&(se&&W.error('Request '+this._requests[K].id+' timed out (secondary), restarting'),Z.abort=!0,Z.xhr.abort(),Z.xhr.onreadystatechange=function(){},this._requests[K]=new W.Request(Z.xmlData,Z.origFunc,Z.rid,Z.sends),Z=this._requests[K]),0===Z.xhr.readyState){W.debug('request id '+Z.id+'.'+Z.sends+' posting');try{var ae=this._conn.options.contentType||'text/xml; charset=utf-8';Z.xhr.open('POST',this._conn.service,!this._conn.options.sync),'undefined'!=typeof Z.xhr.setRequestHeader&&Z.xhr.setRequestHeader('Content-Type',ae),this._conn.options.withCredentials&&(Z.xhr.withCredentials=!0)}catch(le){return W.error('XHR open failed.'),this._conn.connected||this._conn._changeConnectStatus(W.Status.CONNFAIL,'bad-service'),void this._conn.disconnect()}var ie=function(){if(Z.date=new Date,Q._conn.options.customHeaders){var le=Q._conn.options.customHeaders;for(var ce in le)le.hasOwnProperty(ce)&&Z.xhr.setRequestHeader(ce,le[ce])}Z.xhr.send(Z.data)};if(1<Z.sends){var de=1e3*_Mathmin(_Mathfloor(W.TIMEOUT*this.wait),_Mathpow(Z.sends,3));setTimeout(function(){ie()},de)}else ie();Z.sends++,this._conn.xmlOutput!==W.Connection.prototype.xmlOutput&&(Z.xmlData.nodeName===this.strip&&Z.xmlData.childNodes.length?this._conn.xmlOutput(Z.xmlData.childNodes[0]):this._conn.xmlOutput(Z.xmlData)),this._conn.rawOutput!==W.Connection.prototype.rawOutput&&this._conn.rawOutput(Z.data)}else W.debug('_processRequest: '+(0===K?'first':'second')+' request has readyState of '+Z.xhr.readyState)},_removeRequest:function(K){W.debug('removing request');var Q;for(Q=this._requests.length-1;0<=Q;Q--)K==this._requests[Q]&&this._requests.splice(Q,1);K.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(K){var Q=this._requests[K];null===Q.dead&&(Q.dead=new Date),this._processRequest(K)},_reqToData:function(K){try{return K.getResponse()}catch(Q){if('parsererror'!=Q)throw Q;this._conn.disconnect('strophe-parsererror')}},_sendTerminate:function(K){W.info('_sendTerminate was called');var Q=this._buildBody().attrs({type:'terminate'});K&&Q.cnode(K.tree());var Z=new W.Request(Q.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Q.tree().getAttribute('rid'));this._requests.push(Z),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?W.debug('_throttledRequestHandler called with '+this._requests.length+' requests'):W.debug('_throttledRequestHandler called with undefined requests'),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&_Mathabs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},W}),function(W,X){H=[$],!(G=function(K){return X(K.Strophe,K.$build)}.apply(f,H))}(this,function(W,X){return W.Websocket=function(K){this._conn=K,this.strip='wrapper';var Q=K.service;if(0!==Q.indexOf('ws:')&&0!==Q.indexOf('wss:')){var Z='';Z+='ws'===K.options.protocol&&'https:'!==window.location.protocol?'ws':'wss',Z+='://'+window.location.host,Z+=0===Q.indexOf('/')?Q:window.location.pathname+Q,K.service=Z}},W.Websocket.prototype={_buildStream:function(){return X('open',{xmlns:W.NS.FRAMING,to:this._conn.domain,version:'1.0'})},_check_streamerror:function(K,Q){var Z;if(Z=K.getElementsByTagNameNS?K.getElementsByTagNameNS(W.NS.STREAM,'error'):K.getElementsByTagName('stream:error'),0===Z.length)return!1;for(var ee=Z[0],te='',se=0,oe;se<ee.childNodes.length&&(oe=ee.childNodes[se],oe.getAttribute('xmlns')==='urn:ietf:params:xml:ns:xmpp-streams');se++)te='text'===oe.nodeName?oe.textContent:oe.nodeName;var ae='WebSocket stream error: ';return ae+=te?te:'unknown',W.error(ae),this._conn._changeConnectStatus(Q,te),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,'xmpp'),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(K){var Q=this._check_streamerror(K,W.Status.CONNFAIL);if(Q)return W.Status.CONNFAIL},_handleStreamStart:function(K){var Q=!1,Z=K.getAttribute('xmlns');'string'==typeof Z?Z!==W.NS.FRAMING&&(Q='Wrong xmlns in <open />: '+Z):Q='Missing xmlns in <open />';var ee=K.getAttribute('version');return'string'==typeof ee?'1.0'!==ee&&(Q='Wrong version in <open />: '+ee):Q='Missing version in <open />',!Q||(this._conn._changeConnectStatus(W.Status.CONNFAIL,Q),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(K){if(0===K.data.indexOf('<open ')||0===K.data.indexOf('<?xml')){var Q=K.data.replace(/^(<\?.*?\?>\s*)*/,'');if(''===Q)return;var Z=new DOMParser().parseFromString(Q,'text/xml').documentElement;this._conn.xmlInput(Z),this._conn.rawInput(K.data),this._handleStreamStart(Z)&&this._connect_cb(Z)}else if(0===K.data.indexOf('<close ')){this._conn.rawInput(K.data),this._conn.xmlInput(K);var ee=K.getAttribute('see-other-uri');ee?(this._conn._changeConnectStatus(W.Status.REDIRECT,'Received see-other-uri, resetting connection'),this._conn.reset(),this._conn.service=ee,this._connect()):(this._conn._changeConnectStatus(W.Status.CONNFAIL,'Received closing stream'),this._conn._doDisconnect())}else{var te=this._streamWrap(K.data),ne=new DOMParser().parseFromString(te,'text/xml').documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(ne,null,K.data)}},_disconnect:function(K,Q){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED&&(K&&this._conn.send(K),!0!==Q)){var Z=X('close',{xmlns:W.NS.FRAMING});this._conn.xmlOutput(Z);var ee=W.serialize(Z);this._conn.rawOutput(ee);try{this.socket.send(ee)}catch(te){W.info('Couldn\'t send <close /> tag.')}}this._conn._doDisconnect()},_doDisconnect:function(){W.info('WebSockets _doDisconnect was called'),this._closeSocket()},_streamWrap:function(K){return'<wrapper>'+K+'</wrapper>'},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(K){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(K){this._conn.connected&&!this._conn.disconnecting?(W.error('Websocket closed unexpectedly'),this._conn._doDisconnect()):K&&1006===K.code&&!this._conn.connected&&this.socket?(W.error('Websocket closed unexcectedly'),this._conn._changeConnectStatus(W.Status.CONNFAIL,'The WebSocket connection could not be established or was disconnected.'),this._conn._doDisconnect()):W.info('Websocket closed')},_no_auth_received:function(K){W.error('Server did not send any auth methods'),this._conn._changeConnectStatus(W.Status.CONNFAIL,'Server did not send any auth methods'),K&&(K=K.bind(this._conn),K()),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(K){W.error('Websocket error '+K),this._conn._changeConnectStatus(W.Status.CONNFAIL,'The WebSocket connection could not be established or was disconnected.'),this._disconnect()},_onIdle:function(){var K=this._conn._data;if(0<K.length&&!this._conn.paused){for(var Q=0;Q<K.length;Q++)if(null!==K[Q]){var Z,ee;Z='restart'===K[Q]?this._buildStream().tree():K[Q],ee=W.serialize(Z),this._conn.xmlOutput(Z),this._conn.rawOutput(ee),this.socket.send(ee)}this._conn._data=[]}},_onMessage:function(K){var ee='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />',Q,Z;if(K.data===ee)return this._conn.rawInput(ee),this._conn.xmlInput(K),void(this._conn.disconnecting||this._conn._doDisconnect());if(0!==K.data.search('<open '))Z=this._streamWrap(K.data),Q=new DOMParser().parseFromString(Z,'text/xml').documentElement;else if(Q=new DOMParser().parseFromString(K.data,'text/xml').documentElement,!this._handleStreamStart(Q))return;return this._check_streamerror(Q,W.Status.ERROR)?void 0:this._conn.disconnecting&&'presence'===Q.firstChild.nodeName&&'unavailable'===Q.firstChild.getAttribute('type')?(this._conn.xmlInput(Q),void this._conn.rawInput(W.serialize(Q))):void this._conn._dataRecv(Q,K.data)},_onOpen:function(){W.info('Websocket open');var K=this._buildStream();this._conn.xmlOutput(K.tree());var Q=W.serialize(K);this._conn.rawOutput(Q),this.socket.send(Q)},_reqToData:function(K){return K},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},W}),function(){H=[$,Y,G],J=function(X){return X}.apply(f,H),!(J!==void 0&&(u.exports=J))}(this)},function(u,f){'use strict';f.a=function(I){const R=I.Strophe;return R.isTagEqual=function(A,M){return(A.tagName||A.node.tagName)===M},R.addConnectionPlugin('streamManagement',{logging:!0,returnWholeStanza:!1,autoSendCountOnEveryIncomingStanza:!1,requestResponseInterval:0,allowResume:!0,_c:null,_NS:'urn:xmpp:sm:3',_isStreamManagementEnabled:!1,_serverProcesssedStanzasCounter:null,_clientProcessedStanzasCounter:null,_clientSentStanzasCounter:null,_originalXMLOutput:null,_requestHandler:null,_incomingHandler:null,_requestResponseIntervalCount:0,_unacknowledgedStanzas:[],_acknowledgedStanzaListeners:[],_counters:{incoming:0,outgoing:0,server:0},addAcknowledgedStanzaListener:function(A){this._acknowledgedStanzaListeners.push(A)},enable:function(A){const M={xmlns:this._NS,resume:this.allowResume};if(A)try{M.max=''+A/1e3}catch(N){console.error(`Couldn't convert '${A}' to milliseconds:`,N)}this._c.send(I.$build('enable',M)),this._c.flush(),this._c.pause()},requestAcknowledgement:function(){this._requestResponseIntervalCount=0,this._c.send(I.$build('r',{xmlns:this._NS}))},getOutgoingCounter:function(){return this._counters.outgoing},getServerProcessedCounter:function(){return this._counters.server},getIncomingCounter:function(){return this._counters.incoming},init:function(A){this._c=A,R.addNamespace('SM',this._NS);const M=localStorage.getItem(this._c.options.instance_id+'_counters');if(null!==M){let N=null;try{N=JSON.parse(M)}catch(D){}null!==N&&(this._counters=N)}this._originalXMLOutput=this._c.xmlOutput,this._c.xmlOutput=this.xmlOutput.bind(this)},statusChanged:function(A,M){(A===R.Status.CONNECTED||A===R.Status.DISCONNECTED)&&(this._requestResponseIntervalCount=0,this._isStreamManagementEnabled=!1,A===R.Status.CONNECTED&&'resumed'!==M&&this._resetCounters(),A===R.Status.CONNECTED&&'resumed'===M&&(this._isStreamManagementEnabled=!0),this._unacknowledgedStanzas=[],this._requestHandler&&this._c.deleteHandler(this._requestHandler),this._incomingHandler&&this._c.deleteHandler(this._incomingHandler),this._requestHandler=this._c.addHandler(this._handleServerRequestHandler.bind(this),this._NS,'r'),this._incomingHandler=this._c.addHandler(this._incomingStanzaHandler.bind(this),null,null))},xmlOutput:function(A){function M(B){return R.isTagEqual(B,'iq')||R.isTagEqual(B,'presence')||R.isTagEqual(B,'message')}if(M(A))this._increaseSentStanzasCounter(A);else if(void 0!==A.children)for(var D=0,N;D<A.children.length;D++)N=A.children[D],M()&&this._increaseSentStanzasCounter(N);return this._originalXMLOutput.call(this._c,A)},_incomingStanzaHandler:function(A){if(R.isTagEqual(A,'enabled')&&A.getAttribute('xmlns')===this._NS&&(this._isStreamManagementEnabled=!0,this._c.resume()),(R.isTagEqual(A,'iq')||R.isTagEqual(A,'presence')||R.isTagEqual(A,'message'))&&(this._increaseReceivedStanzasCounter(),this.autoSendCountOnEveryIncomingStanza&&this._answerProcessedStanzas(),R.isTagEqual(A,'message')&&'error'===A.getAttribute('type')&&--this._counters.outgoing),R.isTagEqual(A,'a')){var M=parseInt(A.getAttribute('h'));this._handleAcknowledgedStanzas(M,this._counters.server),this._counters.server=M,this._persistCounters(),0<this.requestResponseInterval&&(this._requestResponseIntervalCount=0)}return!0},_handleAcknowledgedStanzas:function(A,M){var N=A-M;0>N&&this._throwError('New reported stanza count lower than previous. New: '+A+' - Previous: '+M),N>this._unacknowledgedStanzas.length&&this._throwError('Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledge Count: '+N+' - Unacknowledge Stanza Count: '+this._unacknowledgedStanzas.length+' - New: '+A+' - Previous: '+M);for(var D=0,B;D<N;D++){B=this._unacknowledgedStanzas.shift();for(var H=0;H<this._acknowledgedStanzaListeners.length;H++)this._acknowledgedStanzaListeners[H](B)}this.logging&&0<this._unacknowledgedStanzas.length&&console.warn('Unacknowledged stanzas',this._unacknowledgedStanzas)},_handleServerRequestHandler:function(){return this._answerProcessedStanzas(),!0},_answerProcessedStanzas:function(A){(this._isStreamManagementEnabled||!0===A)&&this._c.send(I.$build('a',{xmlns:this._NS,h:this._counters.incoming}))},_increaseSentStanzasCounter:function(A){this._isStreamManagementEnabled&&(this._unacknowledgedStanzas.push(this.returnWholeStanza?A:A.getAttribute('id')),this._counters.outgoing++,this._persistCounters(),0<this.requestResponseInterval&&(this._requestResponseIntervalCount++,this._requestResponseIntervalCount===this.requestResponseInterval&&this.requestAcknowledgement()))},_increaseReceivedStanzasCounter:function(){this._isStreamManagementEnabled&&(this._counters.incoming++,this._persistCounters())},_persistCounters:function(){localStorage.setItem(this._c.options.instance_id+'_counters',JSON.stringify(this._counters))},_resetCounters:function(){this._counters={incoming:0,outgoing:0,server:0},this._persistCounters()},_throwError:function(A){console.error(A)}}),I}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(50),I=h(28);f.UsersDirectory=class{constructor(A,M=!1){this._instanceId=null,this._worker=null,this._debug=!1,this.initialised=!1,this._workerResponseListeners={},this._instanceId=A,this._debug=M}_addWorkerResponseListener(A,M){this._workerResponseListeners[A]=M}_onWorkerResponse(A){A.data&&this._debug&&console.log(`Worker: ${A.data.msg}`);const M=this._workerResponseListeners[A.data._id];if(M){const N=M(A.data);!0!==N&&delete this._workerResponseListeners[A.data._id]}}_postMessageToWorker(A,M){if(null===this._worker)throw new Error('Worker has not been initialised!');const N=I.generateGuid();this._workerResponseListeners[N]=M,this._worker.postMessage(Object.assign({},A,{_id:N}))}initialise(A,M){return new Promise((N,D)=>{this._worker=new Worker(window.URL.createObjectURL(new Blob([`const start = ${E.default.toString()}; start.call(self);`],{type:'text/javascript'}))),this._worker.onmessage=this._onWorkerResponse.bind(this),this._postMessageToWorker({action:'initialise',instanceId:this._instanceId,key:A,iv:M,debug:this._debug},(B)=>{return!0===B.success?(this.initialised=!0,N(B.msg)):(console.error(B.msg),this.initialised=!1,this.destroy(!0).then(()=>{D(B.msg)})),!1})})}update(A,M,N){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((D,B)=>{this._postMessageToWorker({action:'fetch',endpoint:N,jid:A,pass:M},(H)=>{return!0===H.success?D(H):(console.error(H.msg),B(H.msg)),!1})})}search(A,M){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((N,D)=>{this._postMessageToWorker({action:'search',query:A,fields:M||[]},(B)=>{return!0===B.success?N(B.results):(console.error(B.msg),D(B.msg)),!1})})}getUserByJid(A){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((M,N)=>{this._postMessageToWorker({action:'jid-search',jid:A},(D)=>{return!0===D.success?M(D.result):(console.error(D.msg),N(D.msg)),!1})})}getAllUsers(){if(!0!==this.initialised)throw new Error('User index must be initialised first.');return new Promise((A,M)=>{this._postMessageToWorker({action:'get-all-users'},(N)=>{return!0===N.success?A(N.results):(console.error(N.msg),M(N.msg)),!1})})}destroy(A=!1){if(!0!==this.initialised&&!1===A)throw new Error('User index must be initialised first.');return new Promise((M,N)=>{this._postMessageToWorker({action:'destroy'},(D)=>{return!0===D.success?(this.initialised=!1,M(D.msg)):(console.error(D.msg),N(D.msg)),!1})})}static _resolvePath(A){return A?0===A.indexOf('http')||0===A.indexOf('//')?A:0===A.indexOf('/')?window.location.origin+A:`${window.location.origin}/${A}`:null}}},function(u,f,h){'use strict';function E(oe){return-1!==oe.indexOf('.')&&(oe=oe.split('.').pop().toLowerCase()),se.hasOwnProperty(oe)?se[oe].mimeType:null}function I(oe){return-1!==oe.indexOf('.')&&(oe=oe.split('.').pop().toLowerCase()),se.hasOwnProperty(oe)?se[oe].mediaType:null}function R(oe){const ae=Object.keys(se).filter((ie)=>se[ie].mimeType===oe)[0];return ae?se[ae].mediaType:null}function A(oe){return oe.replace(/\\/g,'/').split('/').pop()}function M(){return new W.Promise((oe,ae)=>{if(X.isElectron())try{const ie=Q.require('electron').remote.app,de=Q.require('path'),le=de.sep,ce=ie.getPath('userData'),ue=ce+le+te+le,pe=Q.require('fs');pe.existsSync(ue)||pe.mkdirSync(ue),oe(ue)}catch(ie){ae(ie)}else{const ie=X.getPlatformName(),de=K.getSource('file');if(!1!==de){let le='';if('ios'===ie)le+=de.documentsDirectory;else if('android'===ie)le+=de.dataDirectory;else return ae('Unsupported platform, expected Android or iOS.');Z.resolveLocalFileSystemURL(le,function(ce){ce.getDirectory(te,{create:!0,exclusive:!1},function(ue){oe(ue.nativeURL)},ae)},ae)}else ae('No file plugin available.')}})}function z(oe){return new W.Promise((ae)=>{const de=new XMLHttpRequest;de.open('GET',oe,!0),de.responseType='blob',de.onload=()=>{200===de.status&&ae(de.response)},de.send()})}Object.defineProperty(f,'__esModule',{value:!0});const W=h(38),X=h(27),K=h(22),Q=window,Z=window;let ee=null;const te='attachments',ne={IMAGE:'image',AUDIO:'audio',VIDEO:'video'},se={a:{mimeType:'application/octet-stream',mediaType:null},ai:{mimeType:'application/postscript',mediaType:null},aif:{mimeType:'audio/x-aiff',mediaType:ne.AUDIO},aifc:{mimeType:'audio/x-aiff',mediaType:ne.AUDIO},aiff:{mimeType:'audio/x-aiff',mediaType:ne.AUDIO},au:{mimeType:'audio/basic',mediaType:ne.AUDIO},avi:{mimeType:'video/x-msvideo',mediaType:null},bat:{mimeType:'text/plain',mediaType:null},bin:{mimeType:'application/octet-stream',mediaType:null},bmp:{mimeType:'image/x-ms-bmp',mediaType:ne.IMAGE},c:{mimeType:'text/plain',mediaType:null},cdf:{mimeType:'application/x-cdf',mediaType:null},csh:{mimeType:'application/x-csh',mediaType:null},css:{mimeType:'text/css',mediaType:null},dll:{mimeType:'application/octet-stream',mediaType:null},doc:{mimeType:'application/msword',mediaType:null},docm:{mimeType:'application/vnd.ms-word.document.macroEnabled.12',mediaType:null},docx:{mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.document',mediaType:null},dot:{mimeType:'application/msword',mediaType:null},dotx:{mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.template',mediaType:null},dvi:{mimeType:'application/x-dvi',mediaType:null},eml:{mimeType:'message/rfc822',mediaType:null},eps:{mimeType:'application/postscript',mediaType:null},etx:{mimeType:'text/x-setext',mediaType:null},exe:{mimeType:'application/octet-stream',mediaType:null},gif:{mimeType:'image/gif',mediaType:ne.IMAGE},gtar:{mimeType:'application/x-gtar',mediaType:null},h:{mimeType:'text/plain',mediaType:null},hdf:{mimeType:'application/x-hdf',mediaType:null},htm:{mimeType:'text/html',mediaType:null},html:{mimeType:'text/html',mediaType:null},jpe:{mimeType:'image/jpe',mediaType:ne.IMAGE},jpeg:{mimeType:'image/jpeg',mediaType:ne.IMAGE},jpg:{mimeType:'image/jpeg',mediaType:ne.IMAGE,preferred:!0},js:{mimeType:'application/javascript',mediaType:null},json:{mimeType:'application/json',mediaType:null},ksh:{mimeType:'text/plain',mediaType:null},latex:{mimeType:'application/x-latex',mediaType:null},m1v:{mimeType:'video/mpeg',mediaType:ne.VIDEO},m4a:{mimeType:'audio/mpeg',mediaType:ne.AUDIO,preferred:!0},man:{mimeType:'application/x-troff-man',mediaType:null},me:{mimeType:'application/x-troff-me',mediaType:null},mht:{mimeType:'message/rfc822',mediaType:null},mhtml:{mimeType:'message/rfc822',mediaType:null},mif:{mimeType:'application/x-mif',mediaType:null},mov:{mimeType:'video/quicktime',mediaType:ne.VIDEO},movie:{mimeType:'video/x-sgi-movie',mediaType:ne.VIDEO},mp2:{mimeType:'audio/mpeg',mediaType:ne.AUDIO},mp3:{mimeType:'audio/mp3',mediaType:ne.AUDIO},mp4:{mimeType:'video/mp4',mediaType:ne.VIDEO},mpa:{mimeType:'video/mpeg',mediaType:ne.VIDEO},mpe:{mimeType:'video/mpeg',mediaType:ne.VIDEO},mpeg:{mimeType:'video/mpeg',mediaType:ne.VIDEO},mpg:{mimeType:'video/mpeg',mediaType:ne.VIDEO,preferred:!0},ms:{mimeType:'application/x-troff-ms',mediaType:null},nc:{mimeType:'application/x-netcdf',mediaType:null},nws:{mimeType:'message/rfc822',mediaType:null},o:{mimeType:'application/octet-stream',mediaType:null},obj:{mimeType:'application/octet-stream',mediaType:null},oda:{mimeType:'application/oda',mediaType:null},otf:{mimeType:'application/x-font-opentype',mediaType:null},pbm:{mimeType:'image/x-portable-bitmap',mediaType:ne.IMAGE},pdf:{mimeType:'application/pdf',mediaType:null},pfx:{mimeType:'application/x-pkcs12',mediaType:null},pgm:{mimeType:'image/x-portable-graymap',mediaType:ne.IMAGE},png:{mimeType:'image/png',mediaType:ne.IMAGE},pnm:{mimeType:'image/x-portable-anymap',mediaType:ne.IMAGE},po:{mimeType:'text/x-gettext-translation',mediaType:null},pot:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},ppa:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},ppm:{mimeType:'image/x-portable-pixmap',mediaType:ne.IMAGE},pps:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},ppt:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},pptm:{mimeType:'application/vnd.ms-powerpoint.presentation.macroEnabled.12',mediaType:null},pptx:{mimeType:'application/vnd.openxmlformats-officedocument.presentationml.presentation',mediaType:null},ps:{mimeType:'application/postscript',mediaType:null},pwz:{mimeType:'application/vnd.ms-powerpoint',mediaType:null},py:{mimeType:'text/x-python',mediaType:null},pyc:{mimeType:'application/x-python-code',mediaType:null},pyo:{mimeType:'application/x-python-code',mediaType:null},qt:{mimeType:'video/quicktime',mediaType:ne.VIDEO},ra:{mimeType:'audio/x-pn-realaudio',mediaType:ne.AUDIO},ram:{mimeType:'application/x-pn-realaudio',mediaType:ne.AUDIO},ras:{mimeType:'image/x-cmu-raster',mediaType:ne.IMAGE},rdf:{mimeType:'application/xml',mediaType:null},rgb:{mimeType:'image/x-rgb',mediaType:ne.IMAGE},roff:{mimeType:'application/x-troff',mediaType:null},rtx:{mimeType:'text/richtext',mediaType:null},sgm:{mimeType:'text/x-sgml',mediaType:null},sgml:{mimeType:'text/x-sgml',mediaType:null},sh:{mimeType:'application/x-sh',mediaType:null},shar:{mimeType:'application/x-shar',mediaType:null},snd:{mimeType:'audio/basic',mediaType:ne.AUDIO},so:{mimeType:'application/octet-stream',mediaType:null},src:{mimeType:'application/x-wais-source',mediaType:null},svg:{mimeType:'image/svg+xml',mediaType:ne.IMAGE},swf:{mimeType:'application/x-shockwave-flash',mediaType:null},t:{mimeType:'application/x-troff',mediaType:null},tar:{mimeType:'application/x-tar',mediaType:null},tcl:{mimeType:'application/x-tcl',mediaType:null},tex:{mimeType:'application/x-tex',mediaType:null},texi:{mimeType:'application/x-texinfo',mediaType:null},texinfo:{mimeType:'application/x-texinfo',mediaType:null},tif:{mimeType:'image/tiff',mediaType:ne.IMAGE},tiff:{mimeType:'image/tiff',mediaType:ne.IMAGE},tr:{mimeType:'application/x-troff',mediaType:null},tsv:{mimeType:'text/tab-separated-values',mediaType:null},ttf:{mimeType:'application/x-font-truetype',mediaType:null},txt:{mimeType:'text/plain',mediaType:null,preferred:!0},ustar:{mimeType:'application/x-ustar',mediaType:null},vcf:{mimeType:'text/x-vcard',mediaType:null},wav:{mimeType:'audio/x-wav',mediaType:ne.AUDIO},woff:{mimeType:'application/font-woff',mediaType:null,preferred:!0},woff2:{mimeType:'application/font-woff',mediaType:null},wsdl:{mimeType:'application/xml',mediaType:null},xbm:{mimeType:'image/x-xbitmap',mediaType:ne.IMAGE},xlb:{mimeType:'application/vnd.ms-excel',mediaType:null},xls:{mimeType:'application/vnd.ms-excel',mediaType:null},xlsm:{mimeType:'application/vnd.ms-excel.sheet.macroEnabled.12',mediaType:null},xlsx:{mimeType:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',mediaType:null},xml:{mimeType:'text/xml',mediaType:null},xpdl:{mimeType:'application/xml',mediaType:null},xpm:{mimeType:'image/x-xpixmap',mediaType:ne.IMAGE},xsl:{mimeType:'application/xml',mediaType:null},xwd:{mimeType:'image/x-xwindowdump',mediaType:ne.IMAGE},zip:{mimeType:'application/zip',mediaType:null}};f.getMimeTypeFromExtension=E,f.getMediaTypeFromExtension=I,f.getMediaTypeFromMimeType=R,f.getFileNameFromPath=A,f.upload=function(oe,ae,ie,de){return new W.Promise((le,ce)=>{if(null==ee&&(ee=X.isElectron()?K.getSource('@commontimeltd/com.commontime.filetransfer'):K.getSource('FileTransfer')),!1!==ee){const ue={httpMethod:'PUT',fileName:A(oe),fileKey:'file',headers:de,mimeType:E(oe),chunkedMode:!1},pe=new ee;pe.upload(oe,ae,(me)=>{le({source:oe,target:ae,response:me.response})},ce,ue)}else console.warn('Falling back to using XHR for file uploads.'),z(oe).then((ue)=>{const pe=new XMLHttpRequest;if(pe.addEventListener('load',(me)=>{le({source:ie,target:ae,response:me})}),pe.addEventListener('error',ce),pe.open('PUT',ae,!0),de)for(let me in de)pe.setRequestHeader(me,de[me]);pe.send(ue)})})},f.download=function(oe,ae=null){return new W.Promise((ie,de)=>{null===ee&&(ee=X.isElectron()?K.getSource('@commontimeltd/com.commontime.filetransfer'):K.getSource('FileTransfer')),!1===ee?ie({source:oe,target:oe}):M().then((le)=>{const ce=new ee,ue=le+Date.now()+'_'+A(oe),pe=(ge)=>{X.isElectron()?ie({source:ge.filePath,target:oe}):X.isDevice()?ie({source:ge.nativeURL,target:oe}):(console.warn('Attachments are not currently supported on this platform.'),de())},me=(ge)=>{console.error(`Unable to download file '${ue}' from '${oe}':`,ge),de(ge)};X.isDevice()?ce.download(oe,ue,pe,me,!1,{headers:ae}):ce.download(oe,ue,pe,me,{headers:ae})}).catch(de)})},f.getFileInfo=function(oe){return new W.Promise((ae,ie)=>{if(X.isElectron())try{const de=Q.require('fs-plus');de.stat(oe,(le,ce)=>{le?ie(le):ae({name:A(oe),path:oe,size:ce.size,type:E(oe),mediaType:I(oe)})})}catch(de){ie('Couldn\'t require \'fs-plus\' module.')}else if(X.isDevice()){const de=0===oe.indexOf('file://')?oe:`file://${oe}`;Z.resolveLocalFileSystemURL(de,function(le){le.file(function(ce){const ue=ce.type?ce.type:E(oe);ae({name:ce.name,path:de,size:ce.size,type:ue,mediaType:I(oe)})})},ie)}else z(oe).then((de)=>{ae({name:oe.split('/').pop(),path:oe,size:de.size,type:de.type,mediaType:R(de.type)})})})},f.deleteFile=function(oe){return new W.Promise((ae,ie)=>{if(X.isElectron())try{const de=Q.require('fs-plus'),le=de.existsSync(oe);le?(de.unlinkSync(oe),ae()):ie(`File '${oe}' doesn't exist and cannot be deleted.`)}catch(de){ie(`Something went wrong while trying to delete the file '${oe}': ${de}`)}else X.isDevice()?Z.resolveLocalFileSystemURL(oe,(de)=>{de.isDirectory?ie(`File path '${oe}' is a directory and cannot be deleted.`):de.remove(ae,ie)}):ae()})},f.urlToBlob=z,f.blobToObjectUrl=function(oe){return new W.Promise((ae)=>{ae(URL.createObjectURL(oe))})},f.deleteAttachments=function(){return new W.Promise((oe,ae)=>{if(X.isElectron()){const ie=Q.require('path'),de=Q.require('fs'),le=Q.require('electron').remote.app.getPath('userData'),ce=ie.sep,ue=le+ce+te+ce;if(!de.existsSync(ue))return oe();de.readdir(ue,(pe,me)=>{if(pe)return ae(pe);for(const ge of me)de.lstatSync(ie.join(ue,ge)).isFile()&&de.unlinkSync(ie.join(ue,ge));oe()})}else if(X.isDevice()){const ie=X.getPlatformName(),de=K.getSource('file');if(!1!==de){let le=null;'ios'===ie?le=de.documentsDirectory:'android'===ie&&(le=de.dataDirectory),null===le?ae('Unsupported platform, expected Android or iOS.'):Z.resolveLocalFileSystemURL(le,(ce)=>{ce.getDirectory(te,{create:!1,exclusive:!1},function(ue){ue.removeRecursively(oe,ae)},function(ue){1===ue.code?oe():(console.error(`Couldn't get '${te}' to delete:`,ue),ae(ue))})},function(ce){ae(ce)})}else ae('No file plugin available.')}else oe()})},f.pickFile=function(oe){return new W.Promise((ae,ie)=>{let de=[],le=['*'],ce='All Files';if(void 0===oe.mediaType?void 0!==oe.mimeTypes&&(de=oe.mimeTypes,le=Object.keys(se).filter((ue)=>0<=de.indexOf(se[ue].mimeType))):(le=Object.keys(se).filter((ue)=>se[ue].mediaType===oe.mediaType),de=le.map((ue)=>{return se[ue].mimeType}),ce=oe.mediaType),X.isElectron()){const ue=Q.require('electron').remote.dialog;ue.showOpenDialog({properties:['openFile','multiSelections'],filters:[{name:ce,extensions:le}]},(pe)=>{const me=Q.require('path'),ge=Q.require('fs'),_e=Q.require('electron').remote.app.getPath('userData'),fe=me.sep,he=_e+fe+te+fe;ge.existsSync(he)||ge.mkdirSync(he);const ye=[];pe.forEach((Ce)=>{ye.push(new W.Promise((Te,ve)=>{const Se=me.join(he,Date.now()+'_'+me.basename(Ce)),be=(Re)=>{console.error(`A problem occurred when trying to copy the file '${Ce}' to '${Se}'.`,Re),ve(Re)},Ee=ge.createReadStream(Ce);Ee.on('error',be);const Ie=ge.createWriteStream(Se);Ie.on('error',be),Ie.on('close',()=>{Te(Se)}),Ee.pipe(Ie)}))}),W.Promise.all(ye).then(ae).catch(ie)})}else if(X.isDevice()){const ue=X.getPlatformName(),pe=K.getSource('file');if(!1!==pe){let me=null;'ios'===ue?me=pe.documentsDirectory:'android'===ue&&(me=pe.dataDirectory),null===me?ie('Unsupported platform, expected Android or iOS.'):Z.resolveLocalFileSystemURL(me,(ge)=>{ge.getDirectory(te,{create:!0,exclusive:!1},()=>{const fe=K.getSource('fileimporter');null===fe?ie('File importer plugin not available.'):fe.importFile((he)=>{ae([he])},ie,void 0,de,te)},ie)},ie)}else ie('No file plugin available.')}else{const ue=document.createElement('input');ue.setAttribute('type','file'),ue.setAttribute('multiple','multiple'),ue.addEventListener('change',()=>{const pe=[];for(let me=0;me<ue.files.length;me++)pe.push(URL.createObjectURL(ue.files[me]));ae(pe)}),ue.click()}})},f.getFileSize=function(oe){return new W.Promise((ae,ie)=>{if(oe&&-1!==oe.name.indexOf('.encrypted')){const de=K.getSource('fileEncryption');de?de.getFileSize((le)=>{try{ae(parseInt(le))}catch(ce){console.error('Couldn\'t convert file size to an integer.'),ie(ce)}},ie,oe.path):ae(oe.size)}else ae(oe.size)})}},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});class E{constructor(I,R,A){this._id=null,this._timeout=-1,this._startTime=-1,this._totalTimeRun=-1,this._complete=!1,this._duration=-1,this._callback=null,this._paused=!1,this._id=I,this._duration=A,this._callback=R,this._startTime=new Date().getTime(),this._timeout=setTimeout(this._callback,this._duration)}_timeDiff(I){return new Date().getTime()-I}cancel(){clearTimeout(this._timeout),this._paused=!1}pause(){clearTimeout(this._timeout),this._totalTimeRun=this._timeDiff(this._startTime),this._complete=this._totalTimeRun>=this._duration,this._complete||(this._paused=!0)}resume(){this._paused=!1,this._timeout=this._complete?-1:setTimeout(this._callback,this._duration-this._totalTimeRun)}restart(){this._paused=!1,this._startTime=new Date().getTime(),this._timeout=setTimeout(this._callback,this._duration)}get paused(){return this._paused}get id(){return this._id}}f.default=E},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});class E{constructor(){this.nsResolve=function(I){return'vc'==I?'vcard-temp':null},this.json={}}static fromXml(I){const R=new E;try{R.initFromXML(I)}catch(A){return console.error('Bad vCard: '+A),void 0}return R}static fromJSON(I){const R=new E;return R.initFromJSON(I),R}_extractEmail(I){const R={};return'string'==typeof I.USERID&&(R.address=I.USERID),I.HOME&&(R.home=!0),I.WORK&&(R.work=!0),I.INTERNET&&(R.internet=!0),I.PREF&&(R.pref=!0),I.X400&&(R.x400=!0),R}_extractTelephone(I){const R={};return'string'==typeof I.NUMBER&&(R.number=I.NUMBER),I.HOME&&(R.home=!0),I.WORK&&(R.work=!0),I.VOICE&&(R.voice=!0),I.FAX&&(R.fax=!0),I.PAGER&&(R.pager=!0),I.MSG&&(R.msg=!0),I.CELL&&(R.cell=!0),I.VIDEO&&(R.video=!0),I.BBS&&(R.bbs=!0),I.MODEM&&(R.modem=!0),I.ISDN&&(R.isdn=!0),I.PCS&&(R.pcs=!0),I.PREF&&(R.pref=!0),R}_extractAddress(I){const R={};return'string'==typeof I.POBOX&&(R.poBox=I.POBOX),'string'==typeof I.EXTADD&&(R.extraAddress=I.EXTADD),'string'==typeof I.STREET&&(R.street=I.STREET),'string'==typeof I.LOCALITY&&(R.locality=I.LOCALITY),'string'==typeof I.REGION&&(R.locality=I.REGION),'string'==typeof I.PCODE&&(R.locality=I.PCODE),'string'==typeof I.CTRY&&(R.locality=I.CTRY),I.WORK&&(R.work=!0),I.HOME&&(R.home=!0),I.POSTAL&&(R.postal=!0),I.PARCEL&&(R.parcel=!0),I.DOM&&(R.dom=!0),I.INTL&&(R.intl=!0),I.PREF&&(R.pref=!0),R}initFromXML(I){const R={};'string'==typeof I.VERSION&&(R.version=I.VERSION),'string'==typeof I.FN&&(R.fullName=I.FN),'object'!=typeof I.N||Array.isArray(I.N)||(R.name={},'string'==typeof I.N.FAMILY&&(R.name.family=I.N.FAMILY),'string'==typeof I.N.GIVEN&&(R.name.given=I.N.GIVEN),'string'==typeof I.N.MIDDLE&&(R.name.middle=I.N.MIDDLE),'string'==typeof I.N.PREFIX&&(R.name.prefix=I.N.PREFIX),'string'==typeof I.N.SUFFIX&&(R.name.suffix=I.N.SUFFIX)),'string'==typeof I.NICKNAME&&(R.nickName=I.NICKNAME),'object'!=typeof I.PHOTO||Array.isArray(I.PHOTO)||(R.photo={},'string'==typeof I.PHOTO.TYPE&&(R.photo.type=I.PHOTO.TYPE),'string'==typeof I.PHOTO.BINVAL&&(R.photo.binval=I.PHOTO.BINVAL)),'string'==typeof I.BDAY&&(R.birthday=I.BDAY),'object'==typeof I.ADR&&(R.address=[],Array.isArray(I.ADR)?I.ADR.forEach((A)=>{R.address.push(this._extractAddress(A))}):R.address.push(this._extractAddress(I.ADR))),'object'==typeof I.TEL&&(R.telephone=[],Array.isArray(I.TEL)?I.TEL.forEach((A)=>{R.telephone.push(this._extractTelephone(A))}):R.telephone.push(this._extractTelephone(I.TEL))),'object'==typeof I.EMAIL&&(R.email=[],Array.isArray(I.EMAIL)?I.EMAIL.forEach((A)=>{R.email.push(this._extractEmail(A))}):R.email.push(this._extractEmail(I.EMAIL))),'string'==typeof I.JABBERID&&(R.jabberId=I.JABBERID),'string'==typeof I.MAILER&&(R.mailer=I.MAILER),'string'==typeof I.TZ&&(R.timeZone=I.TZ),'object'!=typeof I.GEO||Array.isArray(I.GEO)||(R.geolocation={},'string'==typeof I.GEO.LAT&&(R.geolocation.lat=I.GEO.LAT),'string'==typeof I.GEO.LON&&(R.geolocation.lng=I.N.GIVEN)),'string'==typeof I.TITLE&&(R.title=I.TITLE),'string'==typeof I.ROLE&&(R.role=I.ROLE),'object'!=typeof I.LOGO||Array.isArray(I.LOGO)||(R.logo={},'string'==typeof I.LOGO.TYPE&&(R.logo.type=I.PHOTO.TYPE),'string'==typeof I.PHOTO.BINVAL&&(R.logo.binval=I.PHOTO.BINVAL),'string'==typeof I.PHOTO.EXTVAL&&(R.logo.extval=I.PHOTO.EXTVAL)),'object'!=typeof I.AGENT||Array.isArray(I.AGENT)||(R.agent={},'string'==typeof I.AGENT.EXTVAL&&(R.agent.extval=I.AGENT.EXTVAL)),'object'!=typeof I.ORG||Array.isArray(I.ORG)||(R.organisation={},'string'==typeof I.ORG.ORGNAME&&(R.organisation.name=I.ORG.ORGNAME),'string'==typeof I.ORG.ORGUNIT&&(R.organisation.unit=I.ORG.ORGUNIT)),'object'==typeof I.CATEGORIES&&(R.categories=[],Array.isArray(I.CATEGORIES)?I.CATEGORIES.forEach((A)=>{R.categories.push({keyword:A.KEYWORD})}):R.telephone.push({keyword:I.CATEGORIES.KEYWORD})),'string'==typeof I.NOTE&&(R.note=I.NOTE),'string'==typeof I.PRODID&&(R.prodid=I.PRODID),'string'==typeof I.REV&&(R.rev=I.REV),'string'==typeof I['SORT-STRING']&&(R.sortString=I['SORT-STRING']),'object'!=typeof I.SOUND||Array.isArray(I.SOUND)||(R.sound={},'string'==typeof I.SOUND.PHONETIC&&(R.sound.phonetic=I.SOUND.PHONETIC),'string'==typeof I.SOUND.BINVAL&&(R.sound.binval=I.SOUND.BINVAL),'string'==typeof I.SOUND.EXTVAL&&(R.sound.extval=I.SOUND.EXTVAL)),'string'==typeof I.UID&&(R.uid=I.UID),'string'==typeof I.URL&&(R.url=I.URL),'string'==typeof I.DESC&&(R.description=I.DESC),'object'!=typeof I.CLASS||Array.isArray(I.CLASS)||(I.CLASS.PUBLIC&&(R.classification='public'),I.CLASS.PRIVATE&&(R.classification='private'),I.CLASS.CONFIDENTIAL&&(R.classification='confidential')),'object'!=typeof I.KEY||Array.isArray(I.KEY)||(R.key={},'string'==typeof I.KEY.CRED&&(R.key.credential=I.KEY.CRED),'string'==typeof I.KEY.TYPE&&(R.key.type=I.KEY.TYPE)),this.json=R}initFromJSON(I){this.json=I}toJSON(){return this.json}toXML(I){const R=new DOMParser().parseFromString('<vCard xmlns="vcard-temp"/>','text/xml'),A=R.firstElementChild;if(this.json.fullName&&this.addNode(A,'FN',this.json.fullName),this.json.name){const N=this.addNode(A,'N');this.json.name.family&&this.addNode(N,'FAMILY',this.json.name.family),this.json.name.given&&this.addNode(N,'GIVEN',this.json.name.given),this.json.name.middle&&this.addNode(N,'MIDDLE',this.json.name.middle),this.json.name.prefix&&this.addNode(N,'PREFIX',this.json.name.prefix),this.json.name.suffix&&this.addNode(N,'SUFFIX',this.json.name.suffix)}if(this.json.nickName&&this.addNode(A,'NICKNAME',this.json.nickName),this.json.photo){const N=this.addNode(A,'PHOTO');this.json.photo.type&&this.addNode(N,'TYPE',this.json.photo.type),this.json.photo.binval&&this.addNode(N,'BINVAL',this.json.photo.binval)}if(this.json.birthday&&this.addNode(A,'BDAY',this.json.birthday),this.json.address&&this.json.address.forEach((N)=>{const D=this.addNode(A,'ADR');N.home&&this.addNode(D,'HOME'),N.work&&this.addNode(D,'WORK'),N.postal&&this.addNode(D,'POSTAL'),N.parcel&&this.addNode(D,'PARCEL'),N.dom&&this.addNode(D,'DOM'),N.intl&&this.addNode(D,'INTL'),N.pref&&this.addNode(D,'PREF'),N.poBox&&this.addNode(D,'POBOX',N.poBox),N.extraAddress&&this.addNode(D,'EXTADD',N.extraAddress),N.street&&this.addNode(D,'STREET',N.street),N.locality&&this.addNode(D,'LOCALITY',N.locality),N.region&&this.addNode(D,'REGION',N.region),N.postcode&&this.addNode(D,'PCODE',N.postcode),N.country&&this.addNode(D,'CTRY',N.country)}),this.json.telephone&&this.json.telephone.forEach((N)=>{const D=this.addNode(A,'TEL');N.home&&this.addNode(D,'HOME'),N.work&&this.addNode(D,'WORK'),N.voice&&this.addNode(D,'VOICE'),N.fax&&this.addNode(D,'FAX'),N.pager&&this.addNode(D,'PAGER'),N.msg&&this.addNode(D,'MSG'),N.cell&&this.addNode(D,'CELL'),N.video&&this.addNode(D,'VIDEO'),N.bbs&&this.addNode(D,'BBS'),N.modem&&this.addNode(D,'MODEM'),N.isdn&&this.addNode(D,'ISDN'),N.pcs&&this.addNode(D,'PCS'),N.pref&&this.addNode(D,'PREF'),N.number&&this.addNode(D,'NUMBER',N.number)}),this.json.email&&this.json.email.forEach((N)=>{const D=this.addNode(A,'EMAIL');N.home&&this.addNode(D,'HOME'),N.work&&this.addNode(D,'WORK'),N.internet&&this.addNode(D,'INTERNET'),N.pref&&this.addNode(D,'PREF'),N.x400&&this.addNode(D,'X400'),N.address&&this.addNode(D,'USERID',N.address)}),this.json.jabberId&&this.addNode(A,'JABBERID',this.json.jabberId),this.json.mailer&&this.addNode(A,'MAILER',this.json.mailer),this.json.timeZone&&this.addNode(A,'TZ',this.json.timeZone),this.json.geolocation){const N=this.addNode(A,'GEO');this.json.geolocation.lat&&this.addNode(N,'LAT',this.json.geolocation.lat),this.json.geolocation.lng&&this.addNode(N,'LON',this.json.geolocation.lng)}if(this.json.title&&this.addNode(A,'TITLE',this.json.title),this.json.role&&this.addNode(A,'ROLE',this.json.role),this.json.logo){const N=this.addNode(A,'LOGO');this.json.logo.type&&this.addNode(N,'TYPE',this.json.logo.type),this.json.logo.binval&&this.addNode(N,'BINVAL',this.json.logo.binval),this.json.logo.extval&&this.addNode(N,'EXTVAL',this.json.logo.extval)}if(this.json.organisation){const N=this.addNode(A,'ORG');this.json.organisation.name&&this.addNode(N,'ORGNAME',this.json.organisation.name),this.json.organisation.unit&&this.addNode(N,'ORGUNIT',this.json.organisation.unit)}if(this.json.categories&&this.json.categories.forEach((N)=>{const D=this.addNode(A,'CATEGORIES');N.keyword&&this.addNode(D,'KEYWORD',N.keyword)}),this.json.note&&this.addNode(A,'NOTE',this.json.note),this.json.productId&&this.addNode(A,'PRODID',this.json.productId),this.json.lastRevised&&this.addNode(A,'REV',this.json.lastRevised),this.json.sortString&&this.addNode(A,'SORT-STRING',this.json.sortString),this.json.sound){const N=this.addNode(A,'SOUND');this.json.sound.phonetic&&this.addNode(N,'PHONETIC',this.json.sound.phonetic),this.json.sound.extval&&this.addNode(N,'EXTVAL',this.json.sound.extval),this.json.sound.binval&&this.addNode(N,'BINVAL',this.json.sound.binval)}if(this.json.uid&&this.addNode(A,'UID',this.json.uid),this.json.url&&this.addNode(A,'URL',this.json.url),this.json.description&&this.addNode(A,'DESC',this.json.description),this.json.classification){const N=this.addNode(A,'CLASS');'public'===this.json.classification&&this.addNode(N,'PUBLIC'),'private'===this.json.classification&&this.addNode(N,'PRIVATE'),'confidential'===this.json.classification&&this.addNode(N,'CONFIDENTIAL')}if(this.json.key){const N=this.addNode(A,'KEY');this.json.key.credential&&this.addNode(N,'CRED',this.json.key.credential),this.json.key.type&&this.addNode(N,'TYPE',this.json.key.type)}let M='';if(I)M=new XMLSerializer().serializeToString(R);else{const N=R.children[0];for(let D=0;D<N.childElementCount;D++){console.log(N.childNodes.item(D));const B=new XMLSerializer().serializeToString(N.childNodes.item(D));M+=B}}return M}addNode(I,R,A){const M=I.ownerDocument.createElement(R);return I.appendChild(M),void 0!==A&&(M.textContent=A),M}}f.VCardSimple=E},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(18),R=h(30),A=h(13),M=h(1),N=h(6),D=h(3);class B{constructor(H,z){if(this.waitingAlertId=void 0,this.suppressMode=!1,this._messageHandlers=new Map,this._messageProcessorQueue=Promise.resolve(),this._sendMessageQueue=Promise.resolve({}),this._suppressModeQueue=[],this._deferredStanzas=[],!z)throw new Error('You must supply a config object');this.name=H,this.config=z,this._eventListeners={},this.logger=new A.Logger(this.config.logging||[]),this._setUpHandlers(),R.LayerRegistration.addInstance(this.name,this)}static getInstance(H){return R.LayerRegistration.getInstance(H)}static onReady(H,z){R.LayerRegistration.onReady(H,z)}bootstrap(H,z){return this._buildCommonComponents(),this.showWaitingMessage('Initialising app'),Promise.resolve().then(()=>this._setStore(z)).then(()=>this._setLogger()).then(()=>this._setComms(H)).then(()=>this._setupPushNotifications()).then(()=>this._setupCommonEventListeners()).then(()=>R.LayerRegistration.fireReady(this.name)).then(()=>this.dismissWaitingMessage()).catch(($)=>{R.LayerRegistration.fireReady(this.name),setTimeout(()=>{this.error('Error during bootstrap',$)},100)})}on(H,z,$=!1,Y=!1){this._eventListeners[H]===void 0&&(this._eventListeners[H]=[]);this._eventListeners[H].push({oneTimeOnly:$,allowSuppress:Y,callback:(J)=>{z(J.detail)}})}emit(H,z){this._eventListeners[H]||(this._eventListeners[H]=[]),this.logger.log(A.LoggerTypes.Events,`%c📞 RAISING EVENT:%c ${H} (${this._eventListeners[H].length} listeners)`,'color: #066; font-weight: bold;','color: #999; font-weight: normal;',{data:z});const $=[];for(let Y=0;Y<this._eventListeners[H].length;Y++){const G=this._eventListeners[H][Y];this.suppressMode&&G.allowSuppress||G.callback({detail:z}),!0===G.oneTimeOnly&&$.push(Y)}$.length&&(this._eventListeners[H]=this._eventListeners[H].filter((Y,G)=>!$.includes(G)))}login(H,z){return E(this,void 0,void 0,function*(){return yield this.comms.login(H,z)})}attemptReconnect(){this.comms.attemptReconnect()}logout(){return E(this,void 0,void 0,function*(){return yield this.comms.logout()})}getSyncedTimestamp(){return this.comms.getSyncedTimestamp()}getConnectionStatus(){return this.comms.getConnectionStatus()}clearAllData(H=!1){return E(this,void 0,void 0,function*(){yield this.store.clearAllData(),yield this.comms.clearAllData(H)})}getCurrentUserJid(){return this.comms.username}getCurrentUserResource(){return this.comms.getCurrentUserResource()}getCurrentXmppDisplayName(){return this.config.xmpp.user.displayName||this.config.xmpp.user.id}error(H,z){return E(this,void 0,void 0,function*(){yield this.cancelSuppressMode('*'),this.dismissWaitingMessage();const $='string'==typeof z?z:z.message;this.emit(N.BaseEvents._Request_RaiseAlert,M.DefaultAlerts.AlertErrorWithOkayButton(H,$,1,{})),this.logger.error(z)})}getLabel(H,z){return this.config.labels&&this.config.labels[H]?D.tokenReplace(this.config.labels[H],z):null}getUniqueCommsId(){return this.comms.getUniqueId()}sendMessage(H,z,$,Y=[]){return E(this,void 0,void 0,function*(){try{const G=yield this._prepareMessage(H,$);if(null===G)return null;const J=yield this.comms.sendMessage(z,G,Y),W=J.data[H.toString()]&&JSON.parse(J.data[H.toString()]);return Object.assign({},J,{data:{[H.toString()]:W}})}catch(G){this.error('Error sending message',G)}})}sendRoomMessage(H,z){return E(this,void 0,void 0,function*(){try{const $=yield this._prepareMessage(H,z);if(null===$)return null;const Y=yield this.comms.sendRoomMessage($),G=Y.data[H.toString()]&&JSON.parse(Y.data[H.toString()]);return Object.assign({},Y,{data:{[H.toString()]:G}})}catch($){this.error('Error sending room message',$)}})}sendMulticastMessage(H,z,$=[],Y=[]){return E(this,void 0,void 0,function*(){try{const G=yield this._prepareMessage(H,z);if(null===G)return null;const J=yield this.comms.sendMulticastMessage($,G,this.config.isBroadcaster,Y),W=J.data[H.toString()]&&JSON.parse(J.data[H.toString()]);return Object.assign({},J,{data:{[H.toString()]:W}})}catch(G){G.includes('Stream Management')?this.logger.error(G):this.error('Error sending multicast message',G)}})}sendMessageToBot(H,z,$=!1){return E(this,void 0,void 0,function*(){try{yield this._sendBotCommand(H,z,null)}catch(Y){if($)throw Y;else this.error('Error sending bot message',Y)}})}sendBotCommand(H,z,$=!1){return E(this,void 0,void 0,function*(){try{return yield this.comms.sendBotCommand(H.toString(),z)}catch(Y){if($)throw Y;else this.error('Error sending bot command',Y)}})}downloadFile(H){return E(this,void 0,void 0,function*(){try{return yield this.comms.downloadFile(H)}catch(z){this.error('Error downloading file',z)}})}setSupportLoggingTypes(H=['_all_']){return E(this,void 0,void 0,function*(){return this.logger.setTypes(H),yield this.store.saveLoggerTypes(H)})}resetSupportLogging(){return E(this,void 0,void 0,function*(){return this.logger.setTypes([]),yield this.store.deleteLoggerTypes()})}showWaitingMessage(H){if(this.dismissWaitingMessage(),!this.waitingAlertId){const z=M.DefaultAlerts.AlertWaiting(H);this.waitingAlertId=z.id,this.alertModalManager.raiseAlert(z)}}dismissWaitingMessage(){this.waitingAlertId&&(this.alertModalManager.dismissAlertById(this.waitingAlertId),this.waitingAlertId=null)}enableSuppressMode(H,z=!1){if('*'===H)throw new Error('Suppress mode cannot be enabled with the id \'*\'');z&&this._suppressModeQueue.includes(H)?this.logger.log(A.LoggerTypes.Other,`%c🔇 SUPPRESSION MODE ALREADY EXISTS IN QUEUE %c${H}`,'color: #696; font-weight: bold;','color: #999; font-weight: normal;'):(this.logger.log(A.LoggerTypes.Other,`%c🔇 ADDING TO SUPPRESSION MODE QUEUE %c${H}`,'color: #696; font-weight: bold;','color: #999; font-weight: normal;'),this._suppressModeQueue.push(H)),this.logger.log(A.LoggerTypes.Other,'%c\uD83D\uDD07 SUPPRESSION MODE QUEUE','color: #696; font-weight: bold;',this._suppressModeQueue),this.suppressMode||(this.logger.log(A.LoggerTypes.Other,'%c\uD83D\uDD07 ENTERING SUPPRESSION MODE','color: #696; font-weight: bold;'),this.suppressMode=!0)}cancelSuppressMode(H){return E(this,void 0,void 0,function*(){return this.logger.log(A.LoggerTypes.Other,`↪️ Adding promise 'cancelSuppressMode' to the processor queue...`),this._messageProcessorQueue=this._messageProcessorQueue.then(()=>E(this,void 0,void 0,function*(){return this.logger.log(A.LoggerTypes.Other,`↪️ Processing promise 'cancelSuppressMode' to the processor queue...`),new Promise((z)=>{if('*'===H)this.logger.log(A.LoggerTypes.Other,'%c\uD83D\uDD07 CLEARING SUPPRESSION MODE QUEUE','color: #696; font-weight: bold;'),this._suppressModeQueue=[],this.suppressMode=!1;else{const $=this._suppressModeQueue.indexOf(H);-1!==$&&(this.logger.log(A.LoggerTypes.Other,`%c🔇 REMOVING FROM SUPPRESSION MODE QUEUE %c${H}`,'color: #696; font-weight: bold;','color: #999; font-weight: normal;'),this._suppressModeQueue.splice($,1),this.logger.log(A.LoggerTypes.Other,'%c\uD83D\uDD07 SUPPRESSION MODE QUEUE','color: #696; font-weight: bold;',this._suppressModeQueue))}if(!0===this.suppressMode&&0===this._suppressModeQueue.length){if(this.logger.log(A.LoggerTypes.Other,'%c\uD83D\uDD0A EXITING SUPPRESSION MODE','color: #696; font-weight: bold;'),this.suppressMode=!1,0<this._deferredStanzas.length){const $=[...this._deferredStanzas],Y=$.filter((G)=>G.eventType===I.CtXmppClient.EVENT_TYPES.NEW_MESSAGE).map((G)=>G.payload.data);this._deferredStanzas=[],this.logger.log(A.LoggerTypes.Other,`%c📬 HANDLING ${Y.length} DEFERRED MESSAGE(S) RECEIVED DURING SUPPRESSED MODE`,'color: #696; font-weight: bold;',Y),$.forEach((G)=>{switch(G.eventType){case I.CtXmppClient.EVENT_TYPES.NEW_MESSAGE:this.handleNewMessage(G.payload);break;case I.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED:this.handleMessageUpdate(G.payload);break;case I.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED:this.handleChatMarkerUpdate(G.payload);}})}else this.logger.log(A.LoggerTypes.Other,`%c📭 NO MESSAGES RECEIVED DURING SUPPRESSED MODE`,'color: #696; font-weight: bold;');this.logger.log(A.LoggerTypes.Other,'%c\uD83C\uDFA8 REDRAWING UIS','color: #696; font-weight: bold;'),this.emit(N.BaseEvents._Request_RedrawAllUIs)}z()})})),this._messageProcessorQueue})}addDeferredStanza(H){this._deferredStanzas||(this._deferredStanzas=[]),this.logger.log(A.LoggerTypes.Other,`%c🔇 ADDING DEFERRED STANZA %c${H.id} > ${H.eventType}`,'color: #696; font-weight: bold;','color: #999; font-weight: normal;',{payload:H.payload}),this._deferredStanzas.push(H)}removeDeferredStanza(H,z){this._deferredStanzas&&this._deferredStanzas.length&&(!this._deferredStanzas.some(($)=>$.id===H&&$.eventType===z)||(this.logger.log(A.LoggerTypes.Other,`%c🔇 REMOVING DEFERRED STANZA %c${H} > ${z}`,'color: #696; font-weight: bold;','color: #999; font-weight: normal;'),this._deferredStanzas=this._deferredStanzas.filter(($)=>{return $.id!==H||$.eventType!==z})))}_setComms(H){return new Promise((z,$)=>{const Y=this.config.xmpp.initTimeout||1e4,G=setTimeout(()=>{$(`Comms was not initialised within ${_Mathfloor(Y/1e3)} seconds. Aborting.`)},Y);this.comms=H,this.comms.onLogin((J)=>{this.handleLogin(J)}),this.comms.onLogout((J)=>{this.handleLogout(J)}),this.comms.onNewMessage((J)=>{this.handleNewMessage(J)}),this.comms.onMessageUpdate((J)=>{this.handleMessageUpdate(J)}),this.comms.onChatMarkerUpdate((J)=>{this.handleChatMarkerUpdate(J)}),this.comms.onStatusUpdate((J,W)=>{this.handleConnectionChange(J,W)}),this.comms.onPresenceUpdate((J)=>{this.handlePresenceUpdate(J)}),this.comms.onRoomNewParticipant((J)=>{this.handleRoomParticipantUpdate(J)}),this.comms.onRoomParticipantUpdate((J)=>{this.handleRoomParticipantUpdate(J)}),this.comms.onStartFetchingMissedMessages(()=>{this.enableSuppressMode('baseLayer#mam',!0)}),this.comms.onFinishedFetchingMissedMessages(()=>{this.cancelSuppressMode('baseLayer#mam')}),this.comms.onInitialized(()=>{z(),clearTimeout(G),this.config.xmpp.user.id&&this.config.xmpp.user.password&&this.config.xmpp.user.domain&&(this.showWaitingMessage(`Logging in as ${this.config.xmpp.user.id}`),this._attemptAutoLogin(this.config.xmpp.user.id,this.config.xmpp.user.password,this.config.xmpp.user.domain))})})}_setStore(H){return new Promise((z)=>{this.store=H,this.store.init().then(()=>z())})}_setLogger(){return new Promise((H)=>E(this,void 0,void 0,function*(){const z=yield this.store.getLoggerTypes();z&&this.logger.setTypes(z),H()}))}_setupPushNotifications(){return new Promise((H)=>E(this,void 0,void 0,function*(){const z=window;this.config.enablePushNotifications&&z.cordova?z.cordova.plugins.notification?z.cti.store.notification&&z.cti.store.notification.token?(yield this.store.savePushNotificationToken(z.cti.store.notification.token),H()):z.cordova.plugins.notification.registerForPush(($)=>E(this,void 0,void 0,function*(){yield this.store.savePushNotificationToken($),H()}),($)=>{this.logger.error($),H()},{channelName:this.name}):H():H()}))}_setupCommonEventListeners(){return new Promise((H)=>E(this,void 0,void 0,function*(){const z=yield this.store.getTheme();this._setThemeOnHtml(z),this.on(N.BaseEvents._Request_ThemeChange,($)=>E(this,void 0,void 0,function*(){yield this.store.saveTheme($),this._setThemeOnHtml($)})),H()}))}_setThemeOnHtml(H){document.querySelector('html').setAttribute('theme',H),this.emit(N.BaseEvents._Request_RedrawAllUIs)}_setUpHandlers(){this._messageHandlers=new Map,this.getHandlers().forEach((H)=>{H.messageKey&&this._messageHandlers.set(H.messageKey,H),H.eventType&&H.eventType.length&&H.eventType.forEach((z)=>{this.on(z,($)=>E(this,void 0,void 0,function*(){try{yield H.callHandleEvent(z,$)}catch(Y){this.error('Error handling event',`Event type: ${z.toString()}. ${Y.message||Y}`)}}))})})}_prepareMessage(H,z){return E(this,void 0,void 0,function*(){const $=this._messageHandlers.get(H),Y=yield $.callCreateMessage(z);return null===Y||void 0===Y?null:{[$.messageKey]:JSON.stringify(Y)}})}_sendBotCommand(H,z,$){return E(this,void 0,void 0,function*(){const Y=H.toString(),G=yield this._prepareBotMessage(H,z,$);if(null!==G){const J=yield this.comms.sendBotCommand(Y,G);if(J&&!1===J.success){const W=yield this._shouldRetryBotMessage(H,z,J);!0===W&&(yield this._sendBotCommand(H,z,J))}else if(J&&!0===J.success){this.emit(N.BaseEvents.BotResponseReceived,{data:z,response:J,messageType:H})}}})}_prepareBotMessage(H,z,$){return E(this,void 0,void 0,function*(){const Y=this._messageHandlers.get(H),G=yield Y.callCreateBotMessage(z,$);return null===G||void 0===G?null:{[Y.messageKey]:JSON.stringify(G)}})}_shouldRetryBotMessage(H,z,$){return E(this,void 0,void 0,function*(){const Y=this._messageHandlers.get(H);return yield Y.callHandleFailedBotResponse(z,$)})}_buildCommonComponents(){return E(this,void 0,void 0,function*(){const H='div',z='___ct_base_layer_modal_container';let $=document.querySelector(`${H}#${z}`);$||($=document.createElement(H),$.id=z,$.setAttribute('style','position: absolute; top: 0; left: 0; width: 0; height: 0; z-index: 99999;'),document.body.appendChild($)),this.alertModalManager=document.querySelector('ct-alert-modal-manager'),this.alertModalManager||(this.alertModalManager=document.createElement('ct-alert-modal-manager'),this.alertModalManager.owner=this.name,$.appendChild(this.alertModalManager)),yield this.generateCommonComponents($)})}_attemptAutoLogin(H,z,$){return E(this,void 0,void 0,function*(){let Y=`${H}@${$}`;this.config.xmpp.user&&!0===this.config.xmpp.user.forceLowercaseJid&&(Y=Y.toLowerCase()),this.logger.log(A.LoggerTypes.Connectivity,`%c💻 ATTEMPTING AUTOMATIC LOGIN AS > %c${Y}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),yield this.comms.login(Y,z)})}handleLogin(H){this.emit(N.BaseEvents.LoginResult,H)}handleLogout(H){this.emit(N.BaseEvents.LogoutResult,H)}handleNewMessage(H){if(!0===this.suppressMode&&!0!==H.isFromMam)return void this.addDeferredStanza({id:H._id,eventType:I.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,payload:H});this.emit(N.BaseEvents.UserActivity,new N.UserActivityEventArgs(H.jid,H.ts));const z=D.getMessageType(H.data);if(!z)return;const $=H.data[z]&&JSON.parse(H.data[z]),Y=Object.assign({},H,{data:{[z]:$}}),G=this._messageHandlers.get(z);G&&(this.logger.log(A.LoggerTypes.Other,`↪️ Adding promise 'handleNewMessage' to the processor queue...`),this._messageProcessorQueue=this._messageProcessorQueue.then(()=>E(this,void 0,void 0,function*(){this.logger.log(A.LoggerTypes.Other,`↪️ Processing promise 'handleNewMessage' to the processor queue...`);try{return this.removeDeferredStanza(H._id,I.CtXmppClient.EVENT_TYPES.NEW_MESSAGE),this.logger.log(A.LoggerTypes.ProcessingReceived,`%c👷 PROCESSING NEW MESSAGE:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$}),yield G.callHandleMessage(Y)}catch(J){this.error('Error processing message',J)}})).catch((J)=>this.error('Error processing message',J)))}handleMessageUpdate(H){if(!0===this.suppressMode)return void this.addDeferredStanza({id:H._id,eventType:I.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,payload:H});this.emit(N.BaseEvents.UserActivity,new N.UserActivityEventArgs(H.jid,H.ts));const z=D.getMessageType(H.data);if(!z)return;const $=H.data[z]&&JSON.parse(H.data[z]),Y=Object.assign({},H,{data:{[z]:$}}),G=this._messageHandlers.get(z);G&&(this.logger.log(A.LoggerTypes.Other,`↪️ Adding promise 'handleMessageUpdate' to the processor queue...`),this._messageProcessorQueue=this._messageProcessorQueue.then(()=>E(this,void 0,void 0,function*(){this.logger.log(A.LoggerTypes.Other,`↪️ Processing promise 'handleMessageUpdate' to the processor queue...`);try{return this.removeDeferredStanza(H._id,I.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED),this.logger.log(A.LoggerTypes.ProcessingUpdated,`%c👷 PROCESSING MESSAGE UPDATE:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$}),yield G.callHandleMessageUpdate(Y)}catch(J){this.error('Error processing message update',J)}})).catch((J)=>this.error('Error processing message update',J)))}handleChatMarkerUpdate(H){if(!0===this.suppressMode)return void this.addDeferredStanza({id:H.message_id,eventType:I.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,payload:H});const z=Object.assign({},H);let $=`${z.sender_resource}@${this.config.xmpp.user.domain}`;this.config.xmpp.user&&!0===this.config.xmpp.user.forceLowercaseJid&&($=$.toLowerCase()),z.sender_resource=$,this.emit(N.BaseEvents.UserActivity,new N.UserActivityEventArgs(z.sender_resource,z.message.updated_at||z.message.ts));const Y=D.getMessageType(z.message.data);if(!Y)return;const G=z.message.data[Y]&&JSON.parse(z.message.data[Y]),J=Object.assign({},z,{message:{data:{[Y]:G}}}),W=this._messageHandlers.get(Y);W&&(this.logger.log(A.LoggerTypes.Other,`↪️ Adding promise 'handleChatMarkerUpdate' to the processor queue...`),this._messageProcessorQueue=this._messageProcessorQueue.then(()=>E(this,void 0,void 0,function*(){this.logger.log(A.LoggerTypes.Other,`↪️ Processing promise 'handleChatMarkerUpdate' to the processor queue...`);try{this.removeDeferredStanza(H.message_id,I.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED);const X=z.sender_resource.split('@').shift();return this.logger.log(A.LoggerTypes.ProcessingChatMarker,`%c👷 PROCESSING CHAT MARKER: %c${X} > ${z.type}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),yield W.callHandleMessageReceipt(z)}catch(X){this.error('Error processing chat marker',X)}})).catch((X)=>this.error('Error processing chat marker',X)))}handleRoomParticipantUpdate(H){if(H.jid){this.emit(N.BaseEvents.UserActivity,new N.UserActivityEventArgs(H.jid,H.updated_at||H.ts));const z=H.metadata&&H.metadata.role?H.metadata.role:'';this.emit(N.BaseEvents.RoomParticipantUpdate,new N.RoomParticipantUpdateEventArgs(H.jid,H.room_name,z,M.RoomRole[H.room_role]))}}handleConnectionChange(H,z){this.comms.setConnectionStatus(H),B.onReady(this.name,()=>{this.emit(N.BaseEvents.ConnectionStatusChange,new N.ConnectionStatusEventArgs(H,z))})}handlePresenceUpdate(H){H.online&&this.emit(N.BaseEvents.UserActivity,new N.UserActivityEventArgs(H.id,this.getSyncedTimestamp()));const z=H.online?M.ConnectionStatus.Connected:M.ConnectionStatus.Disconnected;this.emit(N.BaseEvents.OtherUserConnectionStatusChange,new N.UserConnectionStatusEventArgs(H.id,z))}}f.BaseLayer=B},function(u,f,h){'use strict';var E=this&&this.__decorate||function(z,$,Y,G){var J=arguments.length,W=3>J?$:null===G?G=Object.getOwnPropertyDescriptor($,Y):G,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,G);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>J?X(W):3<J?X($,Y,W):X($,Y))||W);return 3<J&&W&&Object.defineProperty($,Y,W),W},I=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(15),A=h(2),M=h(30),N=h(13),D=h(6),B=h(29);class H extends B.CTBaseComponent{constructor(){super(...arguments),this._connected=!1,this._debouncers={}}get layer(){return this._baseLayer?this._baseLayer:null}get componentStyles(){return this.generateComponentStyles}componentMarkup(){if(!this.layer){const z=this._findParentCTLayerComponent();if(z&&(this._baseLayer=z._baseLayer,this._initializeForBaseLayer()),!this._connected)return null;if(!this.layer)return z?console.error(`Component <${this.localName}> child of <${z.localName}> does not have an owner layer specified`):console.error(`Component <${this.localName}> does not have an owner layer specified`),R.h('em',{style:{display:'inline-block',fontSize:'12px',color:'#900',backgroundColor:'#FF0',padding:'3px 6px'}},`${this.localName}:`,R.h('br'),'OWNER NOT SPECIFIED')}return this.generateComponentMarkup()}connectedCallback(){super.connectedCallback()}attributeChangedCallback(z,$,Y){super.attributeChangedCallback(z,$,Y);'owner'===z?Y!==$&&''!==Y&&(this.owner=Y,this._attemptConnectToBaseLayer()):void 0}forceRedraw(){this._renderTrigger=new Date().getTime()}debounce(z,$,Y=100){clearTimeout(this._debouncers[z]),this._debouncers[z]=setTimeout(()=>{$(),delete this._debouncers[z]},Y)}emitEvent(z,$){this._baseLayer?this._baseLayer.emit(z,$):console.error(`Could not emit event from component <${this.localName}> - it does not have an owner layer specified`)}emitComponentEvent(z,$){this._baseLayer?(this._baseLayer.logger.log(N.LoggerTypes.Events,`%c📞 RAISING COMPONENT EVENT:%c ${z}`,'color: #066; font-weight: bold;','color: #999; font-weight: normal;',{component:this,data:$}),this.dispatchEvent(new CustomEvent(z,{detail:$}))):console.error(`Could not emit event from component <${this.localName}> - it does not have an owner layer specified`)}addListener(z,$,Y){if(this._baseLayer){let G=!1,J=!0;Y&&!0===Y.onceOnly&&(G=!0),Y&&!0===Y.dontSuppress&&(J=!1),this._baseLayer.on(z,$,G,J)}else console.error(`Could not set event handler on component <${this.localName}> - it does not have an owner layer specified`)}addListeners(z,$,Y){z.forEach((G)=>{this.addListener(G,$,Y)})}launchModal(z){this._baseLayer.emit(D.BaseEvents._Request_RaiseAlert,z)}closeModal(z){this._baseLayer.emit(D.BaseEvents._Request_CloseAlert,z.id)}getLabel(z,$){return this.layer.getLabel(z,$)}_attemptConnectToBaseLayer(){this.owner&&M.LayerRegistration.onReady(this.owner,()=>{this._connectToLayer()})}_connectToLayer(){return I(this,void 0,void 0,function*(){this._connected||this.owner&&(this._baseLayer=M.LayerRegistration.getInstance(this.owner)||null,this._baseLayer&&(yield this._initializeForBaseLayer()))})}_initializeForBaseLayer(){return I(this,void 0,void 0,function*(){yield this.initialize.apply(this),this.setupListeners(),this._connected=!0,this.forceRedraw(),this.addListener(D.BaseEvents._Request_RedrawAllUIs,()=>I(this,void 0,void 0,function*(){yield this.initialize.apply(this),this.forceRedraw()}))})}_findParentCTLayerComponent(){let z=this,$=!1;do z=z.parentNode||z.host,z||($=!0),z&&z.owner&&($=!0);while(!$);return z||null}}H.is=null,E([A.prop({type:String,attribute:!0})],H.prototype,'owner',void 0),E([A.prop({type:Number,attribute:!1,default:0})],H.prototype,'_renderTrigger',void 0),f.CTLayerComponent=H},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(26),R=h(18),A=h(1),M=h(6),N=h(13),D=h(3);f.BaseComms=class{constructor(H,z,$,Y){this._firstConnectionInitialized=!1,this._loggingIn=!1,this._loginTimeout=null,this._clientName=H;const G={debug:Y.getTypesAsEnumValues().includes(N.LoggerTypes.XmppClient),mucHost:z.mucHost,mam:{auto:z.mam&&!0===z.mam.autoFetch||!1,defaultTimeLimit:z.maxMessageAge||0,pageSize:500},autoLogin:!(z.autoLogin!==void 0)||z.autoLogin,autoReconnect:!(z.autoReconnect!==void 0)||z.autoReconnect,enablePing:!1!==z.enablePing,pingInterval:z.pingInterval||5e3,pingTimeout:z.pingTimeout||1e4,multicastHost:z.multicastHost,uploadHost:z.uploadHost,autoMarkMessages:z.useChatMarkers,encryption:z.encryption||!1,autoPurgeOldMessagesAge:z.maxMessageAge||0,authAttachments:!0===z.authAttachments,streamResumption:!1!==z.streamResumption,useEncodedJidAsResource:z.user&&!0===z.user.userPersistentResource||!1,adSpn:z.adSpn||null,adSecurityPackage:z.adSecurityPackage||null,useConnectionEvents:z.useConnectionEvents||!1,maxReconnectBackoff:z.maxReconnectBackoff||3e5,maxStreamResumptionTime:z.maxStreamResumptionTime||null,sendTimeout:z.sendTimeout||3e5};z.adTokenPlaceholder&&(G.adTokenPlaceholder=z.adTokenPlaceholder),this.client=new R.CtXmppClient(this._clientName,z.endpoint,G),this.store=$,this.logger=Y,this.xmppConfig=z,this._localEventHandlers={},this._setupCommonHandlers()}onInitialized(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.INITIALISED,()=>{H()})}onLogin(H){const z='comms-login';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onLogout(H){const z='comms-logout';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onNewMessage(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,(z)=>{H(Object.assign({},z))})}onMessageUpdate(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,(z)=>{H(Object.assign({},z))})}onChatMarkerUpdate(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,(z)=>{H(Object.assign({},z))})}onStatusUpdate(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.STATUS,(z)=>{let $=A.ConnectionStatus.Disconnected;switch(z.id){case I.default.Strophe.Status.CONNFAIL:$=A.ConnectionStatus.Disconnected;break;case I.default.Strophe.Status.AUTHFAIL:$=A.ConnectionStatus.Disconnected;break;case I.default.Strophe.Status.ERROR:$=A.ConnectionStatus.Disconnected;break;case I.default.Strophe.Status.CONNECTING:$=A.ConnectionStatus.Connecting;break;case I.default.Strophe.Status.AUTHENTICATING:$=A.ConnectionStatus.Connecting;break;case I.default.Strophe.Status.CONNECTED:$=A.ConnectionStatus.Connected;break;case I.default.Strophe.Status.DISCONNECTING:$=A.ConnectionStatus.Disconnecting;break;case I.default.Strophe.Status.DISCONNECTED:$=A.ConnectionStatus.Disconnected;break;default:A.ConnectionStatus.Disconnected;}H($,z.reconnectTime)})}onPresenceUpdate(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.PRESENCE_UPDATE,(z)=>{H(z)})}onRoomNewParticipant(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.NEW_PARTICIPANT,(z)=>{H(Object.assign({},z))})}onRoomParticipantUpdate(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.PARTICIPANT_UPDATED,(z)=>{H(Object.assign({},z))})}onError(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.ERROR,(z)=>{H(z)})}onStartFetchingMissedMessages(H){const z='missed-messages-start';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onFinishedFetchingMissedMessages(H){const z='missed-messages-finished';this._localEventHandlers[z]===void 0&&(this._localEventHandlers[z]=[]),this._localEventHandlers[z].push(H)}onAutoReconnected(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.AUTO_RECONNECTED,()=>{H()})}onDatabasesAutoDestroyed(H){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.AUTO_DBS_DESTROYED,()=>{H()})}getSyncedTimestamp(H){const z=null===H||H===void 0?new Date().getTime():H;return this.client.getSyncedTimestamp(z)}getCurrentUserResource(){return this.client.resource}getConnectionStatus(){return this.status}setConnectionStatus(H){this.status=H}login(H,z,$=!0){return E(this,void 0,void 0,function*(){return!0===this._loggingIn?Promise.reject(new Error('Login currently in progress, please wait.')):new Promise((Y,G)=>E(this,void 0,void 0,function*(){try{this._loggingIn=!0,clearTimeout(this._loginTimeout);const J=this.xmppConfig.loginTimeout||1e4;this._loginTimeout=setTimeout(()=>E(this,void 0,void 0,function*(){clearTimeout(this._loginTimeout),yield this.logout(!0,!0),this.logger.log(N.LoggerTypes.Connectivity,'%c\uD83D\uDEAB LOGIN TIMED OUT','color: #600; font-weight: bold;'),G(new Error(`Logging in took longer than ${_Mathfloor(J/1e3)} seconds. Please check your connectivity and try again.`))}),J),this.xmppConfig.user&&!0===this.xmppConfig.user.forceLowercaseJid&&(H=H.toLowerCase()),this.logger.log(N.LoggerTypes.Connectivity,`%c💻 ATTEMPTING LOGIN > %c${H}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),this.username=H,yield this.client.login(H,z),this.checkTimeSync(!1),$&&this.triggerLoginEvent(!0),clearTimeout(this._loginTimeout),this._loggingIn=!1,Y()}catch(J){clearTimeout(this._loginTimeout),this._loggingIn=!1,this.logger.log(N.LoggerTypes.Connectivity,`%c🚫 LOGIN FAILED > %c${H}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;'),this.username='',$&&this.triggerLoginEvent(!1,J),G(J)}}))})}logout(H=!1,z=!0){return E(this,void 0,void 0,function*(){try{this.logger.log(N.LoggerTypes.Connectivity,`%c✋ LOGGING OUT > %c${this.username}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),this._firstConnectionInitialized=!1,yield this.client.logout(H),this.username='',z&&this.triggerLogoutEvent(!0)}catch($){this.logger.log(N.LoggerTypes.Connectivity,`%c🚫 LOGOUT FAILED > %c${this.username}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;'),z&&this.triggerLogoutEvent(!1)}})}attemptReconnect(){this.client.reLoginNow()}joinRoom(){return E(this,void 0,void 0,function*(){(yield this.xmppConfig)&&this.xmppConfig.room?this._joinOrLeaveRoom(this.xmppConfig.room):null})}leaveRoom(){return E(this,void 0,void 0,function*(){(yield this.xmppConfig)&&this.xmppConfig.room?this._joinOrLeaveRoom(this.xmppConfig.room,!0):null})}setClientStateActive(H){return E(this,void 0,void 0,function*(){const z=H?R.CtXmppClient.CLIENT_STATES.ACTIVE:R.CtXmppClient.CLIENT_STATES.INACTIVE;this.client.setClientState(z)})}getUniqueId(){return this.client.getUniqueId()}sendMessage(H,z,$=[]){return E(this,void 0,void 0,function*(){if(this.status!==A.ConnectionStatus.Connected)throw new Error('Unable to send message: not currently connected');const Y=yield this.client.sendChatMessage(H,null,z,$);if(this.logger.shouldLog(N.LoggerTypes.MessageSent)){const G=D.getMessageType(Y.data),J=Y.data[G]&&JSON.parse(Y.data[G]);this.logger.log(N.LoggerTypes.MessageSent,`%c👈 MESSAGE SENT: %c${H} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{[G]:J})}return Y})}sendRoomMessage(H){return E(this,void 0,void 0,function*(){if(!this.xmppConfig.room)throw new Error('No room configured in XmppConfig');if(this.status!==A.ConnectionStatus.Connected)throw new Error('Unable to send room message: not currently connected');const z=this.xmppConfig.room.name,$=yield this.client.sendGroupChatMessage(z,null,H);if(this.logger.shouldLog(N.LoggerTypes.MessageSent)){const Y=D.getMessageType($.data),G=$.data[Y]&&JSON.parse($.data[Y]);this.logger.log(N.LoggerTypes.MessageSent,`%c👈 ROOM MESSAGE SENT: %c${z} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{[Y]:G})}return $})}sendMulticastMessage(H,z,$,Y=[]){return E(this,void 0,void 0,function*(){if(this.status!==A.ConnectionStatus.Connected)throw new Error('Unable to multicast message: not currently connected');const G=yield this.client.sendMulticastMessage(H,null,z,Y);if(this.logger.shouldLog(N.LoggerTypes.MessageSent)){const J=JSON.stringify(H),W=D.getMessageType(G.data),X=G.data[W]&&JSON.parse(G.data[W]);this.logger.log(N.LoggerTypes.MessageSent,`%c👈 MUTILCAST MESSAGE SENT: %c${J} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{[W]:X})}return G})}sendBotCommand(H,z){return E(this,void 0,void 0,function*(){if(this.status!==A.ConnectionStatus.Connected)throw new Error(`Unable to send bot command "${H}": not currently connected`);if(!this.xmppConfig.bot)throw new Error('No bot configured in XmppConfig');const $=this.xmppConfig.bot.componentJid;if(!$)throw new Error('Unable to issue bot command; no bot component jid configured');if(void 0!==z&&null!==z){const Y=Object.assign({},z);H in Y&&(Y[H]=JSON.parse(Y[H])),this.logger.log(N.LoggerTypes.MessageSent,`%c🤖 BOT COMMAND SENT: %c${H} >`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{data:Y})}else this.logger.log(N.LoggerTypes.MessageSent,`%c🤖 BOT COMMAND SENT: %c${H}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;');try{const Y=yield this.client.sendBotCommand($,H,z,this.xmppConfig.bot.timeout);return this.logger.log(N.LoggerTypes.MessageSent,`%c🤖 BOT RESPONSE: %c${H} > ${Y.success?'success':'fail'}`,'color: #600; font-weight: bold;','color: #999; font-weight: normal;',{data:Y.data||null}),Y}catch(Y){const G='Server connections to local subdomains are forbidden'===Y?`Unable to connect to bot: ${$}`:Y.message||Y;throw new Error(G)}})}updateStatus(H,z,$=!1,Y){return E(this,void 0,void 0,function*(){const G=yield this.client.setChatStatus(H,z,$,Y);if(this.logger.shouldLog(N.LoggerTypes.Status)){const J=JSON.stringify(G);this.logger.log(N.LoggerTypes.Status,`%c👌 STATUS UPDATED: %c${J}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;')}return G})}listParticipantsByRoom(H){return E(this,void 0,void 0,function*(){const z=yield this.client.listParticipantsByRoom(H);return Promise.all(z.map(($)=>E(this,void 0,void 0,function*(){return yield this._participantToUser($)})))})}getParticipantByRoomAndJid(H,z){return E(this,void 0,void 0,function*(){const $=yield this.client.getParticipantByRoomAndJid(H,z);return!$?null:yield this._participantToUser($)})}getAllContacts(){return E(this,void 0,void 0,function*(){const H=yield this.client.getContacts();return Promise.all(H.map((z)=>E(this,void 0,void 0,function*(){return yield this._xmppContactToUser(z)})).filter((z)=>null!==z))})}getChatHistory(H){return E(this,void 0,void 0,function*(){return yield this.client.getChatHistory(H)})}queryMam(H,z,$,Y,G=!0){return E(this,void 0,void 0,function*(){return yield this.client.queryMam(H,z,$,Y,G)})}clearAllData(H=!1){return E(this,void 0,void 0,function*(){yield this.client.destroyDbs(!1,H)})}createPushNotificationRegistration(H){return E(this,void 0,void 0,function*(){const z=this._generatePushNotificationPayload(H.platform,H.channelUri,H.azureId);return yield this.client.sendIq('push.localhost','set',z)})}checkTimeSync(H=!0){const z=new Date().getTime(),$=this.getSyncedTimestamp(z),Y=_Mathabs($-z),J=Y<1e4,W=J?'#666':'#F00',X=J?'#999':'#F00',K=H?console.log:J?()=>{}:console.log;if(K.call(console.log,`%c🕐 CLIENT TIME: %c${new Date(z).toTimeString()}`,'color: #666; font-weight: bold;','color: #999; font-weight: normal;'),K.call(console.log,`%c🕐 SERVER TIME: %c${new Date($).toTimeString()}`,'color: #666; font-weight: bold;','color: #999; font-weight: normal;'),Y){const Q=_Mathfloor(Y/3600000%24),Z=_Mathfloor(Y/60000%60),ee=_Mathfloor(Y/1e3%60),te=_Mathfloor(Y%1e3);let ne='';0<Q&&(ne+=`${Q}h `),0<Z&&(ne+=`${Z}m `),0<ee&&(ne+=`${ee}s `),0<te&&(ne+=`${te}ms `),z>$?K.call(console.log,`%c🕐 TIME SYNC: %cClient is %c${ne.trim()} ahead %cof server`,`color: ${W}; font-weight: bold;`,`color: ${X}; font-weight: normal;`,`color: ${X}; font-weight: bold;`,`color: ${X}; font-weight: normal;`):K.call(console.log,`%c🕐 TIME SYNC: %cClient is %c${ne.trim()} behind %cserver`,`color: ${W}; font-weight: bold;`,`color: ${X}; font-weight: normal;`,`color: ${X}; font-weight: bold;`,`color: ${X}; font-weight: normal;`)}else K.call(console.log,`%c🕐 TIME SYNC: %cClient and server times are identical`,'color: #666; font-weight: bold;','color: #999; font-weight: normal;')}updateVCardForUser(H){return E(this,void 0,void 0,function*(){return this.username&&this.username===H?null:void(yield this.client.updatevCardForContact(H))})}getOurVCard(){return E(this,void 0,void 0,function*(){try{return yield this.client.getOurvCard()}catch(H){return null}})}downloadFile(H){return E(this,void 0,void 0,function*(){const z=yield this.client.doDownload(H);return z.source||null})}initializeFirstConnection(){return E(this,void 0,void 0,function*(){})}buildCurrentUser(H){return E(this,void 0,void 0,function*(){const z=H.split('@').shift(),$={id:H,jid:H,username:z,firstName:'',lastName:'',connectionStatus:this.getConnectionStatus()},Y=yield this.getOurVCard();return yield this.embelishUser($,Y,A.UserAdditionalDetailsType.VCard,!0)})}triggerLoginEvent(H,z){this._fireLocalEventHandlers('comms-login',new M.CommsEventArgs(H,z))}triggerLogoutEvent(H,z){this._fireLocalEventHandlers('comms-logout',new M.CommsEventArgs(H,z))}triggerFetchingMissedMessagesState(H){H?this._fireLocalEventHandlers('missed-messages-start'):this._fireLocalEventHandlers('missed-messages-finished')}_setupCommonHandlers(){this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,(H)=>E(this,void 0,void 0,function*(){if(this.logger.shouldLog(N.LoggerTypes.MessageReceived)){const z=D.getMessageType(H.data),$=H.data[z]&&JSON.parse(H.data[z]);this.logger.log(N.LoggerTypes.MessageReceived,`%c✊ MESSAGE RECEIVED:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$})}})),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,(H)=>{if(this.logger.shouldLog(N.LoggerTypes.MessageUpdated)){const z=D.getMessageType(H.data),$=H.data[z]&&JSON.parse(H.data[z]);this.logger.log(N.LoggerTypes.MessageUpdated,`%c✊ MESSAGE UPDATED:%c`,'color: #060; font-weight: bold;','color: #999; font-weight: normal;',{[z]:$})}}),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,(H)=>{if(this.logger.shouldLog(N.LoggerTypes.MessageChatMarker)){const z=H.sender_resource.split('@').shift();this.logger.log(N.LoggerTypes.MessageChatMarker,`%c👁 CHAT MARKER RECEIVED: %c${z} > ${H.type}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;')}}),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.STATUS,(H)=>E(this,void 0,void 0,function*(){const z=A.ConnectionStatus[H.label];if(this.setConnectionStatus(z),z===A.ConnectionStatus.Connected&&(this.username=this.client.bareJid,!1===this._firstConnectionInitialized&&(yield this.initializeFirstConnection(),this._firstConnectionInitialized=!0)),this.logger.shouldLog(N.LoggerTypes.Connectivity)){const $=H.reconnectTime?` - reconnect attempt in ${H.reconnectTime/1e3} second(s)`:'';this.logger.log(N.LoggerTypes.Connectivity,`%c💻 CONNECTIVITY CHANGE: %c${z}${$}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;')}})),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.NEW_PARTICIPANT,(H)=>E(this,void 0,void 0,function*(){if(H.jid&&this.logger.shouldLog(N.LoggerTypes.Participation)){const z=yield this._participantToUser(H);this.logger.log(N.LoggerTypes.Participation,`%c👋 NEW PARTICIPANT: %c${z.username} > ${z.connectionStatus}`,'color: #006; font-weight: bold;','color: #999; font-weight: normal;',{participant:H})}})),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.PARTICIPANT_UPDATED,(H)=>E(this,void 0,void 0,function*(){if(H.jid&&this.logger.shouldLog(N.LoggerTypes.Participation)){const z=yield this._participantToUser(H);this.logger.log(N.LoggerTypes.Participation,`%c👋 PARTICIPANT UPDATED: %c${z.username} > ${z.connectionStatus}`,'color: #006; font-weight: bold;','color: #999; font-weight: normal;',{participant:H})}})),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.PRESENCE_UPDATE,(H)=>E(this,void 0,void 0,function*(){if(H.id&&this.logger.shouldLog(N.LoggerTypes.Presence)){const z=yield this._xmppContactToUser(H);z?this.logger.log(N.LoggerTypes.Presence,`%c👋 PRESENCE UPDATED: %c${z.username} > ${z.connectionStatus}`,'color: #006; font-weight: bold;','color: #999; font-weight: normal;'):this.logger.error(N.LoggerTypes.Presence,`%c👋 PRESENCE UPDATED FOR UNKNOWN CONTACT:`,'color: #006; font-weight: bold;',{contact:H})}})),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.ERROR,(H)=>{this.logger.error(`%c⛔ ERROR:`,'color: #C00; font-weight: bold;','\r\n\t',H)}),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.AUTO_RECONNECTED,({resumed:H})=>E(this,void 0,void 0,function*(){if(this.logger.shouldLog(N.LoggerTypes.Connectivity)){const z=!0===H?' - STREAM RESUMED':'';this.logger.log(N.LoggerTypes.Connectivity,`%c💻 AUTO RECONNECTED AFTER DISCONNECT${z}`,'color: #669; font-weight: bold;')}})),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.DBS_DESTROYED,()=>{this.logger.shouldLog(N.LoggerTypes.CleanUp)&&this.logger.log(N.LoggerTypes.CleanUp,`%c☠️☠ DATABASES DESTROYED`,'color: #669; font-weight: bold;')}),this.client.addEventListener(R.CtXmppClient.EVENT_TYPES.AUTO_DBS_DESTROYED,()=>{this.logger.shouldLog(N.LoggerTypes.CleanUp)&&this.logger.log(N.LoggerTypes.CleanUp,`%c☠️☠ DATABASES AUTO DESTROYED`,'color: #669; font-weight: bold;')})}_joinOrLeaveRoom(H,z=!1){return E(this,void 0,void 0,function*(){'participant'===H.type&&((yield z)?this.client.leaveRoom(H.name):this.client.joinRoom(H.name)),'subscriber'===H.type&&((yield z)?this.client.unsubscribeFromRoom(H.name):this.client.subscribeToRoom(H.name,H.nodes))})}_participantToUser(H){return E(this,void 0,void 0,function*(){const z={id:H._id,jid:H.jid,username:H.username,firstName:'',lastName:'',connectionStatus:H.online?A.ConnectionStatus.Connected:A.ConnectionStatus.Disconnected};return this.embelishUser(z,H,A.UserAdditionalDetailsType.Participant,!1)})}_xmppContactToUser(H){return E(this,void 0,void 0,function*(){if(!H||!H.id)return null;const z={id:H.id,jid:H.id,username:H.id.substring(0,H.id.indexOf('@')),firstName:'',lastName:'',connectionStatus:H.online?A.ConnectionStatus.Connected:A.ConnectionStatus.Disconnected,groups:H.groups,subscription:H.subscription};return this.embelishUser(z,H,A.UserAdditionalDetailsType.Contact,!1)})}_fireLocalEventHandlers(H,z){this._localEventHandlers[H]!==void 0&&this._localEventHandlers[H].forEach(($)=>$(z))}_generatePushNotificationPayload(H,z,$){return{push:{$attributes:{xmlns:'urn:commontime:infinity:push'},notification:{type:'android'===H?'gcm':'apns',installation_id:$,registration_id:z}}}}}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(15);f.Stroolean=E.prop.create({coerce:(I)=>'string'==typeof I&&'true'===I.toLowerCase(),default:!1,deserialize:(I)=>'string'==typeof I&&'true'===I.toLowerCase(),serialize:(I)=>I?'true':'false'}),f.NullableNumber=E.prop.create({coerce:(I)=>'null'===I?null:parseInt(I),default:null,deserialize:(I)=>'null'===I?null:parseInt(I),serialize:(I)=>null===I||I===void 0?'null':I.toString()})},function(u,f,h){'use strict';function I(N){if('function'==typeof N){const D=N();return D instanceof Array?'array':'object'==typeof D?'object':typeof D}}var R=this&&this.__rest||function(N,D){var B={};for(var H in N)Object.prototype.hasOwnProperty.call(N,H)&&0>D.indexOf(H)&&(B[H]=N[H]);if(null!=N&&'function'==typeof Object.getOwnPropertySymbols)for(var z=0,H=Object.getOwnPropertySymbols(N);z<H.length;z++)0>D.indexOf(H[z])&&(B[H[z]]=N[H[z]]);return B};Object.defineProperty(f,'__esModule',{value:!0});const A=h(15),M=(N)=>N;f.prop=function(N){return function(D,B){const{type:H}=N,z=R(N,['type']),$=I(H),Y=A.prop[$]||M,G=D.constructor,J=G.props||{},W=Object.assign({},J,{[B]:Y(z)});Object.defineProperty(G,'props',{configurable:!0,get(){return W}})}}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(14);class I extends E.BaseEventArgs{constructor(R,A){super(),this.success=R,A&&(this.errorMessage=A)}}f.CommsEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(14);class I extends E.BaseEventArgs{constructor(R,A){super(),this.status=R,this.reconnectTime=A}}f.ConnectionStatusEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(14);class I extends E.BaseEventArgs{constructor(R,A,M,N){super(),this.jid=R,this.roomName=A,this.role=M,this.roomRole=N}}f.RoomParticipantUpdateEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(14);class I extends E.BaseEventArgs{constructor(R,A){super(),this.jid=R,this.date=A}}f.UserActivityEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(14);class I extends E.BaseEventArgs{constructor(R,A){super(),this.jid=R,this.connectionStatus=A}}f.UserConnectionStatusEventArgs=I},function(u,f){'use strict';var E=this&&this.__awaiter||function(R,A,M,N){return new(M||(M=Promise))(function(D,B){function H(Y){try{$(N.next(Y))}catch(G){B(G)}}function z(Y){try{$(N['throw'](Y))}catch(G){B(G)}}function $(Y){Y.done?D(Y.value):new M(function(G){G(Y.value)}).then(H,z)}$((N=N.apply(R,A||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});f.BaseHandler=class{constructor(R){this.messageKey=null,this.eventType=[],this.layer=R}createMessage(){throw new Error('Not implemented')}createBotMessage(){throw new Error('Not implemented')}handleFailedBotResponse(){return E(this,void 0,void 0,function*(){return!1})}handleMessage(){return E(this,void 0,void 0,function*(){})}handleMessageUpdate(){return E(this,void 0,void 0,function*(){})}handleMessageReceipt(){return E(this,void 0,void 0,function*(){})}handleEvent(){return E(this,void 0,void 0,function*(){})}callCreateMessage(R){return E(this,void 0,void 0,function*(){return this.createMessage(R)})}callCreateBotMessage(R){return E(this,void 0,void 0,function*(){return this.createMessage(R)})}callHandleFailedBotResponse(R,A){return E(this,void 0,void 0,function*(){return A&&!0!==A.success&&(yield this.handleFailedBotResponse(R,A))})}callHandleMessage(R){return E(this,void 0,void 0,function*(){yield this.handleMessage(R)})}callHandleMessageUpdate(R){return E(this,void 0,void 0,function*(){yield this.handleMessageUpdate(R)})}callHandleMessageReceipt(R){return E(this,void 0,void 0,function*(){yield this.handleMessageReceipt(R)})}callHandleEvent(R,A){return E(this,void 0,void 0,function*(){yield this.handleEvent(R,A)})}}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const I=h(15);f.ComponentStylesMixin=function(R){class A extends R{constructor(...M){super(...M);const N=window.ShadyCSS;if(this.styleElements||(this.styleElements=[]),!!this.componentStyles)if(!N)this.styleElements=[I.h('style',this.componentStyles),...this.styleElements];else{if(!this.overridingStylesMixinApplied)return;const B=this.localName;if(!0!==A._seenTags[B]){A._seenTags[B]=!0;const H=document.createElement('template');H.innerHTML=`<style>${this.componentStyles}</style>`,N.prepareTemplate(H,B)}}}get componentStylesMixinApplied(){return!0}}return A._seenTags={},A}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E=h(71);f.RenderMixin=E.RenderMixin;var I=h(68);f.ComponentStylesMixin=I.ComponentStylesMixin;var R=h(70);f.OverridingStylesMixin=R.OverridingStylesMixin},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const I=h(15);f.OverridingStylesMixin=function(R){class A extends R{constructor(...M){super(...M);const N=this.localName,D=window.ShadyCSS,H=window.__CtOverridingStyles||{},z=[...(H['*']||[]),...(H[N.toLowerCase()]||[])];if(!D)z&&(!this.styleElements&&(this.styleElements=[]),z.forEach(($)=>{const Y=/^(.*?)\.css$/.test($),G=Y?`@import url('${$}');`:$;this.styleElements=[...this.styleElements,I.h('style',G)]}));else if(!0!==A._seenTags[N]){function $(G){return new Promise((J)=>{const W=new XMLHttpRequest;W.onreadystatechange=()=>{W.readyState===XMLHttpRequest.DONE&&(200===W.status?J(W.responseText):J(`:host { content: 'Error: could not load stylesheet: ${G}' }`))},W.open('GET',G),W.send()})}A._seenTags[N]=!0;const Y=[];z&&z.forEach((G)=>{const J=/^(.*?)\.css$/.test(G),W=J?$(G):Promise.resolve(G);Y.push(W)}),Promise.all(Y).then((G)=>{const J=document.createElement('template');if(this.componentStyles&&!0===this.componentStylesMixinApplied&&(J.innerHTML+=this.componentStyles),0<G.length){const W=G.join('\n');J.innerHTML+=`<style>${W}</style>`}J.innerHTML.length&&D.prepareTemplate(J,N)})}}get overridingStylesMixinApplied(){return!0}}return A._seenTags={},A}},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0}),f.RenderMixin=function(I){function R(M){return M instanceof Array?M:[M]}return class extends I{renderCallback(){const M=R(this.styleElements||[]),N=R(this.componentMarkup?this.componentMarkup()||[]:[]);return[...M,...N]}}}},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Broadcaster='broadcaster']='Broadcaster',I[I.Responder='responder']='Responder'})(E=f.AppMode||(f.AppMode={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Connecting='connecting']='Connecting',I[I.Connected='connected']='Connected',I[I.Disconnected='disconnected']='Disconnected',I[I.Disconnecting='disconnecting']='Disconnecting'})(E=f.ConnectionStatus||(f.ConnectionStatus={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.None='none']='None',I[I.Participant='participant']='Participant',I[I.Moderator='moderator']='Moderator'})(E=f.RoomRole||(f.RoomRole={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Contact='contact']='Contact',I[I.VCard='vcard']='VCard',I[I.Participant='participant']='Participant'})(E=f.UserAdditionalDetailsType||(f.UserAdditionalDetailsType={}))},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(A,M,N,D){return new(N||(N=Promise))(function(B,H){function z(G){try{Y(D.next(G))}catch(J){H(J)}}function $(G){try{Y(D['throw'](G))}catch(J){H(J)}}function Y(G){G.done?B(G.value):new N(function(J){J(G.value)}).then(z,$)}Y((D=D.apply(A,M||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(13);f.BaseStore=class{constructor(A,M){this._saveToPersistentQueue=Promise.resolve(),this._isDestoryingDb=!1,this.name=A,this.logger=M,this._createDb(this.name)}init(){return E(this,void 0,void 0,function*(){this.state=yield this.getFromPersistent()})}savePushNotificationToken(A){return E(this,void 0,void 0,function*(){this.state.pushNotificationToken=A,yield this.saveToPersistent()})}getPushNotificationToken(){return E(this,void 0,void 0,function*(){return this.state.pushNotificationToken})}savePushNotificationAzureId(A){return E(this,void 0,void 0,function*(){this.state.pushNotificationTokenAzureId=A,yield this.saveToPersistent()})}getPushNotificationAzureId(){return E(this,void 0,void 0,function*(){return this.state.pushNotificationTokenAzureId})}clearAllData(){return E(this,void 0,void 0,function*(){return new Promise((A)=>{localStorage.removeItem(this.name),this._db&&!this._isDestoryingDb?(this._isDestoryingDb=!0,this._db.destroy().then(()=>{return this._createDb(this.name),this.init()}).then(()=>{this._isDestoryingDb=!1,A()})):A()})})}getLoggerTypes(){return E(this,void 0,void 0,function*(){return this.state.loggerTypes})}saveLoggerTypes(A){return E(this,void 0,void 0,function*(){return this.state.loggerTypes=A,yield this.saveToPersistent()})}deleteLoggerTypes(){return E(this,void 0,void 0,function*(){return delete this.state.loggerTypes,yield this.saveToPersistent()})}getStateSnapshot(){return this.state}getTheme(){return E(this,void 0,void 0,function*(){return this.state.theme||''})}saveTheme(A){return E(this,void 0,void 0,function*(){return this.state.theme=A,yield this.saveToPersistent()})}getFromPersistent(){return E(this,void 0,void 0,function*(){if(this._db)try{return yield this._db.get(this.name)}catch(A){const M=this.generateInitialState(),N=yield this._db.put(M);return M._rev=N.rev,M}else{localStorage.getItem(this.name)?JSON.parse(localStorage.getItem(this.name)):this.generateInitialState()}})}saveToPersistent(){return E(this,void 0,void 0,function*(){clearTimeout(this._saveDebouncer),this._saveDebouncer=setTimeout(()=>{this._db?this._saveToPersistentQueue=this._saveToPersistentQueue.then(()=>E(this,void 0,void 0,function*(){try{const A=yield this._db.put(this.state);this.state._rev=A.rev,this.logger.shouldLog(I.LoggerTypes.DataStorage)&&this.logger.log(I.LoggerTypes.DataStorage,'\uD83D\uDCBE %cSTATE UPDATED:','color: #606; font-weight: bold;',{state:Object.assign({},this.state)})}catch(A){throw new Error(A)}})):(localStorage[this.name]=JSON.stringify(this.state),this.logger.shouldLog(I.LoggerTypes.DataStorage)&&this.logger.log(I.LoggerTypes.DataStorage,'\uD83D\uDCBE %cSTATE UPDATED:','color: #606; font-weight: bold;',{state:Object.assign({},this.state)}))},150)})}_createDb(A){window.PouchDB?(this.logger.log(I.LoggerTypes.DataStorage,`💾 %cUSING POUCHDB: %c${A}`,'color: #606; font-weight: bold;','color: #999; font-weight: normal;'),this._db=new window.PouchDB(`${A}`,{revs_limit:1})):this.logger.log(I.LoggerTypes.DataStorage,'\uD83D\uDCBE %cCANNOT FIND POUCHDB, USING LOCAL STORAGE INSTEAD','color: #606; font-weight: bold;')}}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(2);class I extends E.CTLayerComponent{}f.CTILComponent=I},function(u,f,h){'use strict';var E=this&&this.__awaiter||function($,Y,G,J){return new(G||(G=Promise))(function(W,X){function K(ee){try{Z(J.next(ee))}catch(te){X(te)}}function Q(ee){try{Z(J['throw'](ee))}catch(te){X(te)}}function Z(ee){ee.done?W(ee.value):new G(function(te){te(ee.value)}).then(K,Q)}Z((J=J.apply($,Y||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(18),R=h(13),A=h(59),M=h(1),N=h(8),D=h(35),B=h(0),H=h(3);class z extends A.BaseComms{constructor($,Y,G,J,W){super($,Y,G,J),this.user=null,this._postLoginTimeout=null,this._mamFetchInProgress=!1,this._mamQueryInProgress=!1,this._disconnectedDuringMamFetch=!1,this._shouldClearData=!1,this._incidentLayer=W,this._setupHandlers()}joinIncidentRoom($,Y){return E(this,void 0,void 0,function*(){if(!this.xmppConfig||!this.xmppConfig.room)throw new Error('No room configured in XmppConfig');this.triggerFetchingMissedMessagesState(!0);const G=yield this.client.getLastArchiveIdForRoom(this.xmppConfig.room.name);yield this.joinRoom(),'function'==typeof $&&(yield $()),yield this._getMissedMessagesFromMam(G),'function'==typeof Y&&(yield Y())})}setRole($,Y){return E(this,void 0,void 0,function*(){$?this._updateUserRole($.id,Y):this._clearUserRole()})}leaveRole(){return E(this,void 0,void 0,function*(){this._clearUserRole()})}login($,Y,G=!1){const J=(W)=>super[W];return E(this,void 0,void 0,function*(){let W;this._incidentLayer.showWaitingMessage('Authenticating...'),this._incidentLayer.enableSuppressMode('incident/comms#login');try{let X=Y;!0===this._incidentLayer.config.xmpp.user.sendAppIdentifier&&(X=`app_id~${this._incidentLayer.config.appIdentifier}~${Y}`),W=yield J('login').call(this,$,X,G)}catch(X){throw this._handleLoginFailure(!0,!1,X.msg),X}try{return yield this._postLogin(),W}catch(X){throw this._handleLoginFailure(!1,!0,X),X}})}logout($=!1,Y=!0){const G=(J)=>super[J];return E(this,void 0,void 0,function*(){if(this._incidentLayer.showWaitingMessage('Logging out...'),this.user&&this.user.role){this.logger.log(R.LoggerTypes.Connectivity,`%c✋ LOGGING OUT: REMOVE FROM ROLE FIRST > %c${this.user.role.id}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;');const J=new D.RemoveFromRoleHandler(this._incidentLayer);yield J.handleEvent(B.IncidentEvents._Request_LeaveRole,null)}else yield this.leaveRoom(),this.user=null,this._loggedIn=!1,this._incidentLayer.dismissWaitingMessage(),yield G('logout').call(this,$,Y)})}setConnectionStatus($){this._updateUserConnectionStatus($),super.setConnectionStatus($)}initializeFirstConnection(){const $=(Y)=>super[Y];return E(this,void 0,void 0,function*(){$('initializeFirstConnection').call(this),this.client.addExcludeStanzaFilter((Y)=>{const G=Y.message&&Y.message.event&&Y.message.event.items&&Y.message.event.items.item&&Y.message.event.items.item.message;return G&&G.data&&this._shouldIgnoreMessage(Y.message.event.items.item.message,!1)})})}embelishUser($,Y,G,J){return E(this,void 0,void 0,function*(){let W=null;if(!(Y===void 0))G&&G===M.UserAdditionalDetailsType.VCard?W=Y:G&&G===M.UserAdditionalDetailsType.Contact&&(W=Y.vCard);else if($.username!==this.client.username){const oe=yield this.client.getContactByJid($.jid);oe&&oe.vCard&&(W=oe.vCard)}const X=!0!==this._incidentLayer.config.isBroadcaster,K=X&&!J?null:yield this._incidentLayer.getUserRoleInfo($),Q=X&&!J?null:yield this._incidentLayer.getUserLastSeen($),Z=W&&W.name&&W.name.prefix||'',ee=W&&W.name&&W.name.given||'',te=W&&W.name&&W.name.family||'',ne=W&&W.fullName||`${Z} ${ee} ${te}`.trim()||$.username,se=W&&W.telephone&&0<W.telephone.length&&W.telephone[0]&&W.telephone[0].number||null;return Object.assign({},$,{prefix:Z,firstName:ee,lastName:te,displayName:ne,telephone:se,lastSeenDate:Q,isOnCall:null!==K,cameOnCall:K&&K.cameOnCall||null,role:K&&K.role||null})})}_setupHandlers(){this.onStatusUpdate(($)=>{!0===this._mamQueryInProgress&&$===M.ConnectionStatus.Disconnected&&(this._incidentLayer.showWaitingMessage('Disconnection during update.<br />Attempting to reconnect...'),this._mamFetchInProgress=!1,this._mamQueryInProgress=!1,this._disconnectedDuringMamFetch=!0)}),this.client.addEventListener(I.CtXmppClient.EVENT_TYPES.AUTO_RECONNECTED,($)=>E(this,void 0,void 0,function*(){const Y=!0===this._loggedIn,G=!0===$.resumed;if(!1==Y){if(this.xmppConfig.user.id&&this.xmppConfig.user.password)return;try{yield this._postLogin()}catch(J){this._handleLoginFailure(!1,!0,J)}}else if(this._disconnectedDuringMamFetch||!G){if(!this.xmppConfig||!this.xmppConfig.room)throw new Error('No room configured in XmppConfig');const J=!0===this._incidentLayer.config.isBroadcaster,W=J||this.user&&!!this.user.role;if(W){this.triggerFetchingMissedMessagesState(!0),this._disconnectedDuringMamFetch&&(yield this._incidentLayer.clearAllData(!0));const X=yield this.client.getLastArchiveIdForRoom(this.xmppConfig.room.name),K=(yield this.client.status)===M.ConnectionStatus.Disconnected;K?this.logger.log(R.LoggerTypes.Connectivity,'Not Fetching from MAM, as disconnected.'):yield this._getMissedMessagesFromMam(X)}}})),this.client.addEventListener(I.CtXmppClient.EVENT_TYPES.AUTO_DBS_DESTROYED,()=>E(this,void 0,void 0,function*(){this._shouldClearData=!0}))}_postLogin(){return E(this,void 0,void 0,function*(){return this.username?new Promise(($,Y)=>E(this,void 0,void 0,function*(){clearTimeout(this._postLoginTimeout),this._postLoginTimeout=null;const G=this.xmppConfig.loginTimeout||1e4;this._postLoginTimeout=setTimeout(()=>{clearTimeout(this._postLoginTimeout),this._postLoginTimeout=null,this.logger.log(R.LoggerTypes.Connectivity,'%c\uD83D\uDEAB SYNCING WITH SERVER TIMED OUT','color: #600; font-weight: bold;'),Y(new Error(`Syncing with the server took longer than expected. Please check your connectivity and log in again.`))},G),this._incidentLayer.showWaitingMessage('Syncing with server...'),this._shouldClearData&&(this.logger.log(R.LoggerTypes.CleanUp,`%c🗑 DELETING DATA FOR FRESH USER`,'color: #669; font-weight: bold;'),yield this._incidentLayer.store.clearIncidentData(),this._shouldClearData=!1);const J=!0!==this._incidentLayer.config.isBroadcaster;J||(yield this._incidentLayer.updateAllStateFromBot(!0,!0)),this.user=yield this.buildCurrentUser(this.username),yield this._purgeOldIncidentsAndMessages(),yield this._updateOnCallUserDetails(),this.client.resumeTimers(),this._incidentLayer.cancelSuppressMode('incident/comms#login'),this._incidentLayer.dismissWaitingMessage();null==this._postLoginTimeout||(clearTimeout(this._postLoginTimeout),this._loggedIn=!0,this.logger.log(R.LoggerTypes.Connectivity,`%c💻 LOGIN COMPLETE > %c${this.username}`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;'),this.triggerLoginEvent(!0),$())})):Promise.reject(new Error('Error in post-login: no username specified'))})}_handleLoginFailure($,Y,G){const J=(W)=>super[W];return E(this,void 0,void 0,function*(){!0===$&&this.triggerLoginEvent(!1,G),!0===Y&&(this._incidentLayer.error('Error during sync','There was an error whilst syncing with the server. Please try logging in again.'),yield J('logout').call(this,!0,!0)),this._incidentLayer.cancelSuppressMode('incident/comms#login'),this._incidentLayer.dismissWaitingMessage(),this._loggedIn=!1,this.user=null})}_purgeOldIncidentsAndMessages(){return E(this,void 0,void 0,function*(){if(0<this.xmppConfig.maxMessageAge){yield this.client.purgeMessagesOlderThan(this.xmppConfig.maxMessageAge);const $=this.getSyncedTimestamp()-this.xmppConfig.maxMessageAge;yield this._incidentLayer.store.purgeIncidentsOlderThanDate($),yield this._incidentLayer.store.purgeReportsOlderThanDate($)}})}_updateOnCallUserDetails(){return E(this,void 0,void 0,function*(){const $=yield this._incidentLayer.getOnCallUsers(),Y=$.map((G)=>this.updateVCardForUser(G.jid));yield Promise.all(Y)})}_getMissedMessagesFromMam($){return E(this,void 0,void 0,function*(){if(!0===this._mamFetchInProgress)return void this.logger.log(R.LoggerTypes.Mam,`%c🚫 MAM FETCHING ALREADY IN PROGRESS: SKIPPING MAM CHECK`,'color: #669; font-weight: bold;');if(this.xmppConfig.mam&&!1===this.xmppConfig.mam.enabled)return this.triggerFetchingMissedMessagesState(!1),void this.logger.log(R.LoggerTypes.Mam,`%c🚫 MAM DISABLED: SKIPPING MAM CHECK`,'color: #669; font-weight: bold;');this._mamFetchInProgress=!0,this.logger.log(R.LoggerTypes.Mam,`%c📬 QUERYING MAM FOR MISSED MESSAGE(S) SINCE:`,'color: #669; font-weight: bold;',$);try{this._mamQueryInProgress=!0,this._disconnectedDuringMamFetch=!1;const Y=Date.now(),G=yield this.client.queryMamByRoomName(this.xmppConfig.room.name,!1,$),J=Date.now();if(this._mamQueryInProgress=!1,this.logger.log(R.LoggerTypes.Mam,`%c📬 QUERYING MAM TOOK ${J-Y}ms`,'color: #669; font-weight: bold;'),this.logger.log(R.LoggerTypes.Mam,`%c📬 FOUND ${G.length} MISSED MESSAGE(S) IN THE MAM`,'color: #669; font-weight: bold;'),0<G.length){const W=[],X=[];G.forEach((K)=>{if(!K||!K.data)return void W.push(K);const Q=H.getMessageType(K.data);if(!Q)return void W.push(K);const Z=K.data[Q]&&JSON.parse(K.data[Q]);this._shouldIgnoreMessage(K,!0)?X.push({[Q]:Z}):(this.logger.shouldLog(R.LoggerTypes.Mam)&&this.logger.log(R.LoggerTypes.Mam,`%c📭 DISPATCHING MAM MESSAGE:%c`,'color: #669; font-weight: bold;','color: #999; font-weight: normal;',{[Q]:Z}),K.isFromMam=!0,this.client._dispatchEvent(I.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,K))}),this.logger.log(R.LoggerTypes.Mam,`%c📭 ${G.length-X.length-W.length} MAM MESSAGE(S) DISPATCHED`,'color: #669; font-weight: bold;'),0<X.length&&this.logger.log(R.LoggerTypes.Mam,`%c📭 ${X.length} MAM MESSAGE(S) IGNORED DUE TO STANZA EXCLUSION RULES`,'color: #669; font-weight: bold;',X),0<W.length&&this.logger.error(R.LoggerTypes.Mam,`%c🚫 ${W.length} INVALID MAM MESSAGE(S) IGNORED`,'color: #C00; font-weight: bold;',W),setTimeout(()=>{this.triggerFetchingMissedMessagesState(!1),this._mamFetchInProgress=!1},100)}else this.triggerFetchingMissedMessagesState(!1),this._mamFetchInProgress=!1}catch(Y){this.logger.error(R.LoggerTypes.Mam,`%c🚫 ERROR DURING MAM FETCH`,'color: #C00; font-weight: bold;',Y),this._incidentLayer.error('ERROR DURING UPDATE',`<p>An error occured whilst updating:</p><p>${Y.message}</p>`)}})}_shouldIgnoreMessage($,Y){const G=!0===this._incidentLayer.config.isBroadcaster,J=!0!==this._incidentLayer.config.isBroadcaster,W=this._incidentLayer.config.reporting&&!0===this._incidentLayer.config.reporting.enabled;if($&&$.data){const X=H.getMessageType($.data),K=JSON.parse($.data[X]||'null');if(!K)return!0;if(G){const Q=[N.IncidentMessageType.AcknowledgeIncidentUpdate];if(Y&&(Q.push(N.IncidentMessageType.HelloFromBot),Q.push(N.IncidentMessageType.SetRole),Q.push(N.IncidentMessageType.RemoveFromRole)),Q.includes(X))return!0}if(J){const Q=[];if(Y&&(Q.push(N.IncidentMessageType.HelloFromBot),Q.push(N.IncidentMessageType.SetRole)),Q.includes(X))return!0;const Z=[N.IncidentMessageType.AcknowledgeIncidentUpdate];if(Z.includes(X)&&!this._isOwnMessage(K))return!0;if(X===N.IncidentMessageType.RemoveFromRole){const ee=K.removeuserjid;if(ee&&ee!==this.user.jid)return!0}}if(!W){const Q=[N.IncidentMessageType.RequestReport,N.IncidentMessageType.ReportReady,N.IncidentMessageType.ReportFailed];if(Q.includes(X))return!0}}return!1}_isOwnMessage($){return!!this.user&&!!$.senderjid&&this.user.jid===$.senderjid}_updateUserRole($,Y){if(this.user){const G=this._incidentLayer.config.roles.find((J)=>J.id===$);G?(this.user.role=G,this.user.isOnCall=!0,null===this.user.cameOnCall&&(this.user.cameOnCall=Y)):this._clearUserRole()}}_clearUserRole(){this.user&&(this.user.role=null,this.user.isOnCall=null,this.user.cameOnCall=null)}_updateUserConnectionStatus($){this.user&&(this.user.connectionStatus=$)}}f.Comms=z},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(12);class I extends E.BaseIncidentEventArgs{constructor(R,A){super(R),this.severityChange=A}}f.ChangeIncidentSeverityEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(12);class I extends E.BaseIncidentEventArgs{constructor(R,A,M,N){super(R),this.responderJid=A,this.state=M,this.changeType=N}}f.ChangeResponderStateEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(12);class I extends E.BaseIncidentEventArgs{constructor(R,A,M,N){super(R),this.collectionId=A,this.state=M,this.changeType=N}}f.ChangeResponseCollectionStateEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(12);class I extends E.BaseIncidentEventArgs{constructor(R,A){super(R),this.reason=A}}f.CloseIncidentEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R,A,M,N=!1){super(),this.type=R,this.startDate=A,this.endDate=M,this.notify=N}}f.GenerateReportEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(0);class I extends E.IncidentEventArgs{constructor(R,A){super(R),this.response=A}}f.IncidentAlertEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R,A){super(),this.oldIncident=R,this.newIncident=A}}f.IncidentChangeEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(12);class I extends E.BaseIncidentEventArgs{constructor(R){super(R.id),this.incident=R}}f.IncidentEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R,A){super(),this.incident=R,this.response=A}}f.IncidentResponseEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(12);class I extends E.BaseIncidentEventArgs{constructor(R,A=null){super(R),this.response=A}}f.NewIncidentMessageReceievedEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R,A,M,N,D){super(),this.priority=R,this.severity=A,this.patientType=M,this.location=N,this.isTestIncident=D}}f.RaiseNewIncidentEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(0);class I extends E.ReportEventArgs{constructor(R,A){super(A),this.filePath=R}}f.ReportDownloadEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R){super(),this.report=R}}f.ReportEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R){super(),this.predefinedIncidentData=R}}f.RequestNewIncidentEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(12);class I extends E.BaseIncidentEventArgs{constructor(R,A,M=0,N=!1){super(R),this.responseStatus=A,this.eta=M,this.autoResponse=N}}f.RespondedToIncidentEventArgs=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(6);class I extends E.BaseEventArgs{constructor(R,A){super(),this.role=R,this.completionEventId=A}}f.RoleSelectionEventArgs=I},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(N,D,B,H){return new(B||(B=Promise))(function(z,$){function Y(W){try{J(H.next(W))}catch(X){$(X)}}function G(W){try{J(H['throw'](W))}catch(X){$(X)}}function J(W){W.done?z(W.value):new B(function(X){X(W.value)}).then(Y,G)}J((H=H.apply(N,D||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(8),R=h(9),A=h(0);class M extends R.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=I.IncidentMessageType.AcknowledgeIncidentUpdate,this.eventType=[A.IncidentEvents._Request_AcknowledgeIncidentUpdate]}createBotMessage(N){return{incidentid:N.incidentId}}handleMessage(N){return E(this,void 0,void 0,function*(){const D=N.data[this.messageKey],B=this.layer.getCurrentUser();B&&D.senderjid===B.jid&&(yield this.layer.store.removePendingAlert(D.incidentid),this.layer.emit(A.IncidentEvents.IncidentAlertChange))})}handleEvent(N,D){return E(this,void 0,void 0,function*(){if(N===A.IncidentEvents._Request_AcknowledgeIncidentUpdate){const H={incidentId:D.incidentId};yield this.layer.sendMessageViaBot(I.IncidentMessageType.AcknowledgeIncidentUpdate,H)}})}}f.AcknowledgeIncidentUpdateHandler=M},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(8),A=h(9),M=h(7),N=h(0),D=h(11),B=h(3);class H extends A.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=R.IncidentMessageType.ChangeIncidentSeverity,this.eventType=[N.IncidentEvents._Request_ChangeIncidentSeverity]}createBotMessage(z){if(!z.severityChange)throw new Error(`No severity change specified in: ${JSON.stringify(z)}`);const Y=this.layer.config.severities.find((G)=>G.id===z.severityChange.severityId);if(!Y)throw new Error(`No severity could be found with id: "${z.severityChange.severityId}"`);return{incidentid:z.incidentId,severityid:Y.id,severitylabel:Y.name,severitychangeid:z.severityChange.id,severitychangename:z.severityChange.name}}handleFailedBotResponse(z,$){return E(this,void 0,void 0,function*(){return new Promise((Y)=>{if('incident_update_denied'===$.data.reason){const G=$.data.reasonMessage||'Incident update denied.';this.layer.emit(N.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton('Cannot update Incident',G,1)),Y(!1)}})})}handleMessage(z){return E(this,void 0,void 0,function*(){const $=z.data[this.messageKey],Y=yield this._changeIncidentSeverity($.incidentid,$.severityid,$.severitychangeid,$.senderjid,$.sendername,z.ts),G=this.layer.getCurrentUser();if(G&&!1===this.layer.config.isBroadcaster){const J=this.layer.getSyncedTimestamp();this._shouldAddAsPendingAlert(G,Y,J)&&(yield this.layer.store.addPendingAlert(Y.id),this.layer.emit(N.IncidentEvents.IncidentAlertChange))}})}handleEvent(z,$){return E(this,void 0,void 0,function*(){if(z===N.IncidentEvents._Request_ChangeIncidentSeverity){const Y=$,G={incidentId:Y.incidentId,severityChange:Y.severityChange};yield this.layer.sendMessageViaBot(R.IncidentMessageType.ChangeIncidentSeverity,G)}})}_changeIncidentSeverity(z,$,Y,G,J,W){return E(this,void 0,void 0,function*(){const X=yield this.layer.getIncidentById(z);if(!X)return null;const K=X.severity;if(!K)return null;if(K.id===$)return X;const Q=(K.changes||[]).find((ne)=>ne.id===Y);if(!Q)throw new Error(`No severity change could be found with id: ${Y} (current severity id: ${K.id})`);const Z=this.layer.config.severities.find((ne)=>ne.id===Q.severityId);if(!Z)throw new Error(`No severity could be found with id: ${Q.severityId}`);const ee=B.deepCloneObject(X),te={action:M.IncidentAction.ChangeSeverity,jid:G,name:J,date:W,reference:Y,data:Q.label||Q.name};return X.severity=Z,X.actions.push(te),yield this.layer.store.updateIncident(X),this.layer.emit(N.IncidentEvents.IncidentUpdated,new N.IncidentEventArgs(X)),this.layer.emit(N.IncidentEvents.IncidentSeverityChanged,new N.IncidentChangeEventArgs(ee,X)),X})}_shouldAddAsPendingAlert(z,$,Y){return!!$&&!(!0!==z.isOnCall)&&(z.cameOnCall>$.opened.date&&!D.userHasResponded($,z.jid)?!1:!this._incidentHasExpired($,Y))}_incidentHasExpired(z,$){return 0<z.expirationDate&&$>=z.expirationDate}_userRespondedUnable(z,$){const Y=D.findUserResponse(z,$.jid,$.role&&$.role.id);return Y&&Y.status===M.ResponseStatus.Unable}}f.ChangeIncidentSeverityHandler=H},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(8),A=h(9),M=h(0),N=h(11),D=h(3);class B extends A.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=R.IncidentMessageType.ChangeResponderState,this.eventType=[M.IncidentEvents._Request_ChangeResponderState]}createBotMessage(H){return{incidentid:H.incidentId,responderjid:H.responderJid,state:H.state.toString(),changetype:H.changeType.toString()}}handleFailedBotResponse(H,z){return E(this,void 0,void 0,function*(){return new Promise(($)=>{if('incident_update_denied'===z.data.reason){const Y=z.data.reasonMessage||'Incident update denied.';this.layer.emit(M.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton('Cannot update Incident',Y,1)),$(!1)}})})}handleMessage(H){return E(this,void 0,void 0,function*(){const z=H.data[this.messageKey],$=D.enumFromString(z.state),Y=D.enumFromString(z.changetype);null!==$&&null!==Y&&(yield this._triggerResponderStateChange(z.incidentid,z.responderjid,$,Y,z.senderjid,z.sendername,H.ts))})}handleEvent(H,z){return E(this,void 0,void 0,function*(){if(H===M.IncidentEvents._Request_ChangeResponderState){const $=z,Y={incidentId:$.incidentId,responderJid:$.responderJid,state:$.state,changeType:$.changeType};yield this.layer.sendMessageViaBot(R.IncidentMessageType.ChangeResponderState,Y)}})}_triggerResponderStateChange(H,z,$,Y,G,J,W){return E(this,void 0,void 0,function*(){const X=yield this.layer.getIncidentById(H);if(X){const K=N.findUserResponseCollection(X,z);K&&(N.processResponderStateChange(X,z,$,null,Y,G,J,W),N.aggregateResponseCollectionInformation(K),yield this.layer.store.updateIncident(X),this.layer.emit(M.IncidentEvents.IncidentUpdated,new M.IncidentEventArgs(X)))}})}}f.ChangeResponderStateHandler=B},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(8),A=h(9),M=h(0),N=h(11),D=h(3);class B extends A.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=R.IncidentMessageType.ChangeResponseCollectionState,this.eventType=[M.IncidentEvents._Request_ChangeResponseCollectionState]}createBotMessage(H){return{incidentid:H.incidentId,collectionid:H.collectionId,state:H.state.toString(),changetype:H.changeType.toString()}}handleFailedBotResponse(H,z){return E(this,void 0,void 0,function*(){return new Promise(($)=>{if('incident_update_denied'===z.data.reason){const Y=z.data.reasonMessage||'Incident update denied.';this.layer.emit(M.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton('Cannot update Incident',Y,1)),$(!1)}})})}handleMessage(H){return E(this,void 0,void 0,function*(){const z=H.data[this.messageKey],$=D.enumFromString(z.state),Y=D.enumFromString(z.changetype);null!==$&&null!==Y&&(yield this._triggerResponseCollectionStateChange(z.incidentid,z.collectionid,$,Y,z.senderjid,z.sendername,H.ts))})}handleEvent(H,z){return E(this,void 0,void 0,function*(){if(H===M.IncidentEvents._Request_ChangeResponseCollectionState){const $=z,Y={incidentId:$.incidentId,collectionId:$.collectionId,state:$.state,changeType:$.changeType};yield this.layer.sendMessageViaBot(R.IncidentMessageType.ChangeResponseCollectionState,Y)}})}_triggerResponseCollectionStateChange(H,z,$,Y,G,J,W){return E(this,void 0,void 0,function*(){const X=yield this.layer.getIncidentById(H);if(X){const K=X.responses.find((Q)=>Q.id===z);K&&(N.processResponseCollectionStateChange(K,$,null,Y,G,J,W),yield this.layer.store.updateIncident(X),this.layer.emit(M.IncidentEvents.IncidentUpdated,new M.IncidentEventArgs(X)))}})}}f.ChangeResponseCollectionStateHandler=B},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(8),R=h(9),A=h(7),M=h(0),N=h(11);class D extends R.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=I.IncidentMessageType.CloseIncident,this.eventType=[M.IncidentEvents._Request_CloseIncident]}createBotMessage(B){if(!B.reason)throw new Error(`No reason specified in: ${JSON.stringify(B)}`);return{incidentid:B.incidentId,reasonid:B.reason.id.toString(),reasonlabel:B.reason.label}}handleMessage(B){return E(this,void 0,void 0,function*(){const H=B.data[this.messageKey],z=this.layer.config.closeReasons.find((G)=>G.id===H.reasonid);if(!z)throw new Error(`No close reason could be found with the id: ${H.reasonid}`);const $=yield this.layer.getIncidentById(H.incidentid);if(!$)return null;yield this._closeIncident($,H.senderjid,H.sendername,B.ts,z);const Y=this.layer.getCurrentUser();if(Y&&!1===this.layer.config.isBroadcaster){const G=this.layer.getSyncedTimestamp();this._shouldAddAsPendingAlert(z,Y,$,G)&&(yield this.layer.store.addPendingAlert($.id),this.layer.emit(M.IncidentEvents.IncidentAlertChange))}})}handleEvent(B,H){return E(this,void 0,void 0,function*(){if(B===M.IncidentEvents._Request_CloseIncident){const z=H,$=this.layer.getCurrentUser();try{const Y={incidentId:z.incidentId,reason:z.reason};yield this.layer.sendMessageViaBot(I.IncidentMessageType.CloseIncident,Y)}catch(Y){this.layer.error('Error closing incident',Y)}}})}_closeIncident(B,H,z,$,Y){return E(this,void 0,void 0,function*(){return B.status=A.IncidentStatus.Closed,B.closed={jid:H,name:z,date:$},B.closedReasonId=Y.id,yield this.layer.store.updateIncident(B),this.layer.emit(M.IncidentEvents.IncidentClosed,new M.IncidentEventArgs(B)),Y.notifyResponders||(yield this.layer.store.removePendingAlert(B.id),this.layer.emit(M.IncidentEvents.IncidentAlertChange)),B})}_shouldAddAsPendingAlert(B,H,z){return!!z&&!(!0!==B.notifyResponders)&&!1!==H.isOnCall&&(H.cameOnCall>z.opened.date&&!N.userHasResponded(z,H.jid)?!1:!B.includeUnableResponders&&this._userRespondedUnable(z,H)?!1:!0)}_incidentHasExpired(B,H){return 0<B.expirationDate&&H>=B.expirationDate}_userRespondedUnable(B,H){const z=N.findUserResponse(B,H.jid,H.role&&H.role.id);return z&&z.status===A.ResponseStatus.Unable}}f.CloseIncidentHandler=D},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(N,D,B,H){return new(B||(B=Promise))(function(z,$){function Y(W){try{J(H.next(W))}catch(X){$(X)}}function G(W){try{J(H['throw'](W))}catch(X){$(X)}}function J(W){W.done?z(W.value):new B(function(X){X(W.value)}).then(Y,G)}J((H=H.apply(N,D||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(6),R=h(9),A=h(0);class M extends R.BaseIncidentHandler{constructor(){super(...arguments),this.eventType=[I.BaseEvents.LoginResult,I.BaseEvents._Request_Logout]}handleEvent(N,D){return E(this,void 0,void 0,function*(){if(N===I.BaseEvents.LoginResult){const B=D;if(!B.success){const H=this.layer.getLabel('LABEL_ERROR_LOGGING_IN_TITLE')||'Error logging in',z=B.errorMessage||this.layer.getLabel('LABEL_ERROR_LOGGING_IN_MESSAGE')||'Check your connectivity and credentials and try again.';this.layer.error(H,z)}else if(this.layer.config.isBroadcaster)this.layer.comms.joinIncidentRoom(()=>E(this,void 0,void 0,function*(){this.layer.comms.leaveRole()}));else if(this.layer.config.xmpp.user&&this.layer.config.xmpp.user.roleId){const H=this.layer.config.roles.find((z)=>z.id===this.layer.config.xmpp.user.roleId);if(!H)throw new Error(`Could not automatically join with role; no role could be found with id: ${this.layer.config.xmpp.user.roleId}`);this.layer.emit(A.IncidentEvents._Request_JoinRole,new A.RoleSelectionEventArgs(H))}else{const H=this.layer.getCurrentUser();if(H&&H.role){const z=this.layer.config.roles.find(($)=>$.id===H.role.id);if(!z)throw new Error(`Could not rejoin role; no role could be found with id: ${H.role.id}`);this.layer.emit(A.IncidentEvents._Request_JoinRole,new A.RoleSelectionEventArgs(z))}}}if(N===I.BaseEvents._Request_Logout)try{yield this.layer.comms.logout()}catch(B){this.layer.error('Error logging out',B)}})}}f.CommsConnectionHandler=M},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(D,B,H,z){return new(H||(H=Promise))(function($,Y){function G(X){try{W(z.next(X))}catch(K){Y(K)}}function J(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(G,J)}W((z=z.apply(D,B||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(6),R=h(1),A=h(8),M=h(9);class N extends M.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=A.IncidentMessageType.HelloFromBot}createBotMessage(){throw new Error('HelloFromBot message is only meant to be issued by the bot')}handleMessage(D){return E(this,void 0,void 0,function*(){const B=D.data[this.messageKey];this.layer.emit(I.BaseEvents._Request_RaiseAlert,R.DefaultAlerts.AlertAcknowledge('Incidents v'+this.layer.VERSION,B.message))})}}f.HelloFromBotHandler=N},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(9),A=h(8),M=h(7),N=h(0),D=h(11),B=h(34);class H extends R.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=A.IncidentMessageType.NewIncident}createBotMessage(z,$){const Y={id:z.id,priorityid:z.priority.id,prioritylabel:z.priority.name,severityid:z.severity.id,severitylabel:z.severity.name,patienttypeid:z.patientType&&z.patientType.id||'',patienttypelabel:z.patientType&&z.patientType.name||'',locationid:z.location&&z.location.id||'',locationlabel:z.location&&z.location.name||'',responders:JSON.stringify(z.responders),expiresin:z.expiresIn,istest:z.isTestIncident};return $&&'confirm_replace_incident'===$.data.reason&&(Y.confirmreplace=!0,Y.confirmreplaceincidentid=$.data.currentincidentid),Y}handleFailedBotResponse(z,$){return E(this,void 0,void 0,function*(){return new Promise((Y)=>{if('confirm_create_incident'===$.data.reason){const G=$.data.reasonMessage||'There is currently an incident in progress. Do you still wish to raise a new incident?';this.layer.emit(N.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertYesNoQuestion('Raise New Incident?',G,1,{yes:()=>{Y(!0)},no:()=>{Y(!1)}}))}else if('confirm_replace_incident'===$.data.reason){const G=$.data.reasonMessage||'There is currently an incident in progress. Do you wish to replace it with this new incident?';this.layer.emit(N.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertYesNoQuestion('Raise New Incident?',G,1,{yes:()=>{Y(!0)},no:()=>{Y(!1)}}))}else if('incident_exists'===$.data.reason){const G=$.data.reasonMessage||'There is currently an incident in progress. You cannot raise this incident at this time.';this.layer.emit(N.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton('Raise New Incident',G,1)),Y(!1)}else if('incident_replacement_rejected'===$.data.reason){const G=$.data.reasonMessage||'Unable to raise new incident, a different incident has already been opened.';this.layer.emit(N.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton('Raise New Incident',G,1)),Y(!1)}else Y(!1)})})}handleMessage(z){return E(this,void 0,void 0,function*(){const $=z.data[this.messageKey],Y=yield this.layer.getIncidentById($.id);if(!Y){const G=$.senderjid,J=$.sendername,W=this.layer.config.severities.find((se)=>se.id===$.severityid),X=this.layer.config.priorities.find((se)=>se.id===$.priorityid),K=$.patienttypeid&&this.layer.config.patientTypes.find((se)=>se.id===$.patienttypeid)||null,Q=$.locationid&&this.layer.config.locations.find((se)=>se.id===$.locationid)||null,Z=$.expiresin,ee=$.responders&&JSON.parse($.responders)||null,te=D.generateNewIncident($.id,G,J,z.ts,X,W,K,Q,Z,ee,$.istest,this.layer);yield this.layer.store.addIncident(te),this.layer.emit(N.IncidentEvents.NewIncident,new N.IncidentEventArgs(te));const ne=this.layer.getCurrentUser();if(ne&&!1===this.layer.config.isBroadcaster){const se=this.layer.getSyncedTimestamp();this._shouldSendReceievedResponse(z,ne,te,se)&&(yield this._sendReceivedResponse(te)),this._shouldAddAsPendingAlert(ne,te,se)&&(yield this.layer.store.addPendingAlert(te.id),this.layer.emit(N.IncidentEvents.IncidentAlertChange))}}})}_shouldSendReceievedResponse(z,$,Y,G){if(Y.status===M.IncidentStatus.Closed)return!1;if(this.layer.config.behaviour.onCallRespondersOnly){if(!1===$.isOnCall)return!1;if($.cameOnCall>Y.opened.date)return!1}return!this._incidentHasExpired(Y,G)&&!this._userAlreadyReceieved(z,$)}_shouldAddAsPendingAlert(z,$,Y){if($.status===M.IncidentStatus.Closed)return!1;if(this.layer.config.behaviour.onCallRespondersOnly){if(!1===z.isOnCall)return!1;if(z.cameOnCall>$.opened.date)return!1}return!this._incidentHasExpired($,Y)}_incidentHasExpired(z,$){return 0<z.expirationDate&&$>=z.expirationDate}_userAlreadyReceieved(z,$){return z.state.markers.some((Y)=>Y.sender_resource===$.username)}_sendReceivedResponse(z){return E(this,void 0,void 0,function*(){const $=new B.IncidentResponseHandler(this.layer);yield $.handleEvent(N.IncidentEvents._Request_RespondToIncident,new N.RespondedToIncidentEventArgs(z.id,M.ResponseStatus.Received,0,!0))})}}f.NewIncidentHandler=H},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(9),A=h(8),M=h(0),N=h(11);class D extends R.BaseIncidentHandler{constructor(){super(...arguments),this.eventType=[M.IncidentEvents._Request_NewIncident,M.IncidentEvents._Request_RaiseNewIncident]}handleEvent(B,H){return E(this,void 0,void 0,function*(){if(B===M.IncidentEvents._Request_NewIncident){const z=H;this.layer.getConnectionStatus()===I.ConnectionStatus.Connected?this._checkCanRequestIncident(z.predefinedIncidentData).then(($)=>{$&&(z.predefinedIncidentData?this._raisePredefinedIncident(z.predefinedIncidentData):this.layer.emit(M.IncidentEvents._Request_LaunchNewIncidentModal))}):this.layer.emit(M.IncidentEvents._Request_LaunchOfflineModal)}if(B===M.IncidentEvents._Request_RaiseNewIncident){const z=H;try{const $=this.layer.config.behaviour.incidentExpiration||0;let Y=[];if(!0===this.layer.config.behaviour.prePopulateResponseCollections){const J=this.layer.config.roles,W=!0===this.layer.config.behaviour.onCallRespondersOnly?yield this.layer.getOnCallUsers():[];Y=N.generatePrePopulatedResponders(J,W)}const G={id:this.layer.getUniqueCommsId(),priority:z.priority,severity:z.severity,patientType:z.patientType,location:z.location,expiresIn:$,responders:Y,isTestIncident:z.isTestIncident};yield this.layer.sendMessageViaBot(A.IncidentMessageType.NewIncident,G)}catch($){this.layer.error('Error raising incident',$)}}})}_checkCanRequestIncident(B){return E(this,void 0,void 0,function*(){return new Promise((H)=>E(this,void 0,void 0,function*(){const z=yield this.layer.sendBotCommand(A.IncidentBotCommands.CanRequestIncident,{predefinedIncidentId:B&&B.id||null});if(z.success)H(!0);else if('confirm'===z.data.reason){const $=I.DefaultAlerts.AlertQuestion('Raise New Incident?',z.data.reasonMessage,1,[{text:'No',type:'primary',action:()=>{H(!1)}},{text:'Yes, Raise Incident',type:'primary',action:()=>{H(!0)}}],'');this.layer.emit(M.IncidentEvents._Request_RaiseAlert,$)}else{const $=I.DefaultAlerts.AlertErrorWithOkayButton('Raise New Incident',z.data.reasonMessage);this.layer.emit(M.IncidentEvents._Request_RaiseAlert,$),H(!1)}}))})}_raisePredefinedIncident(B){const H=B.priorityId&&this.layer.config.priorities.find((W)=>W.id===B.priorityId)||null;if(!H)return void this.layer.error('Unable to raise predefined incident',`Predefined incidents must have a valid priorityId. Unable to find priority with id: ${B.priorityId}`);const z=B.severityId&&this.layer.config.severities.find((W)=>W.id===B.severityId)||null;if(!z)return void this.layer.error('Unable to raise predefined incident',`Predefined incidents must have a valid severityId. Unable to find severity with id: ${B.severityId}`);const $=B.patientTypeId&&this.layer.config.patientTypes.find((W)=>W.id===B.patientTypeId)||null,Y=B.locationId&&this.layer.config.locations.find((W)=>W.id===B.locationId)||null,G=B.isTestIncident||!1,J=B.confirmationTitle||'Raise New Incident?';if(B.confirmationMessage){const W=I.DefaultAlerts.AlertQuestion(J,B.confirmationMessage,1,[{text:'Cancel',type:'primary',action:()=>{}},{text:'Confirm',type:'primary',action:()=>{this.layer.emit(M.IncidentEvents._Request_RaiseNewIncident,new M.RaiseNewIncidentEventArgs(H,z,$,Y,G))}}],z.colorCode);this.layer.emit(M.IncidentEvents._Request_RaiseAlert,W)}else this.layer.emit(M.IncidentEvents._Request_RaiseNewIncident,new M.RaiseNewIncidentEventArgs(H,z,$,Y,G))}}f.RaiseNewIncidentHandler=D},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(D,B,H,z){return new(H||(H=Promise))(function($,Y){function G(X){try{W(z.next(X))}catch(K){Y(K)}}function J(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(G,J)}W((z=z.apply(D,B||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(8),R=h(9),A=h(7),M=h(0);class N extends R.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=I.IncidentMessageType.ReportFailed}createBotMessage(){throw new Error('ReportFailed message is only meant to be issued by the bot')}handleMessage(D){return E(this,void 0,void 0,function*(){if(!this.layer.config.reporting||!0!==this.layer.config.reporting.enabled)return;const B=D.data[this.messageKey],H=yield this.layer.getReportById(B.id);if(H){const z=this.layer.config.reporting.reportTypes.find((J)=>J.id===B.type);if(!z)throw new Error(`No report type could be found with id: "${B.type}"`);H.status=A.ReportStatus.Failed,H.requested.date=B.requested,H.type=z,H.startDate=B.startdate,H.endDate=B.enddate,H.failReason=B.reason,yield this.layer.store.updateReport(H),this.layer.emit(M.IncidentEvents.ReportFailed,new M.ReportEventArgs(H));const $=`report_alert_${H.id}`;this.layer.emit(M.IncidentEvents._Request_CloseAlert,$);const Y=H.failReason?`
                <p><strong>Error generating report:</strong></p>
                <p>${B.reason}</p>
            `:`
                <p><strong>There was an error generating the report.</strong></p>
            `,G={id:$,raisedOn:new Date().getTime(),priority:1,type:'error',title:'Generate Report',body:Y,buttons:[{text:'Okay',action:()=>{},type:'primary'}]};this.layer.emit(M.IncidentEvents._Request_RaiseAlert,G)}})}}f.ReportFailedHandler=N},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(D,B,H,z){return new(H||(H=Promise))(function($,Y){function G(X){try{W(z.next(X))}catch(K){Y(K)}}function J(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(G,J)}W((z=z.apply(D,B||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(8),R=h(9),A=h(7),M=h(0);class N extends R.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=I.IncidentMessageType.ReportReady}createBotMessage(){throw new Error('ReportReady message is only meant to be issued by the bot')}handleMessage(D){return E(this,void 0,void 0,function*(){if(!this.layer.config.reporting||!0!==this.layer.config.reporting.enabled)return;const B=D.data[this.messageKey],H=yield this.layer.getReportById(B.id);if(H){const z=this.layer.config.reporting.reportTypes.find((Y)=>Y.id===B.type);if(!z)throw new Error(`No report type could be found with id: "${B.type}"`);H.status=A.ReportStatus.Ready,H.requested.date=B.requested,H.completed=B.completed,H.type=z,H.startDate=B.startdate,H.endDate=B.enddate,H.url=B.url,yield this.layer.store.updateReport(H),this.layer.emit(M.IncidentEvents.ReportReady,new M.ReportEventArgs(H));const $=this.layer.getCurrentUser();if($&&this._shouldShowAlert(D,B,$,H)){const Y=`report_alert_${H.id}`;this.layer.emit(M.IncidentEvents._Request_CloseAlert,Y);const G={id:Y,raisedOn:new Date().getTime(),priority:1,type:'question',title:'Generate Report',body:'Your report is now available',buttons:[{text:'Download',action:()=>E(this,void 0,void 0,function*(){return yield this._downloadReport(H)}),type:'primary'},{text:'Okay',action:()=>{},type:'primary'}]};this.layer.emit(M.IncidentEvents._Request_RaiseAlert,G)}}})}_shouldShowAlert(D,B,H,z){return!(!0!==B.notify)&&!(z.requested.jid!==H.jid)&&!this._userAlreadyReceieved(D,H)}_userAlreadyReceieved(D,B){return D.state.markers.some((H)=>H.sender_resource===B.username)}_downloadReport(D){return E(this,void 0,void 0,function*(){const B=yield this.layer.downloadFile(D.url);null!==B&&this.layer.emit(M.IncidentEvents.ReportDownloaded,new M.ReportDownloadEventArgs(B,D))})}}f.ReportReadyHandler=N},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(8),A=h(9),M=h(7),N=h(0);class D extends A.BaseIncidentHandler{constructor(){super(...arguments),this.messageKey=R.IncidentMessageType.RequestReport,this.eventType=[N.IncidentEvents._Request_GenerateReport]}createBotMessage(B){return this.layer.config.reporting&&!0===this.layer.config.reporting.enabled?{id:B.id,type:B.type,startdate:B.startDate,enddate:B.endDate,notify:B.notify}:null}handleFailedBotResponse(B,H){return E(this,void 0,void 0,function*(){return new Promise((z)=>{if('report_limit_reached'===H.data.reason){this.layer.emit(N.IncidentEvents._Request_RaiseAlert,I.DefaultAlerts.AlertErrorWithOkayButton('Generate Report','Unable to generate report at this time as the limit has been reached, please try again later',1)),z(!1)}})})}handleMessage(B){return E(this,void 0,void 0,function*(){if(!this.layer.config.reporting||!0!==this.layer.config.reporting.enabled)return;const H=B.data[this.messageKey],z=yield this.layer.getReportById(H.id);if(!z){const $=this.layer.config.reporting.reportTypes.find((J)=>J.id===H.type);if(!$)throw new Error(`No report type could be found with id: "${H.type}"`);const Y={id:H.id,status:M.ReportStatus.Pending,requested:{jid:H.senderjid,name:H.sendername,date:B.ts},completed:null,type:$,startDate:H.startdate,endDate:H.enddate,url:null,failReason:null};yield this.layer.store.addReport(Y),this.layer.emit(N.IncidentEvents.ReportRequested,new N.ReportEventArgs(Y));const G=this.layer.getCurrentUser();if(G&&this._shouldShowAlert(B,H,G,Y)){const J=I.DefaultAlerts.AlertAcknowledge('Generate Report','Your report is being generated - you will be notified when it is available to download');J.id=`report_alert_${Y.id}`,this.layer.emit(N.IncidentEvents._Request_RaiseAlert,J)}}})}handleEvent(B,H){return E(this,void 0,void 0,function*(){if(this.layer.config.reporting&&!0===this.layer.config.reporting.enabled&&B===N.IncidentEvents._Request_GenerateReport){const z=H,$=this.layer.getUniqueCommsId(),Y={id:$,type:z.type,startDate:z.startDate,endDate:z.endDate,notify:z.notify||!1};yield this.layer.sendMessageViaBot(R.IncidentMessageType.RequestReport,Y)}})}_shouldShowAlert(B,H,z,$){return!(!0!==H.notify)&&!($.requested.jid!==z.jid)&&!this._userAlreadyReceieved(B,z)}_userAlreadyReceieved(B,H){return B.state.markers.some((z)=>z.sender_resource===H.username)}}f.RequestReportHandler=D},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(6),A=h(9),M=h(8),N=h(0),D=h(11);class B extends A.BaseIncidentHandler{constructor(){super(...arguments),this._completionEventMappings=new Map,this.messageKey=M.IncidentMessageType.SetRole,this.eventType=[N.IncidentEvents._Request_JoinRole]}createBotMessage(H){return{roleid:H.role.id,rolename:H.role.name}}handleFailedBotResponse(H,z){return E(this,void 0,void 0,function*(){return'invalid_role_id'===z.data.reason&&(this.layer.error('Invalid role',`Invalid role id: ${H.role.id} (${H.role.name})`),this._completionEventMappings.delete(H.role.id)),!1})}handleMessage(H){return E(this,void 0,void 0,function*(){const z=this.layer.getCurrentUser();if(!z)return;const $=H.data[this.messageKey],Y=this.layer.config.roles.find((G)=>G.id===$.roleid);if(!Y)throw new Error(`Unable to find role with id: ${$.roleid} (role name: ${$.rolename})`);if(z.jid===$.senderjid){const G=this._completionEventMappings.get($.roleid);G&&(this.layer.emit(G,new N.RoleSelectionEventArgs(Y)),this._completionEventMappings.delete($.roleid)),this.layer.emit(N.IncidentEvents.RoleSelection,new N.RoleSelectionEventArgs(Y)),yield this._showValidPendingIncidents(z,Y)}else;yield this.layer.updateAllStateFromBot(),this.layer.emit(N.IncidentEvents.UserActivity,new R.UserActivityEventArgs($.senderjid,H.ts))})}handleEvent(H,z){return E(this,void 0,void 0,function*(){if(H===N.IncidentEvents._Request_JoinRole&&!1===this.layer.config.isBroadcaster){const $=z,Y={role:$.role};let G=!1;if(!0===this.layer.config.behaviour.singleUserInRole){let J=!1;try{yield this.layer.updateRoleUserMappings(!1),J=!0}catch(W){this.layer.error('Error joining role','There was an error joining the role - the bot was unavailable. Please try again.')}if(J){const W=yield this.layer.getAllUsersRoleInfo(),X=W[$.role.id];if(X&&0<X.length){const K=W[$.role.id][0].jid;yield this.layer.comms.updateVCardForUser(K);const Q=yield this.layer.getUserByJid(K),Z=this.layer.getCurrentUser();Z.jid===Q.jid?G=!0:Q&&Q.jid!==Z.jid&&(yield this._showKickOffQuestion($.role,Z,Q))?G=!0:!Q&&(G=!0)}else G=!0}}else G=!0;G&&($.completionEventId&&this._completionEventMappings.set($.role.id,$.completionEventId),yield this.layer.comms.joinIncidentRoom(()=>E(this,void 0,void 0,function*(){yield this.layer.sendMessageViaBot(M.IncidentMessageType.SetRole,Y),yield this.layer.updateAllStateFromBot(!0);const J=this.layer.getSyncedTimestamp();this.layer.comms.setRole($.role,J)})))}})}_shouldUpdateUserRole(H,z){return H.cameOnCall&&H.cameOnCall>z?!1:!0}_showKickOffQuestion(H,z,$){const Y=this.layer.getLabel('LABEL_CONFIRM_KICK_USER_TITLE',{role:H&&H.name||'',currentUser:z.displayName,onCallUser:$.displayName})||`Replace User in Role?`,G=this.layer.getLabel('LABEL_CONFIRM_KICK_USER_MESSAGE',{role:H&&H.name||'',currentUser:z.displayName,onCallUser:$.displayName})||'Somebody is currently on call in that role. Would you like to replace them?';return new Promise((J)=>{const X=I.DefaultAlerts.AlertYesNoQuestion(Y,G,1,{yes:()=>{J(!0)},no:()=>{J(!1)}});this.layer.emit(N.IncidentEvents._Request_RaiseAlert,X)})}_showValidPendingIncidents(H,z){return E(this,void 0,void 0,function*(){const $=yield this.layer.getOpenIncidents();let Y=!1;$.forEach((G)=>E(this,void 0,void 0,function*(){const J=D.findUserResponse(G,H.jid,z.id);J&&!D.isConcludedResponse(J.status)&&(Y=!0,yield this.layer.store.addPendingAlert(G.id))})),Y&&this.layer.emit(N.IncidentEvents.IncidentAlertChange)})}}f.RoleSelectionHandler=B},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I.STATUSES={Transmitted:{viewBox:'0 0 1024 1024',paths:['M200.194 726.176l41.15-90.528c-88.918-76.354-145.344-189.53-145.344-315.648 0-98.228 34.244-188.596 91.392-259.844l-75.124-60.134c-72.734 90.508-112.268 202.196-112.268 319.978 0 136.76 53.256 265.336 149.96 362.040 15.914 15.912 32.704 30.62 50.234 44.136z','M782.656 635.646l41.148 90.53c17.534-13.516 34.322-28.224 50.234-44.136 96.704-96.704 149.962-225.28 149.962-362.040 0-117.78-39.534-229.468-112.268-319.978l-75.124 60.134c57.148 71.248 91.392 161.616 91.392 259.844 0 126.118-56.426 239.294-145.344 315.646z','M704.396 463.474l43.52 95.744c0.554-0.548 1.12-1.078 1.672-1.63 122.162-122.164 130.388-315.752 24.718-447.56l-74.942 59.99c68.292 85.186 69.97 206.494 5.032 293.456z','M274.412 557.588c0.552 0.552 1.118 1.082 1.672 1.63l43.52-95.744c-64.938-86.962-63.26-208.272 5.032-293.458l-74.942-59.99c-105.67 131.81-97.444 325.398 24.718 447.562z','M640 320c0-70.692-57.306-128-128-128-70.692 0-128 57.308-128 128 0 37.312 15.974 70.886 41.448 94.282l-277.146 609.718h105.452l58.182-128h400.128l58.182 128h105.452l-277.146-609.718c25.474-23.396 41.448-56.97 41.448-94.282zM512 455.86l83.702 184.14h-167.402l83.7-184.14zM682.972 832h-341.946l58.182-128h225.582l58.182 128z']},Received:{viewBox:'0 0 1024 1024',paths:['M736 0h-448c-52.8 0-96 43.2-96 96v832c0 52.8 43.2 96 96 96h448c52.8 0 96-43.2 96-96v-832c0-52.8-43.2-96-96-96zM384 48h256v32h-256v-32zM512 960c-35.346 0-64-28.654-64-64s28.654-64 64-64 64 28.654 64 64-28.654 64-64 64zM768 768h-512v-640h512v640z']},Acknowledged:{viewBox:'0 0 844 1024',paths:['M180.705882,75.2941176 L421.647059,75.2941176 L421.647059,45.1764706 L180.705882,45.1764706 L180.705882,75.2941176 Z M602.352941,366.408791 L602.352941,90.3529412 C602.352941,40.6588235 561.633882,0 512,0 L90.3529412,0 C40.6588235,0 0,40.6588235 0,90.3529412 L0,873.411765 C0,923.105882 40.6588235,963.764706 90.3529412,963.764706 L272.732581,963.764706 C215.504242,899.824159 180.705882,815.38764 180.705882,722.823529 C180.705882,523.221323 342.515441,361.411765 542.117647,361.411765 C562.640547,361.411765 582.763913,363.122375 602.352941,366.408791 Z','M542.117647,1024 C375.782475,1024 240.941176,889.158701 240.941176,722.823529 C240.941176,556.488358 375.782475,421.647059 542.117647,421.647059 C708.452819,421.647059 843.294118,556.488358 843.294118,722.823529 C843.294118,889.158701 708.452819,1024 542.117647,1024 Z M677.647059,602.352941 L474.352941,805.647059 L406.588235,737.882353 L361.411765,783.058824 L474.352941,896 L722.823529,647.529412 L677.647059,602.352941 Z']},Attending:{viewBox:'0 0 1024 1024',paths:['M722.823529,1024 C556.488358,1024 421.647059,889.158701 421.647059,722.823529 C421.647059,556.488358 556.488358,421.647059 722.823529,421.647059 C889.158701,421.647059 1024,556.488358 1024,722.823529 C1024,889.158701 889.158701,1024 722.823529,1024 Z M858.352941,602.352941 L655.058824,805.647059 L587.294118,737.882353 L542.117647,783.058824 L655.058824,896 L903.529412,647.529412 L858.352941,602.352941 Z','M361.411765,692.705882 C361.411765,550.369882 451.644235,428.694588 577.897412,381.952 C593.197176,347.557647 602.352941,309.308235 602.352941,271.058824 C602.352941,121.374118 602.352941,0 421.647059,0 C240.941176,0 240.941176,121.374118 240.941176,271.058824 C240.941176,364.303059 294.972235,457.487059 361.411765,494.893176 L361.411765,544.587294 C157.033412,561.272471 0,661.684706 0,783.058824 L373.940706,783.058824 C365.808941,754.326588 361.411765,724.028235 361.411765,692.705882']},Unable:{viewBox:'0 0 1024 1024',paths:['M384 736c0-151.234 95.874-280.486 230.032-330.2 16.28-36.538 25.968-77.164 25.968-117.8 0-159.058 0-288-192-288s-192 128.942-192 288c0 99.060 57.502 198.104 128 237.832v52.78c-217.102 17.748-384 124.42-384 253.388h397.306c-8.664-30.53-13.306-62.732-13.306-96z','M736 448c-159.058 0-288 128.942-288 288s128.942 288 288 288c159.056 0 288-128.942 288-288s-128.942-288-288-288zM889.456 838.544c14.060 14.058 14.060 36.852 0 50.91-7.030 7.030-16.242 10.546-25.456 10.546s-18.426-3.516-25.456-10.544l-102.544-102.546-102.544 102.544c-7.030 7.030-16.242 10.546-25.456 10.546s-18.426-3.516-25.456-10.544c-14.060-14.058-14.060-36.852 0-50.91l102.546-102.546-102.544-102.544c-14.060-14.058-14.060-36.852 0-50.91 14.058-14.058 36.852-14.058 50.91 0l102.544 102.544 102.544-102.544c14.058-14.058 36.852-14.058 50.91 0 14.060 14.058 14.060 36.852 0 50.91l-102.544 102.544 102.546 102.544z']},Arrived:{viewBox:'0 0 1408 1024',paths:['M768 705.306v-13.256c92.524-35.408 160-145.59 160-276.050 0-159.058-100.29-288-224-288-123.712 0-224 128.942-224 288 0 130.46 67.476 240.642 160 276.050v13.256c-217.102 8.874-384 62.21-384 126.694v128h896v-128c0-64.484-166.898-117.82-384-126.694z','M1152 448.592v-5.078c73.032-20.754 128-111.146 128-219.514 0-123.712-71.634-224-160-224s-160 100.288-160 224c0 108.37 54.968 198.76 128 219.514v5.078c-31.81 1.172-62.054 4.074-89.878 8.412-6.28 68.208-28.092 131.24-61.738 182.996h471.616v-96c0-49.414-112.006-90.1-256-95.408z','M409.878 457.004c-27.824-4.338-58.070-7.24-89.878-8.412v-5.078c73.032-20.754 128-111.146 128-219.514 0-123.712-71.634-224-160-224s-160 100.288-160 224c0 108.37 54.968 198.76 128 219.514v5.078c-143.994 5.308-256 45.994-256 95.408v96h471.618c-33.646-51.756-55.458-114.788-61.74-182.996z']},StandIn:{viewBox:'0 0 1024 1024',paths:['M768 770.614v-52.782c70.496-39.728 128-138.772 128-237.832 0-159.058 0-288-192-288s-192 128.942-192 288c0 99.060 57.502 198.104 128 237.832v52.782c-217.102 17.746-384 124.418-384 253.386h896c0-128.968-166.898-235.64-384-253.386z','M207.498 616c-13.554 4.938-26.606 10.284-39.116 16h306.044c-2.456-5.294-4.79-10.628-6.99-16h-259.938z','M27.2 744c-3.366 5.254-6.438 10.59-9.208 16h373.4c12.264-5.682 24.928-11.022 37.958-16h-402.15z','M87.52 680c-6.71 5.188-13.088 10.524-19.112 16h443.694c-3.82-5.202-7.53-10.532-11.108-16h-413.474z','M336.676 584c-27.154 3.968-53.32 9.344-78.23 16h202.854c-1.9-5.306-3.67-10.64-5.32-16h-119.304z','M384 552v16h67.426c-1.378-5.316-2.614-10.652-3.746-16h-63.68z','M374.466 520c3.152 2.048 6.326 4.024 9.536 5.832v10.168h60.63c-0.876-5.326-1.588-10.662-2.218-16h-67.948z','M1.946 808c-0.862 5.288-1.416 10.624-1.704 16h288.084c6.556-5.46 13.394-10.798 20.526-16h-306.906z','M109.986 664h381.106c-1.562-2.676-3.096-5.376-4.598-8.106-1.44-2.616-2.818-5.254-4.192-7.894h-345.738c-9.252 5.114-18.122 10.452-26.578 16z','M256.34 232c-0.098 5.282-0.166 10.618-0.216 16h213.696c0.264-0.586 0.512-1.178 0.782-1.762 2.252-4.892 4.66-9.628 7.186-14.238h-221.448z','M10.782 776c-2.060 5.274-3.842 10.608-5.322 16h326.984c8.732-5.54 17.75-10.89 27.1-16h-348.762z','M297.16 56h301.654c-4.488-5.72-9.462-11.068-14.986-16h-271.662c-5.526 4.936-10.514 10.276-15.006 16z','M38.546 728h438.050c16.396-4.888 33.202-9.278 50.39-13.086-0.81-0.958-1.6-1.946-2.404-2.914h-472.378c-4.866 5.228-9.424 10.564-13.658 16z','M336.34 488c5.438 5.694 11.048 11.046 16.822 16h87.716c-0.378-5.336-0.616-10.67-0.744-16h-103.794z','M310.266 456c3.854 5.524 7.852 10.872 12.002 16h117.734c0.002-5.354 0.008-10.688 0.024-16h-129.76z','M272.352 104c-1.698 5.182-3.216 10.52-4.58 16h360.458c-1.364-5.486-2.902-10.812-4.602-16h-351.276z','M264.302 136c-0.982 5.226-1.852 10.558-2.616 16h296.024c11.48-6.244 23.802-11.582 36.966-16h-330.374z','M257.386 200c-0.262 5.272-0.48 10.602-0.652 16h230.738c3.722-5.576 7.678-10.908 11.862-16h-241.948z','M259.756 168c-0.54 5.25-1.002 10.586-1.396 16h255.65c5.878-5.714 12.116-11.048 18.712-16h-272.966z','M375.446 8c-15.558 3.962-29.090 9.342-40.86 16h226.826c-11.78-6.666-25.348-12.036-40.928-16h-145.038z','M290.816 424c2.872 5.456 5.888 10.792 9.042 16h140.258c0.048-5.36 0.116-10.694 0.21-16h-149.51z','M286.394 72c-2.942 5.11-5.602 10.446-8.002 16h339.206c-2.4-5.556-5.070-10.888-8.012-16h-323.192z','M265.736 360c1.44 5.384 3.040 10.718 4.768 16h171.696c0.352-5.376 0.766-10.708 1.242-16h-177.706z','M276.234 392c2.106 5.414 4.356 10.75 6.746 16h157.726c0.16-5.368 0.36-10.7 0.604-16h-165.076z','M256.026 264c-0.016 5.294-0.024 10.628-0.026 16h201.92c1.63-5.412 3.41-10.746 5.352-16h-207.246z','M256.146 296c0.166 5.342 0.512 10.676 0.998 16h192.916c1.052-5.398 2.228-10.728 3.514-16h-197.428z','M259.072 328c0.806 5.36 1.742 10.698 2.848 16h183.186c0.642-5.382 1.36-10.718 2.172-16h-188.206z']},OffDuty:{viewBox:'0 0 1024 1024',paths:['M384 736c0-151.234 95.874-280.486 230.032-330.2 16.28-36.538 25.968-77.164 25.968-117.8 0-159.058 0-288-192-288s-192 128.942-192 288c0 99.060 57.502 198.104 128 237.832v52.78c-217.102 17.748-384 124.42-384 253.388h397.306c-8.664-30.53-13.306-62.732-13.306-96z','M736 448c-159.058 0-288 128.942-288 288s128.942 288 288 288c159.056 0 288-128.942 288-288s-128.942-288-288-288zM512 736c0-123.71 100.29-224 224-224 48.862 0 94.062 15.656 130.88 42.208l-312.67 312.672c-26.554-36.818-42.21-82.018-42.21-130.88zM736 960c-48.862 0-94.062-15.656-130.88-42.208l312.672-312.672c26.552 36.818 42.208 82.018 42.208 130.88 0 123.71-100.288 224-224 224z']}},I.UI={Tick:{viewBox:'0 0 1024 1024',paths:['M864 128l-480 480-224-224-160 160 384 384 640-640z']},Cross:{viewBox:'0 0 1024 1024',paths:['M1014.662 822.66c-0.004-0.004-0.008-0.008-0.012-0.010l-310.644-310.65 310.644-310.65c0.004-0.004 0.008-0.006 0.012-0.010 3.344-3.346 5.762-7.254 7.312-11.416 4.246-11.376 1.824-24.682-7.324-33.83l-146.746-146.746c-9.148-9.146-22.45-11.566-33.828-7.32-4.16 1.55-8.070 3.968-11.418 7.31 0 0.004-0.004 0.006-0.008 0.010l-310.648 310.652-310.648-310.65c-0.004-0.004-0.006-0.006-0.010-0.010-3.346-3.342-7.254-5.76-11.414-7.31-11.38-4.248-24.682-1.826-33.83 7.32l-146.748 146.748c-9.148 9.148-11.568 22.452-7.322 33.828 1.552 4.16 3.97 8.072 7.312 11.416 0.004 0.002 0.006 0.006 0.010 0.010l310.65 310.648-310.65 310.652c-0.002 0.004-0.006 0.006-0.008 0.010-3.342 3.346-5.76 7.254-7.314 11.414-4.248 11.376-1.826 24.682 7.322 33.83l146.748 146.746c9.15 9.148 22.452 11.568 33.83 7.322 4.16-1.552 8.070-3.97 11.416-7.312 0.002-0.004 0.006-0.006 0.010-0.010l310.648-310.65 310.648 310.65c0.004 0.002 0.008 0.006 0.012 0.008 3.348 3.344 7.254 5.762 11.414 7.314 11.378 4.246 24.684 1.826 33.828-7.322l146.746-146.748c9.148-9.148 11.57-22.454 7.324-33.83-1.552-4.16-3.97-8.068-7.314-11.414z']}},I.INCIDENT_ALERT={BellFilled:{viewBox:'0 0 1024 1024',paths:['M512 192c-35.346 0-64-28.654-64-64v-64c0-35.346 28.654-64 64-64s64 28.654 64 64v64c0 35.346-28.654 64-64 64z','M800 704h-32v-192c0-141.384-114.614-256-256-256-141.384 0-256 114.616-256 256v192h-32c-17.672 0-32 14.326-32 32v128c0 17.674 14.328 32 32 32h576c17.674 0 32-14.326 32-32v-128c0-17.674-14.326-32-32-32z','M864 1024h-704c-17.672 0-32-14.326-32-32s14.328-32 32-32h704c17.674 0 32 14.326 32 32s-14.326 32-32 32z','M192 256c-16.378 0-32.758-6.248-45.254-18.746l-64-64c-24.994-24.994-24.994-65.516 0-90.51s65.516-24.994 90.51 0l64 64c24.994 24.994 24.994 65.516 0 90.51-12.498 12.498-28.876 18.746-45.256 18.746z','M128 576h-64c-35.346 0-64-28.654-64-64s28.654-64 64-64h64c35.346 0 64 28.654 64 64s-28.654 64-64 64z','M832 256c-16.378 0-32.758-6.248-45.254-18.746-24.994-24.994-24.994-65.516 0-90.51l64-64c24.992-24.994 65.516-24.994 90.508 0 24.994 24.994 24.994 65.516 0 90.51l-64 64c-12.496 12.498-28.874 18.746-45.254 18.746z','M960 576h-64c-35.346 0-64-28.654-64-64s28.654-64 64-64h64c35.346 0 64 28.654 64 64s-28.654 64-64 64z']},PatientType:{viewBox:'0 0 1024 1024',paths:['M416 96c0-53.018 42.98-96 96-96s96 42.982 96 96c0 53.020-42.98 96-96 96s-96-42.98-96-96z','M640 320l329.596-142.172-23.77-59.424-401.826 137.596h-64l-401.826-137.596-23.77 59.424 329.596 142.172v256l-131.27 424.57 59.84 22.7 185.716-415.27h27.428l185.716 415.27 59.84-22.7-131.27-424.57z']},WarningTriangle:{viewBox:'0 0 1024 1024',paths:['M585.143 785.714v-108.571c0-10.286-8-18.857-18.286-18.857h-109.714c-10.286 0-18.286 8.571-18.286 18.857v108.571c0 10.286 8 18.857 18.286 18.857h109.714c10.286 0 18.286-8.571 18.286-18.857zM584 572l10.286-262.286c0-3.429-1.714-8-5.714-10.857-3.429-2.857-8.571-6.286-13.714-6.286h-125.714c-5.143 0-10.286 3.429-13.714 6.286-4 2.857-5.714 8.571-5.714 12l9.714 261.143c0 7.429 8.571 13.143 19.429 13.143h105.714c10.286 0 18.857-5.714 19.429-13.143zM576 38.286l438.857 804.571c12.571 22.286 12 49.714-1.143 72s-37.143 36-62.857 36h-877.714c-25.714 0-49.714-13.714-62.857-36s-13.714-49.714-1.143-72l438.857-804.571c12.571-23.429 37.143-38.286 64-38.286s51.429 14.857 64 38.286z']},Watermark:{viewBox:'0 0 1346 2402',paths:['M1280.5,3386 C677.128911,3386 188,2896.87109 188,2293.5 C188,1690.12891 677.128911,1201 1280.5,1201 C1883.87109,1201 2373,1690.12891 2373,2293.5 C2373,2896.87109 1883.87109,3386 1280.5,3386 Z M1279.5,3317 C1829.29947,3317 2275,2871.29947 2275,2321.5 C2275,1771.70053 1829.29947,1326 1279.5,1326 C729.700532,1326 284,1771.70053 284,2321.5 C284,2871.29947 729.700532,3317 1279.5,3317 Z','M1246,3188 C752.257434,3188 352,2802.96488 352,2328 C352,1853.03512 752.257434,1468 1246,1468 C1739.74257,1468 2140,1853.03512 2140,2328 C2140,2802.96488 1739.74257,3188 1246,3188 Z M1244.4407,3134 C1694.26314,3134 2058.91628,2783.2151 2058.91628,2350.5 C2058.91628,1917.7849 1694.26314,1567 1244.4407,1567 C794.618255,1567 429.965116,1917.7849 429.965116,2350.5 C429.965116,2783.2151 794.618255,3134 1244.4407,3134 Z','M1229.5,3067 C821.085428,3067 490,2756.50947 490,2373.5 C490,1990.49053 821.085428,1680 1229.5,1680 C1637.91457,1680 1969,1990.49053 1969,2373.5 C1969,2756.50947 1637.91457,3067 1229.5,3067 Z M1229,3023 C1601.23992,3023 1903,2740.04396 1903,2391 C1903,2041.95604 1601.23992,1759 1229,1759 C856.760079,1759 555,2041.95604 555,2391 C555,2740.04396 856.760079,3023 1229,3023 Z','M1236.5,2916 C884.418472,2916 599,2676.24848 599,2380.5 C599,2084.75152 884.418472,1845 1236.5,1845 C1588.58153,1845 1874,2084.75152 1874,2380.5 C1874,2676.24848 1588.58153,2916 1236.5,2916 Z M1236.5,2880 C1557.1013,2880 1817,2661.73882 1817,2392.5 C1817,2123.26118 1557.1013,1905 1236.5,1905 C915.898703,1905 656,2123.26118 656,2392.5 C656,2661.73882 915.898703,2880 1236.5,2880 Z','M1224.5,2815 C932.61751,2815 696,2627.40731 696,2396 C696,2164.59269 932.61751,1977 1224.5,1977 C1516.38249,1977 1753,2164.59269 1753,2396 C1753,2627.40731 1516.38249,2815 1224.5,2815 Z M1225,2786 C1490.64896,2786 1706,2615.42049 1706,2405 C1706,2194.57951 1490.64896,2024 1225,2024 C959.351035,2024 744,2194.57951 744,2405 C744,2615.42049 959.351035,2786 1225,2786 Z']}}})(E=f.Icons||(f.Icons={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.ChangeSeverity='change-severity']='ChangeSeverity'})(E=f.IncidentAction||(f.IncidentAction={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Closed=0]='Closed',I[I.Open=1]='Open'})(E=f.IncidentStatus||(f.IncidentStatus={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Pending=0]='Pending',I[I.Ready=1]='Ready',I[I.Failed=2]='Failed'})(E=f.ReportStatus||(f.ReportStatus={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Arrived='arrived']='Arrived'})(E=f.ResponderState||(f.ResponderState={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.StandInArranged='stand-in-arranged']='StandInArranged'})(E=f.ResponseCollectionState||(f.ResponseCollectionState={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Transmitted='transmitted']='Transmitted',I[I.Received='received']='Received',I[I.Displayed='displayed']='Displayed',I[I.Unable='unable']='Unable',I[I.Attending='attending']='Attending',I[I.Acknowledged='acknowledged']='Acknowledged',I[I.Arrived='arrived']='Arrived',I[I.StandIn='standin']='StandIn',I[I.OffDuty='offduty']='OffDuty'})(E=f.ResponseStatus||(f.ResponseStatus={}))},function(u,f){'use strict';Object.defineProperty(f,'__esModule',{value:!0});var E;(function(I){I[I.Add='add']='Add',I[I.Remove='remove']='Remove',I[I.Update='update']='Update'})(E=f.StateChangeType||(f.StateChangeType={}))},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(M,N,D,B){return new(D||(D=Promise))(function(H,z){function $(J){try{G(B.next(J))}catch(W){z(W)}}function Y(J){try{G(B['throw'](J))}catch(W){z(W)}}function G(J){J.done?H(J.value):new D(function(W){W(J.value)}).then($,Y)}G((B=B.apply(M,N||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(76),R=h(13);class A extends I.BaseStore{constructor(M,N,D){super(M,N),this.SCHEMA_VERSION=1,this._config=D}init(){const M=(N)=>super[N];return E(this,void 0,void 0,function*(){yield M('init').call(this),this.state.schemaVersion===this.SCHEMA_VERSION?this.logger.log(R.LoggerTypes.DataStorage,`💾 %cSTATE IS USING EXPECTED SCHEMA VERSION: %c${this.state.schemaVersion}`,'color: #606; font-weight: bold;','color: #999; font-weight: normal;'):this.state.schemaVersion<this.SCHEMA_VERSION?this.logger.log(R.LoggerTypes.DataStorage,`💾 %cSTATE IS USING OLD SCHEMA VERSION:`,'color: #C00; font-weight: bold;',{current:this.state.schemaVersion,expected:this.SCHEMA_VERSION}):this.logger.log(R.LoggerTypes.DataStorage,`💾 %cSTATE IS NEWER THAN EXPECTED SCHEMA VERSION:`,'color: #C00; font-weight: bold;',{current:this.state.schemaVersion,expected:this.SCHEMA_VERSION})})}getIncidents(){return E(this,void 0,void 0,function*(){return this.state.incidents||[]})}addIncident(M){return E(this,void 0,void 0,function*(){this.state.incidents=[M,...this.state.incidents],this.saveToPersistent()})}updateIncident(M){return E(this,void 0,void 0,function*(){this.state.incidents=(this.state.incidents||[]).map((N)=>{return N.id===M.id?Object.assign({},M):Object.assign({},N)}),this.saveToPersistent()})}purgeIncidentsOlderThanDate(M){return E(this,void 0,void 0,function*(){M&&(this.state.incidents=(this.state.incidents||[]).filter((N)=>N.opened.date>=M),this.saveToPersistent())})}getPendingAlerts(){return E(this,void 0,void 0,function*(){return this.state.pendingAlerts||[]})}addPendingAlert(M){return E(this,void 0,void 0,function*(){if(!(this.state.pendingAlerts||[]).includes(M)){const N=(this._config.behaviour&&this._config.behaviour.incidentAlertSequence||'fifo').toLowerCase();switch(N){case'fifo':this.state.pendingAlerts=[...this.state.pendingAlerts,M];break;case'lifo':this.state.pendingAlerts=[M,...this.state.pendingAlerts];break;case'mro':this.state.pendingAlerts=[M];break;default:throw new Error(`Unrecognised incidentAlertSequence: ${N}`);}this.saveToPersistent()}})}removePendingAlert(M){return E(this,void 0,void 0,function*(){this.state.pendingAlerts=(this.state.pendingAlerts||[]).filter((N)=>N!==M),this.saveToPersistent()})}getReports(){return E(this,void 0,void 0,function*(){return this.state.reports||[]})}addReport(M){return E(this,void 0,void 0,function*(){this.state.reports=[M,...this.state.reports],this.saveToPersistent()})}updateReport(M){return E(this,void 0,void 0,function*(){this.state.reports=(this.state.reports||[]).map((N)=>{return N.id===M.id?Object.assign({},M):Object.assign({},N)}),this.saveToPersistent()})}purgeReportsOlderThanDate(M){return E(this,void 0,void 0,function*(){M&&(this.state.reports=(this.state.reports||[]).filter((N)=>N.requested.date>=M),this.saveToPersistent())})}clearIncidentData(){return E(this,void 0,void 0,function*(){this.state.incidents=[],this.state.pendingAlerts=[],this.state.reports=[],this.saveToPersistent()})}generateInitialState(){return{_id:this.name,_rev:'',schemaVersion:this.SCHEMA_VERSION,incidents:[],pendingAlerts:[],reports:[]}}}f.Store=A},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(19),R=h(7),A=h(0),M=h(20),N=h(3);class D extends I.IncidentViewBase{constructor(B,H){super(B);const z={headerOptions:M.IncidentHeader.getDefaultOptions({showCurrentUserResponse:!0})};this.hostComponent=B,this._options=N.mergeDeep({},z,H)}initialize(){return E(this,void 0,void 0,function*(){})}setupListeners(){this.hostComponent.addListener(A.IncidentEvents.ConnectionStatusChange,()=>{this.redrawComponent()})}renderStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host .incident{background-color:var(--incident-list-incident-bg, #fff);color:var(--incident-list-incident-text, #000);border-top:1px solid var(--incident-list-incident-border-color, #f2f2f2);margin:0 0 10px 0}:host .incident :host{color:#212121;font-weight:400}:host .incident :host h1,:host .incident :host h2,:host .incident :host h3,:host .incident :host h4,:host .incident :host h5,:host .incident :host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host .incident :host,:host .incident :host *{box-sizing:border-box}:host .incident .user-html p{margin:0}:host .incident .user-html p+p{margin:.8em 0 0 0}:host .incident .user-html strong{font-weight:600}:host .incident .header{position:relative;display:flex;align-items:stretch;padding:10px 10px 10px 0;font-size:18px}:host .incident .header .header-group{display:flex;flex-direction:row;align-items:flex-start;flex:0 0}:host .incident .header .header-group.header-group-details{flex:1 1;flex-wrap:wrap;align-items:center}:host .incident .header .header-item{display:flex;flex:none}:host .incident .header .header-item .header-item-content .heading{color:#9b9b9b;font-size:10px;font-weight:300}:host .incident .header .header-item .header-item-content .heading.right{text-align:right}:host .incident .header .header-item.data-item{padding:0 10px}:host .incident .header .header-item.data-item .header-item-content .heading{margin-bottom:0.1em}:host .incident .header .header-item.data-item .header-item-content .text{line-height:0.9em;margin-bottom:0.5em}:host .incident .header .header-item.header-spacer{display:none}:host .incident .header .header-item.severity{flex:0 0;flex-basis:var(--incident-header-severity-width, 170px);font-size:20px}:host .incident .header .header-item.location{flex:0 0;flex-basis:var(--incident-header-location-width, 230px)}:host .incident .header .header-item.priority{flex:0 0;flex-basis:var(--incident-header-priority-width, 130px)}:host .incident .header .header-item.patient-type{flex:0 0;flex-basis:var(--incident-header-patient-type-width, 130px)}:host .incident .header .header-item.creator{flex:0 0;flex-basis:var(--incident-header-creator-width, 190px)}:host .incident .header .header-item.severity-change{flex:0 0;flex-basis:var(--incident-header-severity-change-width, 150px)}:host .incident .header .header-item.opened{flex:0 0 100px}:host .incident .header .header-item.actions{margin:3px 0 0 0;flex:0 0 240px}:host .incident .header .header-item.actions ct-button{width:115px;font-size:14px;background:#ffffff}:host .incident .header .header-item.actions ct-button+ct-button{margin:0 0 0 6px}:host .incident .header.inline{flex-direction:row}:host .incident .header.inline .header-item.header-spacer{display:block;flex:1}:host .incident .header.inline .header-item.header-end{justify-content:flex-end;margin-left:auto}:host .incident .header.inline .data-item{flex-direction:column}@media screen and (max-width: 1120px){:host .incident .header.inline .header-group.header-group-details{align-items:flex-start}:host .incident .header.inline .header-item.header-spacer{display:none}:host .incident .header.inline .header-item.actions{flex:0 0 120px;flex-wrap:wrap}:host .incident .header.inline .header-item.actions ct-button+ct-button{margin:6px 0 0 0}}:host .incident .header.stacked{flex-direction:column;align-items:flex-start;padding-bottom:0}:host .incident .header.stacked .header-group{flex-direction:column;align-items:flex-start}:host .incident .header.stacked .header-item{display:block;margin:0 0 10px 0;flex:none}:host .incident .header.stacked .header-item:not(.severity){padding:0 0 0 20px}:host .incident .header.stacked .header-item .header-item-content .heading,:host .incident .header.stacked .header-item .header-item-content .heading.right{text-align:left}:host .incident .header.stacked .header-spacer{display:none}:host .incident .header.mobile{padding:0;flex-direction:column}:host .incident .header.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;align-items:stretch;flex:1;border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2)}:host .incident .header.mobile .mobile-header-row .header-item{display:flex;align-items:center;font-size:14px;border-left:1px solid var(--incident-list-incident-border-color, #f2f2f2);border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2);padding:10px 8px;margin-bottom:-1px;min-width:33%;min-height:48px}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content{display:block}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .heading{margin:0 0 3px 0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .text{margin:0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item.severity{flex:0 0 130px;min-width:130px;font-size:15px;padding:0}:host .incident .header.mobile .mobile-header-row .header-item.location{flex:1 1;border-left:0}:host .incident .header.mobile .mobile-header-row .header-item.opened{flex:0 0 50px;min-width:50px;padding-top:0;padding-bottom:0;justify-content:center;font-size:18px;font-weight:600}:host .incident .header.mobile .mobile-header-row .header-item.opened ct-il-time-diff-display{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.opened .label{color:#9b9b9b;font-size:10px;font-weight:300;line-height:0.9em;text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.closed{flex:0 0 55px;min-width:55px;text-align:center;justify-content:center}:host .incident .header.mobile .mobile-header-row .header-item.closed .header-item-content .heading{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.user-response{flex:0 0 125px;min-width:125px}:host .incident .header.mobile .mobile-header-row .header-item.user-response+.priority{max-width:100%}:host .incident .header.mobile .mobile-header-row .header-item.priority{flex:1 1;min-width:90px;max-width:130px}:host .incident .header.mobile .mobile-header-row .header-item.patient-type,:host .incident .header.mobile .mobile-header-row .header-item.creator{flex:1}:host .incident .header.mobile .mobile-header-row .header-item.severity-change{flex:0 0 145px}:host .incident .header.mobile .mobile-header-row .header-item.actions{flex:1 1;margin:0;justify-content:flex-end}:host .incident .header.mobile .mobile-header-row .header-item:first-child,:host .incident .header.mobile .mobile-header-row .header-item:nth-child(3n+1){border-left:0}:host .incident .header.closed.mobile{padding:0;flex-direction:column}:host .incident .header.closed.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;flex:1;border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident .header.closed.mobile .mobile-header-row .header-item{border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident.closed{background-color:var(--incident-list-closed-incident-bg, #f2f2f2);color:var(--incident-list-incident-closed-text, #000);border-top:1px solid var(--incident-list-closed-incident-border-color, #fff)}:host(:first-child) .incident{border-top:0}:host(:first-child) .incident.closed{border-top:0}
        `}renderIncident(B){const H=['incident',`severity-${B.severity.id}`,`priority-${B.priority.id}`];return B.status===R.IncidentStatus.Closed&&H.push('closed'),B.isTestIncident&&H.push('test'),window.__CTRender('div',{class:H.join(' ')},this._renderHeader(B))}_renderHeader(B){return M.IncidentHeader.generateMobileHeader(this.hostComponent,B,this._options.headerOptions,!0,null)}}f.ResponderSummaryMobileIncidentView=D},function(u,f,h){'use strict';var E=this&&this.__awaiter||function($,Y,G,J){return new(G||(G=Promise))(function(W,X){function K(ee){try{Z(J.next(ee))}catch(te){X(te)}}function Q(ee){try{Z(J['throw'](ee))}catch(te){X(te)}}function Z(ee){ee.done?W(ee.value):new G(function(te){te(ee.value)}).then(K,Q)}Z((J=J.apply($,Y||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(0),R=h(19),A=h(7),M=h(11),N=h(20),D=h(3),B=h(4),H=h(16);class z extends R.IncidentViewBase{constructor($,Y){super($);const G={headerOptions:N.IncidentHeader.getDefaultOptions(),showRespondents:!0,respondentOrderBy:'as_supplied',respondentOrderByReverse:!1,respondentStatusFilter:'all',showArrivedStatus:!0,showStandInStatus:!0,showIndividualResponses:!1};this._options=D.mergeDeep({},G,Y)}initialize(){return E(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(I.IncidentEvents.ConnectionStatusChange,()=>{this.redrawComponent()})}renderStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block;margin:10px 0 0 0}:host .incident{background-color:var(--incident-list-incident-bg, #fff);color:var(--incident-list-incident-text, #000)}:host .incident :host{color:#212121;font-weight:400}:host .incident :host h1,:host .incident :host h2,:host .incident :host h3,:host .incident :host h4,:host .incident :host h5,:host .incident :host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host .incident :host,:host .incident :host *{box-sizing:border-box}:host .incident .user-html p{margin:0}:host .incident .user-html p+p{margin:.8em 0 0 0}:host .incident .user-html strong{font-weight:600}:host .incident .header{position:relative;display:flex;align-items:stretch;padding:10px 10px 10px 0;font-size:18px}:host .incident .header .header-group{display:flex;flex-direction:row;align-items:flex-start;flex:0 0}:host .incident .header .header-group.header-group-details{flex:1 1;flex-wrap:wrap;align-items:center}:host .incident .header .header-item{display:flex;flex:none}:host .incident .header .header-item .header-item-content .heading{color:#9b9b9b;font-size:10px;font-weight:300}:host .incident .header .header-item .header-item-content .heading.right{text-align:right}:host .incident .header .header-item.data-item{padding:0 10px}:host .incident .header .header-item.data-item .header-item-content .heading{margin-bottom:0.1em}:host .incident .header .header-item.data-item .header-item-content .text{line-height:0.9em;margin-bottom:0.5em}:host .incident .header .header-item.header-spacer{display:none}:host .incident .header .header-item.severity{flex:0 0;flex-basis:var(--incident-header-severity-width, 170px);font-size:20px}:host .incident .header .header-item.location{flex:0 0;flex-basis:var(--incident-header-location-width, 230px)}:host .incident .header .header-item.priority{flex:0 0;flex-basis:var(--incident-header-priority-width, 130px)}:host .incident .header .header-item.patient-type{flex:0 0;flex-basis:var(--incident-header-patient-type-width, 130px)}:host .incident .header .header-item.creator{flex:0 0;flex-basis:var(--incident-header-creator-width, 190px)}:host .incident .header .header-item.severity-change{flex:0 0;flex-basis:var(--incident-header-severity-change-width, 150px)}:host .incident .header .header-item.opened{flex:0 0 100px}:host .incident .header .header-item.actions{margin:3px 0 0 0;flex:0 0 240px}:host .incident .header .header-item.actions ct-button{width:115px;font-size:14px;background:#ffffff}:host .incident .header .header-item.actions ct-button+ct-button{margin:0 0 0 6px}:host .incident .header.inline{flex-direction:row}:host .incident .header.inline .header-item.header-spacer{display:block;flex:1}:host .incident .header.inline .header-item.header-end{justify-content:flex-end;margin-left:auto}:host .incident .header.inline .data-item{flex-direction:column}@media screen and (max-width: 1120px){:host .incident .header.inline .header-group.header-group-details{align-items:flex-start}:host .incident .header.inline .header-item.header-spacer{display:none}:host .incident .header.inline .header-item.actions{flex:0 0 120px;flex-wrap:wrap}:host .incident .header.inline .header-item.actions ct-button+ct-button{margin:6px 0 0 0}}:host .incident .header.stacked{flex-direction:column;align-items:flex-start;padding-bottom:0}:host .incident .header.stacked .header-group{flex-direction:column;align-items:flex-start}:host .incident .header.stacked .header-item{display:block;margin:0 0 10px 0;flex:none}:host .incident .header.stacked .header-item:not(.severity){padding:0 0 0 20px}:host .incident .header.stacked .header-item .header-item-content .heading,:host .incident .header.stacked .header-item .header-item-content .heading.right{text-align:left}:host .incident .header.stacked .header-spacer{display:none}:host .incident .header.mobile{padding:0;flex-direction:column}:host .incident .header.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;align-items:stretch;flex:1;border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2)}:host .incident .header.mobile .mobile-header-row .header-item{display:flex;align-items:center;font-size:14px;border-left:1px solid var(--incident-list-incident-border-color, #f2f2f2);border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2);padding:10px 8px;margin-bottom:-1px;min-width:33%;min-height:48px}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content{display:block}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .heading{margin:0 0 3px 0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .text{margin:0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item.severity{flex:0 0 130px;min-width:130px;font-size:15px;padding:0}:host .incident .header.mobile .mobile-header-row .header-item.location{flex:1 1;border-left:0}:host .incident .header.mobile .mobile-header-row .header-item.opened{flex:0 0 50px;min-width:50px;padding-top:0;padding-bottom:0;justify-content:center;font-size:18px;font-weight:600}:host .incident .header.mobile .mobile-header-row .header-item.opened ct-il-time-diff-display{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.opened .label{color:#9b9b9b;font-size:10px;font-weight:300;line-height:0.9em;text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.closed{flex:0 0 55px;min-width:55px;text-align:center;justify-content:center}:host .incident .header.mobile .mobile-header-row .header-item.closed .header-item-content .heading{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.user-response{flex:0 0 125px;min-width:125px}:host .incident .header.mobile .mobile-header-row .header-item.user-response+.priority{max-width:100%}:host .incident .header.mobile .mobile-header-row .header-item.priority{flex:1 1;min-width:90px;max-width:130px}:host .incident .header.mobile .mobile-header-row .header-item.patient-type,:host .incident .header.mobile .mobile-header-row .header-item.creator{flex:1}:host .incident .header.mobile .mobile-header-row .header-item.severity-change{flex:0 0 145px}:host .incident .header.mobile .mobile-header-row .header-item.actions{flex:1 1;margin:0;justify-content:flex-end}:host .incident .header.mobile .mobile-header-row .header-item:first-child,:host .incident .header.mobile .mobile-header-row .header-item:nth-child(3n+1){border-left:0}:host .incident .header.closed.mobile{padding:0;flex-direction:column}:host .incident .header.closed.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;flex:1;border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident .header.closed.mobile .mobile-header-row .header-item{border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident .respondents{background:var(--incident-list-incident-respondents-bg, #fff);padding:16px 8px}:host .incident .respondents ul.response-collections{display:flex;list-style-type:none;margin:0;padding:0;flex-wrap:wrap}:host .incident .respondents ul.response-collections li.response-collection{min-width:20%;padding:5px 12px}@media screen and (max-width: 1120px){:host .incident .respondents ul.response-collections li.response-collection{min-width:33%}}@media screen and (max-width: 768px){:host .incident .respondents ul.response-collections li.response-collection{min-width:50%}}@media screen and (max-width: 640px){:host .incident .respondents ul.response-collections li.response-collection{width:100%}}:host .incident .respondents ul.response-collections li.response-collection ul.individual-responses{display:block;list-style-type:none;margin:0;padding:0;font-size:12px}:host .incident .respondents ul.response-collections li.response-collection ul.individual-responses li.individual-response{display:block;margin:5px 0 0 0;padding:0}:host .incident.closed{background-color:var(--incident-list-closed-incident-bg, #f2f2f2);color:var(--incident-list-incident-closed-text, #000)}:host .incident.closed .respondents{background-color:var(--incident-list-closed-incident-respondents-bg, #fff)}:host(:first-child){margin-top:0}
        `}renderIncident($){const Y=['incident',`severity-${$.severity.id}`,`priority-${$.priority.id}`];return $.status===A.IncidentStatus.Closed&&Y.push('closed'),$.isTestIncident&&Y.push('test'),window.__CTRender('div',{class:Y.join(' ')},this._renderHeader($),B.renderIf(this._options.showRespondents,this._renderRespondents($)))}_renderHeader($){return N.IncidentHeader.generateHeader(this.hostComponent,$,this._options.headerOptions)}_renderRespondents($){const Y=this._getResponseCollections($);return window.__CTRender('div',{class:'respondents'},window.__CTRender('ul',{class:'response-collections'},Y.map((G)=>{let J=G.status||A.ResponseStatus.Transmitted,W=G.date||$.opened.date;const X=G.collectionState.find((Q)=>Q.state===A.ResponseCollectionState.StandInArranged)||null,K=G.state.find((Q)=>Q.state===A.ResponderState.Arrived)||null;return this._options.showStandInStatus&&null!==X?(J=A.ResponseStatus.StandIn,W=X.date):this._options.showArrivedStatus&&null!==K&&(J=A.ResponseStatus.Arrived,W=K.date),window.__CTRender('li',{class:'response-collection'},window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'primary',label:G.name,status:J,date:W}),B.renderIf(this._options.showIndividualResponses,this._renderIndividualResponses(G)))})))}_renderIndividualResponses($){return window.__CTRender('ul',{class:'individual-responses'},$.responses.map((Y)=>window.__CTRender('li',{class:'individual-response'},window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'simple',iconWidth:'12px',iconHeight:'12px',label:Y.responder.name,status:Y.status||A.ResponseStatus.Transmitted,date:Y.date}))))}_getResponseCollections($){let Y=[...($.responses||[])];return Y=M.filterIncidentResponses(Y,'status',this._options.respondentStatusFilter),Y=M.orderIncidentRespondents(Y,this._options.respondentOrderBy,this._options.respondentOrderByReverse),Y}}f.ResponseSummaryIncidentView=z},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(W,X,K,Q){return new(K||(K=Promise))(function(Z,ee){function te(oe){try{se(Q.next(oe))}catch(ae){ee(ae)}}function ne(oe){try{se(Q['throw'](oe))}catch(ae){ee(ae)}}function se(oe){oe.done?Z(oe.value):new K(function(ae){ae(oe.value)}).then(te,ne)}se((Q=Q.apply(W,X||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(19),A=h(0),M=h(7),N=h(11),D=h(36),B=h(17),H=h(16),z=h(20),$=h(3),Y=h(4),G=h(5);class J extends R.IncidentViewBase{constructor(W,X){super(W);const K={headerOptions:z.IncidentHeader.getDefaultOptions({allowSeverityChange:!0,allowClose:!0}),showRespondents:!0,respondentOrderBy:'as_supplied',respondentOrderByReverse:!1,respondentStatusFilter:'all',showRespondentOnlineStatus:!0,showRespondentTelNumber:!0,showRespondentCurrentOnCallStatus:!0,allowFlagArrived:!0,allowFlagStandIn:!0};this._options=$.mergeDeep({},K,X),this._users=null}initialize(){return E(this,void 0,void 0,function*(){this._users=yield this.layer.getOnCallUsers(),this._connectionStatus=this.layer.getConnectionStatus()})}setupListeners(){this.addListener(A.IncidentEvents.ConnectionStatusChange,()=>{this._connectionStatus=this.layer.getConnectionStatus(),this.redrawComponent()}),this.addListeners([A.IncidentEvents.OnCallUsersChange,A.IncidentEvents.OtherUserConnectionStatusChange],()=>E(this,void 0,void 0,function*(){this._users=yield this.layer.getOnCallUsers(),this.redrawComponent()}))}renderStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block;margin:10px 0 0 0}:host .incident{background-color:var(--incident-list-incident-bg, #fff);color:var(--incident-list-incident-text, #000)}:host .incident :host{color:#212121;font-weight:400}:host .incident :host h1,:host .incident :host h2,:host .incident :host h3,:host .incident :host h4,:host .incident :host h5,:host .incident :host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host .incident :host,:host .incident :host *{box-sizing:border-box}:host .incident .user-html p{margin:0}:host .incident .user-html p+p{margin:.8em 0 0 0}:host .incident .user-html strong{font-weight:600}:host .incident .header{position:relative;display:flex;align-items:stretch;padding:10px 10px 10px 0;font-size:18px}:host .incident .header .header-group{display:flex;flex-direction:row;align-items:flex-start;flex:0 0}:host .incident .header .header-group.header-group-details{flex:1 1;flex-wrap:wrap;align-items:center}:host .incident .header .header-item{display:flex;flex:none}:host .incident .header .header-item .header-item-content .heading{color:#9b9b9b;font-size:10px;font-weight:300}:host .incident .header .header-item .header-item-content .heading.right{text-align:right}:host .incident .header .header-item.data-item{padding:0 10px}:host .incident .header .header-item.data-item .header-item-content .heading{margin-bottom:0.1em}:host .incident .header .header-item.data-item .header-item-content .text{line-height:0.9em;margin-bottom:0.5em}:host .incident .header .header-item.header-spacer{display:none}:host .incident .header .header-item.severity{flex:0 0;flex-basis:var(--incident-header-severity-width, 170px);font-size:20px}:host .incident .header .header-item.location{flex:0 0;flex-basis:var(--incident-header-location-width, 230px)}:host .incident .header .header-item.priority{flex:0 0;flex-basis:var(--incident-header-priority-width, 130px)}:host .incident .header .header-item.patient-type{flex:0 0;flex-basis:var(--incident-header-patient-type-width, 130px)}:host .incident .header .header-item.creator{flex:0 0;flex-basis:var(--incident-header-creator-width, 190px)}:host .incident .header .header-item.severity-change{flex:0 0;flex-basis:var(--incident-header-severity-change-width, 150px)}:host .incident .header .header-item.opened{flex:0 0 100px}:host .incident .header .header-item.actions{margin:3px 0 0 0;flex:0 0 240px}:host .incident .header .header-item.actions ct-button{width:115px;font-size:14px;background:#ffffff}:host .incident .header .header-item.actions ct-button+ct-button{margin:0 0 0 6px}:host .incident .header.inline{flex-direction:row}:host .incident .header.inline .header-item.header-spacer{display:block;flex:1}:host .incident .header.inline .header-item.header-end{justify-content:flex-end;margin-left:auto}:host .incident .header.inline .data-item{flex-direction:column}@media screen and (max-width: 1120px){:host .incident .header.inline .header-group.header-group-details{align-items:flex-start}:host .incident .header.inline .header-item.header-spacer{display:none}:host .incident .header.inline .header-item.actions{flex:0 0 120px;flex-wrap:wrap}:host .incident .header.inline .header-item.actions ct-button+ct-button{margin:6px 0 0 0}}:host .incident .header.stacked{flex-direction:column;align-items:flex-start;padding-bottom:0}:host .incident .header.stacked .header-group{flex-direction:column;align-items:flex-start}:host .incident .header.stacked .header-item{display:block;margin:0 0 10px 0;flex:none}:host .incident .header.stacked .header-item:not(.severity){padding:0 0 0 20px}:host .incident .header.stacked .header-item .header-item-content .heading,:host .incident .header.stacked .header-item .header-item-content .heading.right{text-align:left}:host .incident .header.stacked .header-spacer{display:none}:host .incident .header.mobile{padding:0;flex-direction:column}:host .incident .header.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;align-items:stretch;flex:1;border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2)}:host .incident .header.mobile .mobile-header-row .header-item{display:flex;align-items:center;font-size:14px;border-left:1px solid var(--incident-list-incident-border-color, #f2f2f2);border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2);padding:10px 8px;margin-bottom:-1px;min-width:33%;min-height:48px}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content{display:block}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .heading{margin:0 0 3px 0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .text{margin:0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item.severity{flex:0 0 130px;min-width:130px;font-size:15px;padding:0}:host .incident .header.mobile .mobile-header-row .header-item.location{flex:1 1;border-left:0}:host .incident .header.mobile .mobile-header-row .header-item.opened{flex:0 0 50px;min-width:50px;padding-top:0;padding-bottom:0;justify-content:center;font-size:18px;font-weight:600}:host .incident .header.mobile .mobile-header-row .header-item.opened ct-il-time-diff-display{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.opened .label{color:#9b9b9b;font-size:10px;font-weight:300;line-height:0.9em;text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.closed{flex:0 0 55px;min-width:55px;text-align:center;justify-content:center}:host .incident .header.mobile .mobile-header-row .header-item.closed .header-item-content .heading{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.user-response{flex:0 0 125px;min-width:125px}:host .incident .header.mobile .mobile-header-row .header-item.user-response+.priority{max-width:100%}:host .incident .header.mobile .mobile-header-row .header-item.priority{flex:1 1;min-width:90px;max-width:130px}:host .incident .header.mobile .mobile-header-row .header-item.patient-type,:host .incident .header.mobile .mobile-header-row .header-item.creator{flex:1}:host .incident .header.mobile .mobile-header-row .header-item.severity-change{flex:0 0 145px}:host .incident .header.mobile .mobile-header-row .header-item.actions{flex:1 1;margin:0;justify-content:flex-end}:host .incident .header.mobile .mobile-header-row .header-item:first-child,:host .incident .header.mobile .mobile-header-row .header-item:nth-child(3n+1){border-left:0}:host .incident .header.closed.mobile{padding:0;flex-direction:column}:host .incident .header.closed.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;flex:1;border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident .header.closed.mobile .mobile-header-row .header-item{border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident .respondents{background-color:var(--incident-list-incident-respondents-bg, #fff);margin:10px 0 0 0}:host .incident .respondents .responses-header{font-size:12px;font-weight:300;color:#9b9b9b;margin:10px 0 0 0;padding:0 10px}:host .incident .respondents .col-group{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center}:host .incident .respondents .col-group .col{padding:3px}:host .incident .respondents .col-group .col:first-child{padding-left:0}:host .incident .respondents .col-group .col.col-status{flex:0 0 45px;text-align:center}:host .incident .respondents .col-group .col.col-role{flex:1 1}:host .incident .respondents .col-group .col.col-name{flex:1 1}:host .incident .respondents .col-group .col.col-tel{flex:0 0 120px}:host .incident .respondents .col-group .col.col-transmitted,:host .incident .respondents .col-group .col.col-received{flex:0 0 90px;text-align:center}:host .incident .respondents .col-group .col.col-response{flex:0 0 150px;text-align:center}:host .incident .respondents .col-group .col.col-arrived{flex:0 0 90px;text-align:center}:host .incident .respondents .col-group .col.col-stand-in{flex:0 0 90px;text-align:center}:host .incident .respondents .col-group .col.col-btns{display:flex;justify-content:flex-end}:host .incident .respondents .col-group .col.col-btns.col-btns-1{flex:0 0 120px}:host .incident .respondents .col-group .col.col-btns.col-btns-2{flex:0 0 240px}:host .incident .respondents .col-group .col.col-btns ct-button{width:115px;font-size:14px;background:#ffffff}:host .incident .respondents .col-group .col.col-btns ct-button+ct-button{margin:0 0 0 6px}:host .incident .respondents .col-group .col:last-child{padding-right:0}:host .incident .respondents .col-group .col-rwd-break{display:none}:host .incident .respondents ul.response-collections{list-style-type:none;margin:0;padding:0}:host .incident .respondents ul.response-collections li.response{font-size:15px;font-weight:400;margin:0;padding:10px;background:var(--incident-list-incident-role-bg, transparent);border-bottom:var(--incident-list-incident-role-border, 1px solid #f0f0f0)}:host .incident .respondents ul.response-collections li.response .col.col-role{display:flex;align-items:center;font-weight:600}:host .incident .respondents ul.response-collections li.response .col.col-role:before{content:'';display:block;height:30px}:host .incident .respondents ul.response-collections li.response.on-call.support{background:var(--incident-list-incident-support-role-bg, #f6f6f6);border-bottom:var(--incident-list-incident-support-role-border, 1px solid #fff)}:host .incident .respondents ul.response-collections li.response.off-duty{background-size:5px 5px;background-image:linear-gradient(45deg, transparent 46%, #d8d8d8 49%, #d8d8d8 51%, transparent 55%)}:host .incident.closed{background-color:var(--incident-list-closed-incident-bg, #f2f2f2);color:var(--incident-list-incident-closed-text, #000)}:host .incident.closed .respondents{background-color:var(--incident-list-closed-incident-respondents-bg, #fff)}:host .incident.closed .respondents ul.response-collection li.response{background:var(--incident-list-closed-incident-role-bg, transparent);border-bottom:var(--incident-list-closed-incident-role-border, 1px solid #f0f0f0)}:host .incident.closed .respondents ul.response-collection li.response.on-call.support{background:var(--incident-list-closed-incident-support-role-bg, #f6f6f6);border-bottom:var(--incident-list-closed-incident-support-role-border, 1px solid #fff)}@media screen and (max-width: 1120px){:host .incident .respondents .responses-header{display:none}:host .incident .respondents .col-group .col.col-role,:host .incident .respondents .col-group .col.col-name,:host .incident .respondents .col-group .col.col-tel{flex:none}:host .incident .respondents .col-group .col.col-tel.has-telephone{margin-left:10px}:host .incident .respondents .col-group .col.col-tel.has-telephone:before{content:'('}:host .incident .respondents .col-group .col.col-tel.has-telephone:after{content:')'}:host .incident .respondents .col-group .col.col-name,:host .incident .respondents .col-group .col.col-transmitted{margin:0 0 0 45px}:host .incident .respondents .col-group .col.col-transmitted,:host .incident .respondents .col-group .col.col-received,:host .incident .respondents .col-group .col.col-response,:host .incident .respondents .col-group .col.col-arrived,:host .incident .respondents .col-group .col.col-stand-in{margin-top:10px;padding:3px 0;flex:none}:host .incident .respondents .col-group .col.col-transmitted ct-il-incident-response-pill,:host .incident .respondents .col-group .col.col-received ct-il-incident-response-pill,:host .incident .respondents .col-group .col.col-response ct-il-incident-response-pill,:host .incident .respondents .col-group .col.col-arrived ct-il-incident-response-pill,:host .incident .respondents .col-group .col.col-stand-in ct-il-incident-response-pill{margin:0 6px 0 0}:host .incident .respondents .col-group .col-rwd-break{display:block;flex:1 1 100%}:host .incident .respondents ul.response-collections li.response{position:relative}:host .incident .respondents ul.response-collections li.response .col.col-btns{position:absolute;top:6px;right:10px;display:block}:host .incident .respondents ul.response-collections li.response .col.col-btns ct-button+ct-button{margin:6px 0 0 0}}:host(:first-child){margin-top:0}
        `}renderIncident(W){if(null===this._users)return null;const X=['incident',`severity-${W.severity.id}`,`priority-${W.priority.id}`];return W.status===M.IncidentStatus.Closed&&X.push('closed'),W.isTestIncident&&X.push('test'),window.__CTRender('div',{class:X.join(' ')},this._renderHeader(W),this._renderResponses(W))}_renderHeader(W){return z.IncidentHeader.generateHeader(this.hostComponent,W,this._options.headerOptions)}_renderResponses(W){const X=this._getResponseCollections(W);return window.__CTRender('div',{class:'respondents'},window.__CTRender('div',{class:'responses-header col-group'},Y.renderIf(this._options.showRespondentOnlineStatus,window.__CTRender('div',{class:'col col-status'},'Status')),window.__CTRender('div',{class:'col col-role'},'Role'),window.__CTRender('div',{class:'col col-name'},'On-call'),Y.renderIf(this._options.showRespondentTelNumber,window.__CTRender('div',{class:'col col-tel'},'Contact Tel')),window.__CTRender('div',{class:'col col-transmitted'},'Transmitted'),window.__CTRender('div',{class:'col col-received'},'Received'),window.__CTRender('div',{class:'col col-response'},'Response'),window.__CTRender('div',{class:'col col-arrived'},'Arrived'),window.__CTRender('div',{class:'col col-stand-in'},'Stand In'),Y.renderIf(this._options.allowFlagArrived||this._options.allowFlagStandIn,window.__CTRender('div',{class:`col col-btns ${this._options.allowFlagArrived&&this._options.allowFlagStandIn?'col-btns-2':'col-btns-1'}`}))),window.__CTRender('ul',{class:'response-collections'},X.map((K)=>this._renderResponse(W,K))))}_renderResponse(W,X){const K=['response','col-group',X.isAttender?'attender':'support',X.wasOnCall?this._options.showRespondentCurrentOnCallStatus?X.isCurrentlyOnCall?'on-call':'off-duty':'on-call':'off-duty'];return window.__CTRender('li',{class:K.join(' ')},Y.renderIf(this._options.showRespondentOnlineStatus,window.__CTRender('div',{class:'col col-status'},window.__CTRender(B.CTILOnlineStatusPill,{status:X.isOnline?I.ConnectionStatus.Connected:I.ConnectionStatus.Disconnected,showLabel:!1}))),window.__CTRender('div',{class:'col col-role'},X.roleName),window.__CTRender('div',{class:'col-rwd-break'}),window.__CTRender('div',{class:'col col-name'},X.onCallUserName),Y.renderIf(this._options.showRespondentTelNumber,window.__CTRender('div',{class:`col col-tel ${X.onCallUserTelephone&&1<X.onCallUserTelephone.length?'has-telephone':''}`},X.onCallUserTelephone)),window.__CTRender('div',{class:'col-rwd-break'}),window.__CTRender('div',{class:'col col-transmitted'},Y.renderIf(null!==X.transmittedDate,window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'secondary',center:!0,status:M.ResponseStatus.Transmitted,label:'',date:X.transmittedDate}))),window.__CTRender('div',{class:'col col-received'},Y.renderIf(null!==X.receivedDate,window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'secondary',center:!0,status:M.ResponseStatus.Received,label:'',date:X.receivedDate}))),window.__CTRender('div',{class:'col col-response'},Y.renderIf(null!==X.responseType&&null!==X.responseDate,window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'secondary',center:!0,status:X.responseType,label:X.responseLabel,date:X.responseDate}))),window.__CTRender('div',{class:'col col-arrived'},Y.renderIf(null!==X.arrivedDate,window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'secondary',center:!0,status:M.ResponseStatus.Arrived,label:'',date:X.arrivedDate}))),window.__CTRender('div',{class:'col col-stand-in'},Y.renderIf(null!==X.standInDate,window.__CTRender(H.CTILIncidentResponsePill,{pillStyle:'secondary',center:!0,status:M.ResponseStatus.StandIn,label:'',date:X.standInDate}))),this._renderActions(W,X))}_renderActions(W,X){if(!this._options.allowFlagArrived&&!this._options.allowFlagStandIn)return null;const K=this._connectionStatus!==I.ConnectionStatus.Connected,Q=[];if(this._options.allowFlagArrived&&X.isAttender&&X.wasOnCall&&X.responseType!==M.ResponseStatus.Unable){const ee=null===X.arrivedDate?null:M.Icons.UI.Tick;Q.push(window.__CTRender(G.CTButton,{type:'secondary',disabled:K,icon:ee,iconWidth:'14px',iconHeight:'14px',onClick:()=>this._toggleArrived(W,X)},'Arrived'))}if(this._options.allowFlagStandIn&&X.isAttender){const ee=null===X.standInDate?null:M.Icons.UI.Tick;Q.push(window.__CTRender(G.CTButton,{type:'secondary',disabled:K,icon:ee,iconWidth:'14px',iconHeight:'14px',onClick:()=>this._toggleStandIn(W,X)},'Stand-in'))}let Z=0;return this._options.allowFlagArrived&&(Z+=1),this._options.allowFlagStandIn&&(Z+=1),window.__CTRender('div',{class:`col col-btns col-btns-${Z}`},Q)}_toggleArrived(W,X){const K=null===X.arrivedDate?M.StateChangeType.Add:M.StateChangeType.Remove;this.emitEvent(A.IncidentEvents._Request_ChangeResponderState,new A.ChangeResponderStateEventArgs(W.id,X.jid,M.ResponderState.Arrived,K))}_toggleStandIn(W,X){const K=null===X.standInDate?M.StateChangeType.Add:M.StateChangeType.Remove;this.emitEvent(A.IncidentEvents._Request_ChangeResponseCollectionState,new A.ChangeResponseCollectionStateEventArgs(W.id,X.roleId,M.ResponseCollectionState.StandInArranged,K))}_getResponseCollections(W){let X=[...(W.responses||[])];return X=N.filterIncidentResponses(X,'status',this._options.respondentStatusFilter),X=N.orderIncidentRespondents(X,this._options.respondentOrderBy,this._options.respondentOrderByReverse),X.map((K)=>D.incidentResponseCollectionToRoleResponse(W,K,this._users,this.hostComponent.layer.config.roles))}}f.RoleOnCallIncidentView=J},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(W,X,K,Q){return new(K||(K=Promise))(function(Z,ee){function te(oe){try{se(Q.next(oe))}catch(ae){ee(ae)}}function ne(oe){try{se(Q['throw'](oe))}catch(ae){ee(ae)}}function se(oe){oe.done?Z(oe.value):new K(function(ae){ae(oe.value)}).then(te,ne)}se((Q=Q.apply(W,X||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(19),A=h(0),M=h(7),N=h(11),D=h(36),B=h(3),H=h(4),z=h(17),$=h(16),Y=h(20),G=h(5);class J extends R.IncidentViewBase{constructor(W,X){super(W);const K={collapseMode:'summary',headerOptions:Y.IncidentHeader.getDefaultOptions({allowSeverityChange:!0,allowClose:!0}),showRespondents:!0,respondentOrderBy:'as_supplied',respondentOrderByReverse:!1,respondentStatusFilter:'all',showRespondentOnlineStatus:!0,showRespondentCurrentOnCallStatus:!0,showRespondentTelNumber:!0,allowFlagArrived:!0,allowFlagStandIn:!0};this._options=B.mergeDeep({},K,X)}initialize(){return E(this,void 0,void 0,function*(){this._users=yield this.layer.getOnCallUsers(),this._connectionStatus=this.layer.getConnectionStatus();const W='detail'===this._options.collapseMode;this._headerExpanded=!1,this._incidentExpanded=W,this._responseExpanded={}})}setupListeners(){this.addListener(A.IncidentEvents.ConnectionStatusChange,()=>{this._connectionStatus=this.layer.getConnectionStatus(),this.redrawComponent()}),this.addListeners([A.IncidentEvents.OnCallUsersChange,A.IncidentEvents.OtherUserConnectionStatusChange],()=>E(this,void 0,void 0,function*(){this._users=yield this.layer.getOnCallUsers(),this.redrawComponent()}))}renderStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host .incident{background-color:var(--incident-list-incident-bg, #fff);color:var(--incident-list-incident-text, #000)}:host .incident :host{color:#212121;font-weight:400}:host .incident :host h1,:host .incident :host h2,:host .incident :host h3,:host .incident :host h4,:host .incident :host h5,:host .incident :host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host .incident :host,:host .incident :host *{box-sizing:border-box}:host .incident .user-html p{margin:0}:host .incident .user-html p+p{margin:.8em 0 0 0}:host .incident .user-html strong{font-weight:600}:host .incident .header{position:relative;display:flex;align-items:stretch;padding:10px 10px 10px 0;font-size:18px}:host .incident .header .header-group{display:flex;flex-direction:row;align-items:flex-start;flex:0 0}:host .incident .header .header-group.header-group-details{flex:1 1;flex-wrap:wrap;align-items:center}:host .incident .header .header-item{display:flex;flex:none}:host .incident .header .header-item .header-item-content .heading{color:#9b9b9b;font-size:10px;font-weight:300}:host .incident .header .header-item .header-item-content .heading.right{text-align:right}:host .incident .header .header-item.data-item{padding:0 10px}:host .incident .header .header-item.data-item .header-item-content .heading{margin-bottom:0.1em}:host .incident .header .header-item.data-item .header-item-content .text{line-height:0.9em;margin-bottom:0.5em}:host .incident .header .header-item.header-spacer{display:none}:host .incident .header .header-item.severity{flex:0 0;flex-basis:var(--incident-header-severity-width, 170px);font-size:20px}:host .incident .header .header-item.location{flex:0 0;flex-basis:var(--incident-header-location-width, 230px)}:host .incident .header .header-item.priority{flex:0 0;flex-basis:var(--incident-header-priority-width, 130px)}:host .incident .header .header-item.patient-type{flex:0 0;flex-basis:var(--incident-header-patient-type-width, 130px)}:host .incident .header .header-item.creator{flex:0 0;flex-basis:var(--incident-header-creator-width, 190px)}:host .incident .header .header-item.severity-change{flex:0 0;flex-basis:var(--incident-header-severity-change-width, 150px)}:host .incident .header .header-item.opened{flex:0 0 100px}:host .incident .header .header-item.actions{margin:3px 0 0 0;flex:0 0 240px}:host .incident .header .header-item.actions ct-button{width:115px;font-size:14px;background:#ffffff}:host .incident .header .header-item.actions ct-button+ct-button{margin:0 0 0 6px}:host .incident .header.inline{flex-direction:row}:host .incident .header.inline .header-item.header-spacer{display:block;flex:1}:host .incident .header.inline .header-item.header-end{justify-content:flex-end;margin-left:auto}:host .incident .header.inline .data-item{flex-direction:column}@media screen and (max-width: 1120px){:host .incident .header.inline .header-group.header-group-details{align-items:flex-start}:host .incident .header.inline .header-item.header-spacer{display:none}:host .incident .header.inline .header-item.actions{flex:0 0 120px;flex-wrap:wrap}:host .incident .header.inline .header-item.actions ct-button+ct-button{margin:6px 0 0 0}}:host .incident .header.stacked{flex-direction:column;align-items:flex-start;padding-bottom:0}:host .incident .header.stacked .header-group{flex-direction:column;align-items:flex-start}:host .incident .header.stacked .header-item{display:block;margin:0 0 10px 0;flex:none}:host .incident .header.stacked .header-item:not(.severity){padding:0 0 0 20px}:host .incident .header.stacked .header-item .header-item-content .heading,:host .incident .header.stacked .header-item .header-item-content .heading.right{text-align:left}:host .incident .header.stacked .header-spacer{display:none}:host .incident .header.mobile{padding:0;flex-direction:column}:host .incident .header.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;align-items:stretch;flex:1;border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2)}:host .incident .header.mobile .mobile-header-row .header-item{display:flex;align-items:center;font-size:14px;border-left:1px solid var(--incident-list-incident-border-color, #f2f2f2);border-bottom:1px solid var(--incident-list-incident-border-color, #f2f2f2);padding:10px 8px;margin-bottom:-1px;min-width:33%;min-height:48px}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content{display:block}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .heading{margin:0 0 3px 0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item .header-item-content .text{margin:0;line-height:1em}:host .incident .header.mobile .mobile-header-row .header-item.severity{flex:0 0 130px;min-width:130px;font-size:15px;padding:0}:host .incident .header.mobile .mobile-header-row .header-item.location{flex:1 1;border-left:0}:host .incident .header.mobile .mobile-header-row .header-item.opened{flex:0 0 50px;min-width:50px;padding-top:0;padding-bottom:0;justify-content:center;font-size:18px;font-weight:600}:host .incident .header.mobile .mobile-header-row .header-item.opened ct-il-time-diff-display{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.opened .label{color:#9b9b9b;font-size:10px;font-weight:300;line-height:0.9em;text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.closed{flex:0 0 55px;min-width:55px;text-align:center;justify-content:center}:host .incident .header.mobile .mobile-header-row .header-item.closed .header-item-content .heading{text-align:center}:host .incident .header.mobile .mobile-header-row .header-item.user-response{flex:0 0 125px;min-width:125px}:host .incident .header.mobile .mobile-header-row .header-item.user-response+.priority{max-width:100%}:host .incident .header.mobile .mobile-header-row .header-item.priority{flex:1 1;min-width:90px;max-width:130px}:host .incident .header.mobile .mobile-header-row .header-item.patient-type,:host .incident .header.mobile .mobile-header-row .header-item.creator{flex:1}:host .incident .header.mobile .mobile-header-row .header-item.severity-change{flex:0 0 145px}:host .incident .header.mobile .mobile-header-row .header-item.actions{flex:1 1;margin:0;justify-content:flex-end}:host .incident .header.mobile .mobile-header-row .header-item:first-child,:host .incident .header.mobile .mobile-header-row .header-item:nth-child(3n+1){border-left:0}:host .incident .header.closed.mobile{padding:0;flex-direction:column}:host .incident .header.closed.mobile .mobile-header-row{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;flex:1;border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident .header.closed.mobile .mobile-header-row .header-item{border-color:var(--incident-list-closed-incident-border-color, #fff)}:host .incident .respondents{background-color:var(--incident-list-incident-respondents-bg, #fff);border:5px solid var(--incident-list-incident-border-color, #f2f2f2)}:host .incident .respondents .col-group{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center}:host .incident .respondents .col-group .col{padding:6px 3px}:host .incident .respondents .col-group .col.col-status{flex:0 0 32px}:host .incident .respondents .col-group .col.col-role{flex:1 1}:host .incident .respondents .col-group .col.col-time{flex:0 0 50px;text-align:right}:host .incident .respondents .col-group .col.col-response{flex:0 0 32px}:host .incident .respondents ul.response-collections{list-style-type:none;margin:0;padding:0}:host .incident .respondents ul.response-collections li.response{font-size:14px;font-weight:400;margin:0;padding:0 5px;background:var(--incident-list-incident-role-bg, transparent);border-bottom:var(--incident-list-incident-role-border, 1px solid #f0f0f0)}:host .incident .respondents ul.response-collections li.response .response-summary .col.col-role{display:flex;align-items:center;font-weight:600}:host .incident .respondents ul.response-collections li.response .response-summary .col.col-role:before{content:'';display:block;height:30px}:host .incident .respondents ul.response-collections li.response .response-detail{display:flex;padding:0 0 10px 35px;justify-content:space-between}:host .incident .respondents ul.response-collections li.response .response-detail .details{flex:1 1;display:flex;flex-direction:column;justify-content:space-between}:host .incident .respondents ul.response-collections li.response .response-detail .details .contact-details{flex:1 1}:host .incident .respondents ul.response-collections li.response .response-detail .details .contact-details .name{padding:0 0 5px 0}:host .incident .respondents ul.response-collections li.response .response-detail .details .contact-details .tel{display:block;padding:0 0 5px 0;color:var(--primary-color, #15233b);text-decoration:none;font-weight:600}:host .incident .respondents ul.response-collections li.response .response-detail .details .actions{flex:none;display:flex;margin:20px 0 0 0}:host .incident .respondents ul.response-collections li.response .response-detail .details .actions ct-button+ct-button{margin:0 0 0 5px}:host .incident .respondents ul.response-collections li.response .response-detail .history{flex:0 0 80px;margin:-6px 0 0 auto}:host .incident .respondents ul.response-collections li.response .response-detail .history .history-item{display:flex;justify-content:flex-end;align-items:center;margin:3px 0}:host .incident .respondents ul.response-collections li.response .response-detail .history .history-item .time,:host .incident .respondents ul.response-collections li.response .response-detail .history .history-item .response{margin:0 3px}:host .incident .respondents ul.response-collections li.response.on-call.support{background:var(--incident-list-incident-support-role-bg, #f6f6f6);border-bottom:var(--incident-list-incident-support-role-border, 1px solid #fff)}:host .incident .respondents ul.response-collections li.response.off-duty{background-size:5px 5px;background-image:linear-gradient(45deg, transparent 46%, #d8d8d8 49%, #d8d8d8 51%, transparent 55%)}:host .incident.closed{background-color:var(--incident-list-closed-incident-bg, #f2f2f2);color:var(--incident-list-incident-closed-text, #000)}:host .incident.closed .respondents{background-color:var(--incident-list-closed-incident-respondents-bg, #fff)}:host .incident.closed .respondents ul.response-collection li.response{background:var(--incident-list-closed-incident-role-bg, transparent);border-bottom:var(--incident-list-closed-incident-role-border, 1px solid #f0f0f0)}:host .incident.closed .respondents ul.response-collection li.response.on-call.support{background:var(--incident-list-closed-incident-support-role-bg, #f6f6f6);border-bottom:var(--incident-list-closed-incident-support-role-border, 1px solid #fff)}
        `}renderIncident(W){const X=['incident',this._options.collapseMode,`severity-${W.severity.id}`,`priority-${W.priority.id}`];return W.status===M.IncidentStatus.Closed&&X.push('closed'),W.isTestIncident&&X.push('test'),window.__CTRender('div',{class:X.join(' ')},this._renderHeader(W),H.renderIf(this._incidentExpanded,this._renderResponses(W)))}_renderHeader(W){return Y.IncidentHeader.generateMobileHeader(this.hostComponent,W,this._options.headerOptions,this._headerExpanded,this._toggleExpandHeader.bind(this))}_renderResponses(W){const X=this._getResponseCollections(W);return window.__CTRender('div',{class:'respondents'},window.__CTRender('ul',{class:'response-collections'},X.map((K)=>this._renderResponse(W,K))))}_renderResponse(W,X){const K=this._responseExpanded[X.roleName]||!1,Q=['response'];Q.push(X.isAttender?'attender':'support'),Q.push(X.wasOnCall?this._options.showRespondentCurrentOnCallStatus?X.isCurrentlyOnCall?'on-call':'off-duty':'on-call':'off-duty'),K&&Q.push('expanded');const Z=this._getResponseHistory(X),ee=Z[0]||null;return window.__CTRender('li',{class:Q.join(' ')},window.__CTRender('div',{class:'response-summary col-group',onClick:()=>this._toggleExpandResponse(X)},H.renderIf(this._options.showRespondentOnlineStatus,window.__CTRender('div',{class:'col col-status'},window.__CTRender(z.CTILOnlineStatusPill,{status:X.isOnline?I.ConnectionStatus.Connected:I.ConnectionStatus.Disconnected,showLabel:!1}))),window.__CTRender('div',{class:'col col-role'},X.roleName),window.__CTRender('div',{class:'col col-time'},B.formatDate(ee&&ee.time,'HH:mm')),window.__CTRender('div',{class:'col col-response'},window.__CTRender($.CTILIncidentResponsePill,{pillStyle:'primary',status:ee&&ee.status,label:'',collapsed:!0}))),H.renderIf(K,window.__CTRender('div',{class:'response-detail'},window.__CTRender('div',{class:'details'},window.__CTRender('div',{class:'contact-details'},window.__CTRender('div',{class:'name'},X.onCallUserName),H.renderIf(this._options.showRespondentTelNumber&&X.onCallUserTelephone&&1<X.onCallUserTelephone.length,window.__CTRender('a',{class:'tel',href:`tel:${X.onCallUserTelephone}`},X.onCallUserTelephone))),this._renderActions(W,X)),window.__CTRender('div',{class:'history'},this._renderResponseHistory(X)))))}_renderActions(W,X){if(!this._options.allowFlagArrived&&!this._options.allowFlagStandIn)return null;const K=this._connectionStatus!==I.ConnectionStatus.Connected,Q=[];if(this._options.allowFlagArrived&&X.isAttender&&X.wasOnCall&&X.responseType!==M.ResponseStatus.Unable){const Z=null===X.arrivedDate?null:M.Icons.UI.Tick;Q.push(window.__CTRender(G.CTButton,{type:'secondary',disabled:K,icon:Z,iconWidth:'14px',iconHeight:'14px',onClick:()=>this._toggleArrived(W,X)},'Arrived'))}if(this._options.allowFlagStandIn&&X.isAttender){const Z=null===X.standInDate?null:M.Icons.UI.Tick;Q.push(window.__CTRender(G.CTButton,{type:'secondary',disabled:K,icon:Z,iconWidth:'14px',iconHeight:'14px',onClick:()=>this._toggleStandIn(W,X)},'Stand-in'))}return 0===Q.length?null:window.__CTRender('div',{class:'actions'},Q)}_toggleExpandHeader(){const W='summary'===this._options.collapseMode,X='detail'===this._options.collapseMode;W&&(this._headerExpanded=!this._headerExpanded,this._incidentExpanded=!this._incidentExpanded,this.redrawComponent()),X&&(this._headerExpanded=!this._headerExpanded,this._incidentExpanded=!0,this.redrawComponent())}_toggleExpandResponse(W){const X='summary'===this._options.collapseMode;X||(this._responseExpanded[W.roleName]=!(this._responseExpanded[W.roleName]||!1),this.redrawComponent())}_toggleArrived(W,X){const K=null===X.arrivedDate?M.StateChangeType.Add:M.StateChangeType.Remove;this.emitEvent(A.IncidentEvents._Request_ChangeResponderState,new A.ChangeResponderStateEventArgs(W.id,X.jid,M.ResponderState.Arrived,K))}_toggleStandIn(W,X){const K=null===X.standInDate?M.StateChangeType.Add:M.StateChangeType.Remove;this.emitEvent(A.IncidentEvents._Request_ChangeResponseCollectionState,new A.ChangeResponseCollectionStateEventArgs(W.id,X.roleId,M.ResponseCollectionState.StandInArranged,K))}_getResponseCollections(W){let X=[...(W.responses||[])];return X=N.filterIncidentResponses(X,'status',this._options.respondentStatusFilter),X=N.orderIncidentRespondents(X,this._options.respondentOrderBy,this._options.respondentOrderByReverse),X.map((K)=>D.incidentResponseCollectionToRoleResponse(W,K,this._users,this.layer.config.roles))}_getResponseHistory(W){const X=[];return null!==W.standInDate&&X.push({time:W.standInDate,status:M.ResponseStatus.StandIn}),null!==W.arrivedDate&&X.push({time:W.arrivedDate,status:M.ResponseStatus.Arrived}),W.responseDate&&W.responseType&&X.push({time:W.responseDate,status:W.responseType}),W.receivedDate&&X.push({time:W.receivedDate,status:M.ResponseStatus.Received}),W.transmittedDate&&X.push({time:W.transmittedDate,status:M.ResponseStatus.Transmitted}),X}_renderResponseHistory(W){const X=this._getResponseHistory(W);return X.splice(0,1),X.map((K)=>this._renderHistoryItem(K))}_renderHistoryItem(W){return window.__CTRender('div',{class:'history-item'},window.__CTRender('div',{class:'time'},B.formatDate(W.time,'HH:mm')),window.__CTRender('div',{class:'response'},window.__CTRender($.CTILIncidentResponsePill,{pillStyle:'secondary',status:W.status,label:'',collapsed:!0})))}}f.RoleOnCallMobileIncidentView=J},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const I=h(119),R=h(120),A=h(118),M=h(117),N=new Map;f.getView=function(D,B,H){0===N.size&&(N.set('roleoncall',I.RoleOnCallIncidentView),N.set('roleoncallmobile',R.RoleOnCallMobileIncidentView),N.set('responsesummary',A.ResponseSummaryIncidentView),N.set('respondersummarymobile',M.ResponderSummaryMobileIncidentView));const z=N.get((D||'').toLowerCase())||null;return null===z?null:new z(B,H)}},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(23);class I extends E.ViewBase{constructor(R){super(R)}}f.ReportListViewBase=I},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(122),A=h(0),M=h(7),N=h(3),D=h(4),B=h(5);class H extends R.ReportListViewBase{constructor(z,$){super(z);this._options=N.mergeDeep({},{},$)}initialize(){return E(this,void 0,void 0,function*(){this._connectionStatus=this.layer.getConnectionStatus(),this._downloadsProcessing=[]})}setupListeners(){this.addListener(A.IncidentEvents.ConnectionStatusChange,()=>{this._connectionStatus=this.layer.getConnectionStatus(),this.redrawComponent()})}renderStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host .report-table{margin:10px 0 0 0}:host .report-table .report-table-header{font-size:12px;font-weight:300;color:#9b9b9b;margin:10px 0 0 0;padding:0 10px}:host .report-table .col-group{display:flex;flex-direction:row;flex-wrap:wrap}:host .report-table .col-group.ready .col-status .icon{color:var(--response-status-accepted-bg, #55950c)}:host .report-table .col-group.failed .col-status .icon{color:var(--response-status-declined-bg, #d0021c)}:host .report-table .col-group .col{padding:3px}:host .report-table .col-group .col:first-child{padding-left:0}:host .report-table .col-group .col.col-type,:host .report-table .col-group .col.col-dates,:host .report-table .col-group .col.col-requested,:host .report-table .col-group .col.col-status{flex:1 0}:host .report-table .col-group .col.col-type{font-weight:600}:host .report-table .col-group .col.col-status .data .sub-data{margin-left:17px}:host .report-table .col-group .col.col-btns{flex:0 0 120px;display:flex;justify-content:flex-end}:host .report-table .col-group .col.col-btns ct-button{width:115px;height:36px;font-size:14px;background:#ffffff}:host .report-table .col-group .col .label{font-size:12px;font-weight:300;color:#9b9b9b}:host .report-table .col-group .col .data .icon,:host .report-table .col-group .col .data .text{display:inline-flex}:host .report-table .col-group .col .data .icon{margin:0 5px 0 0}:host .report-table .col-group .col .data .sub-data{font-size:12px;font-weight:400}:host .report-table .col-group .col:last-child{padding-right:0}:host .report-table .col-group .col-rwd-break{display:none}:host .report-table ul.reports{list-style-type:none;margin:0;padding:0}:host .report-table ul.reports li.report{font-size:15px;font-weight:400;margin:0;padding:10px;border-bottom:1px solid #f0f0f0}:host .report-table ul.reports li.report .col.col-role{display:flex;align-items:center}:host .report-table .large-screen{position:inherit;top:auto;left:auto}:host .report-table .small-screen{position:fixed;top:-9999px;left:-9999px}@media screen and (max-width: 768px){:host .report-table .report-table-header{padding:0 15px;font-size:10px}:host .report-table .col-group .col-type{margin-right:130px}:host .report-table .col-group .col-type,:host .report-table .col-group .col-dates{padding-bottom:10px}:host .report-table .col-group .col-rwd-break+.col{padding-left:0}:host .report-table .col-group .col-btns{margin-left:auto}:host .report-table .col-group .col-rwd-break{display:block;flex:1 1 100%}:host .report-table ul.reports li.report{position:relative;padding:8px 15px}:host .report-table ul.reports li.report .col.col-btns{position:absolute;top:6px;right:10px;display:block}:host .report-table .large-screen{position:fixed;top:-9999px;left:-9999px}:host .report-table .small-screen{position:inherit;top:auto;left:auto}}
        `}render(z){return window.__CTRender('div',{class:'report-table'},window.__CTRender('div',{class:'report-table-header col-group large-screen'},window.__CTRender('div',{class:'col col-type'},window.__CTRender('span',{class:'label'},'Report')),window.__CTRender('div',{class:'col col-requested'},window.__CTRender('span',{class:'label'},'Requested')),window.__CTRender('div',{class:'col col-status'},window.__CTRender('span',{class:'label'},'Status')),window.__CTRender('div',{class:'col col-btns'})),window.__CTRender('ul',{class:'reports'},(z||[]).map(($)=>this._renderReport($))))}_renderReport(z){const $=this._connectionStatus!==I.ConnectionStatus.Connected,Y=this._downloadsProcessing.includes(z.id),G=['report','col-group'];return z.status===M.ReportStatus.Pending&&G.push('pending'),z.status===M.ReportStatus.Ready&&G.push('ready'),z.status===M.ReportStatus.Failed&&G.push('failed'),window.__CTRender('li',{class:G.join(' ')},window.__CTRender('div',{class:'col col-type'},window.__CTRender('div',{class:'data'},z.type.name||z.type.id,window.__CTRender('div',{class:'sub-data'},N.formatDate(z.startDate,'Do MMM YYYY'),' - ',N.formatDate(z.endDate,'Do MMM YYYY')))),window.__CTRender('div',{class:'col-rwd-break'}),window.__CTRender('div',{class:'col col-requested'},window.__CTRender('div',{class:'label small-screen'},'Requested:'),window.__CTRender('div',{class:'data'},N.formatDateForTimeOrDate(z.requested.date,!0),window.__CTRender('div',{class:'sub-data'},'Requested by: ',z.requested.name))),window.__CTRender('div',{class:'col col-status'},window.__CTRender('div',{class:'label small-screen'},'Status:'),this._renderReportStatus(z)),window.__CTRender('div',{class:'col col-btns'},D.renderIf(z.status===M.ReportStatus.Ready,window.__CTRender(B.CTButton,{class:'download-button',type:'primary',disabled:$||Y,isWaiting:Y,onclick:()=>this._downloadReport(z)},'Download'))))}_renderReportStatus(z){switch(z.status){case M.ReportStatus.Pending:return window.__CTRender('div',{class:'data'},window.__CTRender('div',{class:'icon'},window.__CTRender(B.CTIcon,{icon:I.Icons.COMMON.LoadingSpinner,width:'12px',height:'12px',spin:!0})),window.__CTRender('div',{class:'text'},'Processing...'));case M.ReportStatus.Ready:const $=0<z.completed?N.prettyDuration(z.completed-z.requested.date):'';return window.__CTRender('div',{class:'data'},window.__CTRender('div',{class:'icon'},window.__CTRender(B.CTIcon,{icon:M.Icons.UI.Tick,width:'12px',height:'12px'})),window.__CTRender('div',{class:'text'},'Ready'),window.__CTRender('div',{class:'sub-data'},'Report took ',$));case M.ReportStatus.Failed:return window.__CTRender('div',{class:'data'},window.__CTRender('div',{class:'icon'},window.__CTRender(B.CTIcon,{icon:M.Icons.UI.Cross,width:'12px',height:'12px'})),window.__CTRender('div',{class:'text'},'Failed'));}}_downloadReport(z){return E(this,void 0,void 0,function*(){if(this.layer.config.reporting&&!0===this.layer.config.reporting.enabled){this._setDownloading(z,!0);try{const $=yield this.layer.downloadFile(z.url);null!==$&&this.emitEvent(A.IncidentEvents.ReportDownloaded,new A.ReportDownloadEventArgs($,z)),this._setDownloading(z,!1)}catch($){this._setDownloading(z,!1)}}})}_setDownloading(z,$){if($)this._downloadsProcessing.includes(z.id)||(this._downloadsProcessing.push(z.id),this.redrawComponent());else{const Y=this._downloadsProcessing.findIndex((G)=>G===z.id);-1!==Y&&(this._downloadsProcessing.splice(Y,1),this.redrawComponent())}}}f.ReportTableReportListView=H},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const I=h(123),R=new Map;f.getView=function(A,M,N){0===R.size&&R.set('reporttable',I.ReportTableReportListView);const D=R.get((A||'').toLowerCase())||null;return null===D?null:new D(M,N)}},function(u,f,h){'use strict';var E=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const I=h(1),R=h(126),A=h(0),M=h(3),N=h(4),D=h(17);class B extends R.UserListViewBase{constructor(H,z){super(H);this._options=M.mergeDeep({},{},z),this._roles=null,this._users=null}initialize(){return E(this,void 0,void 0,function*(){this._roles=this.layer.config.roles,this._users=yield this.layer.getOnCallUsers(),this._connectionStatus=this.layer.getConnectionStatus()})}setupListeners(){this.addListeners([A.IncidentEvents.OnCallUsersChange,A.IncidentEvents.UserLastSeenChange,A.IncidentEvents.OtherUserConnectionStatusChange],()=>E(this,void 0,void 0,function*(){this._users=yield this.layer.getOnCallUsers(),this.redrawComponent()}))}renderStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block}:host .user-list{margin:10px 0 0 0}:host .user-list .user-list-header{font-size:12px;font-weight:300;color:#9b9b9b;margin:10px 0 0 0;padding:0 10px}:host .user-list .col-group{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center}:host .user-list .col-group .col{padding:3px}:host .user-list .col-group .col:first-child{padding-left:0}:host .user-list .col-group .col.col-status{flex:0 0 80px;display:flex;justify-content:center;text-align:center}:host .user-list .col-group .col.col-role,:host .user-list .col-group .col.col-name,:host .user-list .col-group .col.col-tel,:host .user-list .col-group .col.col-time{flex:1 0}:host .user-list .col-group .col.col-role{margin:0 0 0 10px}:host .user-list .col-group .col.col-tel .tel-link{color:var(--primary-color, #15233b);font-weight:var(--font-weight-semibold, 600);text-decoration:none}:host .user-list .col-group .col.col-combined{flex:1 1}:host .user-list .col-group .col:last-child{padding-right:0}:host .user-list .col-group .col-rwd-break{display:none}:host .user-list ul.roles-users{list-style-type:none;margin:0;padding:0}:host .user-list ul.roles-users li.role-user{font-size:15px;font-weight:400;margin:0;padding:10px;border-bottom:1px solid #f0f0f0}:host .user-list ul.roles-users li.role-user .col.col-role{display:flex;align-items:center}:host .user-list ul.roles-users li.role-user .col.col-role:before{content:'';display:block;height:30px}:host .user-list ul.roles-users li.role-user.off-duty{background-size:5px 5px;background-image:linear-gradient(45deg, transparent 46%, #d8d8d8 49%, #d8d8d8 51%, transparent 55%)}:host .user-list .large-screen{position:inherit;top:auto;left:auto}:host .user-list .small-screen{position:fixed;top:-9999px;left:-9999px}@media screen and (max-width: 640px){:host .user-list .user-list-header{padding:0 15px;font-size:10px}:host .user-list .col-group .col.col-status{flex:0 0 30px}:host .user-list .col-group .col.col-combined{margin:0 0 0 10px}:host .user-list .col-group .col.col-time{flex:0 0 60px;text-align:right}:host .user-list .col-group .col-rwd-break{display:block;flex:1 1 100%}:host .user-list ul.roles-users li.role-user{position:relative;padding:8px 15px}:host .user-list ul.roles-users li.role-user .col.col-status{position:absolute;top:8px;left:15px;width:30px}:host .user-list ul.roles-users li.role-user .col.col-role,:host .user-list ul.roles-users li.role-user .col.col-name,:host .user-list ul.roles-users li.role-user .col.col-tel{margin:0 0 0 40px;padding:0 6px}:host .user-list ul.roles-users li.role-user .col.col-role:before{height:auto;display:none}:host .user-list ul.roles-users li.role-user .col.col-time{position:absolute;top:6px;right:15px;width:42px;text-align:left}:host .user-list .large-screen{position:fixed;top:-9999px;left:-9999px}:host .user-list .small-screen{position:inherit;top:auto;left:auto}}
        `}render(){return window.__CTRender('div',{class:'user-list'},window.__CTRender('div',{class:'user-list-header col-group'},window.__CTRender('div',{class:'col col-status'},window.__CTRender('span',{class:'label'},'Status')),window.__CTRender('div',{class:'col col-role large-screen'},window.__CTRender('span',{class:'label'},'Role')),window.__CTRender('div',{class:'col col-name large-screen'},window.__CTRender('span',{class:'label'},'On-call')),window.__CTRender('div',{class:'col col-tel large-screen'},window.__CTRender('span',{class:'label'},'Contact Tel')),window.__CTRender('div',{class:'col col-combined small-screen'},window.__CTRender('span',{class:'label'},'Role / On-call / Contact Telephone')),window.__CTRender('div',{class:'col col-time'},window.__CTRender('span',{class:'label'},'Last contact'))),window.__CTRender('ul',{class:'roles-users'},(this._roles||[]).map((H)=>this._renderRole(H))))}_renderRole(H){const z=this._users.find((K)=>K.role&&K.role.id===H.id),$=['role-user','col-group'];$.push(H.attender?'attender':'support'),$.push(z&&z.connectionStatus===I.ConnectionStatus.Connected?'online':'offline'),$.push(z&&z.isOnCall?'on-call':'off-duty');const Y=z&&z.connectionStatus||I.ConnectionStatus.Disconnected,G=z&&z.displayName||'Off Duty',J=z&&z.telephone||'-',W=z&&z.lastSeenDate?M.formatDate(z.lastSeenDate,'HH:mm'):'-';return window.__CTRender('li',{class:$.join(' ')},window.__CTRender('div',{class:'col col-status'},window.__CTRender(D.CTILOnlineStatusPill,{class:'large-screen',status:Y,showLabel:!0}),window.__CTRender(D.CTILOnlineStatusPill,{class:'small-screen',status:Y,showLabel:!1})),window.__CTRender('div',{class:'col col-role'},H.name),window.__CTRender('div',{class:'col-rwd-break'}),window.__CTRender('div',{class:'col col-name'},G),window.__CTRender('div',{class:'col-rwd-break'}),window.__CTRender('div',{class:'col col-tel large-screen'},J),window.__CTRender('div',{class:'col col-tel small-screen'},N.renderIfElse('-'!==J,window.__CTRender('a',{class:'tel-link',href:`tel:${J}`},J),window.__CTRender('span',null,J))),window.__CTRender('div',{class:'col col-time'},W))}}f.RoleOnCallUserListView=B},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const E=h(23);class I extends E.ViewBase{constructor(R){super(R)}}f.UserListViewBase=I},function(u,f,h){'use strict';Object.defineProperty(f,'__esModule',{value:!0});const I=h(125),R=new Map;f.getView=function(A,M,N){0===R.size&&R.set('roleoncall',I.RoleOnCallUserListView);const D=R.get((A||'').toLowerCase())||null;return null===D?null:new D(M,N)}},function(u,f,h){'use strict';var E=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,G=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(J=B[W])&&(G=(3>Y?J(G):3<Y?J(H,z,G):J(H,z))||G);return 3<Y&&G&&Object.defineProperty(H,z,G),G},I=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(6),M=h(32),N=h(5);class D extends R.CTLayerComponent{static get is(){return'ct-alert-modal-manager'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(A.BaseEvents._Request_RaiseAlert,(B)=>this.raiseAlert(B)),this.addListener(A.BaseEvents._Request_CloseAlert,(B)=>this.dismissAlertById(B))}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:none;width:100%;height:100%;background:var(--modal-overlay, rgba(0,0,0,0.5));position:fixed;top:0;z-index:1000;padding:20px;overflow:auto}:host .alerts{display:flex;width:100%;max-width:420px;margin:auto;position:relative}:host([alerts-to-show]){display:flex}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:'alerts'},this.alerts.map((B,H)=>window.__CTRender(N.CTAlertModal,{id:B.id||M.DefaultAlerts.generateId(),raisedOn:B.raisedOn,priority:B.priority,type:B.type,title:B.title,body:B.body,buttons:B.buttons,remaining:this.alerts.length,positionInStack:H,showLoadingAnimation:B.showLoadingAnimation,overrideHeaderColour:B.overrideHeaderColour})))}raiseAlert(B){if(B){if(B.buttons)for(const H of B.buttons)if(!H.action)H.action=()=>this.dismissAlert();else{const z=H.action.bind(this);H.action=($)=>{z($),this.dismissAlert()}}this.alerts=[...this.alerts,B],this.alertsToShow=!0}}dismissAlert(B=0){this.alerts.splice(B,1),0===this.alerts.length?this.alertsToShow=!1:this.alerts=this.alerts.map((H)=>{return H.remaining=this.alerts.length,H})}dismissAlertById(B){const H=this.alerts.findIndex((z)=>z.id===B);-1!==H&&this.dismissAlert(H)}}E([R.prop({type:Boolean,attribute:!0,default:!1})],D.prototype,'alertsToShow',void 0),E([R.prop({type:Array,attribute:!1,default:[]})],D.prototype,'alerts',void 0),f.CTAlertModalManager=D,D.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,G=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(J=B[W])&&(G=(3>Y?J(G):3<Y?J(H,z,G):J(H,z))||G);return 3<Y&&G&&Object.defineProperty(H,z,G),G},I=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(33),M=h(5),N=h(4);class D extends R.CTLayerComponent{static get is(){return'ct-alert-modal'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:none;width:100%;height:100%;flex-direction:column;background-color:var(--modal-bg, #fff)}:host .alert-dialog{overflow:hidden}:host .alert-dialog .remaining{position:absolute;width:35px;height:35px;background-color:red;border-radius:50%;text-align:center;line-height:35px;color:white;right:-5%;top:-5%}:host .alert-dialog .title{display:flex;justify-content:center;text-align:center;font-size:15px;text-transform:uppercase;margin:0 auto;padding:10px}:host .alert-dialog .body{display:flex;justify-content:center;text-align:center;align-items:flex-start;font-size:18px;font-weight:300;padding:50px}:host .alert-dialog .body ct-icon{flex:none;margin:3px 10px 0 0}:host .alert-dialog .buttons{padding:10px 5px;flex:none;display:flex;flex-wrap:wrap;flex-direction:row;justify-content:space-between}:host .alert-dialog .buttons ct-button{flex:1;margin:0 5px}:host .alert-dialog .buttons ct-button.overflex{flex-basis:100%}:host .alert-dialog .buttons ct-button.overflex+ct-button{margin-top:10px}:host .alert-dialog.error .title{background-color:var(--alert-error-bg, #c80031);color:var(--alert-error-text, #fff)}:host .alert-dialog.info .title{background-color:var(--alert-info-bg, #15233b);color:var(--alert-info-text, #fff)}:host .alert-dialog.question .title{background-color:var(--alert-question-bg, #15233b);color:var(--alert-question-text, #fff)}:host .alert-dialog.success .title{background-color:var(--alert-success-bg, #bcdf90);color:var(--alert-success-text, #fff)}:host([showing]){display:flex;z-index:10}:host([stacked]){display:flex;position:absolute;bottom:5px;right:5px;z-index:1}:host([stacked]):before{content:'';display:block;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.25)}
        `}generateComponentMarkup(){const B=A.Icons.COMMON.LoadingSpinner,H=5*this.positionInStack;this.style.right=`${H}px`,this.style.bottom=`${H}px`,this.style.zIndex=`${this.remaining-this.positionInStack}`,0===this.positionInStack?this.showing=!0:this.stacked=!0;const z={};this.overrideHeaderColour&&''!==this.overrideHeaderColour&&(z.backgroundColor=this.overrideHeaderColour);const $=N.buildStyles(z);return window.__CTRender('div',{"alert-id":this.id,class:`alert-dialog ${this.type}`},1<this.remaining&&this.showing?window.__CTRender('div',{class:'remaining'},this.remaining):null,window.__CTRender('div',{class:'title',style:$},this.renderHtml(this.title)),window.__CTRender('div',{class:'body'},N.renderIf(this.showLoadingAnimation,window.__CTRender(M.CTIcon,{class:'loading',width:'18',height:'18',spin:!0,icon:B})),window.__CTRender('div',{class:'message'},this.renderHtml(this.body))),N.renderIf(!!this.buttons&&0<this.buttons.length,window.__CTRender('div',{class:'buttons'},this.buttons.map((Y,G)=>window.__CTRender(M.CTButton,{type:Y.type,disabled:Y.disabled,class:`${2<this.buttons.length?'overflex':''} ${2===this.buttons.length&&0===G?'right-border':''}`,onClick:(J)=>Y.action(J.target.textContent)},Y.text)))))}}E([R.prop({type:Boolean,attribute:!0,default:!1})],D.prototype,'showing',void 0),E([R.prop({type:String,attribute:!1,default:0})],D.prototype,'id',void 0),E([R.prop({type:Number,attribute:!1,default:0})],D.prototype,'raisedOn',void 0),E([R.prop({type:Number,attribute:!1,default:0})],D.prototype,'priority',void 0),E([R.prop({type:String,attribute:!1,default:'info'})],D.prototype,'type',void 0),E([R.prop({type:String,attribute:!1,default:''})],D.prototype,'title',void 0),E([R.prop({type:String,attribute:!1,default:''})],D.prototype,'body',void 0),E([R.prop({type:Array,attribute:!1,default:[]})],D.prototype,'buttons',void 0),E([R.prop({type:Number,attribute:!1,default:0})],D.prototype,'remaining',void 0),E([R.prop({type:Number,attribute:!1,default:0})],D.prototype,'positionInStack',void 0),E([R.prop({type:Boolean,attribute:!1,default:!1})],D.prototype,'showLoadingAnimation',void 0),E([R.prop({type:String,attribute:!1,default:''})],D.prototype,'overrideHeaderColour',void 0),E([R.prop({type:Boolean,attribute:!0,default:!1})],D.prototype,'stacked',void 0),f.CTAlertModal=D,D.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,G=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(J=B[W])&&(G=(3>Y?J(G):3<Y?J(H,z,G):J(H,z))||G);return 3<Y&&G&&Object.defineProperty(H,z,G),G},I=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(18),M=h(5),N=h(1);class D extends R.CTLayerComponent{constructor(){super(...arguments),this.btnClick=()=>I(this,void 0,void 0,function*(){const B=yield A.CtXmppClient.pickFile({mimeTypes:this.fileTypes});this.callback&&this.callback(B)})}static get is(){return'ct-file-picker'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return``}generateComponentMarkup(){return window.__CTRender('div',null,window.__CTRender(M.CTButton,{icon:N.Icons.COMMON.PlusSign,iconColor:'#fff',onClick:this.btnClick}))}}E([R.prop({type:Array,attribute:!0,default:['image/jpeg','image/png','image/gif']})],D.prototype,'fileTypes',void 0),E([R.prop({type:Function,attribute:!1})],D.prototype,'callback',void 0),f.CTFilePicker=D,D.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(N,D,B,H){var z=arguments.length,$=3>z?D:null===H?H=Object.getOwnPropertyDescriptor(D,B):H,Y;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)$=Reflect.decorate(N,D,B,H);else for(var G=N.length-1;0<=G;G--)(Y=N[G])&&($=(3>z?Y($):3<z?Y(D,B,$):Y(D,B))||$);return 3<z&&$&&Object.defineProperty(D,B,$),$},I=this&&this.__awaiter||function(N,D,B,H){return new(B||(B=Promise))(function(z,$){function Y(W){try{J(H.next(W))}catch(X){$(X)}}function G(W){try{J(H['throw'](W))}catch(X){$(X)}}function J(W){W.done?z(W.value):new B(function(X){X(W.value)}).then(Y,G)}J((H=H.apply(N,D||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(4);class M extends R.CTLayerComponent{static get is(){return'ct-icon'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:flex}:host svg{margin:auto}:host([spin]) svg{animation:spin 1s infinite linear;transform-origin:50% 50%}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        `}generateComponentMarkup(){if(!this.icon)return null;const N=A.buildStyles({fill:'auto'===this.color?window.getComputedStyle(this.parentElement).color:this.color,width:this.width,height:this.height}),D=this.icon.viewBox||'0 0 1024 1024',B=this.icon.paths||[];return window.__CTRender('svg',{width:this.width,height:this.height,viewBox:D,style:N},B.map((H)=>window.__CTRender('path',{d:H})))}}E([R.prop({type:String,attribute:!0})],M.prototype,'width',void 0),E([R.prop({type:String,attribute:!0})],M.prototype,'height',void 0),E([R.prop({type:String,attribute:!0,default:'auto'})],M.prototype,'color',void 0),E([R.prop({type:Boolean,attribute:!0,default:!1})],M.prototype,'spin',void 0),E([R.prop({type:Object,attribute:!1,default:null})],M.prototype,'icon',void 0),f.CTIcon=M,M.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(H,z,$,Y){var G=arguments.length,J=3>G?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(J=(3>G?W(J):3<G?W(z,$,J):W(z,$))||J);return 3<G&&J&&Object.defineProperty(z,$,J),J},I=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(6),M=h(4),N=h(5),D=h(1);class B extends R.CTLayerComponent{static get is(){return'ct-login-form'}initialize(){return I(this,void 0,void 0,function*(){this._resetFields()})}setupListeners(){this.addListener(A.BaseEvents.ConnectionStatusChange,(H)=>{switch(H.status){case D.ConnectionStatus.Connected:this.userLoggedIn=!0,this.isWaiting=!1;break;case D.ConnectionStatus.Connecting:this.isWaiting=!0;break;default:this.userLoggedIn=!1;}})}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block;width:100%;margin:auto}:host .form{display:flex;flex-direction:column;width:100%}:host .form .form-field,:host .form .form-buttons{margin:5px 0}
        `}generateComponentMarkup(){return this.userLoggedIn?this._renderLogoutForm():this._renderLoginForm()}_renderLoginForm(){const H=M.buildStyles({display:this.hideUsername?'none':'block'});return window.__CTRender('div',{class:'form'},window.__CTRender('div',{class:'form-field',style:H},window.__CTRender(N.CTTextbox,{type:'text',placeholder:'Username',name:'username',defaultValue:this._username,disabled:this.disableUsername||this.isWaiting,callback:(z)=>this._onChange(z),returnKeypress:()=>this._login()})),window.__CTRender('div',{class:'form-field'},window.__CTRender(N.CTTextbox,{type:'password',placeholder:'Password',name:'password',defaultValue:this._password,callback:(z)=>this._onChange(z),disabled:this.isWaiting,returnKeypress:()=>this._login()})),window.__CTRender('div',{class:'form-buttons'},window.__CTRender(N.CTButton,{type:'primary',disabled:this.disabled,onClick:()=>this._login(),isWaiting:this.isWaiting},'Log In')))}_renderLogoutForm(){let H=this.layer.getCurrentUserJid();return this.autoAppendDomainName&&(H=H.split('@').shift()),window.__CTRender('div',{class:'form',style:M.buildStyles({display:'flex'})},window.__CTRender('div',{class:'form-field'},window.__CTRender(N.CTTextbox,{type:'text',placeholder:'Username',name:'username',defaultValue:H,disabled:!0})),window.__CTRender('div',{class:'form-buttons'},window.__CTRender(N.CTButton,{type:'primary',disabled:!1,onClick:()=>this._logout(),isWaiting:this.isWaiting},'Log Out')))}_onChange(H){H&&'username'===H.key&&(this._username=H.value),H&&'password'===H.key&&(this._password=H.value),this.disabled=!this._username||!this._password}_resetFields(){this._username=this.username||'',this._password='',this.disabled=!0}_login(){return I(this,void 0,void 0,function*(){if(this._username&&this._password){this.isWaiting=!0;let H=this.autoAppendDomainName?`${this._username.trim()}@${this.layer.config.xmpp.user.domain}`:this._username.trim();this.layer.config.xmpp.user&&!0===this.layer.config.xmpp.user.forceLowercaseJid&&(H=H.toLowerCase());try{yield this.layer.login(H,this._password),this.emitComponentEvent(A.BaseEvents.LoginFormResult,new A.CommsEventArgs(!0)),this.isWaiting=!1,this._resetFields()}catch(z){this.emitComponentEvent(A.BaseEvents.LoginFormResult,new A.CommsEventArgs(!1,`Could not log in as ${H}`)),this.isWaiting=!1,this._password='',this._onChange(),document.activeElement.blur()}}})}_logout(){return I(this,void 0,void 0,function*(){this.isWaiting=!0;try{yield this.layer.logout(),this.isWaiting=!1,this._resetFields()}catch(H){this.emitComponentEvent(A.BaseEvents.LoginFormResult,new A.CommsEventArgs(!1,`There was an error logging out. Please try again.`)),this.isWaiting=!1,document.activeElement.blur()}})}}E([R.prop({type:R.Stroolean,attribute:!0,default:!0})],B.prototype,'autoAppendDomainName',void 0),E([R.prop({type:String,attribute:!0,default:''})],B.prototype,'username',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],B.prototype,'hideUsername',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],B.prototype,'disableUsername',void 0),E([R.prop({type:Boolean,attribute:!1,default:!1})],B.prototype,'isWaiting',void 0),E([R.prop({type:Boolean,attribute:!1,default:!0})],B.prototype,'disabled',void 0),E([R.prop({type:Boolean,attribute:!1,default:!1})],B.prototype,'userLoggedIn',void 0),f.CTLoginForm=B,B.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(z,$,Y,G){var J=arguments.length,W=3>J?$:null===G?G=Object.getOwnPropertyDescriptor($,Y):G,X;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)W=Reflect.decorate(z,$,Y,G);else for(var K=z.length-1;0<=K;K--)(X=z[K])&&(W=(3>J?X(W):3<J?X($,Y,W):X($,Y))||W);return 3<J&&W&&Object.defineProperty($,Y,W),W},I=this&&this.__awaiter||function(z,$,Y,G){return new(Y||(Y=Promise))(function(J,W){function X(Z){try{Q(G.next(Z))}catch(ee){W(ee)}}function K(Z){try{Q(G['throw'](Z))}catch(ee){W(ee)}}function Q(Z){Z.done?J(Z.value):new Y(function(ee){ee(Z.value)}).then(X,K)}Q((G=G.apply(z,$||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(1),M=h(6),N=h(4),D=h(5),B=h(37);class H extends R.CTLayerComponent{constructor(){super(...arguments),this.attemptCount=0}static get is(){return'ct-online-indicator'}initialize(){return I(this,void 0,void 0,function*(){this.status=this.layer.getConnectionStatus()})}setupListeners(){this.addListener(M.BaseEvents.ConnectionStatusChange,(z)=>{this.status=z.status,this.reconnectTime=z.reconnectTime,this.allowReconnect=z.status===A.ConnectionStatus.Disconnected,clearInterval(this.timeoutId),z.reconnectTime&&(this.timeoutId=setInterval(()=>{this.reconnectTime-=1e3},1e3))},{dontSuppress:!0})}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:inline-flex;font-size:inherit;font-weight:inherit;color:inherit}:host .online-indicator{display:flex;align-items:center}:host .online-indicator .icon{flex:none;margin:0 5px 0 0}:host .online-indicator .label{display:flex;align-items:center;flex:1 1}:host .online-indicator .label .reconnect-detail{display:flex;align-items:center}:host .online-indicator .label .reconnect-detail .countdown{width:40px;padding:0 5px}
        `}generateComponentMarkup(){const z=['online-indicator',this.status===A.ConnectionStatus.Connected?'online':'offline'],$=this.status===A.ConnectionStatus.Connecting?A.Icons.COMMON.LoadingSpinner:this.status===A.ConnectionStatus.Connected?A.Icons.COMMON.StatusOnline:A.Icons.COMMON.StatusOffline;return window.__CTRender('div',{class:z.join(' ')},N.renderIf(this.showIcon,window.__CTRender('div',{class:'icon'},window.__CTRender(D.CTIcon,{width:'16',height:'16',icon:$,spin:this.status===A.ConnectionStatus.Connecting}))),N.renderIf(this.showText,window.__CTRender('div',{class:'label'},window.__CTRender('span',{class:'status'},this._getStatusLabel()),N.renderIf(this.status===A.ConnectionStatus.Disconnected&&this.reconnectTime!==void 0&&0<this.reconnectTime,window.__CTRender('span',{class:'reconnect-detail'},window.__CTRender('span',{class:'countdown'},this._getCountdownLabel()),window.__CTRender(B.CTButton,{type:'invert-secondary',disabled:!this.allowReconnect,onClick:(Y)=>this._tryLoginNow(Y)},'Reconnect'))))))}_getStatusLabel(){switch(this.status){case A.ConnectionStatus.Connected:return'Online';case A.ConnectionStatus.Connecting:return'Reconnecting';case A.ConnectionStatus.Disconnecting:case A.ConnectionStatus.Disconnected:return'Offline';}}_getCountdownLabel(){return`(${this.reconnectTime/1e3}s)`}_tryLoginNow(){!1===this.allowReconnect||(this.allowReconnect=!1,this.status=A.ConnectionStatus.Connecting,this.layer.attemptReconnect())}}E([R.prop({type:R.Stroolean,attribute:!0,default:!0})],H.prototype,'showIcon',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!0})],H.prototype,'showText',void 0),E([R.prop({type:String,attribute:!1,default:A.ConnectionStatus.Disconnected})],H.prototype,'status',void 0),E([R.prop({type:Number,attribute:!1,default:0})],H.prototype,'reconnectTime',void 0),E([R.prop({type:Boolean,attribute:!1,default:!1})],H.prototype,'allowReconnect',void 0),f.CTOnlineIndicator=H,H.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(D,B,H,z){var $=arguments.length,Y=3>$?B:null===z?z=Object.getOwnPropertyDescriptor(B,H):z,G;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Y=Reflect.decorate(D,B,H,z);else for(var J=D.length-1;0<=J;J--)(G=D[J])&&(Y=(3>$?G(Y):3<$?G(B,H,Y):G(B,H))||Y);return 3<$&&Y&&Object.defineProperty(B,H,Y),Y},I=this&&this.__awaiter||function(D,B,H,z){return new(H||(H=Promise))(function($,Y){function G(X){try{W(z.next(X))}catch(K){Y(K)}}function J(X){try{W(z['throw'](X))}catch(K){Y(K)}}function W(X){X.done?$(X.value):new H(function(K){K(X.value)}).then(G,J)}W((z=z.apply(D,B||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(5),M=h(4);class N extends R.CTLayerComponent{static get is(){return'ct-selection-list'}initialize(){return I(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:block;width:100%}:host .selection-list{display:flex;flex-direction:row;flex-wrap:wrap}:host .selection-list .dropdown-contanier{flex:1 1 100%}:host .selection-list .dropdown-contanier select{width:100%;height:30px;background-color:var(--default-bg-color-light, transparent);border:0;color:var(--default-font-color, #000);font-size:15px;outline:var(--default-select-border, 1px solid #000)}:host .selection-list .button-container{position:relative;flex:0 1 50%}:host .selection-list .button-container:nth-child(2n-1){padding:10px 5px 0 0}:host .selection-list .button-container:nth-child(2n-2){padding:10px 0 0 5px}:host .selection-list .button-container:nth-child(1),:host .selection-list .button-container:nth-child(2){padding-top:0}:host .selection-list.button-list{display:block}:host .selection-list.button-list .button-container{display:block;padding:0 0 1px 0}:host .selection-list.button-list .button-container:last-child{padding:0}
        `}generateComponentMarkup(){const B=!this.forceDropdown&&(this.buttonList||this.options.length<=4),H=['selection-list'];return this.buttonList&&H.push('button-list'),window.__CTRender('div',{class:H.join(' ')},M.renderIfElse(B,this._renderButtons(),this._renderDropDown()))}_renderDropDown(){return window.__CTRender('div',{class:'dropdown-contanier'},window.__CTRender('select',{onChange:(D)=>this._onMakeSelection(D),value:this.selected.toString()},this.options.map((D)=>window.__CTRender('option',{"data-key":D.key,value:D.key.toString(),defaultSelected:this.selected===D.key},D.value))))}_renderButtons(){return this.options.map((D)=>window.__CTRender('div',{class:'button-container'},window.__CTRender(A.CTButton,{"data-key":D.key,type:'secondary',selected:this.selected===D.key,onClick:(B)=>this._onMakeSelection(B)},D.value)))}_onMakeSelection(D){const B=D.target;if(!B)return;let H=null;switch(B.nodeName){case'CT-BUTTON':H=parseInt(B.getAttribute('data-key'));break;case'SELECT':H=parseInt(B.value);}if(!isNaN(H)){const z=this.options.find(($)=>$.key===H);z&&(this._makeSelection(z.key),this.selected=z.key)}}_makeSelection(D){'function'==typeof this.onSelect&&this.onSelect(D)}}E([R.prop({type:Number,attribute:!0,default:_NumberMIN_VALUE})],N.prototype,'selected',void 0),E([R.prop({type:R.Stroolean,attribute:!0,default:!1})],N.prototype,'buttonList',void 0),E([R.prop({type:Boolean,attribute:!0,default:!1})],N.prototype,'forceDropdown',void 0),E([R.prop({type:Function,attribute:!0})],N.prototype,'onSelect',void 0),E([R.prop({type:Array,attribute:!1,default:[]})],N.prototype,'options',void 0),f.CTSelectionList=N,N.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(B,H,z,$){var Y=arguments.length,G=3>Y?H:null===$?$=Object.getOwnPropertyDescriptor(H,z):$,J;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)G=Reflect.decorate(B,H,z,$);else for(var W=B.length-1;0<=W;W--)(J=B[W])&&(G=(3>Y?J(G):3<Y?J(H,z,G):J(H,z))||G);return 3<Y&&G&&Object.defineProperty(H,z,G),G},I=this&&this.__awaiter||function(B,H,z,$){return new(z||(z=Promise))(function(Y,G){function J(K){try{X($.next(K))}catch(Q){G(Q)}}function W(K){try{X($['throw'](K))}catch(Q){G(Q)}}function X(K){K.done?Y(K.value):new z(function(Q){Q(K.value)}).then(J,W)}X(($=$.apply(B,H||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(4),M=h(5),N=h(1);class D extends R.CTLayerComponent{constructor(){super(...arguments),this._returnKeypress=(B)=>{13===B.keyCode&&this.returnKeypress?this.returnKeypress():null}}static get is(){return'ct-textbox'}initialize(){return I(this,void 0,void 0,function*(){this._value=this.defaultValue||'',this._isPasswordField=this.type&&'password'===this.type.toLowerCase(),this._isPasswordField&&this._watchPasswordField()})}setupListeners(){}get generateComponentStyles(){return`:host label{color:var(--default-font-color, #9b9b9b)}:host div div.input{display:flex;flex-direction:row;margin:0 0 5px 0;border-bottom:1px solid var(--default-border-color, #9b9b9b)}:host div div.input.focus{border-color:var(--login-form-border-color, green)}:host div div.input input,:host div div.input textarea{flex:1 1;padding:5px;font-size:1em;background-color:var(--default-bg-color-light, transparent);border:none;margin:auto;outline:none;resize:none;color:var(--login-form-font-color, inherit)}:host div div.input input:focus,:host div div.input textarea:focus{border:none;outline-offset:0}:host div div.input input:focus+.clear-value,:host div div.input textarea:focus+.clear-value{opacity:0.5;cursor:pointer}:host div div.input ct-icon{flex:0 0 20px;text-align:center}:host div div.input ct-icon.show-password{opacity:0.5}:host div div.input ct-icon.show-password.show-password-enabled{opacity:1}:host div div.input ct-icon.clear-value{opacity:0}:host div div.input ct-icon+ct-icon{margin:0 0 0 5px}:host div div.input .validation{margin-bottom:1%;color:red}:host div.disabled div.input{border-bottom:none}:host([full-border]) div div.input{border:1px solid var(--default-border-color, #9b9b9b)}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:this.disabled?'disabled':''},A.renderIf(this.label!==void 0,window.__CTRender('label',{htmlFor:this.name},this.label)),window.__CTRender('div',{class:'input'},A.renderIfElse('textarea'===this.type,window.__CTRender('textarea',{placeholder:this.placeholder,name:this.name,onFocus:()=>this._toggleFocus(!0),onBlur:()=>this._toggleFocus(!1),onInput:(B)=>this._updateValue({key:B.target.name,value:B.target.value}),onkeydown:this._returnKeypress,value:this.defaultValue,disabled:this.disabled,rows:5}),window.__CTRender('input',{type:this.type,placeholder:this.placeholder,name:this.name,onFocus:()=>this._toggleFocus(!0),onBlur:()=>this._toggleFocus(!1),onInput:(B)=>this._updateValue({key:B.target.name,value:B.target.value}),onkeydown:this._returnKeypress,value:this.defaultValue,disabled:this.disabled})),A.renderIf(this.showClearOptions&&!this._isPasswordField,window.__CTRender(M.CTIcon,{class:'clear-value',width:'12',height:'12',icon:N.Icons.COMMON.ClearTextbox,onClick:()=>this._clear()})),A.renderIf(this._isPasswordField,window.__CTRender(M.CTIcon,{class:`show-password ${'text'===this.type?'show-password-enabled':''}`,width:'20',height:'20',icon:N.Icons.COMMON.ShowPassword,onClick:()=>this._togglePasswordFieldType()}))),A.renderIf(!this.validated,window.__CTRender('div',{class:'validation'},window.__CTRender('span',null,'This field has a max length of ',this.max,'.'))))}_updateValue(B){this._value=B.value,this._isValidated(),this.callback({key:B.key,value:B.value,validated:this.validated})}_clear(){let B;B='textarea'===this.type?this.shadowRoot.querySelector('textarea'):this.shadowRoot.querySelector('input'),B.value='',B.focus(),B.dispatchEvent(new Event('change'))}_toggleFocus(B){const H=this.shadowRoot.querySelector('.input'),z='textarea'===this.type?H.querySelector('textarea'):H.querySelector('input');B?(H.classList.add('focus'),'scrollIntoViewIfNeeded'in z?z.scrollIntoViewIfNeeded():'scrollIntoView'in z&&z.scrollIntoView()):H.classList.remove('focus')}_isValidated(){this.validated=this._value.length<=this.max}_togglePasswordFieldType(){this._isPasswordField&&('password'===this.type?this.type='text':this.type='password')}_watchPasswordField(){const B=(H)=>{const z=this.shadowRoot.querySelector('.input');if(H.path){const $=H.path.includes(z);!1===$&&'text'===this.type&&(this.type='password')}};document.removeEventListener('click',B),document.addEventListener('click',B)}}E([R.prop({type:String,attribute:!0})],D.prototype,'placeholder',void 0),E([R.prop({type:String,attribute:!0})],D.prototype,'type',void 0),E([R.prop({type:String,attribute:!0})],D.prototype,'label',void 0),E([R.prop({type:String,attribute:!0})],D.prototype,'name',void 0),E([R.prop({type:Boolean,attribute:!0,default:!0})],D.prototype,'showClearOptions',void 0),E([R.prop({type:String,attribute:!0})],D.prototype,'defaultValue',void 0),E([R.prop({type:Boolean,attribute:!0,default:!1})],D.prototype,'disabled',void 0),E([R.prop({type:Boolean,attribute:!0,default:!1})],D.prototype,'fullBorder',void 0),E([R.prop({type:Number,attribute:!0,default:4e3})],D.prototype,'max',void 0),E([R.prop({type:Boolean,attribute:!1,default:!0})],D.prototype,'validated',void 0),f.CTTextbox=D,D.register()},function(u,f,h){'use strict';var E=this&&this.__decorate||function(H,z,$,Y){var G=arguments.length,J=3>G?z:null===Y?Y=Object.getOwnPropertyDescriptor(z,$):Y,W;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)J=Reflect.decorate(H,z,$,Y);else for(var X=H.length-1;0<=X;X--)(W=H[X])&&(J=(3>G?W(J):3<G?W(z,$,J):W(z,$))||J);return 3<G&&J&&Object.defineProperty(z,$,J),J},I=this&&this.__awaiter||function(H,z,$,Y){return new($||($=Promise))(function(G,J){function W(Q){try{K(Y.next(Q))}catch(Z){J(Z)}}function X(Q){try{K(Y['throw'](Q))}catch(Z){J(Z)}}function K(Q){Q.done?G(Q.value):new $(function(Z){Z(Q.value)}).then(W,X)}K((Y=Y.apply(H,z||[])).next())})};Object.defineProperty(f,'__esModule',{value:!0});const R=h(2),A=h(6),M=h(1),N=h(4),D=h(5);class B extends R.CTLayerComponent{static get is(){return'ct-user-display'}initialize(){return I(this,void 0,void 0,function*(){this.username=this.layer.getCurrentXmppDisplayName()})}setupListeners(){this.addListener(A.BaseEvents.ConnectionStatusChange,()=>{this.username=this.layer.getCurrentXmppDisplayName()}),this.addListener(A.BaseEvents.CurrentUserVCardUpdate,()=>{this.username=this.layer.getCurrentXmppDisplayName()})}get generateComponentStyles(){return`:host{color:#212121;font-weight:400}:host h1,:host h2,:host h3,:host h4,:host h5,:host h6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host,:host *{box-sizing:border-box}.user-html p{margin:0}.user-html p+p{margin:.8em 0 0 0}.user-html strong{font-weight:600}:host{display:inline-flex;font-size:inherit;font-weight:inherit;color:inherit}:host .user-display{display:flex;align-items:center}:host .user-display .icon{flex:none;margin:0 5px 0 0}:host .user-display .label{flex:1 1}
        `}generateComponentMarkup(){return window.__CTRender('div',{class:'user-display'},N.renderIf(this.showIcon,window.__CTRender('div',{class:'icon'},window.__CTRender(D.CTIcon,{width:'16',height:'16',icon:M.Icons.COMMON.UserIconEmpty}))),window.__CTRender('div',{class:'label'},this.username))}}E([R.prop({type:R.Stroolean,attribute:!0,default:!0})],B.prototype,'showIcon',void 0),E([R.prop({type:String,attribute:!1})],B.prototype,'username',void 0),f.CTUserDisplay=B,B.register()},function(u,f){'use strict';function E(G){var J=G.length;if(0<J%4)throw new Error('Invalid string. Length must be a multiple of 4');return'='===G[J-2]?2:'='===G[J-1]?1:0}function A(G){return D[63&G>>18]+D[63&G>>12]+D[63&G>>6]+D[63&G]}function M(G,J,W){for(var K=[],Q=J,X;Q<W;Q+=3)X=(G[Q]<<16)+(G[Q+1]<<8)+G[Q+2],K.push(A(X));return K.join('')}f.byteLength=function(G){return 3*G.length/4-E(G)},f.toByteArray=function(G){var Z=G.length,J,W,X,K,Q;K=E(G),Q=new H(3*Z/4-K),W=0<K?Z-4:Z;var ee=0;for(J=0;J<W;J+=4)X=B[G.charCodeAt(J)]<<18|B[G.charCodeAt(J+1)]<<12|B[G.charCodeAt(J+2)]<<6|B[G.charCodeAt(J+3)],Q[ee++]=255&X>>16,Q[ee++]=255&X>>8,Q[ee++]=255&X;return 2===K?(X=B[G.charCodeAt(J)]<<2|B[G.charCodeAt(J+1)]>>4,Q[ee++]=255&X):1===K&&(X=B[G.charCodeAt(J)]<<10|B[G.charCodeAt(J+1)]<<4|B[G.charCodeAt(J+2)]>>2,Q[ee++]=255&X>>8,Q[ee++]=255&X),Q},f.fromByteArray=function(G){for(var W=G.length,X=W%3,K='',Q=[],Z=16383,ee=0,te=W-X,J;ee<te;ee+=Z)Q.push(M(G,ee,ee+Z>te?te:ee+Z));return 1==X?(J=G[W-1],K+=D[J>>2],K+=D[63&J<<4],K+='=='):2==X&&(J=(G[W-2]<<8)+G[W-1],K+=D[J>>10],K+=D[63&J>>4],K+=D[63&J<<2],K+='='),Q.push(K),Q.join('')};for(var D=[],B=[],H='undefined'==typeof Uint8Array?Array:Uint8Array,z='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',$=0,Y=z.length;$<Y;++$)D[$]=z[$],B[z.charCodeAt($)]=$;B['-'.charCodeAt(0)]=62,B['_'.charCodeAt(0)]=63},function(u,f,h){'use strict';(function(E){function R(){return M.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function A(ke,Ue){if(R()<Ue)throw new RangeError('Invalid typed array length');return M.TYPED_ARRAY_SUPPORT?(ke=new Uint8Array(Ue),ke.__proto__=M.prototype):(null===ke&&(ke=new M(Ue)),ke.length=Ue),ke}function M(ke,Ue,Be){if(!M.TYPED_ARRAY_SUPPORT&&!(this instanceof M))return new M(ke,Ue,Be);if('number'==typeof ke){if('string'==typeof Ue)throw new Error('If encoding is specified then the first argument must be a string');return H(this,ke)}return N(this,ke,Ue,Be)}function N(ke,Ue,Be,qe){if('number'==typeof Ue)throw new TypeError('"value" argument must not be a number');return'undefined'!=typeof ArrayBuffer&&Ue instanceof ArrayBuffer?Y(ke,Ue,Be,qe):'string'==typeof Ue?z(ke,Ue,Be):G(ke,Ue)}function D(ke){if('number'!=typeof ke)throw new TypeError('"size" argument must be a number');else if(0>ke)throw new RangeError('"size" argument must not be negative')}function B(ke,Ue,Be,qe){return D(Ue),0>=Ue?A(ke,Ue):void 0===Be?A(ke,Ue):'string'==typeof qe?A(ke,Ue).fill(Be,qe):A(ke,Ue).fill(Be)}function H(ke,Ue){if(D(Ue),ke=A(ke,0>Ue?0:0|J(Ue)),!M.TYPED_ARRAY_SUPPORT)for(var Be=0;Be<Ue;++Be)ke[Be]=0;return ke}function z(ke,Ue,Be){if(('string'!=typeof Be||''===Be)&&(Be='utf8'),!M.isEncoding(Be))throw new TypeError('"encoding" must be a valid string encoding');var qe=0|X(Ue,Be);ke=A(ke,qe);var je=ke.write(Ue,Be);return je!==qe&&(ke=ke.slice(0,je)),ke}function $(ke,Ue){var Be=0>Ue.length?0:0|J(Ue.length);ke=A(ke,Be);for(var qe=0;qe<Be;qe+=1)ke[qe]=255&Ue[qe];return ke}function Y(ke,Ue,Be,qe){if(Ue.byteLength,0>Be||Ue.byteLength<Be)throw new RangeError('\'offset\' is out of bounds');if(Ue.byteLength<Be+(qe||0))throw new RangeError('\'length\' is out of bounds');return Ue=void 0===Be&&void 0===qe?new Uint8Array(Ue):void 0===qe?new Uint8Array(Ue,Be):new Uint8Array(Ue,Be,qe),M.TYPED_ARRAY_SUPPORT?(ke=Ue,ke.__proto__=M.prototype):ke=$(ke,Ue),ke}function G(ke,Ue){if(M.isBuffer(Ue)){var Be=0|J(Ue.length);return(ke=A(ke,Be),0===ke.length)?ke:(Ue.copy(ke,0,0,Be),ke)}if(Ue){if('undefined'!=typeof ArrayBuffer&&Ue.buffer instanceof ArrayBuffer||'length'in Ue)return'number'!=typeof Ue.length||xe(Ue.length)?A(ke,0):$(ke,Ue);if('Buffer'===Ue.type&&Le(Ue.data))return $(ke,Ue.data)}throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')}function J(ke){if(ke>=R())throw new RangeError('Attempt to allocate Buffer larger than maximum size: 0x'+R().toString(16)+' bytes');return 0|ke}function X(ke,Ue){if(M.isBuffer(ke))return ke.length;if('undefined'!=typeof ArrayBuffer&&'function'==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(ke)||ke instanceof ArrayBuffer))return ke.byteLength;'string'!=typeof ke&&(ke=''+ke);var Be=ke.length;if(0===Be)return 0;for(var qe=!1;;)switch(Ue){case'ascii':case'latin1':case'binary':return Be;case'utf8':case'utf-8':case void 0:return Ie(ke).length;case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return 2*Be;case'hex':return Be>>>1;case'base64':return Me(ke).length;default:if(qe)return Ie(ke).length;Ue=(''+Ue).toLowerCase(),qe=!0;}}function K(ke,Ue,Be){var qe=!1;if((void 0===Ue||0>Ue)&&(Ue=0),Ue>this.length)return'';if((void 0===Be||Be>this.length)&&(Be=this.length),0>=Be)return'';if(Be>>>=0,Ue>>>=0,Be<=Ue)return'';for(ke||(ke='utf8');;)switch(ke){case'hex':return me(this,Ue,Be);case'utf8':case'utf-8':return le(this,Ue,Be);case'ascii':return ue(this,Ue,Be);case'latin1':case'binary':return pe(this,Ue,Be);case'base64':return de(this,Ue,Be);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return ge(this,Ue,Be);default:if(qe)throw new TypeError('Unknown encoding: '+ke);ke=(ke+'').toLowerCase(),qe=!0;}}function Q(ke,Ue,Be){var qe=ke[Ue];ke[Ue]=ke[Be],ke[Be]=qe}function Z(ke,Ue,Be,qe,je){if(0===ke.length)return-1;if('string'==typeof Be?(qe=Be,Be=0):2147483647<Be?Be=2147483647:-2147483648>Be&&(Be=-2147483648),Be=+Be,isNaN(Be)&&(Be=je?0:ke.length-1),0>Be&&(Be=ke.length+Be),Be>=ke.length){if(je)return-1;Be=ke.length-1}else if(0>Be)if(je)Be=0;else return-1;if('string'==typeof Ue&&(Ue=M.from(Ue,qe)),M.isBuffer(Ue))return 0===Ue.length?-1:ee(ke,Ue,Be,qe,je);if('number'==typeof Ue)return Ue&=255,M.TYPED_ARRAY_SUPPORT&&'function'==typeof Uint8Array.prototype.indexOf?je?Uint8Array.prototype.indexOf.call(ke,Ue,Be):Uint8Array.prototype.lastIndexOf.call(ke,Ue,Be):ee(ke,[Ue],Be,qe,je);throw new TypeError('val must be string, number or Buffer')}function ee(ke,Ue,Be,qe,je){function He(We,Xe){return 1==Fe?We[Xe]:We.readUInt16BE(Xe*Fe)}var Fe=1,ze=ke.length,$e=Ue.length;if(void 0!==qe&&(qe=(qe+'').toLowerCase(),'ucs2'===qe||'ucs-2'===qe||'utf16le'===qe||'utf-16le'===qe)){if(2>ke.length||2>Ue.length)return-1;Fe=2,ze/=2,$e/=2,Be/=2}var Ve;if(je){var Ye=-1;for(Ve=Be;Ve<ze;Ve++)if(He(ke,Ve)!==He(Ue,-1==Ye?0:Ve-Ye))-1!=Ye&&(Ve-=Ve-Ye),Ye=-1;else if(-1==Ye&&(Ye=Ve),Ve-Ye+1===$e)return Ye*Fe}else for(Be+$e>ze&&(Be=ze-$e),Ve=Be;0<=Ve;Ve--){for(var Ge=!0,Je=0;Je<$e;Je++)if(He(ke,Ve+Je)!==He(Ue,Je)){Ge=!1;break}if(Ge)return Ve}return-1}function te(ke,Ue,Be,qe){Be=+Be||0;var je=ke.length-Be;qe?(qe=+qe,qe>je&&(qe=je)):qe=je;var He=Ue.length;if(0!=He%2)throw new TypeError('Invalid hex string');qe>He/2&&(qe=He/2);for(var Fe=0,ze;Fe<qe;++Fe){if(ze=parseInt(Ue.substr(2*Fe,2),16),isNaN(ze))return Fe;ke[Be+Fe]=ze}return Fe}function ne(ke,Ue,Be,qe){return we(Ie(Ue,ke.length-Be),ke,Be,qe)}function se(ke,Ue,Be,qe){return we(Re(Ue),ke,Be,qe)}function oe(ke,Ue,Be,qe){return se(ke,Ue,Be,qe)}function ae(ke,Ue,Be,qe){return we(Me(Ue),ke,Be,qe)}function ie(ke,Ue,Be,qe){return we(Ae(Ue,ke.length-Be),ke,Be,qe)}function de(ke,Ue,Be){return 0===Ue&&Be===ke.length?Ne.fromByteArray(ke):Ne.fromByteArray(ke.slice(Ue,Be))}function le(ke,Ue,Be){Be=_Mathmin(ke.length,Be);for(var qe=[],je=Ue;je<Be;){var He=ke[je],Fe=null,ze=239<He?4:223<He?3:191<He?2:1;if(je+ze<=Be){var $e,Ve,Ye,Ge;1==ze?128>He&&(Fe=He):2==ze?($e=ke[je+1],128==(192&$e)&&(Ge=(31&He)<<6|63&$e,127<Ge&&(Fe=Ge))):3==ze?($e=ke[je+1],Ve=ke[je+2],128==(192&$e)&&128==(192&Ve)&&(Ge=(15&He)<<12|(63&$e)<<6|63&Ve,2047<Ge&&(55296>Ge||57343<Ge)&&(Fe=Ge))):4==ze?($e=ke[je+1],Ve=ke[je+2],Ye=ke[je+3],128==(192&$e)&&128==(192&Ve)&&128==(192&Ye)&&(Ge=(15&He)<<18|(63&$e)<<12|(63&Ve)<<6|63&Ye,65535<Ge&&1114112>Ge&&(Fe=Ge))):void 0}null===Fe?(Fe=65533,ze=1):65535<Fe&&(Fe-=65536,qe.push(55296|1023&Fe>>>10),Fe=56320|1023&Fe),qe.push(Fe),je+=ze}return ce(qe)}function ce(ke){var Ue=ke.length;if(Ue<=De)return _StringfromCharCode.apply(String,ke);for(var Be='',qe=0;qe<Ue;)Be+=_StringfromCharCode.apply(String,ke.slice(qe,qe+=De));return Be}function ue(ke,Ue,Be){var qe='';Be=_Mathmin(ke.length,Be);for(var je=Ue;je<Be;++je)qe+=_StringfromCharCode(127&ke[je]);return qe}function pe(ke,Ue,Be){var qe='';Be=_Mathmin(ke.length,Be);for(var je=Ue;je<Be;++je)qe+=_StringfromCharCode(ke[je]);return qe}function me(ke,Ue,Be){var qe=ke.length;(!Ue||0>Ue)&&(Ue=0),(!Be||0>Be||Be>qe)&&(Be=qe);for(var je='',He=Ue;He<Be;++He)je+=Ee(ke[He]);return je}function ge(ke,Ue,Be){for(var qe=ke.slice(Ue,Be),je='',He=0;He<qe.length;He+=2)je+=_StringfromCharCode(qe[He]+256*qe[He+1]);return je}function _e(ke,Ue,Be){if(0!=ke%1||0>ke)throw new RangeError('offset is not uint');if(ke+Ue>Be)throw new RangeError('Trying to access beyond buffer length')}function fe(ke,Ue,Be,qe,je,He){if(!M.isBuffer(ke))throw new TypeError('"buffer" argument must be a Buffer instance');if(Ue>je||Ue<He)throw new RangeError('"value" argument is out of bounds');if(Be+qe>ke.length)throw new RangeError('Index out of range')}function he(ke,Ue,Be,qe){0>Ue&&(Ue=65535+Ue+1);for(var je=0,He=_Mathmin(ke.length-Be,2);je<He;++je)ke[Be+je]=(Ue&255<<8*(qe?je:1-je))>>>8*(qe?je:1-je)}function ye(ke,Ue,Be,qe){0>Ue&&(Ue=4294967295+Ue+1);for(var je=0,He=_Mathmin(ke.length-Be,4);je<He;++je)ke[Be+je]=255&Ue>>>8*(qe?je:3-je)}function Ce(ke,Ue,Be,qe){if(Be+qe>ke.length)throw new RangeError('Index out of range');if(0>Be)throw new RangeError('Index out of range')}function Te(ke,Ue,Be,qe,je){return je||Ce(ke,Ue,Be,4,3.4028234663852886e38,-3.4028234663852886e38),Pe.write(ke,Ue,Be,qe,23,4),Be+4}function ve(ke,Ue,Be,qe,je){return je||Ce(ke,Ue,Be,8,1.7976931348623157e308,-1.7976931348623157e308),Pe.write(ke,Ue,Be,qe,52,8),Be+8}function Se(ke){if(ke=be(ke).replace(Oe,''),2>ke.length)return'';for(;0!=ke.length%4;)ke+='=';return ke}function be(ke){return ke.trim?ke.trim():ke.replace(/^\s+|\s+$/g,'')}function Ee(ke){return 16>ke?'0'+ke.toString(16):ke.toString(16)}function Ie(ke,Ue){Ue=Ue||Infinity;for(var qe=ke.length,je=null,He=[],Fe=0,Be;Fe<qe;++Fe){if(Be=ke.charCodeAt(Fe),55295<Be&&57344>Be){if(!je){if(56319<Be){-1<(Ue-=3)&&He.push(239,191,189);continue}else if(Fe+1===qe){-1<(Ue-=3)&&He.push(239,191,189);continue}je=Be;continue}if(56320>Be){-1<(Ue-=3)&&He.push(239,191,189),je=Be;continue}Be=(je-55296<<10|Be-56320)+65536}else je&&-1<(Ue-=3)&&He.push(239,191,189);if(je=null,128>Be){if(0>(Ue-=1))break;He.push(Be)}else if(2048>Be){if(0>(Ue-=2))break;He.push(192|Be>>6,128|63&Be)}else if(65536>Be){if(0>(Ue-=3))break;He.push(224|Be>>12,128|63&Be>>6,128|63&Be)}else if(1114112>Be){if(0>(Ue-=4))break;He.push(240|Be>>18,128|63&Be>>12,128|63&Be>>6,128|63&Be)}else throw new Error('Invalid code point')}return He}function Re(ke){for(var Ue=[],Be=0;Be<ke.length;++Be)Ue.push(255&ke.charCodeAt(Be));return Ue}function Ae(ke,Ue){for(var He=[],Fe=0,Be,qe,je;Fe<ke.length&&!(0>(Ue-=2));++Fe)Be=ke.charCodeAt(Fe),qe=Be>>8,je=Be%256,He.push(je),He.push(qe);return He}function Me(ke){return Ne.toByteArray(Se(ke))}function we(ke,Ue,Be,qe){for(var je=0;je<qe&&!(je+Be>=Ue.length||je>=ke.length);++je)Ue[je+Be]=ke[je];return je}function xe(ke){return ke!==ke}var Ne=h(137),Pe=h(139),Le=h(140);f.Buffer=M,f.SlowBuffer=function(ke){return+ke!=ke&&(ke=0),M.alloc(+ke)},f.INSPECT_MAX_BYTES=50,M.TYPED_ARRAY_SUPPORT=E.TYPED_ARRAY_SUPPORT===void 0?function(){try{var ke=new Uint8Array(1);return ke.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===ke.foo()&&'function'==typeof ke.subarray&&0===ke.subarray(1,1).byteLength}catch(Ue){return!1}}():E.TYPED_ARRAY_SUPPORT,f.kMaxLength=R(),M.poolSize=8192,M._augment=function(ke){return ke.__proto__=M.prototype,ke},M.from=function(ke,Ue,Be){return N(null,ke,Ue,Be)},M.TYPED_ARRAY_SUPPORT&&(M.prototype.__proto__=Uint8Array.prototype,M.__proto__=Uint8Array,'undefined'!=typeof Symbol&&Symbol.species&&M[Symbol.species]===M&&Object.defineProperty(M,Symbol.species,{value:null,configurable:!0})),M.alloc=function(ke,Ue,Be){return B(null,ke,Ue,Be)},M.allocUnsafe=function(ke){return H(null,ke)},M.allocUnsafeSlow=function(ke){return H(null,ke)},M.isBuffer=function(Ue){return!!(null!=Ue&&Ue._isBuffer)},M.compare=function(Ue,Be){if(!M.isBuffer(Ue)||!M.isBuffer(Be))throw new TypeError('Arguments must be Buffers');if(Ue===Be)return 0;for(var qe=Ue.length,je=Be.length,He=0,Fe=_Mathmin(qe,je);He<Fe;++He)if(Ue[He]!==Be[He]){qe=Ue[He],je=Be[He];break}return qe<je?-1:je<qe?1:0},M.isEncoding=function(Ue){switch((Ue+'').toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'latin1':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return!0;default:return!1;}},M.concat=function(Ue,Be){if(!Le(Ue))throw new TypeError('"list" argument must be an Array of Buffers');if(0===Ue.length)return M.alloc(0);var qe;if(Be===void 0)for(Be=0,qe=0;qe<Ue.length;++qe)Be+=Ue[qe].length;var je=M.allocUnsafe(Be),He=0;for(qe=0;qe<Ue.length;++qe){var Fe=Ue[qe];if(!M.isBuffer(Fe))throw new TypeError('"list" argument must be an Array of Buffers');Fe.copy(je,He),He+=Fe.length}return je},M.byteLength=X,M.prototype._isBuffer=!0,M.prototype.swap16=function(){var Ue=this.length;if(0!=Ue%2)throw new RangeError('Buffer size must be a multiple of 16-bits');for(var Be=0;Be<Ue;Be+=2)Q(this,Be,Be+1);return this},M.prototype.swap32=function(){var Ue=this.length;if(0!=Ue%4)throw new RangeError('Buffer size must be a multiple of 32-bits');for(var Be=0;Be<Ue;Be+=4)Q(this,Be,Be+3),Q(this,Be+1,Be+2);return this},M.prototype.swap64=function(){var Ue=this.length;if(0!=Ue%8)throw new RangeError('Buffer size must be a multiple of 64-bits');for(var Be=0;Be<Ue;Be+=8)Q(this,Be,Be+7),Q(this,Be+1,Be+6),Q(this,Be+2,Be+5),Q(this,Be+3,Be+4);return this},M.prototype.toString=function(){var Ue=0|this.length;return 0==Ue?'':0===arguments.length?le(this,0,Ue):K.apply(this,arguments)},M.prototype.equals=function(Ue){if(!M.isBuffer(Ue))throw new TypeError('Argument must be a Buffer');return this===Ue||0===M.compare(this,Ue)},M.prototype.inspect=function(){var Ue='',Be=f.INSPECT_MAX_BYTES;return 0<this.length&&(Ue=this.toString('hex',0,Be).match(/.{2}/g).join(' '),this.length>Be&&(Ue+=' ... ')),'<Buffer '+Ue+'>'},M.prototype.compare=function(Ue,Be,qe,je,He){if(!M.isBuffer(Ue))throw new TypeError('Argument must be a Buffer');if(void 0===Be&&(Be=0),void 0===qe&&(qe=Ue?Ue.length:0),void 0===je&&(je=0),void 0===He&&(He=this.length),0>Be||qe>Ue.length||0>je||He>this.length)throw new RangeError('out of range index');if(je>=He&&Be>=qe)return 0;if(je>=He)return-1;if(Be>=qe)return 1;if(Be>>>=0,qe>>>=0,je>>>=0,He>>>=0,this===Ue)return 0;for(var Fe=He-je,ze=qe-Be,$e=_Mathmin(Fe,ze),Ve=this.slice(je,He),Ye=Ue.slice(Be,qe),Ge=0;Ge<$e;++Ge)if(Ve[Ge]!==Ye[Ge]){Fe=Ve[Ge],ze=Ye[Ge];break}return Fe<ze?-1:ze<Fe?1:0},M.prototype.includes=function(Ue,Be,qe){return-1!==this.indexOf(Ue,Be,qe)},M.prototype.indexOf=function(Ue,Be,qe){return Z(this,Ue,Be,qe,!0)},M.prototype.lastIndexOf=function(Ue,Be,qe){return Z(this,Ue,Be,qe,!1)},M.prototype.write=function(Ue,Be,qe,je){if(void 0===Be)je='utf8',qe=this.length,Be=0;else if(void 0===qe&&'string'==typeof Be)je=Be,qe=this.length,Be=0;else if(isFinite(Be))Be|=0,isFinite(qe)?(qe|=0,void 0===je&&(je='utf8')):(je=qe,qe=void 0);else throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');var He=this.length-Be;if((void 0===qe||qe>He)&&(qe=He),0<Ue.length&&(0>qe||0>Be)||Be>this.length)throw new RangeError('Attempt to write outside buffer bounds');je||(je='utf8');for(var Fe=!1;;)switch(je){case'hex':return te(this,Ue,Be,qe);case'utf8':case'utf-8':return ne(this,Ue,Be,qe);case'ascii':return se(this,Ue,Be,qe);case'latin1':case'binary':return oe(this,Ue,Be,qe);case'base64':return ae(this,Ue,Be,qe);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return ie(this,Ue,Be,qe);default:if(Fe)throw new TypeError('Unknown encoding: '+je);je=(''+je).toLowerCase(),Fe=!0;}},M.prototype.toJSON=function(){return{type:'Buffer',data:Array.prototype.slice.call(this._arr||this,0)}};var De=4096;M.prototype.slice=function(Ue,Be){var qe=this.length;Ue=~~Ue,Be=Be===void 0?qe:~~Be,0>Ue?(Ue+=qe,0>Ue&&(Ue=0)):Ue>qe&&(Ue=qe),0>Be?(Be+=qe,0>Be&&(Be=0)):Be>qe&&(Be=qe),Be<Ue&&(Be=Ue);var je;if(M.TYPED_ARRAY_SUPPORT)je=this.subarray(Ue,Be),je.__proto__=M.prototype;else{var He=Be-Ue;je=new M(He,void 0);for(var Fe=0;Fe<He;++Fe)je[Fe]=this[Fe+Ue]}return je},M.prototype.readUIntLE=function(Ue,Be,qe){Ue|=0,Be|=0,qe||_e(Ue,Be,this.length);for(var je=this[Ue],He=1,Fe=0;++Fe<Be&&(He*=256);)je+=this[Ue+Fe]*He;return je},M.prototype.readUIntBE=function(Ue,Be,qe){Ue|=0,Be|=0,qe||_e(Ue,Be,this.length);for(var je=this[Ue+--Be],He=1;0<Be&&(He*=256);)je+=this[Ue+--Be]*He;return je},M.prototype.readUInt8=function(Ue,Be){return Be||_e(Ue,1,this.length),this[Ue]},M.prototype.readUInt16LE=function(Ue,Be){return Be||_e(Ue,2,this.length),this[Ue]|this[Ue+1]<<8},M.prototype.readUInt16BE=function(Ue,Be){return Be||_e(Ue,2,this.length),this[Ue]<<8|this[Ue+1]},M.prototype.readUInt32LE=function(Ue,Be){return Be||_e(Ue,4,this.length),(this[Ue]|this[Ue+1]<<8|this[Ue+2]<<16)+16777216*this[Ue+3]},M.prototype.readUInt32BE=function(Ue,Be){return Be||_e(Ue,4,this.length),16777216*this[Ue]+(this[Ue+1]<<16|this[Ue+2]<<8|this[Ue+3])},M.prototype.readIntLE=function(Ue,Be,qe){Ue|=0,Be|=0,qe||_e(Ue,Be,this.length);for(var je=this[Ue],He=1,Fe=0;++Fe<Be&&(He*=256);)je+=this[Ue+Fe]*He;return He*=128,je>=He&&(je-=_Mathpow(2,8*Be)),je},M.prototype.readIntBE=function(Ue,Be,qe){Ue|=0,Be|=0,qe||_e(Ue,Be,this.length);for(var je=Be,He=1,Fe=this[Ue+--je];0<je&&(He*=256);)Fe+=this[Ue+--je]*He;return He*=128,Fe>=He&&(Fe-=_Mathpow(2,8*Be)),Fe},M.prototype.readInt8=function(Ue,Be){return Be||_e(Ue,1,this.length),128&this[Ue]?-1*(255-this[Ue]+1):this[Ue]},M.prototype.readInt16LE=function(Ue,Be){Be||_e(Ue,2,this.length);var qe=this[Ue]|this[Ue+1]<<8;return 32768&qe?4294901760|qe:qe},M.prototype.readInt16BE=function(Ue,Be){Be||_e(Ue,2,this.length);var qe=this[Ue+1]|this[Ue]<<8;return 32768&qe?4294901760|qe:qe},M.prototype.readInt32LE=function(Ue,Be){return Be||_e(Ue,4,this.length),this[Ue]|this[Ue+1]<<8|this[Ue+2]<<16|this[Ue+3]<<24},M.prototype.readInt32BE=function(Ue,Be){return Be||_e(Ue,4,this.length),this[Ue]<<24|this[Ue+1]<<16|this[Ue+2]<<8|this[Ue+3]},M.prototype.readFloatLE=function(Ue,Be){return Be||_e(Ue,4,this.length),Pe.read(this,Ue,!0,23,4)},M.prototype.readFloatBE=function(Ue,Be){return Be||_e(Ue,4,this.length),Pe.read(this,Ue,!1,23,4)},M.prototype.readDoubleLE=function(Ue,Be){return Be||_e(Ue,8,this.length),Pe.read(this,Ue,!0,52,8)},M.prototype.readDoubleBE=function(Ue,Be){return Be||_e(Ue,8,this.length),Pe.read(this,Ue,!1,52,8)},M.prototype.writeUIntLE=function(Ue,Be,qe,je){if(Ue=+Ue,Be|=0,qe|=0,!je){var He=_Mathpow(2,8*qe)-1;fe(this,Ue,Be,qe,He,0)}var Fe=1,ze=0;for(this[Be]=255&Ue;++ze<qe&&(Fe*=256);)this[Be+ze]=255&Ue/Fe;return Be+qe},M.prototype.writeUIntBE=function(Ue,Be,qe,je){if(Ue=+Ue,Be|=0,qe|=0,!je){var He=_Mathpow(2,8*qe)-1;fe(this,Ue,Be,qe,He,0)}var Fe=qe-1,ze=1;for(this[Be+Fe]=255&Ue;0<=--Fe&&(ze*=256);)this[Be+Fe]=255&Ue/ze;return Be+qe},M.prototype.writeUInt8=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,1,255,0),M.TYPED_ARRAY_SUPPORT||(Ue=_Mathfloor(Ue)),this[Be]=255&Ue,Be+1},M.prototype.writeUInt16LE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,2,65535,0),M.TYPED_ARRAY_SUPPORT?(this[Be]=255&Ue,this[Be+1]=Ue>>>8):he(this,Ue,Be,!0),Be+2},M.prototype.writeUInt16BE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,2,65535,0),M.TYPED_ARRAY_SUPPORT?(this[Be]=Ue>>>8,this[Be+1]=255&Ue):he(this,Ue,Be,!1),Be+2},M.prototype.writeUInt32LE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,4,4294967295,0),M.TYPED_ARRAY_SUPPORT?(this[Be+3]=Ue>>>24,this[Be+2]=Ue>>>16,this[Be+1]=Ue>>>8,this[Be]=255&Ue):ye(this,Ue,Be,!0),Be+4},M.prototype.writeUInt32BE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,4,4294967295,0),M.TYPED_ARRAY_SUPPORT?(this[Be]=Ue>>>24,this[Be+1]=Ue>>>16,this[Be+2]=Ue>>>8,this[Be+3]=255&Ue):ye(this,Ue,Be,!1),Be+4},M.prototype.writeIntLE=function(Ue,Be,qe,je){if(Ue=+Ue,Be|=0,!je){var He=_Mathpow(2,8*qe-1);fe(this,Ue,Be,qe,He-1,-He)}var Fe=0,ze=1,$e=0;for(this[Be]=255&Ue;++Fe<qe&&(ze*=256);)0>Ue&&0==$e&&0!==this[Be+Fe-1]&&($e=1),this[Be+Fe]=255&(Ue/ze>>0)-$e;return Be+qe},M.prototype.writeIntBE=function(Ue,Be,qe,je){if(Ue=+Ue,Be|=0,!je){var He=_Mathpow(2,8*qe-1);fe(this,Ue,Be,qe,He-1,-He)}var Fe=qe-1,ze=1,$e=0;for(this[Be+Fe]=255&Ue;0<=--Fe&&(ze*=256);)0>Ue&&0==$e&&0!==this[Be+Fe+1]&&($e=1),this[Be+Fe]=255&(Ue/ze>>0)-$e;return Be+qe},M.prototype.writeInt8=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,1,127,-128),M.TYPED_ARRAY_SUPPORT||(Ue=_Mathfloor(Ue)),0>Ue&&(Ue=255+Ue+1),this[Be]=255&Ue,Be+1},M.prototype.writeInt16LE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,2,32767,-32768),M.TYPED_ARRAY_SUPPORT?(this[Be]=255&Ue,this[Be+1]=Ue>>>8):he(this,Ue,Be,!0),Be+2},M.prototype.writeInt16BE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,2,32767,-32768),M.TYPED_ARRAY_SUPPORT?(this[Be]=Ue>>>8,this[Be+1]=255&Ue):he(this,Ue,Be,!1),Be+2},M.prototype.writeInt32LE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,4,2147483647,-2147483648),M.TYPED_ARRAY_SUPPORT?(this[Be]=255&Ue,this[Be+1]=Ue>>>8,this[Be+2]=Ue>>>16,this[Be+3]=Ue>>>24):ye(this,Ue,Be,!0),Be+4},M.prototype.writeInt32BE=function(Ue,Be,qe){return Ue=+Ue,Be|=0,qe||fe(this,Ue,Be,4,2147483647,-2147483648),0>Ue&&(Ue=4294967295+Ue+1),M.TYPED_ARRAY_SUPPORT?(this[Be]=Ue>>>24,this[Be+1]=Ue>>>16,this[Be+2]=Ue>>>8,this[Be+3]=255&Ue):ye(this,Ue,Be,!1),Be+4},M.prototype.writeFloatLE=function(Ue,Be,qe){return Te(this,Ue,Be,!0,qe)},M.prototype.writeFloatBE=function(Ue,Be,qe){return Te(this,Ue,Be,!1,qe)},M.prototype.writeDoubleLE=function(Ue,Be,qe){return ve(this,Ue,Be,!0,qe)},M.prototype.writeDoubleBE=function(Ue,Be,qe){return ve(this,Ue,Be,!1,qe)},M.prototype.copy=function(Ue,Be,qe,je){if(qe||(qe=0),je||0===je||(je=this.length),Be>=Ue.length&&(Be=Ue.length),Be||(Be=0),0<je&&je<qe&&(je=qe),je===qe)return 0;if(0===Ue.length||0===this.length)return 0;if(0>Be)throw new RangeError('targetStart out of bounds');if(0>qe||qe>=this.length)throw new RangeError('sourceStart out of bounds');if(0>je)throw new RangeError('sourceEnd out of bounds');je>this.length&&(je=this.length),Ue.length-Be<je-qe&&(je=Ue.length-Be+qe);var He=je-qe,Fe;if(this===Ue&&qe<Be&&Be<je)for(Fe=He-1;0<=Fe;--Fe)Ue[Fe+Be]=this[Fe+qe];else if(1e3>He||!M.TYPED_ARRAY_SUPPORT)for(Fe=0;Fe<He;++Fe)Ue[Fe+Be]=this[Fe+qe];else Uint8Array.prototype.set.call(Ue,this.subarray(qe,qe+He),Be);return He},M.prototype.fill=function(Ue,Be,qe,je){if('string'==typeof Ue){if('string'==typeof Be?(je=Be,Be=0,qe=this.length):'string'==typeof qe&&(je=qe,qe=this.length),1===Ue.length){var He=Ue.charCodeAt(0);256>He&&(Ue=He)}if(void 0!==je&&'string'!=typeof je)throw new TypeError('encoding must be a string');if('string'==typeof je&&!M.isEncoding(je))throw new TypeError('Unknown encoding: '+je)}else'number'==typeof Ue&&(Ue&=255);if(0>Be||this.length<Be||this.length<qe)throw new RangeError('Out of range index');if(qe<=Be)return this;Be>>>=0,qe=qe===void 0?this.length:qe>>>0,Ue||(Ue=0);var Fe;if('number'==typeof Ue)for(Fe=Be;Fe<qe;++Fe)this[Fe]=Ue;else{var ze=M.isBuffer(Ue)?Ue:Ie(new M(Ue,je).toString()),$e=ze.length;for(Fe=0;Fe<qe-Be;++Fe)this[Fe+Be]=ze[Fe%$e]}return this};var Oe=/[^+\/0-9A-Za-z-_]/g}).call(f,h(39))},function(u,f){f.read=function(h,E,I,R,A){var M,N,D=8*A-R-1,B=(1<<D)-1,H=B>>1,z=-7,$=I?A-1:0,Y=I?-1:1,G=h[E+$];for($+=Y,M=G&(1<<-z)-1,G>>=-z,z+=D;0<z;M=256*M+h[E+$],$+=Y,z-=8);for(N=M&(1<<-z)-1,M>>=-z,z+=R;0<z;N=256*N+h[E+$],$+=Y,z-=8);if(0===M)M=1-H;else{if(M===B)return N?NaN:(G?-1:1)*Infinity;N+=_Mathpow(2,R),M-=H}return(G?-1:1)*N*_Mathpow(2,M-R)},f.write=function(h,E,I,R,A,M){var N,D,B,H=8*M-A-1,z=(1<<H)-1,$=z>>1,Y=23===A?5.960464477539063e-8-6.617444900424222e-24:0,G=R?0:M-1,J=R?1:-1,W=0>E||0===E&&0>1/E?1:0;for(E=_Mathabs(E),isNaN(E)||E===Infinity?(D=isNaN(E)?1:0,N=z):(N=_Mathfloor(_Mathlog(E)/Math.LN2),1>E*(B=_Mathpow(2,-N))&&(N--,B*=2),E+=1<=N+$?Y/B:Y*_Mathpow(2,1-$),2<=E*B&&(N++,B/=2),N+$>=z?(D=0,N=z):1<=N+$?(D=(E*B-1)*_Mathpow(2,A),N+=$):(D=E*_Mathpow(2,$-1)*_Mathpow(2,A),N=0));8<=A;h[I+G]=255&D,G+=J,D/=256,A-=8);for(N=N<<A|D,H+=A;0<H;h[I+G]=255&N,G+=J,N/=256,H-=8);h[I+G-J]|=128*W}},function(u){var h={}.toString;u.exports=Array.isArray||function(E){return'[object Array]'==h.call(E)}},function(u){function h(){throw new Error('setTimeout has not been defined')}function E(){throw new Error('clearTimeout has not been defined')}function I(W){if(H===setTimeout)return setTimeout(W,0);if((H===h||!H)&&setTimeout)return H=setTimeout,setTimeout(W,0);try{return H(W,0)}catch(X){try{return H.call(null,W,0)}catch(K){return H.call(this,W,0)}}}function R(W){if(z===clearTimeout)return clearTimeout(W);if((z===E||!z)&&clearTimeout)return z=clearTimeout,clearTimeout(W);try{return z(W)}catch(X){try{return z.call(null,W)}catch(K){return z.call(this,W)}}}function A(){Y&&G&&(Y=!1,G.length?$=G.concat($):J=-1,$.length&&M())}function M(){if(!Y){var W=I(A);Y=!0;for(var X=$.length;X;){for(G=$,$=[];++J<X;)G&&G[J].run();J=-1,X=$.length}G=null,Y=!1,R(W)}}function N(W,X){this.fun=W,this.array=X}function D(){}var B=u.exports={},H,z;(function(){try{H='function'==typeof setTimeout?setTimeout:h}catch(W){H=h}try{z='function'==typeof clearTimeout?clearTimeout:E}catch(W){z=E}})();var $=[],Y=!1,G,J=-1;B.nextTick=function(W){var X=Array(arguments.length-1);if(1<arguments.length)for(var K=1;K<arguments.length;K++)X[K-1]=arguments[K];$.push(new N(W,X)),1!==$.length||Y||I(M)},N.prototype.run=function(){this.fun.apply(null,this.array)},B.title='browser',B.browser=!0,B.env={},B.argv=[],B.version='',B.versions={},B.on=D,B.addListener=D,B.once=D,B.off=D,B.removeListener=D,B.removeAllListeners=D,B.emit=D,B.prependListener=D,B.prependOnceListener=D,B.listeners=function(){return[]},B.binding=function(){throw new Error('process.binding is not supported')},B.cwd=function(){return'/'},B.chdir=function(){throw new Error('process.chdir is not supported')},B.umask=function(){return 0}},function(u,f){(function(h){u.exports=h}).call(f,{})},function(u){u.exports=moment},function(){},function(u,f,h){h(2),h(5),h(49),h(40),h(41),h(21),h(42),h(16),h(24),h(43),h(44),h(45),h(17),h(46),h(47),h(25),u.exports=h(48)}]);